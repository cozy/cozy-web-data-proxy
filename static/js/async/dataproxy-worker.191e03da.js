(()=>{"use strict";var e={75848:function(e,t,r){let o,n;var i=r("64271"),s=r("16396"),a=r.n(s),c=r("74450"),u=r.n(c),l=r("70999");let d="io.cozy.files",f="io.cozy.contacts",p="io.cozy.apps",y="io.cozy.accounts&",g="io.cozy.konnectors",m="io.cozy.triggers",v="io.cozy.settings";u()("\uD83D\uDC77‍♂️ [Worker utils]");let h=async e=>{var t,r;let o=await e.getStackClient().fetchJSON("GET","/settings/sessions/current");return!!(null==o?void 0:null===(r=o.data)||void 0===r?void 0:null===(t=r.attributes)||void 0===t?void 0:t.long_run)};var b=r("29040"),w=r("57198"),k=r("36742");let S="sharedWorkerStorage",x=null;w.Z.plugin(k.Z),w.Z.plugin(b.Z);let j=()=>new Promise((e,t)=>{if(x)return e(x);let r=indexedDB.open(S,1);r.onupgradeneeded=e=>{!(x=e.target.result).objectStoreNames.contains("store")&&x.createObjectStore("store",{keyPath:"key"})},r.onsuccess=t=>{e(x=t.target.result)},r.onerror=e=>{t(e.target.error)}}),z=async()=>self.navigator.onLine,O={storage:{getItem:async e=>{let t=await j();return new Promise((r,o)=>{let n=t.transaction("store","readonly").objectStore("store").get(e);n.onsuccess=()=>{r(n.result?n.result.value:null)},n.onerror=()=>{o(n.error)}})},setItem:async(e,t)=>{let r=await j();return new Promise((o,n)=>{let i=r.transaction("store","readwrite").objectStore("store").put({key:e,value:t});i.onsuccess=()=>{o()},i.onerror=()=>{n(i.error)}})},removeItem:async e=>{let t=await j();return new Promise((r,o)=>{let n=t.transaction("store","readwrite").objectStore("store").delete(e);n.onsuccess=()=>{r()},n.onerror=()=>{o(n.error)}})},destroy:async()=>new Promise((e,t)=>{x&&(x.close(),x=null);let r=indexedDB.deleteDatabase(S);r.onsuccess=()=>{e()},r.onerror=()=>{t(r.error)}})},events:{addEventListener:(e,t)=>{self.addEventListener(e,t)},removeEventListener:(e,t)=>{self.removeEventListener(e,t)}},pouchAdapter:w.Z,isOnline:z},C={files:{doctype:"io.cozy.files"},contacts:{doctype:"io.cozy.contacts"},apps:{doctype:"io.cozy.apps"}},P=e=>e&&e.links.find(e=>e instanceof l.default)||null,R=u()("\uD83D\uDC77‍♂️ [shared-worker]");u().enable();let _=new BroadcastChannel("DATA_PROXY_BROADCAST_CHANANEL"),E={setup:async e=>{if(R.debug("Received data for setting up client"),n)return;L();let t={doctypes:[d,f,p,y,m,g,v],initialSync:!0,periodicSync:!1,syncDebounceDelayInMs:5e3,syncDebounceMaxDelayInMs:6e5,platform:{...O},pouch:{options:{adapter:"indexeddb"}},doctypesReplicationOptions:{[d]:{strategy:"fromRemote"},[f]:{strategy:"fromRemote"},[p]:{strategy:"fromRemote"},[y]:{strategy:"fromRemote"},[g]:{strategy:"fromRemote"},[m]:{strategy:"fromRemote"},[v]:{strategy:"fromRemote"}}};n=new(a())({uri:e.uri,token:e.token,appMetadata:{slug:"cozy-data-proxy",version:"1"},schema:C,disableStoreForQueries:!0});let r=await h(n)?[new l.default(t),new s.StackLink]:[new s.StackLink];await n.setLinks(r),console.log("setup links is done"),n.instanceOptions=e.instanceOptions,n.capabilities=e.capabilities,R.debug("Setup done"),L()},search:(e,t)=>{if(!n)throw Error("Client is required to execute a search, please initialize CozyClient");if(!o)throw Error("SearchEngine is not initialized");let r=performance.now(),i=o.search(e,t),s=performance.now();return R.debug(`Search took ${s-r} ms`),i},requestLink:async(e,t)=>{if(!n)throw Error("Client is required to request, please initialize CozyClient");if(e.mutationType)return n.requestMutation(e,t);console.log("go request query from dp web");let r=performance.now(),o=await n.requestQuery(e,t),i=performance.now();return console.log(`[SharedWorker] Request took ${i-r} ms`),o},forceSyncPouch:()=>{if(!n)throw Error("Client is required to execute a forceSyncPouch, please initialize CozyClient");let e=P(n);e&&e.startReplication()}},L=()=>{let e={};if(n&&o&&o.searchIndexes){e.status="Ready",e.indexLength=Object.entries(o.searchIndexes).map(e=>{let[t,r]=e;return{doctype:t,count:Object.keys(r.index.store).length}}),_.postMessage(e);return}if(n){e.status="Client set",_.postMessage(e);return}e.status="Waiting configuration",_.postMessage(e)};onconnect=e=>{let t=e.ports[0];console.log("exposed com link onconnect"),i.Jj(E,t),L()}},47936:function(){},18925:function(){}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.m=e,r.x=()=>{var e=r.O(void 0,["465","361","717","490"],function(){return r("75848")});return e=r.O(e)},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce(function(t,o){return r.f[o](e,t),t},[]))},r.u=function(e){return"490"===e?"static/js/async/490.222c7df5.js":"static/js/"+(({361:"lib-react",465:"cozy"})[e]||e)+"."+({361:"6a191116",465:"3c3af7d8",717:"62b7a877"})[e]+".js"},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=function(e){return e.paths=[],!e.children&&(e.children=[]),e},(()=>{var e=[];r.O=function(t,o,n,i){if(o){i=i||0;for(var s=e.length;s>0&&e[s-1][2]>i;s--)e[s]=e[s-1];e[s]=[o,n,i];return}for(var a=1/0,s=0;s<e.length;s++){for(var o=e[s][0],n=e[s][1],i=e[s][2],c=!0,u=0;u<o.length;u++)(!1&i||a>=i)&&Object.keys(r.O).every(function(e){return r.O[e](o[u])})?o.splice(u--,1):(c=!1,i<a&&(a=i));if(c){e.splice(s--,1);var l=n();void 0!==l&&(t=l)}}return t}})(),r.p="/",r.rv=function(){return"1.0.8"},r.j="168",(()=>{var e=r.x;r.x=function(){return Promise.all(["465","361","717","490"].map(r.e,r)).then(e)}})(),(()=>{var e={168:1};r.f.i=function(t,o){!e[t]&&importScripts(r.p+r.u(t))};var t=self.webpackChunkcozy_web_data_proxy=self.webpackChunkcozy_web_data_proxy||[],o=t.push.bind(t);t.push=function(t){var n=t[0],i=t[1],s=t[2];for(var a in i)r.o(i,a)&&(r.m[a]=i[a]);for(s&&s(r);n.length;)e[n.pop()]=1;o(t)}})(),r.ruid="bundler=rspack@1.0.8",r.x()})();