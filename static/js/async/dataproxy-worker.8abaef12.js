(()=>{"use strict";var e={53431:function(e,t,r){let n,o;var i=r("64271"),a=r("16396"),s=r.n(a),c=r("28802"),l=r("71400"),u=r("74450"),d=r.n(u),f=r("70999");let p="io.cozy.files",y="io.cozy.contacts",g="io.cozy.apps",v="io.cozy.accounts",m="io.cozy.konnectors",b="io.cozy.triggers",h="io.cozy.settings";d()("\uD83D\uDC77‍♂️ [Worker utils]");let w=async e=>{var t,r;let n=await e.getStackClient().fetchJSON("GET","/settings/sessions/current");return!!(null==n?void 0:null===(r=n.data)||void 0===r?void 0:null===(t=r.attributes)||void 0===t?void 0:t.long_run)};var S=r("29040"),k=r("57198"),x=r("36742");let O="sharedWorkerStorage",z=null;k.Z.plugin(x.Z),k.Z.plugin(S.Z);let j=()=>new Promise((e,t)=>{if(z)return e(z);let r=indexedDB.open(O,1);r.onupgradeneeded=e=>{!(z=e.target.result).objectStoreNames.contains("store")&&z.createObjectStore("store",{keyPath:"key"})},r.onsuccess=t=>{e(z=t.target.result)},r.onerror=e=>{t(e.target.error)}}),P={getItem:async e=>{let t=await j();return new Promise((r,n)=>{let o=t.transaction("store","readonly").objectStore("store").get(e);o.onsuccess=()=>{r(o.result?o.result.value:null)},o.onerror=()=>{n(o.error)}})},setItem:async(e,t)=>{let r=await j();return new Promise((n,o)=>{let i=r.transaction("store","readwrite").objectStore("store").put({key:e,value:t});i.onsuccess=()=>{n()},i.onerror=()=>{o(i.error)}})},removeItem:async e=>{let t=await j();return new Promise((r,n)=>{let o=t.transaction("store","readwrite").objectStore("store").delete(e);o.onsuccess=()=>{r()},o.onerror=()=>{n(o.error)}})},destroy:async()=>new Promise((e,t)=>{z&&(z.close(),z=null);let r=indexedDB.deleteDatabase(O);r.onsuccess=()=>{e()},r.onerror=()=>{t(r.error)}})},C={storeData:async(e,t)=>P.setItem(e,t),getData:async e=>{let t=P.getItem(e);return t||null}},D=async()=>self.navigator.onLine,R={storage:P,events:{addEventListener:(e,t)=>{self.addEventListener(e,t)},removeEventListener:(e,t)=>{self.removeEventListener(e,t)}},pouchAdapter:k.Z,isOnline:D},_={files:{doctype:"io.cozy.files"},contacts:{doctype:"io.cozy.contacts"},apps:{doctype:"io.cozy.apps"}},E=e=>e&&e.links.find(e=>e instanceof f.default)||null,L=d()("\uD83D\uDC77‍♂️ [DataProxy worker]");d().enable();let M=new BroadcastChannel("DATA_PROXY_BROADCAST_CHANANEL"),I={setup:async e=>{var t;if(L.debug("Received data for setting up client"),o)return;T();let r={doctypes:[p,y,g,v,b,m,h],readOnly:!0,initialSync:!0,periodicSync:!1,syncDebounceDelayInMs:3e4,syncDebounceMaxDelayInMs:6e5,platform:{...R},pouch:{options:{adapter:"indexeddb"}},doctypesReplicationOptions:{[p]:{strategy:"fromRemote"},[y]:{strategy:"fromRemote"},[g]:{strategy:"fromRemote"},[v]:{strategy:"fromRemote"},[m]:{strategy:"fromRemote"},[b]:{strategy:"fromRemote"},[h]:{strategy:"fromRemote"}}};o=new(s())({uri:e.uri,token:e.token,appMetadata:{slug:"cozy-data-proxy",version:"1"},schema:_,disableStoreForQueries:!0});let i=await w(o)&&!e.useRemoteData?[new f.default(r),new a.StackLink]:[new a.StackLink];await o.setLinks(i),o.instanceOptions=e.instanceOptions,o.capabilities=e.capabilities,o.registerPlugin(l.default.plugin),l.default.enable(null===(t=e.instanceOptions)||void 0===t?void 0:t.flags),n=new c.SearchEngine(o,C),L.debug("Setup done"),T()},search:(e,t)=>{if(!o)throw Error("Client is required to execute a search, please initialize CozyClient");if(!n)throw Error("SearchEngine is not initialized");let r=performance.now(),i=n.search(e,t),a=performance.now();return L.debug(`Search took ${a-r} ms`),i},requestLink:async(e,t)=>{if(!o)throw Error("Client is required to request, please initialize CozyClient");return e.mutationType?o.requestMutation(e,t):await o.requestQuery(e,t)},forceSyncPouch:()=>{if(!o)throw Error("Client is required to execute a forceSyncPouch, please initialize CozyClient");let e=E(o);e&&e.startReplication()},reconnectRealtime:()=>{var e;let t=null==o?void 0:null===(e=o.plugins)||void 0===e?void 0:e.realtime;t&&(t.reconnect(),I.forceSyncPouch(),n.init())}},T=()=>{let e={};if(o&&n&&n.searchIndexes){e.status="Ready",e.indexLength=Object.entries(n.searchIndexes).map(e=>{let[t,r]=e;return{doctype:t,count:Object.keys(r.index.store).length}}),M.postMessage(e);return}if(o){e.status="Client set",M.postMessage(e);return}e.status="Waiting configuration",M.postMessage(e)};if("undefined"!=typeof SharedWorkerGlobalScope&&self instanceof SharedWorkerGlobalScope)onconnect=e=>{let t=e.ports[0];i.expose(I,t),T()};else if("undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope)i.expose(I);else throw Error("Worker context not available.")},17770:function(){},47936:function(){},18925:function(){}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.m=e,r.x=()=>{var e=r.O(void 0,["465","361","717","855"],function(){return r("53431")});return e=r.O(e)},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce(function(t,n){return r.f[n](e,t),t},[]))},r.u=function(e){return"855"===e?"static/js/async/855.b7f8f039.js":"static/js/"+(({361:"lib-react",465:"cozy"})[e]||e)+"."+({361:"6a191116",465:"b784d768",717:"1089ac46"})[e]+".js"},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=function(e){return e.paths=[],!e.children&&(e.children=[]),e},(()=>{var e=[];r.O=function(t,n,o,i){if(n){i=i||0;for(var a=e.length;a>0&&e[a-1][2]>i;a--)e[a]=e[a-1];e[a]=[n,o,i];return}for(var s=1/0,a=0;a<e.length;a++){for(var n=e[a][0],o=e[a][1],i=e[a][2],c=!0,l=0;l<n.length;l++)(!1&i||s>=i)&&Object.keys(r.O).every(function(e){return r.O[e](n[l])})?n.splice(l--,1):(c=!1,i<s&&(s=i));if(c){e.splice(a--,1);var u=o();void 0!==u&&(t=u)}}return t}})(),r.p="/",r.rv=function(){return"1.0.8"},r.j="168",(()=>{var e=r.x;r.x=function(){return Promise.all(["465","361","717","855"].map(r.e,r)).then(e)}})(),(()=>{var e={168:1};r.f.i=function(t,n){!e[t]&&importScripts(r.p+r.u(t))};var t=self.webpackChunkcozy_web_data_proxy=self.webpackChunkcozy_web_data_proxy||[],n=t.push.bind(t);t.push=function(t){var o=t[0],i=t[1],a=t[2];for(var s in i)r.o(i,s)&&(r.m[s]=i[s]);for(a&&a(r);o.length;)e[o.pop()]=1;n(t)}})(),r.ruid="bundler=rspack@1.0.8",r.x()})();