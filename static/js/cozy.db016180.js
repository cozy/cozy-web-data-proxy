/*! For license information please see cozy.db016180.js.LICENSE.txt */
"use strict";(self.webpackChunkcozy_web_data_proxy=self.webpackChunkcozy_web_data_proxy||[]).push([["465"],{18621:function(e,t,n){var r=n(34155),a=n(14746),i=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n(54765)),u=i(n(90402)),c=i(n(98235)),s=i(n(80295)),l=i(n(68434)),d=i(n(82007)),f=i(n(65105)),p=i(n(19723)),h=i(n(64512)),y=i(n(66604)),v=i(n(17204)),m=i(n(85564)),b=i(n(45578)),g=i(n(4788)),k=i(n(84486)),_=i(n(27361)),O=i(n(37203)),w=a(n(60359)),S=n(87941),x=i(n(97619)),E=n(25367),P=n(11282),C=n(72004),D=n(71450),j=n(18118),A=i(n(20057)),T=a(n(65972)),R=i(n(39268)),I=i(n(42189)),M=n(37130),N=i(n(31344)),F=n(325),L=i(n(22853)),B=n(76305),z=i(n(67266)),U=i(n(25888)),q=n(23864);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach(function(t){(0,h.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function H(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return J(e,t)}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Y=function(e){return{get:function(t,n){return L.default.warn(e),t[n]}}},W=function(e){var t;if(e&&"undefined"!=typeof window&&null!==(t=window.cozy)&&void 0!==t&&t.isSecureProtocol){var n,r=new URL(e);return r.protocol="https:",(n=r.toString()).endsWith("/")?n.slice(0,-1):n}return e},K="creation",V="update",$=function(){var e,t,n,a,i,O,R,G,J,$,Z,X,ee,et,en,er,ea,ei,eo,eu,ec,es,el;function ed(){var e,t,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,f.default)(this,ed),(0,h.default)(this,"fetchQueryAndGetFromState",(e=(0,d.default)(l.default.mark(function e(t){var r,a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.definition,a=t.options,e.prev=1,e.next=4,n.query(r,a);case 4:return e.abrupt("return",n.getQueryFromState(a.as,a));case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:case"end":return e.stop()}},e,null,[[1,7]])})),function(t){return e.apply(this,arguments)}));var a=r.link,i=r.links,o=r.schema,u=r.appMetadata,c=r.capabilities,p=(0,s.default)(r,["link","links","schema","appMetadata","capabilities"]);a&&L.default.warn("`link` is deprecated, use `links`"),this.appMetadata=void 0===u?{}:u,this.loginPromise=null,p.uri=W(p.uri),this.options=p,this.queryIdGenerator=new B.QueryIDGenerator,this.isLogged=!1,this.instanceOptions={},this.handleRevocationChange=this.handleRevocationChange.bind(this),this.handleTokenRefresh=this.handleTokenRefresh.bind(this),this.createClient();var y=this.getStackClient();if(y.on("error",function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.emit.apply(n,["error"].concat(t))}),this.setLinks(Array.isArray(t=a||i||new x.default)?t:[t]),this.schema=new I.default(void 0===o?{}:o,y),this.capabilities=c||null,this.plugins={},!(this.stackClient instanceof w.OAuthClient))try{this.loadInstanceOptionsFromDOM()}catch(e){}this._promiseCache=new U.default,p.uri&&p.token&&this.login(),this.storeAccesors=null,!1!==p.store&&this.ensureStore()}return(0,p.default)(ed,[{key:"emit",value:function(){}},{key:"on",value:function(){}},{key:"removeListener",value:function(){}},{key:"registerPlugin",value:function(e,t){if(!e.pluginName)throw Error("Cannot register a plugin whose class does not have `pluginName` attribute.");if(this.plugins[e.pluginName])throw Error("Cannot register plugin ".concat(e.pluginName,". A plugin with the same name has already been registered."));var n=new e(this,t);return this.plugins[e.pluginName]=n,n}},{key:"addSchema",value:function(e){this.schema.add(e)}},{key:"registerClientOnLinks",value:function(){var e,t=H(this.links);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.registerClient)try{n.registerClient(this)}catch(e){L.default.warn(e)}}}catch(e){t.e(e)}finally{t.f()}}},{key:"login",value:function(e){return this.isLogged&&!this.isRevoked?(L.default.warn("CozyClient is already logged."),this.loginPromise):this.loginPromise=this._login(e)}},{key:"_login",value:(e=(0,d.default)(l.default.mark(function e(t){var n,r,a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.emit("beforeLogin"),this.registerClientOnLinks(),t&&(t.uri&&this.stackClient.setUri(t.uri),t.token&&this.stackClient.setToken(t.token)),n=H(this.links),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=13;break}if(!(a=r.value).onLogin){e.next=11;break}return e.next=11,a.onLogin();case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:if(this.isLogged=!0,this.isRevoked=!1,!(this.stackClient instanceof w.OAuthClient)){e.next=26;break}return e.next=26,this.loadInstanceOptionsFromStack();case 26:this.emit("login");case 27:case"end":return e.stop()}},e,this,[[4,15,18,21]])})),function(t){return e.apply(this,arguments)})},{key:"logout",value:(t=(0,d.default)(l.default.mark(function e(){var t,n,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLogged){e.next=3;break}return L.default.warn("CozyClient isn't logged."),e.abrupt("return");case 3:if(this.emit("beforeLogout"),this.isLogged=!1,!(this.stackClient instanceof w.OAuthClient)){e.next=17;break}if(e.prev=6,!(this.stackClient.unregister&&(!this.stackClient.isRegistered||this.stackClient.isRegistered()))){e.next=10;break}return e.next=10,this.stackClient.unregister();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),L.default.warn("Impossible to unregister client on stack: ".concat(e.t0));case 15:case 20:e.next=25;break;case 17:return e.prev=17,e.next=20,this.stackClient.fetch("DELETE","/auth/login");case 22:e.prev=22,e.t1=e.catch(17),L.default.warn("Impossible to log out: ".concat(e.t1));case 25:t=H(this.links),e.prev=26,t.s();case 28:if((n=t.n()).done){e.next=41;break}if(!(r=n.value).reset){e.next=39;break}return e.prev=31,e.next=34,r.reset();case 34:e.next=39;break;case 36:e.prev=36,e.t2=e.catch(31),L.default.warn(e.t2);case 39:e.next=28;break;case 41:e.next=46;break;case 43:e.prev=43,e.t3=e.catch(26),t.e(e.t3);case 46:return e.prev=46,t.f(),e.finish(46);case 49:this.store&&this.dispatch((0,T.resetState)()),this.emit("logout");case 51:case"end":return e.stop()}},e,this,[[6,12],[17,22],[26,43,46,49],[31,36]])})),function(){return t.apply(this,arguments)})},{key:"collection",value:function(e){return this.getStackClient().collection(e)}},{key:"fetch",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.getStackClient().fetch(e,t,n,r)}},{key:"all",value:function(e){return L.default.warn("\nclient.all is deprecated, prefer to use the Q helper to build a new QueryDefinition.\n\nimport { Q } from 'cozy-client'\nclient.query(Q('io.cozy.bills'))"),(0,D.Q)(e)}},{key:"find",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return L.default.warn("client.find(doctype, selector) is deprecated, please use Q(doctype).where(selector) to build the same query."),new D.QueryDefinition({doctype:e,selector:t})}},{key:"get",value:function(e,t){return L.default.warn("client.get(".concat(e,", id) is deprecated, please use Q(").concat(e,").getById(id) to build the same query.")),new D.QueryDefinition({doctype:e,id:t})}},{key:"create",value:(n=(0,d.default)(l.default.mark(function e(t,n,r){var a,i,o,u=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:{},n._type,o=Q({_type:t},(0,s.default)(n,["_type"])),e.next=5,this.schema.validate(o);case 5:if(!(!0!==e.sent)){e.next=8;break}throw Error("Validation failed");case 8:return e.abrupt("return",this.mutate(this.getDocumentSavePlan(o,r),a));case 9:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"validate",value:function(e){return this.schema.validate(e)}},{key:"save",value:(a=(0,d.default)(l.default.mark(function e(t){var n,r,a,i,o=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:{},r=t._type,a=(0,s.default)(t,["_type"]),r){e.next=4;break}throw Error("The document must have a `_type` property");case 4:return i=Q({_type:r},a),e.next=7,this.schema.validate(i);case 7:if(!(!0!==e.sent)){e.next=10;break}throw Error("Validation failed");case 10:return e.abrupt("return",this.mutate(this.getDocumentSavePlan(i),n));case 11:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"saveAll",value:(i=(0,d.default)(l.default.mark(function e(t){var n=this,r,a,i,o,u=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:{},!(1!==Array.from(new Set(t.map(function(e){return e._type}))).length)){e.next=4;break}throw Error("saveAll can only save documents with the same doctype");case 4:return e.next=6,Promise.all(t.map(function(e){return n.schema.validate(e)}));case 6:if(!((a=e.sent.filter(function(e){return!0!==e})).length>0)){e.next=11;break}throw L.default.warn("There has been some validation errors while bulk saving",a),Error("Validation failed for at least one doc");case 11:return i=t.map(function(e){return n.prepareDocumentForSave(e)}),o=D.Mutations.updateDocuments(i),e.abrupt("return",this.mutate(o,r));case 14:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"ensureCozyMetadata",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{event:K};if(void 0===this.appMetadata)return e;if(e._type){var r=this.schema.getDoctypeSchema(e._type);t=(0,_.default)(r,"doctypeVersion")}var a=this.appMetadata,i=a.slug,o=a.sourceAccount,u=a.sourceAccountIdentifier,s=a.version,l=new Date().toISOString(),d=(0,_.default)(e,"cozyMetadata",{});return n.event===K?d=Q({metadataVersion:1,doctypeVersion:t,createdByApp:i,sourceAccount:o,sourceAccountIdentifier:u,createdAt:l,createdByAppVersion:s,updatedAt:l,updatedByApps:i?[{date:l,slug:i,version:s}]:[]},d):n.event===V&&(d=Q(Q({},d),{},{updatedAt:l,updatedByApps:[{date:l,slug:i,version:s}].concat((0,c.default)((0,_.default)(e,"cozyMetadata.updatedByApps",[]).filter(function(e){return e.slug!==i})))})),Q(Q({},e),{},{cozyMetadata:d})}},{key:"prepareDocumentForSave",value:function(e){var t=!e._rev;return this.ensureCozyMetadata((0,C.dehydrate)(e),{event:t?K:V})}},{key:"getDocumentSavePlan",value:function(e,t){var n=this,r=!e._rev,a=this.prepareDocumentForSave(e),i=r?D.Mutations.createDocument(a):D.Mutations.updateDocument(a);if(!(t&&Object.values(t).filter(function(e){return Array.isArray(e)?e.length>0:e}).length>0))return i;for(var o=0,c=Object.keys(t);o<c.length;o++){var s,l,d=c[o],f=e._type,p=this.schema.getRelationship(f,d);if(!((s=p.type).prototype.addReferences&&s.prototype.removeReferences)){;throw l=p.name,Error('The "'.concat(l,'" relationship does not support references. If you need to add references to a document, its relationship class must have the methods {add,remove}References'))}}if(t&&!r)throw Error("Unable to save external relationships on a not-new document");return[i,function(e){var r=n.hydrateDocument(e.data);return Object.entries(t).map(function(e){var t=(0,u.default)(e,2),n=t[0],a=t[1];return r[n].addReferences(a)})}]}},{key:"triggerHook",value:function(e,t){if(ed.hooks){var n,r=H((ed.hooks[t._type]||{})[e]||[]);try{for(r.s();!(n=r.n()).done;)(0,n.value)(this,t)}catch(e){r.e(e)}finally{r.f()}}}},{key:"destroy",value:(O=(0,d.default)(l.default.mark(function e(t){var n,r,a=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.triggerHook("before:destroy",t);case 3:return e.next=5,this.mutate(D.Mutations.deleteDocument(t),n);case 5:return r=e.sent,e.next=8,this.triggerHook("after:destroy",t);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)})),function(e){return O.apply(this,arguments)})},{key:"upload",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.mutate(D.Mutations.uploadFile(e,t),n)}},{key:"ensureQueryExists",value:function(e,t,n){this.ensureStore(),("loaded"!==(0,T.getQueryFromState)(this.store.getState(),e).fetchStatus||!t.skip&&!t.bookmark)&&this.dispatch((0,T.initQuery)(e,t,n))}},{key:"query",value:(R=(0,d.default)(l.default.mark(function e(t){var n=this,r,a,i,o,u,c,d,f,p,h=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(r=h.length>1&&void 0!==h[1]?h[1]:{}).update,i=r.executeFromStore,o=(0,s.default)(r,["update","executeFromStore"]),this.ensureStore(),u=o.as||this.queryIdGenerator.generateId(t),c=this.getQueryFromState(u,o),!(void 0!==o.enabled)||!("boolean"!=typeof o.enabled)){e.next=8;break}throw Error("option.enabled should be a boolean for this query: ".concat(JSON.stringify(t)));case 8:if(!o.fetchPolicy){e.next=14;break}if(o.as){e.next=11;break}throw Error("Cannot use `fetchPolicy` without naming the query, please use `as` to name the query");case 11:if(o.fetchPolicy(c)){e.next=14;break}return e.abrupt("return");case 14:if(!(c&&Object.keys(c).length>0)||"loading"!==c.fetchStatus){e.next=17;break}return e.abrupt("return",this._promiseCache.get(function(){return(0,z.default)(t)}));case 17:return this.ensureQueryExists(u,t,o),e.prev=18,d=void 0!==o.backgroundFetching?o.backgroundFetching:this.options.backgroundFetching,this.dispatch((0,T.loadQuery)(u,{backgroundFetching:d})),f=i?function(){return Promise.resolve((0,T.executeQueryFromState)(n.store.getState(),t))}:function(){return n.requestQuery(t)},e.next=24,this._promiseCache.exec(f,function(){return(0,z.default)(t)});case 24:return p=e.sent,this.dispatch((0,T.receiveQueryResult)(u,p,{update:a,backgroundFetching:d})),e.abrupt("return",p);case 29:if(e.prev=29,e.t0=e.catch(18),this.dispatch((0,T.receiveQueryError)(u,e.t0)),!o.onError){e.next=36;break}o.onError(e.t0),e.next=41;break;case 36:if(!this.options.onError){e.next=40;break}this.options.onError(e.t0),e.next=41;break;case 40:throw e.t0;case 41:case"end":return e.stop()}},e,this,[[18,29]])})),function(e){return R.apply(this,arguments)})},{key:"queryAll",value:(G=(0,d.default)(l.default.mark(function e(t){var n,r,a,i,o,u,s=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=s.length>1&&void 0!==s[1]?s[1]:{}).as||this.queryIdGenerator.generateId(t),a=Q(Q({},n),{},{as:r}),e.prev=3,e.next=6,this.query(t,a);case 6:o=(i=e.sent).data;case 8:if(!(i&&i.next)){e.next=22;break}if(!i.bookmark){e.next=15;break}return e.next=12,this.query(t.offsetBookmark(i.bookmark),a);case 12:i=e.sent,e.next=19;break;case 15:return u=(0,T.getRawQueryFromState)(this.store.getState(),r),e.next=18,this.query(t.offset(u.data.length),a);case 18:i=e.sent;case 19:o.push.apply(o,(0,c.default)(i.data)),e.next=8;break;case 22:return e.abrupt("return",o);case 25:return e.prev=25,e.t0=e.catch(3),L.default.log("queryAll error for ".concat(e.t0.toString())),e.abrupt("return",[]);case 29:case"end":return e.stop()}},e,this,[[3,25]])})),function(e){return G.apply(this,arguments)})},{key:"watchQuery",value:function(){return L.default.warn("client.watchQuery is deprecated, please use client.makeObservableQuery."),this.makeObservableQuery.apply(this,arguments)}},{key:"makeObservableQuery",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.ensureStore();var n=t.as||this.queryIdGenerator.generateId(e);return this.ensureQueryExists(n,e),new N.default(n,e,this,t)}},{key:"mutate",value:(J=(0,d.default)(l.default.mark(function e(t){var n,r,a,i,o,u,c=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=c.length>1&&void 0!==c[1]?c[1]:{}).update,a=n.updateQueries,i=(0,s.default)(n,["update","updateQueries"]),this.ensureStore(),o=i.as||this.queryIdGenerator.generateId(t),this.dispatch((0,T.initMutation)(o,t)),e.prev=5,e.next=8,this.requestMutation(t);case 8:return u=e.sent,this.dispatch((0,T.receiveMutationResult)(o,u,{update:r,updateQueries:a},t)),e.abrupt("return",u);case 13:throw e.prev=13,e.t0=e.catch(5),this.dispatch((0,T.receiveMutationError)(o,e.t0,t)),e.t0;case 17:case"end":return e.stop()}},e,this,[[5,13]])})),function(e){return J.apply(this,arguments)})},{key:"requestQuery",value:($=(0,d.default)(l.default.mark(function e(t){var n,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.chain.request(t);case 2:return n=e.sent,e.next=5,this.persistVirtualDocuments(t,n.data);case 5:if(t.includes){e.next=7;break}return e.abrupt("return",n);case 7:return e.next=9,this.fetchRelationships(n,this.getIncludesRelationships(t));case 9:return r=e.sent,e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)})),function(e){return $.apply(this,arguments)})},{key:"persistVirtualDocuments",value:(Z=(0,d.default)(l.default.mark(function e(t,n){var r,a,i,o;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=["io.cozy.files.shortcuts"].includes(t.doctype),"io.cozy.apps_registry"!==t.doctype){e.next=6;break}return e.next=5,this.persistVirtualDocument({_type:"io.cozy.apps_registry",_id:t.id,cozyPouchData:n},r);case 5:return e.abrupt("return",e.sent);case 6:if(Array.isArray(n)){e.next=11;break}return e.next=9,this.persistVirtualDocument(n,r);case 9:e.next=28;break;case 11:a=H(n),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=20;break}return o=i.value,e.next=18,this.persistVirtualDocument(o,r);case 18:e.next=14;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(12),a.e(e.t0);case 25:return e.prev=25,a.f(),e.finish(25);case 28:case"end":return e.stop()}},e,this,[[12,22,25,28]])})),function(e,t){return Z.apply(this,arguments)})},{key:"persistVirtualDocument",value:(X=(0,d.default)(l.default.mark(function e(t,n){var r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!t||t.cozyLocalOnly)){e.next=2;break}return e.abrupt("return");case 2:if(!(!(null!==(r=t.meta)&&void 0!==r&&r.rev)&&!t._rev||n)){e.next=5;break}return e.next=5,this.chain.persistCozyData(t);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return X.apply(this,arguments)})},{key:"fetchRelationships",value:(ee=(0,d.default)(l.default.mark(function e(t,n){var r,a,i,o,c,s,d,f,p,h,y,v,_,O,w,S,x,E,C,j=this;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!(r=!Array.isArray(t.data))&&0===t.data.length)){e.next=3;break}return e.abrupt("return",t);case 3:return a=r?[t.data]:t.data,i=new Map,o=[],c=[],a.forEach(function(e){return(0,k.default)(n,function(t,n){try{var r=t.type.query(e,j,t),a=e._id;i.set(r,[a,n]),r instanceof D.QueryDefinition?c.push(r):o.push(r)}catch(e){}})}),s=(0,A.default)(c),e.next=11,Promise.all(s.map(function(e){return j.chain.request(e)}));case 11:d=e.sent,f=(0,b.default)((0,m.default)(o),"_id"),p=(0,m.default)(d.map(function(e){return e.included||e.data})).concat(f).filter(Boolean),h={},y=H((0,g.default)(s,d));try{for(y.s();!(v=y.n()).done;)O=(_=(0,u.default)(v.value,2))[0],w=_[1],(S=i.get(O))&&(E=(x=(0,u.default)(S,2))[0],C=x[1],h[E]=h[E]||{},h[E][C]=(0,P.responseToRelationship)(w))}catch(e){y.e(e)}finally{y.f()}return e.abrupt("return",Q(Q({},(0,P.attachRelationships)(t,h)),{},{included:p}));case 18:case"end":return e.stop()}},e)})),function(e,t){return ee.apply(this,arguments)})},{key:"requestMutation",value:(et=(0,d.default)(l.default.mark(function e(t){var n,r,a,i,u=this;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=8;break}return r=(n=(0,o.default)(t))[0],a=n.slice(1),e.next=4,this.requestMutation(r);case 4:return i=e.sent,e.next=7,Promise.all(a.map(function(e){var t="function"==typeof e?e(i):e;return u.requestMutation(t)}));case 7:return e.abrupt("return",i);case 8:return e.abrupt("return",this.chain.request(t));case 9:case"end":return e.stop()}},e,this)})),function(e){return et.apply(this,arguments)})},{key:"getIncludesRelationships",value:function(e){var t=this,n=e.includes,r=e.doctype;return n?(0,v.default)(n.map(function(e){return[e,t.schema.getRelationship(r,e)]})):{}}},{key:"hydrateDocuments",value:function(e,t){var n=this;if(!1===this.options.autoHydrate)return t;var r=this.schema.getDoctypeSchema(e);return r.relationships?t.map(function(e){return n.hydrateDocument(e,r)}):t}},{key:"hydrateDocument",value:function(e,t){if(!e)return e;var n=t||this.schema.getDoctypeSchema(e._type);return Q(Q({},e),this.hydrateRelationships(e,n.relationships))}},{key:"hydrateRelationships",value:function(e,t){var n=this.getRelationshipStoreAccessors();return(0,y.default)(t,function(t,r){return(0,E.create)(e,t,n)})}},{key:"makeNewDocument",value:function(e){return this.hydrateDocument({_type:e})}},{key:"generateRandomId",value:function(){return this.queryIdGenerator.generateRandomId()}},{key:"getAssociation",value:function(e,t){return(0,E.create)(e,this.schema.getRelationship(e._type,t),this.getRelationshipStoreAccessors())}},{key:"getRelationshipStoreAccessors",value:function(){var e=this;return!this.storeAccesors&&(this.storeAccessors={get:this.getDocumentFromState.bind(this),save:function(t,n){return e.save.call(e,t,n)},dispatch:this.dispatch.bind(this),query:function(t,n){return e.query.call(e,t,n)},mutate:function(t,n){return e.mutate.call(e,t,n)}}),this.storeAccessors}},{key:"getCollectionFromState",value:function(e){try{return(0,T.getCollectionFromState)(this.store.getState(),e)}catch(t){return L.default.warn("Could not getCollectionFromState",e,t.message),null}}},{key:"getDocumentFromState",value:function(e,t){try{return(0,T.getDocumentFromState)(this.store.getState(),e,t)}catch(n){return L.default.warn("Could not getDocumentFromState",e,t,n.message),null}}},{key:"getQueryFromState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.hydrated||!1,r=t.singleDocData||!1;try{var a=(0,T.getQueryFromState)(this.store.getState(),e),i=a.definition&&a.definition.doctype,o=a.definition&&a.definition.id;if(!n&&!r)return a;var u=n&&i?this.hydrateDocuments(i,a.data):a.data;return Q(Q({},a),{},{data:o&&r?u[0]:u})}catch(t){return L.default.warn("Could not get query from state. queryId: ".concat(e,", error: ").concat(t.message)),null}}},{key:"register",value:function(e){return this.getStackClient().setUri(e),this.startOAuthFlow(j.authFunction)}},{key:"isReactNative",value:function(){return"undefined"!=typeof navigator&&"ReactNative"==navigator.product}},{key:"startOAuthFlow",value:(en=(0,d.default)(l.default.mark(function e(t){var n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getStackClient(),e.next=3,n.register();case 3:return e.next=5,this.certifyFlagship();case 5:return e.abrupt("return",this.authorize({openURLCallback:t}));case 6:case"end":return e.stop()}},e,this)})),function(e){return en.apply(this,arguments)})},{key:"certifyFlagship",value:(er=(0,d.default)(l.default.mark(function e(){var t;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.getStackClient()).oauthOptions.shouldRequireFlagshipPermissions){e.next=4;break}return e.next=4,(0,q.certifyFlagship)(t.oauthOptions.certificationConfig,this);case 4:case"end":return e.stop()}},e,this)})),function(){return er.apply(this,arguments)})},{key:"authorize",value:(ea=(0,d.default)(l.default.mark(function e(){var t,n,r,a,i,o,u,c,s,d,f,p,h,y,v,m=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0===(n=(t=m.length>0&&void 0!==m[0]?m[0]:{}).openURLCallback)?j.authFunction:n,i=void 0===(a=t.sessionCode)?void 0:a,u=void 0===(o=t.pkceCodes)?{}:o,e.prev=1,c=u.codeVerifier,s=u.codeChallenge,f=(d=this.getStackClient()).generateStateCode(),p=d.getAuthCodeURL({stateCode:f,scopes:void 0,sessionCode:i,codeChallenge:s}),e.next=8,r(p);case 8:return h=e.sent,y=d.getAccessCodeFromURL(h,f),e.next=12,d.fetchAccessToken(y,void 0,void 0,c);case 12:return v=e.sent,d.setToken(v),e.abrupt("return",{token:v,infos:d.oauthOptions,client:d.oauthOptions});case 17:throw e.prev=17,e.t0=e.catch(1),e.t0.message===S.REGISTRATION_ABORT&&this.getStackClient().unregister(),e.t0;case 21:case"end":return e.stop()}},e,this,[[1,17]])})),function(){return ea.apply(this,arguments)})},{key:"renewAuthorization",value:function(){return this.authorize({openURLCallback:j.authFunction})}},{key:"setStore",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.force;if(void 0===e)throw Error("Store is undefined");if(this.store&&!(void 0!==n&&n))throw Error("Client already has a store, it is forbidden to change store.\nsetStore must be called before any query is executed. Try to\ncall setStore earlier in your code, preferably just after the\ninstantiation of the client.");this.store=e}},{key:"ensureStore",value:function(){!this.store&&this.setStore((0,T.createStore)())}},{key:"checkForRevocation",value:(ei=(0,d.default)(l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.stackClient instanceof w.OAuthClient)){e.next=4;break}return e.abrupt("return",this.stackClient.checkForRevocation());case 4:throw"checkForRevocation is only implemented for OAutClient";case 5:case"end":return e.stop()}},e,this)})),function(){return ei.apply(this,arguments)})},{key:"handleRevocationChange",value:function(e){e?(this.isRevoked=!0,this.emit("revoked")):(this.isRevoked=!1,this.emit("unrevoked"))}},{key:"handleTokenRefresh",value:function(e){this.emit("tokenRefreshed"),this.options.onTokenRefresh&&(Y("Using onTokenRefresh is deprecated, please use events like this: cozyClient.on('tokenRefreshed', token => console.log('Token has been refreshed', token)). https://git.io/fj3M3"),this.options.onTokenRefresh(e))}},{key:"createClient",value:function(){this.options.client&&L.default.warn("CozyClient: Using options.client is deprecated, please use options.stackClient.");var e=void 0===this.options.warningForCustomHandlers||this.options.warningForCustomHandlers,t=this.options.client||this.options.stackClient,n={onRevocationChange:this.handleRevocationChange,onTokenRefresh:this.handleTokenRefresh};if(t){this.stackClient=t,!t.options&&(t.options={});for(var r=0,a=Object.keys(n);r<a.length;r++){var i=a[r];t.options[i]?e&&L.default.warn("You passed a stackClient with its own ".concat(i,". It is not supported, unexpected things might happen.")):t.options[i]=n[i]}}else{var o=Q(Q({},this.options),n);this.stackClient=this.options.oauth?new w.OAuthClient(o):new w.default(o)}this.client=new Proxy(this.stackClient,Y("Using cozyClient.client is deprecated, please use cozyClient.stackClient."))}},{key:"getClient",value:function(){return L.default.warn("CozyClient: getClient() is deprecated, please use getStackClient()."),this.getStackClient()}},{key:"getStackClient",value:function(){return!this.stackClient&&this.createClient(),this.stackClient}},{key:"reducer",value:function(){return T.default}},{key:"dispatch",value:function(e){return this.store.dispatch(e)}},{key:"getInstanceOptions",value:function(){return this.instanceOptions}},{key:"loadInstanceOptionsFromDOM",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[role=application]",t=document.querySelector(e);if(!(t instanceof HTMLElement))throw Error("The selector that is passed does not return an HTMLElement");var n=t.dataset,r=n.cozy,a=(0,s.default)(n,["cozy"]);this.instanceOptions=Q(Q({},JSON.parse(void 0===r?"{}":r)),a),this.capabilities=this.instanceOptions.capabilities||null}},{key:"loadInstanceOptionsFromStack",value:(eo=(0,d.default)(l.default.mark(function e(){var t,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.query((0,D.Q)("io.cozy.settings").getById("io.cozy.settings.capabilities"));case 2:return t=e.sent.data,e.next=6,this.query((0,D.Q)("io.cozy.settings").getById("io.cozy.settings.instance"));case 6:n=e.sent.data,this.instanceOptions={capabilities:t,locale:n.locale,tracking:n.tracking},this.capabilities=this.instanceOptions.capabilities||null;case 10:case"end":return e.stop()}},e,this)})),function(){return eo.apply(this,arguments)})},{key:"setData",value:function(e){var t=this;this.ensureStore(),Object.entries(e).forEach(function(e){var n=(0,u.default)(e,2),r=(n[0],n[1]);t.dispatch((0,T.receiveQueryResult)(null,{data:r}))})}},{key:"setOnError",value:function(e){if(this.options&&this.options.onError)throw Error("On Error is already defined");this.options.onError=e}},{key:"toJSON",value:function(){return new F.CozyClient({uri:this.options.uri})}},{key:"setAppMetadata",value:function(e){this.appMetadata=Q(Q({},this.appMetadata),e)}},{key:"setLinks",value:function(e){if(this.links=e||[new x.default],this.registerClientOnLinks(),this.chain=(0,M.chain)(this.links),this.isLogged){var t,n=H(this.links);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.onLogin&&r.onLogin()}}catch(e){n.e(e)}finally{n.f()}}}},{key:"getSettings",value:(eu=(0,d.default)(l.default.mark(function e(t,n){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.getSettings)(this,t,n));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return eu.apply(this,arguments)})},{key:"saveAfterFetchSettings",value:(ec=(0,d.default)(l.default.mark(function e(t,n,r){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.saveAfterFetchSettings)(this,t,n,r));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n){return ec.apply(this,arguments)})},{key:"resetQuery",value:(es=(0,d.default)(l.default.mark(function e(t){var n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(0,T.isQueryExisting)(this.store.getState(),t)){e.next=3;break}return e.abrupt("return",Promise.resolve(null));case 3:return this.dispatch((0,T.resetQuery)(t)),n=this.getQueryFromState(t),e.next=7,this.query(n.definition,{as:t});case 7:return e.abrupt("return",e.sent);case 10:throw e.prev=10,e.t0=e.catch(0),e.t0;case 13:case"end":return e.stop()}},e,this,[[0,10]])})),function(e){return es.apply(this,arguments)})}],[{key:"fromOldClient",value:function(e,t){return new ed(Q({uri:e._url,token:e._token.token},t))}},{key:"fromOldOAuthClient",value:(el=(0,d.default)(l.default.mark(function e(t,n){var r,a,i;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._oauth){e.next=12;break}return e.next=3,t.authorize();case 3:if(a={oauth:(r=e.sent).client,token:r.token,scope:r.token.scope},!(i=new ed(Q(Q({uri:t._url},a),n))).loginPromise){e.next=9;break}return e.next=9,i.loginPromise;case 9:return e.abrupt("return",i);case 12:throw Error("Cannot instantiate a new client: old client is not an OAuth client. CozyClient.fromOldClient might be more suitable.");case 13:case"end":return e.stop()}},e)})),function(e,t){return el.apply(this,arguments)})},{key:"fromEnv",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e||(void 0!==r?r.env:{}),a=n.COZY_URL,i=n.COZY_CREDENTIALS;if(!a||!i)throw Error("Env used to instantiate CozyClient must have COZY_URL and COZY_CREDENTIALS");try{t.oauth=JSON.parse(i)}catch(e){t.token=i.trim()}return t.uri=a.trim(),new ed(Q({},t))}},{key:"fromDOM",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"[role=application]",n=document.querySelector(t);if(!(n instanceof HTMLElement))throw Error("Cannot find an HTMLElement corresponding to ".concat(t));if(!n||!n.dataset)throw Error("Found no data in ".concat(t," to instantiate cozyClient"));var r=n.dataset.cozy?JSON.parse(n.dataset.cozy):Q({},n.dataset),a=r.domain,i=r.token;if((!a||!i)&&(a=a||r.cozyDomain,i=i||r.cozyToken),!a||!i)throw Error("Found no data in ".concat(n.dataset," to instantiate cozyClient"));return new ed(Q({uri:"".concat(window.location.protocol,"//").concat(a),token:i,capabilities:r.capabilities},e))}},{key:"registerHook",value:function(e,t,n){var r=ed.hooks[e]=ed.hooks[e]||{};r[t]=r[t]||[],r[t].push(n)}}]),ed}();$.hooks=$.hooks||{},$.fetchPolicies=R.default,$.version="51.0.0",O.default.mixin($);t.default=$},37130:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.chain=t.default=void 0;var a=r(n(98235)),i=r(n(68434)),o=r(n(82007)),u=r(n(65105)),c=r(n(19723)),s=function(){var e,t,n;function r(e,t){(0,u.default)(this,r),"function"==typeof e&&(this.request=e),"function"==typeof t&&(this.persistCozyData=t)}return(0,c.default)(r,[{key:"request",value:(e=(0,o.default)(i.default.mark(function e(t,n,r){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("request is not implemented");case 1:case"end":return e.stop()}},e)})),function(t,n,r){return e.apply(this,arguments)})},{key:"persistCozyData",value:(t=(0,o.default)(i.default.mark(function e(t,n){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("persistCozyData is not implemented");case 1:case"end":return e.stop()}},e)})),function(e,n){return t.apply(this,arguments)})},{key:"reset",value:(n=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("reset is not implemented");case 1:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})}]),r}();t.default=s;var l=function(e){return"function"==typeof e?new s(e):e},d=new s(function(e,t){if(t)return t;if(e.execute)return e.execute();throw Error("No link could handle operation ".concat(JSON.stringify(e)))},function(e,t){});t.chain=function(e){return[].concat((0,a.default)(e),[d]).map(l).reduce(f)};var f=function(e,t){return new s(function(n,r,a){return e.request(n,r,function(e,n){return t.request(e,n,a)})},function(n,r){return e.persistCozyData(n,function(e){return t.persistCozyData(e,r)})})}},31344:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(64512)),u=r(n(27361)),c=n(65972),s=Object.prototype.hasOwnProperty,l=function(){function e(t,n,r,i){var u=this;if((0,a.default)(this,e),(0,o.default)(this,"handleStoreChange",function(){var e=u.currentRawResult();!function(e,t){if(d(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var a=0;a<n.length;a++)if(!s.call(t,n[a])||!d(e[n[a]],t[n[a]]))return!1;return!0}(e,u.lastResult)&&(u.lastResult=e,u.notifyObservers())}),!t||!n||!r)throw Error("ObservableQuery takes 3 arguments: queryId, definition and client");this.queryId=t,this.definition=n,this.client=r,this.observers={},this.idCounter=1,this.lastResult=this.currentRawResult(),this.options=i}return(0,i.default)(e,[{key:"currentResult",value:function(){return this.client.getQueryFromState(this.queryId,{hydrated:(0,u.default)(this.options,"hydrated",!0),singleDocData:!0})}},{key:"fetch",value:function(){return this.client.query(this.definition,{as:this.queryId})}},{key:"fetchMore",value:function(){var e=this.currentRawResult();return e.bookmark?this.client.query(this.definition.offsetBookmark(e.bookmark),{as:this.queryId}):this.client.query(this.definition.offset(e.data.length),{as:this.queryId})}},{key:"currentRawResult",value:function(){return(0,c.getRawQueryFromState)(this.getStore().getState(),this.queryId)}},{key:"notifyObservers",value:function(){var e=this;Object.keys(this.observers).forEach(function(t){return e.observers[t]()})}},{key:"subscribeToStore",value:function(){if(this._unsubscribeStore)throw Error("ObservableQuery instance is already subscribed to store.");this._unsubscribeStore=this.getStore().subscribe(this.handleStoreChange)}},{key:"unsubscribeFromStore",value:function(){if(!this._unsubscribeStore)throw Error("ObservableQuery instance is not subscribed to store");this._unsubscribeStore()}},{key:"subscribe",value:function(e){var t=this,n=this.idCounter;return this.idCounter++,this.observers[n]=e,1===Object.keys(this.observers).length&&this.subscribeToStore(),function(){return t.unsubscribe(n)}}},{key:"unsubscribe",value:function(e){if(!this.observers[e])throw Error("Cannot unsubscribe unknown callbackId ".concat(e));delete this.observers[e],0===Object.keys(this.observers).length&&(this.unsubscribeFromStore(),this._unsubscribeStore=null)}},{key:"getStore",value:function(){return this.client.store}}]),e}();function d(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}t.default=l},63384:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(65105)),o=a(n(19723)),u=a(n(25665)),c=a(n(27952)),s=a(n(12323)),l=a(n(64512)),d=r(n(67294)),f=a(n(45697)),p=a(n(54028)),h=f.default.shape({subscribe:f.default.func.isRequired,dispatch:f.default.func.isRequired,getState:f.default.func.isRequired}),y=function(e){(0,u.default)(a,e);var t,n,r=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function a(e,t){var n;if((0,i.default)(this,a),n=r.call(this,e,t),!e.client)throw Error("CozyProvider was not passed a client instance.");return e.store&&e.client.setStore(e.store),n}return(0,o.default)(a,[{key:"getChildContext",value:function(){return{store:this.props.store||this.context.store||this.props.client.store,client:this.props.client}}},{key:"render",value:function(){return d.default.createElement(p.default.Provider,{value:this.getChildContext()},this.props.children)}}]),a}(d.Component);t.default=y,(0,l.default)(y,"propTypes",{store:h,client:f.default.object.isRequired,children:f.default.oneOfType([f.default.element,f.default.arrayOf(f.default.element)]).isRequired}),(0,l.default)(y,"childContextTypes",{store:f.default.object,client:f.default.object.isRequired}),(0,l.default)(y,"contextTypes",{store:f.default.object})},18597:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.computeChildrenArgs=t.getQueryAttributes=t.default=t.fetchQuery=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(8997)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(64512)),d=r(n(80295)),f=n(67294);r(n(18621));var p=r(n(45697));r(n(31344));function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,l.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var v={},m=function(e,t){return t.fetch?t.fetch():e.query(t.definition,{as:t.queryId})};t.fetchQuery=m;var b=function(e,t){var n=e.create.bind(e),r=e.save.bind(e),a=e.destroy.bind(e),i=e.getAssociation.bind(e),o="function"==typeof t.query?t.query(e,t):t.query,u=e.makeObservableQuery(o,t),c=u.fetchMore.bind(u),s=t.mutations,l=(0,d.default)(t,["mutations"]),f="function"==typeof s?s(e,u,l):s,p=u.fetch?u.fetch.bind(u):null;return{client:e,observableQuery:u,queryDefinition:o,createDocument:n,saveDocument:r,deleteDocument:a,getAssociation:i,fetchMore:c,fetch:p,mutations:f}};t.getQueryAttributes=b;var g=function(e){var t=e.observableQuery,n=e.fetchMore,r=e.fetch,a=e.createDocument,i=e.saveDocument,o=e.deleteDocument,u=e.getAssociation,c=e.mutations;return[y({fetchMore:n,fetch:r},t.currentResult()),y({createDocument:a,saveDocument:i,deleteDocument:o,getAssociation:u},c)]};t.computeChildrenArgs=g;var k=function(e){(0,u.default)(d,e);var t,n,r=(t=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function d(e,t){(0,a.default)(this,d),n=r.call(this,e,t),(0,l.default)((0,o.default)(n),"onQueryChange",function(){n.recomputeChildrenArgs(),n.setState(v)});var n,i=t.client;if(!t.client)throw Error("Query should be used with client in context (use CozyProvider to set context)");return n.client=i,n.observableQuery=null,n.queryUnsubscribe=null,Object.assign((0,o.default)(n),b(i,e)),n.recomputeChildrenArgs(),n}return(0,i.default)(d,[{key:"componentDidMount",value:function(){this.queryUnsubscribe=this.observableQuery.subscribe(this.onQueryChange),!1!==this.props.enabled&&this.executeQueryRespectingFetchPolicy()}},{key:"executeQueryRespectingFetchPolicy",value:function(){if(this.props.fetchPolicy){var e=this.client.getQueryFromState(this.props.as);this.props.fetchPolicy&&"function"==typeof this.props.fetchPolicy&&this.props.fetchPolicy(e)&&m(this.client,this.observableQuery)}else m(this.client,this.observableQuery)}},{key:"componentDidUpdate",value:function(e){!1===e.enabled&&!1!==this.props.enabled&&this.executeQueryRespectingFetchPolicy()}},{key:"componentWillUnmount",value:function(){this.queryUnsubscribe&&this.queryUnsubscribe()}},{key:"recomputeChildrenArgs",value:function(){this.childrenArgs=g(this)}},{key:"render",value:function(){return(0,this.props.children)(this.childrenArgs[0],this.childrenArgs[1])}}]),d}(f.Component);t.default=k,k.contextTypes={client:p.default.object,store:p.default.object};var _=p.default.object;k.propTypes={query:p.default.oneOfType([p.default.func,_]).isRequired,enabled:p.default.bool,as:p.default.string,children:p.default.func.isRequired,fetchPolicy:p.default.func},k.defaultProps={enabled:!0}},1153:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=n(67294),u=r(n(26726)),c=n(45330),s=n(14932),l=(0,o.memo)(function(e){var t=e.doctype,n=(0,u.default)();return(0,o.useEffect)(function(){var e,r=n.plugins.realtime;if(!r)throw Error("You must include the realtime plugin to use RealTimeQueries");var o={};"io.cozy.files"===t&&(o.enhanceDocFn=s.ensureFilePath);var u=function(e){(0,c.dispatchCreate)(n,t,e,o)},l=function(e){(0,c.dispatchUpdate)(n,t,e,o)},d=function(e){(0,c.dispatchDelete)(n,t,e,o)};return(e=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.subscribe("created",t,u);case 2:return e.next=4,r.subscribe("updated",t,l);case 4:return e.next=6,r.subscribe("deleted",t,d);case 6:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})(),function(){r.unsubscribe("created",t,u),r.unsubscribe("updated",t,l),r.unsubscribe("deleted",t,d)}},[n,t]),null});t.default=l},42189:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(64512)),s=r(n(24350)),l=r(n(66604)),d=r(n(82492)),f=r(n(84238)),p=r(n(71843)),h=n(25367);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,c.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m=function(e){var t=(0,l.default)(e.relationships||{},function(e,t){return v(v({},e),{},{name:t,type:(0,h.resolveClass)(e.doctype,e.type)})});return v(v({},e),{},{relationships:(0,f.default)(t)>0?(0,s.default)(t,"name"):null})},b=function(e,t){if(!e)throw Error(t)},g=function(e,t){var n=(0,p.default)(e,t,function(e){return e.name});b(0===n.length,"Duplicated names in schemas being added: ".concat(n.map(function(e){return e.name}).join(", ")));var r=(0,p.default)(e,t,function(e){return e.doctype});b(0===r.length,"Duplicated doctypes in schemas being added: ".concat(r.map(function(e){return e.name}).join(", ")))},k=function(){var e,t;function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,o.default)(this,n),this.byDoctype={},this.add(e),this.client=t}return(0,u.default)(n,[{key:"add",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,l.default)(e,function(e,t){return v({name:t},m(e))});g(Object.values(t),Object.values(this.byDoctype)),(0,d.default)(this.byDoctype,(0,s.default)(t,function(e){return e.doctype}))}},{key:"getDoctypeSchema",value:function(e){var t=this.byDoctype[e];return!t&&(t=m({name:e,doctype:e}),this.byDoctype[e]=t),t}},{key:"getRelationship",value:function(e,t){if(!e)throw TypeError("Invalid doctype ".concat(e));var n=this.getDoctypeSchema(e);if(!n)throw Error("Cannot find doctype ".concat(e," in schema"));if(!n.relationships)throw Error("Schema for doctype ".concat(e," has no relationships"));return n.relationships[t]}},{key:"validate",value:(e=(0,i.default)(a.default.mark(function e(t){var n,r,i,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},r=this.byDoctype[t._type]){e.next=4;break}return e.abrupt("return",!0);case 4:if(r.attributes){e.next=6;break}return e.abrupt("return",!0);case 6:e.t0=a.default.keys(r.attributes);case 7:if((e.t1=e.t0()).done){e.next=15;break}return i=e.t1.value,e.next=11,this.validateAttribute(t,i,r.attributes[i]);case 11:!0!==(o=e.sent)&&(n[i]=o),e.next=7;break;case 15:if(0!==Object.keys(n).length){e.next=17;break}return e.abrupt("return",!0);case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"validateAttribute",value:(t=(0,i.default)(a.default.mark(function e(t,n,r){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.unique&&this.client)){e.next=6;break}return e.next=3,this.client.collection(t._type).checkUniquenessOf(n,t[n]);case 3:if(!(!0!==e.sent)){e.next=6;break}return e.abrupt("return","must be unique");case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)})),function(e,n,r){return t.apply(this,arguments)})}]),n}();t.default=k},97619:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.transformBulkDocsResponse=void 0;var a=r(n(80295)),i=r(n(68434)),o=r(n(82007)),u=r(n(65105)),c=r(n(19723)),s=r(n(25665)),l=r(n(27952)),d=r(n(12323)),f=r(n(64512)),p=r(n(35905)),h=n(71450),y=r(n(37130)),v=n(87941),m=n(29822),b=r(n(22853)),g=n(88930);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach(function(t){(0,f.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var O=function(e){var t=e.selector,n=e.partialFilter,r=e.sort,a=e.fields;return!!t||!!n||!!r||!!a||!1},w=function(e,t){var n=(0,p.default)(e,t,function(e,t){return e.ok?_(_({},t),{},{_id:e.id,_rev:e.rev}):t});if(e.find(function(e){return!e.ok}))throw new m.BulkEditError(e,n);return{data:n}};t.transformBulkDocsResponse=w;var S=function(e){(0,s.default)(k,e);var t,n,r,f,p,y,m=(t=k,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,d.default)(t);return e=n?Reflect.construct(r,arguments,(0,d.default)(this).constructor):r.apply(this,arguments),(0,l.default)(this,e)});function k(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.client,r=t.stackClient,a=t.platform;return(0,u.default)(this,k),e=m.call(this),n&&b.default.warn("Using options.client is deprecated, prefer options.stackClient"),e.stackClient=r||n,e.isOnline=null==a?void 0:a.isOnline,e}return(0,c.default)(k,[{key:"registerClient",value:function(e){this.stackClient=e.stackClient||e.client}},{key:"reset",value:(r=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.stackClient=null;case 1:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"request",value:(f=(0,o.default)(i.default.mark(function e(t,n,r){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.isOnline,!e.t0){e.next=5;break}return e.next=4,this.isOnline();case 4:e.t0=!e.sent;case 5:if(!e.t0){e.next=7;break}return e.abrupt("return",r(t));case 7:if(e.prev=7,!t.mutationType){e.next=12;break}return e.next=11,this.executeMutation(t,n,r);case 11:case 14:return e.abrupt("return",e.sent);case 12:return e.next=14,this.executeQuery(t);case 17:if(e.prev=17,e.t1=e.catch(7),!(0,g.isReactNativeOfflineError)(e.t1)){e.next=21;break}return e.abrupt("return",r(t));case 21:throw e.t1;case 22:case"end":return e.stop()}},e,this,[[7,17]])})),function(e,t,n){return f.apply(this,arguments)})},{key:"persistCozyData",value:(p=(0,o.default)(i.default.mark(function e(t,n){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n(t));case 1:case"end":return e.stop()}},e)})),function(e,t){return p.apply(this,arguments)})},{key:"executeQuery",value:function(e){var t=e.doctype,n=e.selector,r=e.id,i=e.ids,o=e.referenced,u=(0,a.default)(e,["doctype","selector","id","ids","referenced"]);if(!t)throw b.default.warn("Bad query",e),Error("No doctype found in a query definition");var c=this.stackClient.collection(t);return r?c.get(r,e):i?c.getAll(i):o?c.findReferencedBy(o,u):O(e)?c.find(n,u):c.all(u)}},{key:"executeMutation",value:(y=(0,o.default)(i.default.mark(function e(t,n,r){var o,u,c,s,l;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=t.mutationType,u=t.document,c=t.documents,s=(0,a.default)(t,["mutationType","document","documents"]),e.t0=o,e.next=e.t0===h.MutationTypes.CREATE_DOCUMENT?4:e.t0===h.MutationTypes.UPDATE_DOCUMENTS?5:e.t0===h.MutationTypes.UPDATE_DOCUMENT?9:e.t0===h.MutationTypes.DELETE_DOCUMENT?10:e.t0===h.MutationTypes.ADD_REFERENCES_TO?11:e.t0===h.MutationTypes.REMOVE_REFERENCES_TO?12:e.t0===h.MutationTypes.ADD_REFERENCED_BY?13:e.t0===h.MutationTypes.REMOVE_REFERENCED_BY?18:e.t0===h.MutationTypes.UPLOAD_FILE?23:24;break;case 4:return e.abrupt("return",this.stackClient.collection(u._type).create(u));case 5:return e.next=7,this.stackClient.collection(c[0]._type).updateAll(c);case 7:return l=e.sent,e.abrupt("return",w(l,c));case 9:return e.abrupt("return",this.stackClient.collection(u._type).update(u));case 10:return e.abrupt("return",this.stackClient.collection(u._type).destroy(u));case 11:return e.abrupt("return",this.stackClient.collection(s.referencedDocuments[0]._type).addReferencesTo(u,s.referencedDocuments));case 12:return e.abrupt("return",this.stackClient.collection(s.referencedDocuments[0]._type).removeReferencesTo(u,s.referencedDocuments));case 13:if(u._type!==v.DOCTYPE_FILES){e.next=17;break}return e.abrupt("return",this.stackClient.collection(v.DOCTYPE_FILES).addReferencedBy(u,s.referencedDocuments));case 17:case 22:throw Error("The document type should be io.cozy.files");case 18:if(u._type!==v.DOCTYPE_FILES){e.next=22;break}return e.abrupt("return",this.stackClient.collection(v.DOCTYPE_FILES).removeReferencedBy(u,s.referencedDocuments));case 23:return e.abrupt("return",this.stackClient.collection(v.DOCTYPE_FILES).upload(s.file,s.dirPath));case 24:return e.abrupt("return",r(t,n));case 25:case"end":return e.stop()}},e,this)})),function(e,t,n){return y.apply(this,arguments)})}]),k}(y.default);t.default=S},62946:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(25665)),s=r(n(27952)),l=r(n(12323)),d=r(n(37130)),f=function(e){(0,c.default)(h,e);var t,n,r,d,f,p=(t=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,l.default)(t);return e=n?Reflect.construct(r,arguments,(0,l.default)(this).constructor):r.apply(this,arguments),(0,s.default)(this,e)});function h(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.webviewIntent;return(0,o.default)(this,h),(e=p.call(this)).webviewIntent=n,e}return(0,u.default)(h,[{key:"registerClient",value:function(e){}},{key:"reset",value:(r=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"request",value:(d=(0,i.default)(a.default.mark(function e(t,n,r){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.webviewIntent.call("flagshipLinkRequest",t));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n){return d.apply(this,arguments)})},{key:"persistCozyData",value:(f=(0,i.default)(a.default.mark(function e(t,n){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)})),function(e,t){return f.apply(this,arguments)})}]),h}(d.default);t.default=f},28187:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723));n(71450);var o=function(){function e(t,n,r,i){(0,a.default)(this,e);var o=i.dispatch,u=i.get,c=i.query,s=i.mutate,l=i.save;this.target=t,this.name=n,this.doctype=r,this.get=u,this.query=c,this.mutate=s,this.save=l,this.dispatch=o}return(0,i.default)(e,[{key:"raw",get:function(){throw Error("A relationship must define its raw getter")}},{key:"data",get:function(){throw Error("A relationship must define its data getter")}}],[{key:"query",value:function(e,t,n){throw Error("A custom relationship must define its query() function")}}]),e}();t.default=o},13965:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.updateRelationship=t.updateHasManyItem=t.removeHasManyItem=t.setHasManyItem=t.getHasManyItems=t.getHasManyItem=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(8997)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(64512)),d=r(n(98235)),f=r(n(27361)),p=r(n(82492)),h=n(71450),y=n(65972),v=r(n(28187)),m=r(n(22853));function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach(function(t){(0,l.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var k=function(e,t,n){var r=-1===t?e.length:t;return[].concat((0,d.default)(e.slice(0,r)),[n],(0,d.default)(e.slice(r+1)))},_=function(e){(0,u.default)(p,e);var t,n,r=(t=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function p(){var e;(0,a.default)(this,p);for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),(0,l.default)((0,o.default)(e),"updateRelationshipData",function(t){return function(n,r){var a=(0,y.getDocumentFromState)(r(),e.target._type,e.target._id);n((0,y.receiveQueryResult)(null,{data:g(g({},a),{},{relationships:g(g({},a.relationships),{},(0,l.default)({},e.name,t(a.relationships[e.name])))})}))}}),e}return(0,i.default)(p,[{key:"fetchMore",value:function(){throw"Not implemented"}},{key:"exists",value:function(e){return this.existsById(e._id)}},{key:"containsById",value:function(e){return void 0!==this.getRelationship().data.find(function(t){return e===t._id})}},{key:"existsById",value:function(e){return!!(this.containsById(e)&&this.get(this.doctype,e))}},{key:"add",value:function(e){var t=(Array.isArray(e)?e:[e]).map(function(e){return e._id});return this.addById(t)}},{key:"remove",value:function(e){var t=(Array.isArray(e)?e:[e]).map(function(e){return e._id});return this.removeById(t)}},{key:"addTargetRelationships",value:function(e){var t,n=this;!this.target.relationships&&(this.target.relationships={}),!this.target.relationships[this.name]&&(this.target.relationships[this.name]={data:[]});var r=(Array.isArray(e)?e:[e]).filter(function(e){return!n.existsById(e)}).map(function(e){return{_id:e,_type:n.doctype}});(t=this.target.relationships[this.name].data).push.apply(t,(0,d.default)(r)),this.updateMetaCount()}},{key:"addById",value:function(e){return this.addTargetRelationships(e),this.save(this.target)}},{key:"removeTargetRelationships",value:function(e){var t=Array.isArray(e)?e:[e];this.target.relationships[this.name].data=this.target.relationships[this.name].data.filter(function(e){var n=e._id;return!t.includes(n)}),this.updateMetaCount()}},{key:"removeById",value:function(e){return this.removeTargetRelationships(e),this.save(this.target)}},{key:"updateMetaCount",value:function(){void 0!==(0,f.default)(this.target.relationships[this.name],"meta.count")&&(this.target.relationships[this.name].meta=g(g({},this.target.relationships[this.name].meta),{},{count:this.target.relationships[this.name].data.length}))}},{key:"getRelationship",value:function(){var e=this.target[this.name],t=(0,f.default)(this.target,"relationships.".concat(this.name));return t?t:(e&&e.length&&m.default.warn("You're trying to access data on a relationship that appear to not be loaded yet. You may want to use 'include()' on your query"),{data:[],next:!0,meta:{count:0}})}},{key:"updateTargetRelationship",value:function(e,t){var n=e.readDocument(this.target._type,this.target._id);e.writeDocument(this.updateRelationship(n,t))}},{key:"updateRelationship",value:function(e,t){return p.updateRelationship(e,this.name,t)}},{key:"dehydrate",value:function(e){return g(g({},e),{},{relationships:g(g({},e.relationships),{},(0,l.default)({},this.name,{data:this.raw}))})}},{key:"raw",get:function(){return this.getRelationship().data}},{key:"data",get:function(){var e=this;return this.getRelationship().data.map(function(t){var n=t._id,r=t._type;return e.get(r,n)}).filter(Boolean)}},{key:"hasMore",get:function(){return this.getRelationship().next}},{key:"count",get:function(){var e=this.getRelationship();return e.meta?e.meta.count:e.data.length}}],[{key:"query",value:function(e,t,n){var r=(0,f.default)(e,"relationships.".concat(n.name,".data"),[]).map(function(e){return e._id});return new h.QueryDefinition({doctype:n.doctype,ids:r})}}]),p}(v.default),O=_.getHasManyItem=function(e,t,n){return(0,f.default)(e,"relationships.".concat(t,".data"),[]).find(function(e){return e._id==n})};t.getHasManyItem=O;var w=_.getHasManyItems=function(e,t){return(0,f.default)(e,"relationships.".concat(t,".data"),[])};t.getHasManyItems=w;var S=_.setHasManyItem=function(e,t,n,r){var a=_.getHasManyItems(e,t),i=a.findIndex(function(e){return e._id===n}),o=(0,p.default)({},a[i],r),u=k(a,i,o);return _.updateRelationship(e,t,function(e){return(0,p.default)({},e,{data:u})})};t.setHasManyItem=S;var x=_.removeHasManyItem=function(e,t,n){var r=_.getHasManyItems(e,t).filter(function(e){return e._id!==n});return _.updateRelationship(e,t,function(){return{data:r}})};t.removeHasManyItem=x;var E=_.updateHasManyItem=function(e,t,n,r){var a=r(_.getHasManyItem(e,t,n));return _.setHasManyItem(e,t,n,a)};t.updateHasManyItem=E;var P=_.updateRelationship=function(e,t,n){return g(g({},e),{},{relationships:g(g({},e.relationships),{},(0,l.default)({},t,g(g({},e.relationships?e.relationships[t]:{}),n(e.relationships?e.relationships[t]:{}))))})};t.updateRelationship=P;t.default=_},32349:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.getFileDatetime=void 0;var a=r(n(68434)),i=r(n(98235)),o=r(n(64512)),u=r(n(82007)),c=r(n(65105)),s=r(n(19723)),l=r(n(59655)),d=r(n(25665)),f=r(n(27952)),p=r(n(12323)),h=r(n(90402)),y=r(n(27361)),v=r(n(57557)),m=r(n(44908)),b=n(71450),g=n(65972),k=n(87941);r(n(28187));var _=r(n(13965));function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var S=function(e,t){var n=(0,h.default)(e,3),r=n[0],a=n[1],i=n[2];return[i?[r,a,i]:[r,a],t]},x=function(e){var t;return(null===(t=e.metadata)||void 0===t?void 0:t.datetime)||e.created_at};t.getFileDatetime=x;var E=function(e){(0,d.default)(O,e);var t,n,r,o,h,_=(t=O,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,p.default)(t);return e=n?Reflect.construct(r,arguments,(0,p.default)(this).constructor):r.apply(this,arguments),(0,f.default)(this,e)});function O(){return(0,c.default)(this,O),_.apply(this,arguments)}return(0,s.default)(O,[{key:"fetchMore",value:(r=(0,u.default)(a.default.mark(function e(){var t,n,r,o=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.QueryDefinition({doctype:k.DOCTYPE_FILES}),r=(n=this.getRelationship().data)[n.length-1],e.next=5,this.dispatch(function(){var e=(0,u.default)(a.default.mark(function e(u,c){var s,l,d;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=x((0,g.getDocumentFromState)(c(),r._type,r._id)),l=S([o.target._type,o.target._id,s],n[n.length-1]._id),e.next=5,o.query(t.referencedBy(o.target).offsetCursor(l));case 5:return(d=e.sent).data.shift(),e.next=9,o.dispatch(o.updateRelationshipData(function(e){return w(w({},e),{},{data:[].concat((0,i.default)(e.data),(0,i.default)(d.data)),next:d.next})}));case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"addById",value:(o=(0,u.default)(a.default.mark(function e(t){var n,r,i=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Array.isArray(t)?t:[t],this.addTargetRelationships(n),r=n.map(function(e){return{_id:e,_type:i.doctype}}),e.next=5,this.mutate(this.addReferences(r));case 5:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"removeById",value:(h=(0,u.default)(a.default.mark(function e(t){var n,r,i=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Array.isArray(t)?t:[t],this.removeTargetRelationships(t),r=n.map(function(e){return{_id:e,_type:i.doctype}}),e.next=5,this.mutate(this.removeReferences(r));case 5:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"addReferences",value:function(e){if(this.target._type===k.DOCTYPE_FILES)return b.Mutations.addReferencedBy(this.target,e);if(e[0]._type===k.DOCTYPE_FILES)return b.Mutations.addReferencesTo(this.target,e);throw Error("Either the document or the references should be io.cozy.files")}},{key:"removeReferences",value:function(e){if(this.target._type===k.DOCTYPE_FILES)return b.Mutations.removeReferencedBy(this.target,e);if(e[0]._type===k.DOCTYPE_FILES)return b.Mutations.removeReferencesTo(this.target,e);throw Error("Either the document or the references should be io.cozy.files")}},{key:"dehydrate",value:function(e){return(0,v.default)(e,[this.name,"relationships.".concat(this.name)])}},{key:"data",get:function(){var e=this;return this.target._type===k.DOCTYPE_FILES?(0,y.default)(this.target,"referenced_by",[]).map(function(t){var n=t.id,r=t.type;return e.get(r,n)}).filter(Boolean):(0,l.default)((0,p.default)(O.prototype),"data",this)}}],[{key:"query",value:function(e,t,n){if(e._type===k.DOCTYPE_FILES){var r=(0,y.default)(e,"relationships.referenced_by.data",[]),a=(0,m.default)(r.filter(function(e){return e.type===n.doctype}).map(function(e){return e.id}));return a.length>0?(0,b.Q)(n.doctype).getByIds(a):null}var i=S([e._type,e._id],"");return(0,b.Q)(n.doctype).referencedBy(e).offsetCursor(i)}}]),O}(_.default);t.default=E},23433:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(64512)),i=r(n(65105)),o=r(n(19723)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=n(71450),d=r(n(28187));function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=function(e){(0,u.default)(d,e);var t,n,r=(t=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function d(){return(0,i.default)(this,d),r.apply(this,arguments)}return(0,o.default)(d,[{key:"addById",value:function(e){this.getRelationship().push(e)}},{key:"removeById",value:function(e){var t=this.getRelationship(),n=t.indexOf(e);-1!==n&&t.splice(n,1)}},{key:"existsById",value:function(e){return -1!==this.getRelationship().indexOf(e)}},{key:"getRelationship",value:function(){return this.target[this.name]=this.target[this.name]||[],this.target[this.name]}},{key:"dehydrate",value:function(e){return p(p({},e),{},(0,a.default)({},this.name,this.raw||[]))}},{key:"raw",get:function(){return this.target[this.name]}},{key:"data",get:function(){var e=this,t=this.doctype;return(this.raw||[]).map(function(n){return e.get(t,n)})}}],[{key:"query",value:function(e,t,n){var r=e[n.name];return r&&r>0?(0,l.Q)(n.doctype).getByIds(r):null}}]),d}(d.default);t.default=h},1715:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(59655)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(13965)),d=n(71450),f=function(e){(0,u.default)(l,e);var t,n,r=(t=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function l(){return(0,a.default)(this,l),r.apply(this,arguments)}return(0,i.default)(l,[{key:"data",get:function(){var e=this;return(0,o.default)((0,s.default)(l.prototype),"data",this).filter(function(t){return t.slug===e.target.slug})}}],[{key:"query",value:function(e,t){return(0,d.Q)("io.cozy.triggers").where({worker:"konnector"})}}]),l}(l.default);t.default=f},95760:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(64512)),i=r(n(65105)),o=r(n(19723)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(27361)),d=r(n(36968)),f=n(71450),p=r(n(28187)),h=r(n(22853));function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m=function(e){(0,u.default)(p,e);var t,n,r=(t=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function p(){return(0,i.default)(this,p),r.apply(this,arguments)}return(0,o.default)(p,[{key:"add",value:function(e){return this.setRelationship(e),this.save(this.target)}},{key:"remove",value:function(){return this.setRelationship(void 0),this.save(this.target)}},{key:"setRelationship",value:function(e){if(e&&e._type!==this.doctype)throw Error("Tried to associate a ".concat(e._type," document to a HasOne relationship on ").concat(this.doctype," document"));var t="relationships[".concat(this.name,"].data");e?(0,d.default)(this.target,t,{_id:e._id,_type:e._type}):(0,d.default)(this.target,t,void 0)}},{key:"set",value:function(e){h.default.warn("set is deprecated for has-one relationships. Use `add` instead."),this.setRelationship(e)}},{key:"unset",value:function(){h.default.warn("unset is deprecated for has-one relationships. Use `remove` instead."),this.setRelationship(void 0)}},{key:"dehydrate",value:function(e){return this.raw?v(v({},e),{},{relationships:v(v({},e.relationships),{},(0,a.default)({},this.name,{data:this.raw}))}):e}},{key:"raw",get:function(){return(0,l.default)(this.target,"relationships[".concat(this.name,"].data"),null)}},{key:"data",get:function(){return this.raw?this.get(this.doctype,this.raw._id):null}}],[{key:"query",value:function(e,t,n){var r=(0,l.default)(e,"relationships.".concat(n.name,".data"),{});return r&&r._id?(0,f.Q)(n.doctype).getById(r._id):null}}]),p}(p.default);t.default=m},13846:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.BelongsToInPlace=t.default=void 0;var a=r(n(64512)),i=r(n(65105)),o=r(n(19723)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(28187)),d=n(71450);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=function(e){(0,u.default)(l,e);var t,n,r=(t=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function l(){return(0,i.default)(this,l),r.apply(this,arguments)}return(0,o.default)(l,[{key:"dehydrate",value:function(e){return p(p({},e),{},(0,a.default)({},this.name,this.raw||void 0))}},{key:"raw",get:function(){return this.target[this.name]}},{key:"data",get:function(){return this.get(this.doctype,this.raw)}}],[{key:"query",value:function(e,t,n){var r=e[n.name];return t.getDocumentFromState(n.doctype,r)||(0,d.Q)(n.doctype).getById(r)}}]),l}(l.default);t.default=h;t.BelongsToInPlace=h},11282:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getReferencedById=t.getReferencedBy=t.isReferencedById=t.isReferencedBy=t.create=t.resolveClass=t.attachRelationships=t.responseToRelationship=t.pickTypeAndId=void 0;var a=r(n(64512)),i=r(n(78718)),o=r(n(35937)),u=r(n(28187)),c=r(n(95760)),s=r(n(13846)),l=r(n(13965)),d=r(n(23433)),f=r(n(32349));function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=function(e){return(0,i.default)(e,"_type","_id")};t.pickTypeAndId=y;t.responseToRelationship=function(e){var t,n;return(0,o.default)({data:(t=y,Array.isArray(n=e.data)?n.map(t):t(n)),meta:e.meta,next:e.next,skip:e.skip,bookmark:e.bookmark})};var v=function(e,t){return h(h({},e),{},{relationships:h(h({},e.relationships),t)})};t.attachRelationships=function(e,t){if(Array.isArray(e.data))return h(h({},e),{},{data:e.data.map(function(e){return v(e,t[e._id])})});var n=e.data;return h(h({},e),{},{data:v(n,t[n._id])})};var m={"io.cozy.files:has-many":f.default,"has-many":l.default,"belongs-to-in-place":s.default,"has-one":c.default,"has-one-in-place":s.default,"has-many-in-place":d.default};t.resolveClass=function(e,t){if(void 0===t)throw Error("Undefined type for "+e);if("string"!=typeof t)return t;var n=m["".concat(e,":").concat(t)]||m[t];if(n)return n;throw Error("Unknown association '".concat(t,"'"))};t.create=function(e,t,n){var r=t.name,a=t.type,i=t.doctype;if(e[r]instanceof u.default)throw Error("Association ".concat(r," already exists"));return new a(e,r,i,n)};t.isReferencedBy=function(e,t){var n,r;return((null==e?void 0:null===(n=e.relationships)||void 0===n?void 0:null===(r=n.referenced_by)||void 0===r?void 0:r.data)||(null==e?void 0:e.referenced_by)||[]).some(function(e){return e.type===t})};t.isReferencedById=function(e,t,n){var r,a;return((null==e?void 0:null===(r=e.relationships)||void 0===r?void 0:null===(a=r.referenced_by)||void 0===a?void 0:a.data)||(null==e?void 0:e.referenced_by)||[]).some(function(e){return e.type===t&&e.id===n})};t.getReferencedBy=function(e,t){var n,r;return((null==e?void 0:null===(n=e.relationships)||void 0===n?void 0:null===(r=n.referenced_by)||void 0===r?void 0:r.data)||(null==e?void 0:e.referenced_by)||[]).filter(function(e){return e.type===t})};t.getReferencedById=function(e,t,n){var r,a;return((null==e?void 0:null===(r=e.relationships)||void 0===r?void 0:null===(a=r.referenced_by)||void 0===a?void 0:a.data)||(null==e?void 0:e.referenced_by)||[]).filter(function(e){return e.type===t&&e.id===n})}},25367:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"HasManyFiles",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"HasMany",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"HasOne",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"HasOneInPlace",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"HasManyInPlace",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"HasManyTriggers",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"Association",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"resolveClass",{enumerable:!0,get:function(){return d.resolveClass}}),Object.defineProperty(t,"create",{enumerable:!0,get:function(){return d.create}}),Object.defineProperty(t,"isReferencedBy",{enumerable:!0,get:function(){return d.isReferencedBy}}),Object.defineProperty(t,"isReferencedById",{enumerable:!0,get:function(){return d.isReferencedById}}),Object.defineProperty(t,"getReferencedBy",{enumerable:!0,get:function(){return d.getReferencedBy}}),Object.defineProperty(t,"getReferencedById",{enumerable:!0,get:function(){return d.getReferencedById}});var a=r(n(32349)),i=r(n(13965)),o=r(n(95760)),u=r(n(13846)),c=r(n(23433)),s=r(n(1715)),l=r(n(28187)),d=n(11282)},18118:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.authFunction=t.authenticateWithCordova=void 0;var i=a(n(68434)),o=a(n(82007)),u=n(87941),c=n(25976),s="undefined"!=typeof window?window:null,l=function(e){return new Promise(function(t,n){s.SafariViewController.show({url:e,transition:"curl"},function(e){"closed"===e.event&&n(Error(u.REGISTRATION_ABORT))},function(e){console.log("KO: "+e),n(Error(u.REGISTRATION_ABORT))});var r=s.handleOpenURL;s.handleOpenURL=function(e){s.SafariViewController.hide(),t(e),r&&(s.handleOpenURL=r)}})},d=function(e){return new Promise(function(t,n){var r=s.cordova.InAppBrowser.open(e,"_blank","clearcache=yes,zoom=no"),a=function(){r.removeEventListener("loadstart",i),r.removeEventListener("exit",o)},i=function(e){var n=e.url,i=/\?access_code=(.+)$/.test(n),o=/\?state=(.+)$/.test(n);(i||o)&&(t(n),a(),r.close())},o=function(){n(Error(u.REGISTRATION_ABORT)),a(),r.close()};r.addEventListener("loadstart",i),r.addEventListener("exit",o)})};var f=(r=(0,o.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=(0,c.isIOSApp)(),!e.t0){e.next=5;break}return e.next=4,(0,c.hasSafariPlugin)();case 4:e.t0=e.sent;case 5:if(!e.t0){e.next=9;break}return e.abrupt("return",l(t));case 9:if(!(0,c.hasInAppBrowserPlugin)()){e.next=13;break}return e.abrupt("return",d(t));case 13:return console.log(t),e.abrupt("return",new Promise(function(e){setTimeout(function(){e(prompt("Paste the url here:"))},5e3)}));case 15:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.authenticateWithCordova=f;t.authFunction=f},87941:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DOCTYPE_PERMISSIONS=t.DOCTYPE_FILES=t.REGISTRATION_ABORT=void 0;t.REGISTRATION_ABORT="REGISTRATION_ABORT";t.DOCTYPE_FILES="io.cozy.files";t.DOCTYPE_PERMISSIONS="io.cozy.permissions"},20538:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.APP_TYPE=void 0;t.APP_TYPE={KONNECTOR:"konnector",WEBAPP:"webapp"}},54028:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.clientContext=void 0;var a=n(67294);r(n(18621));var i=(0,a.createContext)({client:null,store:null});t.clientContext=i;t.default=i},29822:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.BulkEditError=void 0;var a=r(n(64512)),i=r(n(65105)),o=r(n(19723)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(15500)),d=r(n(35905));function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=function(e){(0,u.default)(a,e);var t,n,r=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function a(e,t){var n;return(0,i.default)(this,a),(n=r.call(this,"Error while bulk saving")).name="BulkEditError",n.results=(0,d.default)(e,t,function(e,t){return p(p({},e),{},{doc:t})}),n}return(0,o.default)(a,[{key:"getUpdatedDocuments",value:function(){return this.results.filter(function(e){return e.ok}).map(function(e){return e.doc})}},{key:"getErrors",value:function(){return this.results.filter(function(e){return!e.ok})}}]),a}((0,l.default)(Error));t.BulkEditError=h},23864:function(e,t,n){var r,a,i,o=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.certifyFlagship=void 0;var u=o(n(68434)),c=o(n(82007));o(n(18621));var s=n(79166);var l=(r=(0,c.default)(u.default.mark(function e(t){var n,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.getStackClient(),e.next=4,n.fetchJSON("POST","/auth/clients/".concat(n.oauthOptions.clientID,"/challenge"),null,{headers:{Authorization:n.registrationAccessTokenToAuthHeader()}});case 4:return r=e.sent,e.abrupt("return",r.nonce);case 8:throw e.prev=8,e.t0=e.catch(0),Error("[FLAGSHIP_CERTIFICATION] Something went wrong while requesting a challenge from CozyStack:\n"+e.t0.message);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(e){return r.apply(this,arguments)});var d=(a=(0,c.default)(u.default.mark(function e(t,n,r){var a,i,o,c,s;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.platform,i=t.attestation,o=t.keyId,c=t.issuer,s=r.getStackClient(),e.next=5,s.fetchJSON("POST","/auth/clients/".concat(s.oauthOptions.clientID,"/attestation"),{platform:a,attestation:i,challenge:n,keyId:o,issuer:c},{headers:{Authorization:s.registrationAccessTokenToAuthHeader()}});case 5:e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),Error("[FLAGSHIP_CERTIFICATION] Something went wrong while giving attestation to CozyStack:\n"+e.t0.message);case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,t,n){return a.apply(this,arguments)});var f=(i=(0,c.default)(u.default.mark(function e(t,n){var r,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("[FLAGSHIP_CERTIFICATION] Certification configuration is not set");case 2:return e.prev=2,e.next=5,l(n);case 5:return r=e.sent,e.next=8,(0,s.getAppAttestationFromStore)(r,t);case 8:return a=e.sent,e.next=11,d(a,r,n);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.warn('[FLAGSHIP_CERTIFICATION] Automatic certification for URI "'.concat(n.stackClient.uri,'" failed. This is expected on dev environments and non-official phones. Cozy-stack will continue with manual certification through 2FA')),console.warn(e.t0.message);case 17:case"end":return e.stop()}},e,null,[[2,13]])})),function(e,t){return i.apply(this,arguments)});t.certifyFlagship=f},79166:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getAppAttestationFromStore=void 0;var i=a(n(68434)),o=a(n(82007));var u=(r=(0,o.default)(i.default.mark(function e(t,n){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("getAppAttestationFromStore can only be called from a React Native container");case 1:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.getAppAttestationFromStore=u},78133:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.dehydrate=void 0;var a=r(n(90402)),i=n(25367);t.dehydrate=function(e){return Object.entries(e).reduce(function(e,t){var n=(0,a.default)(t,2),r=n[0],o=n[1],u=e;if(o instanceof i.Association){if(o.dehydrate)u=o.dehydrate(u);else throw Error("Association on key ".concat(r," should have a dehydrate method"))}else u[r]=o;return u},{})}},72004:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"deconstructCozyWebLinkWithSlug",{enumerable:!0,get:function(){return r.deconstructCozyWebLinkWithSlug}}),Object.defineProperty(t,"deconstructRedirectLink",{enumerable:!0,get:function(){return r.deconstructRedirectLink}}),Object.defineProperty(t,"generateWebLink",{enumerable:!0,get:function(){return r.generateWebLink}}),Object.defineProperty(t,"ensureFirstSlash",{enumerable:!0,get:function(){return r.ensureFirstSlash}}),Object.defineProperty(t,"rootCozyUrl",{enumerable:!0,get:function(){return r.rootCozyUrl}}),Object.defineProperty(t,"InvalidRedirectLinkError",{enumerable:!0,get:function(){return r.InvalidRedirectLinkError}}),Object.defineProperty(t,"InvalidCozyUrlError",{enumerable:!0,get:function(){return r.InvalidCozyUrlError}}),Object.defineProperty(t,"InvalidProtocolError",{enumerable:!0,get:function(){return r.InvalidProtocolError}}),Object.defineProperty(t,"BlockedCozyError",{enumerable:!0,get:function(){return r.BlockedCozyError}}),Object.defineProperty(t,"dehydrate",{enumerable:!0,get:function(){return a.dehydrate}}),Object.defineProperty(t,"editSettings",{enumerable:!0,get:function(){return i.editSettings}}),Object.defineProperty(t,"getQuery",{enumerable:!0,get:function(){return i.getQuery}}),Object.defineProperty(t,"getSettings",{enumerable:!0,get:function(){return i.getSettings}}),Object.defineProperty(t,"normalizeSettings",{enumerable:!0,get:function(){return i.normalizeSettings}}),Object.defineProperty(t,"saveAfterFetchSettings",{enumerable:!0,get:function(){return i.saveAfterFetchSettings}});var r=n(77304),a=n(78133),i=n(56200)},14932:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.ensureFilePath=void 0;var i=a(n(68434)),o=a(n(64512)),u=a(n(82007)),c=n(71450),s=a(n(18621));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var d=function(e){return{definition:function(){return(0,c.Q)("io.cozy.files").getById(e)},options:{as:"io.cozy.files/".concat(e),singleDocData:!0,fetchPolicy:s.default.fetchPolicies.olderThan(3e4)}}};var f=(r=(0,u.default)(i.default.mark(function e(t){var n,r,a,u,c=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:{},!t.path){e.next=3;break}return e.abrupt("return",t);case 3:return r=d(t.dir_id),e.next=6,n.client.fetchQueryAndGetFromState({definition:r.definition(),options:r.options});case 6:if(!(!(a=e.sent).data||!a.data.path)){e.next=9;break}throw Error("Could not define a file path for ".concat(t._id||t.id));case 9:return u=a.data.path+"/"+t.name,e.abrupt("return",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({path:u},t));case 11:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.ensureFilePath=f},56200:function(e,t,n){var r,a,i=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getQuery=t.extractKeys=t.editSettings=t.normalizeSettings=t.saveAfterFetchSettings=t.getSettings=void 0;var o=i(n(90402)),u=i(n(64512)),c=i(n(68434)),s=i(n(82007));i(n(18621));var l=i(n(39268)),d=n(71450);function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=l.default.olderThan(36e5);var v=(r=(0,s.default)(c.default.mark(function e(t,n,r){var a,i;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=w(n),e.next=3,t.fetchQueryAndGetFromState({definition:a.definition,options:a.options});case 3:return i=b(e.sent.data),e.abrupt("return",O(i,r));case 6:case"end":return e.stop()}},e)})),function(e,t,n){return r.apply(this,arguments)});t.getSettings=v;var m=(a=(0,s.default)(c.default.mark(function e(t,n,r,a){var i,o,u,s;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=w(n),e.next=3,t.fetchQueryAndGetFromState({definition:i.definition,options:i.options});case 3:return o=b(e.sent.data),u=void 0,u="function"==typeof r?r(O(o,a)):h(h({},O(o,Object.keys(r))),r),s=g(n,o,u),e.next=10,t.save(s);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e)})),function(e,t,n,r){return a.apply(this,arguments)});t.saveAfterFetchSettings=m;var b=function(e){return(Array.isArray(e)?e[0]:e)||{}};t.normalizeSettings=b;var g=function(e,t,n){var r=E(e);return"instance"===e?k(t,n):_(t,r,n)};t.editSettings=g;var k=function(e,t){for(var n=h(h({_id:e._id,_type:e._type,_rev:e.meta.rev},e),{},{attributes:h({},e.attributes)}),r=0,a=Object.entries(t);r<a.length;r++){var i=(0,o.default)(a[r],2),u=i[0],c=i[1];n[u]=c,n.attributes[u]=c}return n},_=function(e,t,n){for(var r=h({_type:t},e),a=0,i=Object.entries(n);a<i.length;a++){var u=(0,o.default)(i[a],2),c=u[0],s=u[1];r[c]=s}return r},O=function(e,t){var n={},r,a=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;n[i]=e[i]}}catch(e){a.e(e)}finally{a.f()}return n};t.extractKeys=O;var w=function(e){return"instance"===e?x(e):"passwords"===e?x("bitwarden"):S(e)};t.getQuery=w;var S=function(e){var t=E(e);return{definition:(0,d.Q)(t).limitBy(1),options:{as:t,fetchPolicy:y,singleDocData:!0}}},x=function(e){var t="io.cozy.settings",n=E(e);return{definition:(0,d.Q)(t).getById(n),options:{as:"".concat(t,"/").concat(n),fetchPolicy:y,singleDocData:!0}}},E=function(e){return["instance","bitwarden"].includes(e)?"io.cozy.settings.".concat(e):"passwords"===e?"io.cozy.settings.bitwarden":"io.cozy.".concat(e,".settings")}},77304:function(e,t,n){var r,a,i,o=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.rootCozyUrl=t.InvalidCozyUrlError=t.BlockedCozyError=t.InvalidProtocolError=t.InvalidRedirectLinkError=t.deconstructRedirectLink=t.deconstructCozyWebLinkWithSlug=t.generateWebLink=t.ensureFirstSlash=void 0;var u=o(n(98235)),c=o(n(54765)),s=o(n(68434)),l=o(n(82007)),d=o(n(65105)),f=o(n(25665)),p=o(n(27952)),h=o(n(12323)),y=o(n(15500)),v=o(n(90402));function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=(0,h.default)(e);return n=t?Reflect.construct(r,arguments,(0,h.default)(this).constructor):r.apply(this,arguments),(0,p.default)(this,n)}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var g=function(e){return e?e.startsWith("/")?e:"/"+e:"/"};t.ensureFirstSlash=g;t.generateWebLink=function(e){var t=e.cozyUrl,n=e.searchParams,r=e.pathname,a=e.hash,i=e.slug,o=e.subDomainType,u=new URL(t);u.host="nested"===o?"".concat(i,".").concat(u.host):u.host.split(".").map(function(e,t){return 0===t?e+"-"+i:e}).join("."),u.pathname=g(r),u.hash=g(a);var c,s=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(n||[]);try{for(s.s();!(c=s.n()).done;){var l=(0,v.default)(c.value,2),d=l[0],f=l[1];u.searchParams.set(d,f)}}catch(e){s.e(e)}finally{s.f()}return u.toString()};t.deconstructCozyWebLinkWithSlug=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat",n=new URL(e),r="nested"===t?n.host.split(".")[0]:n.host.split(".")[0].split("-")[1],a="nested"===t?n.host.split(".")[1]:n.host.split(".")[0].split("-")[0];return{cozyBaseDomain:n.host.split(".").slice("nested"===t?2:1).join("."),cozyName:a,pathname:n.pathname,hash:n.hash,protocol:n.protocol,searchParams:n.searchParams.toString(),slug:r}};t.deconstructRedirectLink=function(e){var t=e.split("#"),n=(0,v.default)(t,2),r=n[0],a=n[1],i=r.split(/\/(.*)/),o=(0,v.default)(i,2),u=o[0],c=o[1];if(!u.match(/^[a-z0-9]+$/))throw new k(e);return{slug:u,pathname:c,hash:a}};var k=function(e){(0,f.default)(n,e);var t=m(n);function n(e){var r;return(0,d.default)(this,n),(r=t.call(this,"Invalid redirect link ".concat(e))).redirectLink=e,r}return n}((0,y.default)(Error));t.InvalidRedirectLinkError=k;var _=function(e){(0,f.default)(n,e);var t=m(n);function n(e){var r;return(0,d.default)(this,n),(r=t.call(this,"Invalid URL protocol ".concat(e.protocol))).url=e,r}return n}((0,y.default)(Error));t.InvalidProtocolError=_;var O=function(e){(0,f.default)(n,e);var t=m(n);function n(e){var r;return(0,d.default)(this,n),(r=t.call(this,"Blocked cozy ".concat(e.toString()))).url=e,r}return n}((0,y.default)(Error));t.BlockedCozyError=O;var w=function(e){(0,f.default)(n,e);var t=m(n);function n(e){var r;return(0,d.default)(this,n),(r=t.call(this,"URL ".concat(e.toString()," does not seem to be a valid Cozy URL"))).url=e,r}return n}((0,y.default)(Error));t.InvalidCozyUrlError=w;var S=function(e){var t=e.protocol,n=e.hostname,r=e.port;return(""!==t?"".concat(t,"//"):"https://")+n+(""!==r?":".concat(r):"")};var x=(r=(0,l.default)(s.default.mark(function e(t){var n,r,a,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(S(t)+"/.well-known/change-password");case 2:if(r=(n=e.sent).status,a=n.url,404!==r){e.next=6;break}throw new w(t);case 6:return e.next=8,P(n);case 8:if(!e.sent){e.next=10;break}throw new O(t);case 10:return i=t.origin!==new URL(a).origin,e.abrupt("return",200===r&&!i);case 12:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});var E=(a=(0,l.default)(s.default.mark(function e(t){var n,r,a,i,o,l,d,f;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(["http:","https:"].includes(t.protocol)){e.next=2;break}throw new _(t);case 2:return e.next=4,x(t);case 4:if(!e.sent){e.next=6;break}return e.abrupt("return",new URL(S({protocol:t.protocol,hostname:t.hostname,port:t.port})));case 6:if(!/^[^.-][^.]+-[^.-]+\./.test(t.hostname)){e.next=14;break}return n=t.hostname.split("."),a=(r=(0,c.default)(n))[0],i=r.slice(1),o=[a.replace(/-.+/,"")].concat((0,u.default)(i)).join("."),l=new URL(S({protocol:t.protocol,hostname:o,port:t.port})),e.next=12,x(l);case 12:if(!e.sent){e.next=14;break}return e.abrupt("return",l);case 14:return d=t.hostname.split(".").splice(1).join("."),f=new URL(S({protocol:t.protocol,hostname:d,port:t.port})),e.next=18,x(f);case 18:if(!e.sent){e.next=20;break}return e.abrupt("return",f);case 20:throw new w(t);case 21:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)});t.rootCozyUrl=E;var P=(i=(0,l.default)(s.default.mark(function e(t){var n,r,a,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(503!==t.status)){e.next=2;break}return e.abrupt("return",!1);case 2:return a=(r=t.headers.get("content-type"))&&r.indexOf("json")>=0,e.next=6,a?t.json():t.text();case 6:if(!(null!=(i=e.sent)&&null!==(n=i.some)&&void 0!==n&&n.call(i,function(e){return"Blocked"===e.title}))){e.next=9;break}return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)})},378:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.queryConnectFlat=t.queryConnect=t.withClient=void 0;var i=a(n(64512)),o=a(n(95297)),u=r(n(67294)),c=a(n(45697)),s=a(n(47745)),l=a(n(18597)),d=a(n(26726)),f=n(72403),p=a(n(22853));function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}t.withClient=function(e){var t=function(t){var n=(0,d.default)();return u.default.createElement(e,(0,o.default)({},t,{client:n}))};return t.displayName="withClient(".concat(e.displayName||e.name,")"),t};var v=function(e,t,n){if(!t)throw Error("withQuery has no options for ".concat(e," (wrapping ").concat(n.name,")"));return function(n){var r=function(r,a){if(!a.client)throw Error("Should be used with client in context (use CozyProvider to set context)");var o="function"==typeof t?t(r):t;return t.doc?(p.default.warn("queryOpts.doc is deprecated"),u.default.createElement(n,y((0,i.default)({},e,o.doc),r))):u.default.createElement(l.default,o,function(t){return u.default.createElement(n,y((0,i.default)({},e,t),r))})};return r.contextTypes={client:c.default.object},r.displayName="withQuery(".concat(n.displayName||n.name,")"),r}};t.queryConnect=function(e){return function(t){var n=Object.keys(e).map(function(n){return v(n,e[n],t)});return s.default.apply(null,n)(t)}};t.queryConnectFlat=function(e){return function(t){var n=function(n){var r=(0,f.useQueries)(e);return u.default.createElement(t,(0,o.default)({},n,r))};return n.displayName="queryConnectFlat(".concat(t.displayName||t.name,")"),n}}},54277:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(67294);t.default=function(){var e=(0,r.useRef)();return(0,r.useEffect)(function(){return e.current=!0,function(){e.current=!1}},[]),e}},29568:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(90402)),i=n(67294),o=r(n(54277));t.default=function(e){var t=(0,o.default)(),n=(0,i.useState)(e),r=(0,a.default)(n,2),u=r[0],c=r[1];return[u,(0,i.useCallback)(function(e){t.current&&c(e)},[])]}},63786:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useAppLinkWithStoreFallback",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"useCapabilities",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"useFetchShortcut",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"useClient",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"useQuery",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"useQueries",{enumerable:!0,get:function(){return s.useQueries}}),Object.defineProperty(t,"useAppsInMaintenance",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"useQueryAll",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"useMutation",{enumerable:!0,get:function(){return f.useMutation}}),Object.defineProperty(t,"useInstanceInfo",{enumerable:!0,get:function(){return p.useInstanceInfo}}),Object.defineProperty(t,"useSettings",{enumerable:!0,get:function(){return h.useSettings}});var i=a(n(25199)),o=a(n(56733)),u=a(n(90797)),c=a(n(26726)),s=r(n(72403)),l=a(n(82475)),d=a(n(71747)),f=n(34607),p=n(22380),h=n(74108)},25199:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(90402)),u=n(67294),c=n(71450),s=n(23963);t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=(0,u.useState)("loading"),l=(0,o.default)(r,2),d=l[0],f=l[1],p=(0,u.useState)(!0),h=(0,o.default)(p,2),y=h[0],v=h[1],m=(0,u.useState)(null),b=(0,o.default)(m,2),g=b[0],k=b[1];return(0,u.useEffect)(function(){var r;(r=(0,i.default)(a.default.mark(function r(){var i,o,u;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.query((0,c.Q)("io.cozy.apps"));case 3:i=r.sent,o={slug:e},v(!!(u=(0,s.isInstalled)(i.data,o))),u?k((0,s.getUrl)(u)+n):k((0,s.getStoreURL)(i.data,o)),f("loaded"),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(0),f("errored");case 14:case"end":return r.stop()}},r,null,[[0,11]])})),function(){return r.apply(this,arguments)})()},[t,e,n]),{fetchStatus:d,isInstalled:y,url:g}}},82475:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(72403)),i=n(71450),o=r(n(18621));t.default=function(){return(0,a.default)((0,i.Q)("io.cozy.apps_registry").getById("maintenance"),{as:"io.cozy.apps_registry/maintenance",fetchPolicy:o.default.fetchPolicies.olderThan(6e5),singleDocData:!1}).data||[]}},56733:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(90402)),u=n(67294),c=r(n(27361)),s=n(71450);t.default=function(e){var t=(0,u.useState)(),n=(0,o.default)(t,2),r=n[0],l=n[1],d=(0,u.useState)("idle"),f=(0,o.default)(d,2),p=f[0],h=f[1];return(0,u.useEffect)(function(){var t,n=(t=(0,i.default)(a.default.mark(function t(){var n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h("loading"),t.prev=1,t.next=4,e.query((0,s.Q)("io.cozy.settings").getById("io.cozy.settings.capabilities"));case 4:n=t.sent,l((0,c.default)(n,"data",{})),h("loaded"),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),h("failed");case 12:case"end":return t.stop()}},t,null,[[1,9]])})),function(){return t.apply(this,arguments)});e.capabilities?(l(e.capabilities),h("loaded")):n()},[e]),{capabilities:r,fetchStatus:p}}},26726:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(67294),i=r(n(54028));r(n(18621));t.default=function(){return(0,a.useContext)(i.default).client}},90797:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(90402)),u=n(67294),c=n(71450),s=r(n(18621));t.default=function(e,t){var n=(0,u.useState)(null),r=(0,o.default)(n,2),l=r[0],d=r[1],f=(0,u.useState)(null),p=(0,o.default)(f,2),h=p[0],y=p[1],v=(0,u.useState)("idle"),m=(0,o.default)(v,2),b=m[0],g=m[1];return(0,u.useEffect)(function(){var n;(n=(0,i.default)(a.default.mark(function n(){var r,i,o,u,l,f;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return g("loading"),n.prev=1,n.next=4,e.fetchQueryAndGetFromState({definition:(0,c.Q)("io.cozy.files.shortcuts").getById(t),options:{as:"io.cozy.files.shortcuts/".concat(t),fetchPolicy:s.default.fetchPolicies.olderThan(6e5),singleDocData:!0}});case 4:if(!(l=null==(u=n.sent)?void 0:null===(r=u.data)||void 0===r?void 0:null===(i=r.metadata)||void 0===i?void 0:null===(o=i.target)||void 0===o?void 0:o.app)){n.next=13;break}return n.next=9,e.getStackClient().getIconURL({type:"app",slug:l,priority:"stack"});case 9:y(n.sent),n.next=16;break;case 13:f=new URL(u.data.url),y("".concat(e.getStackClient().uri,"/bitwarden/icons/").concat(f.host,"/icon.png"));case 16:d({data:u.data}),g("loaded"),n.next=23;break;case 20:n.prev=20,n.t0=n.catch(1),g("failed");case 23:case"end":return n.stop()}},n,null,[[1,20]])})),function(){return n.apply(this,arguments)})()},[e,t]),{shortcutInfos:l,shortcutImg:h,fetchStatus:b}}},22380:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.useInstanceInfo=void 0;var a=r(n(72403)),i=r(n(18621)),o=n(71450),u=n(88930);t.useInstanceInfo=function(){var e=c("io.cozy.settings.instance"),t=(0,a.default)(e.definition,e.options),n=c("io.cozy.settings.context"),r=(0,a.default)(n.definition,n.options),i=c("io.cozy.settings.disk-usage"),o=(0,a.default)(i.definition,i.options);return{isLoaded:null!==(0,u.hasQueryBeenLoaded)(t)&&null!==(0,u.hasQueryBeenLoaded)(r)&&null!==(0,u.hasQueryBeenLoaded)(o),instance:{data:t.data},context:{data:r.data},diskUsage:{data:o.data}}};var c=function(e){return{definition:(0,o.Q)("io.cozy.settings").getById(e),options:{as:"io.cozy.settings/".concat(e),fetchPolicy:i.default.fetchPolicies.olderThan(54e4),singleDocData:!0}}}},34607:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.useMutation=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(90402)),u=n(67294),c=r(n(45697)),s=r(n(26726)),l=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.onSuccess,r=void 0===n?void 0:n,c=t.onError,l=void 0===c?void 0:c,d=(0,s.default)(),f=(0,u.useState)("pending"),p=(0,o.default)(f,2),h=p[0],y=p[1],v=(0,u.useState)(),m=(0,o.default)(v,2),b=m[0],g=m[1],k=(0,u.useState)(),_=(0,o.default)(k,2),O=_[0],w=_[1];return{mutate:(0,u.useCallback)((e=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g(void 0),y("loading"),e.prev=2,e.next=5,d.save(t);case 5:if(w((n=e.sent).data),"function"!=typeof r){e.next=10;break}return e.next=10,r(n.data);case 10:y("loaded"),e.next=20;break;case 13:if(e.prev=13,e.t0=e.catch(2),y("failed"),g(e.t0),"function"!=typeof l){e.next=20;break}return e.next=20,l(e.t0);case 20:case"end":return e.stop()}},e,null,[[2,13]])})),function(t){return e.apply(this,arguments)}),[d,l,r]),mutationStatus:h,error:b,data:O}};t.useMutation=l,l.propTypes={onSuccess:c.default.func,onError:c.default.func}},72403:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.useQueries=void 0;var a=r(n(90402)),i=r(n(64512)),o=n(67294),u=n(70471),c=r(n(27361)),s=r(n(26726)),l=r(n(22853)),d=n(54028);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n(71450);var h=(0,u.createSelectorHook)(d.clientContext),y=function(e,t){if(!h)throw Error("You must use react-redux > 7.1.0 to use useQuery (uses useSelector) under the hood");if(!e)throw l.default.warn("Bad query",e),Error("Bad query");var n,r=t.as,a=t.enabled,i=void 0===a||a;var u=i?"function"==typeof(n=e)?n():n:null;if(!r)throw Error("You must specify options.as when using useQuery");var d=(0,s.default)(),f=h(function(){return void 0===t.singleDocData&&null!=u&&u.id&&l.default.warn("useQuery options.singleDocData will pass to true in a next version of cozy-client, please add it now to prevent any problem in the future."),d.getQueryFromState(r,{hydrated:(0,c.default)(t,"hydrated",!0),singleDocData:(0,c.default)(t,"singleDocData",!1)})});(0,o.useEffect)(function(){if(!1!==i)d.query(u,t)},[r,i]);var y=(0,o.useCallback)(function(){var e,t=d.getQueryFromState(r);return d.query((e=t).bookmark?e.definition.offsetBookmark(e.bookmark):e.definition.offset(e.data.length),{as:r})},[r,d]),v=(0,o.useCallback)(function(){return d.query(u,t)},[d,u,t]);return p(p({},f),{},{fetchMore:y,fetch:v})};t.useQueries=function(e){for(var t={},n=0,r=Object.entries(e);n<r.length;n++){var i=(0,a.default)(r[n],2),o=i[0],u=i[1];t[o]=y(u.query,u)}return t};t.default=y},71747:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(90402)),u=n(67294);n(71450);var c=r(n(72403)),s=r(n(29568));t.default=function(e,t){var n=(0,s.default)(!1),r=(0,o.default)(n,2),l=r[0],d=r[1],f=(0,c.default)(e,t);return(0,u.useEffect)(function(){var e;(e=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("loaded"===f.fetchStatus&&f.hasMore&&!l)){e.next=5;break}return d(!0),e.next=4,f.fetchMore();case 4:d(!1);case 5:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})()},[f.hasMore,f.fetchStatus,l]),f}},74108:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.useSettings=void 0;var a=r(n(80295)),i=n(67294),o=n(72004),u=n(34607),c=r(n(72403)),s=n(88930),l=n(56200);t.useSettings=function(e,t){var n=(0,o.getQuery)(e),r=(0,c.default)(n.definition,n.options),d=r.data,f=(0,a.default)(r,["data"]),p=(0,u.useMutation)(),h=p.mutate,y=(0,a.default)(p,["mutate"]),v=(0,i.useCallback)(function(t){var n=(0,o.normalizeSettings)(d);return h((0,o.editSettings)(e,n,t))},[h,d,e]),m=(0,o.normalizeSettings)(d),b=(0,s.hasQueryBeenLoaded)(f)?(0,l.extractKeys)(m,t):void 0;return{query:f,values:b,save:v,mutation:y}}},16396:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0});var i={CozyLink:!0,StackLink:!0,WebFlagshipLink:!0,compose:!0,QueryDefinition:!0,Q:!0,Mutations:!0,MutationTypes:!0,getDoctypeFromOperation:!0,Association:!0,HasMany:!0,HasOne:!0,HasOneInPlace:!0,HasManyInPlace:!0,HasManyTriggers:!0,isReferencedBy:!0,isReferencedById:!0,getReferencedBy:!0,getReferencedById:!0,deconstructCozyWebLinkWithSlug:!0,deconstructRedirectLink:!0,dehydrate:!0,generateWebLink:!0,ensureFirstSlash:!0,rootCozyUrl:!0,InvalidRedirectLinkError:!0,InvalidCozyUrlError:!0,InvalidProtocolError:!0,BlockedCozyError:!0,cancelable:!0,isQueryLoading:!0,hasQueryBeenLoaded:!0,isQueriesLoading:!0,hasQueriesBeenLoaded:!0,getQueryFromState:!0,dispatchCreate:!0,dispatchUpdate:!0,dispatchDelete:!0,Registry:!0,RealTimeQueries:!0,manifest:!0,CozyProvider:!0,withMutation:!0,withMutations:!0,Query:!0,queryConnect:!0,queryConnectFlat:!0,withClient:!0,models:!0,fetchPolicies:!0,BulkEditError:!0};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"CozyLink",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"StackLink",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"WebFlagshipLink",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"compose",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"QueryDefinition",{enumerable:!0,get:function(){return d.QueryDefinition}}),Object.defineProperty(t,"Q",{enumerable:!0,get:function(){return d.Q}}),Object.defineProperty(t,"Mutations",{enumerable:!0,get:function(){return d.Mutations}}),Object.defineProperty(t,"MutationTypes",{enumerable:!0,get:function(){return d.MutationTypes}}),Object.defineProperty(t,"getDoctypeFromOperation",{enumerable:!0,get:function(){return d.getDoctypeFromOperation}}),Object.defineProperty(t,"Association",{enumerable:!0,get:function(){return f.Association}}),Object.defineProperty(t,"HasMany",{enumerable:!0,get:function(){return f.HasMany}}),Object.defineProperty(t,"HasOne",{enumerable:!0,get:function(){return f.HasOne}}),Object.defineProperty(t,"HasOneInPlace",{enumerable:!0,get:function(){return f.HasOneInPlace}}),Object.defineProperty(t,"HasManyInPlace",{enumerable:!0,get:function(){return f.HasManyInPlace}}),Object.defineProperty(t,"HasManyTriggers",{enumerable:!0,get:function(){return f.HasManyTriggers}}),Object.defineProperty(t,"isReferencedBy",{enumerable:!0,get:function(){return p.isReferencedBy}}),Object.defineProperty(t,"isReferencedById",{enumerable:!0,get:function(){return p.isReferencedById}}),Object.defineProperty(t,"getReferencedBy",{enumerable:!0,get:function(){return p.getReferencedBy}}),Object.defineProperty(t,"getReferencedById",{enumerable:!0,get:function(){return p.getReferencedById}}),Object.defineProperty(t,"deconstructCozyWebLinkWithSlug",{enumerable:!0,get:function(){return h.deconstructCozyWebLinkWithSlug}}),Object.defineProperty(t,"deconstructRedirectLink",{enumerable:!0,get:function(){return h.deconstructRedirectLink}}),Object.defineProperty(t,"dehydrate",{enumerable:!0,get:function(){return h.dehydrate}}),Object.defineProperty(t,"generateWebLink",{enumerable:!0,get:function(){return h.generateWebLink}}),Object.defineProperty(t,"ensureFirstSlash",{enumerable:!0,get:function(){return h.ensureFirstSlash}}),Object.defineProperty(t,"rootCozyUrl",{enumerable:!0,get:function(){return h.rootCozyUrl}}),Object.defineProperty(t,"InvalidRedirectLinkError",{enumerable:!0,get:function(){return h.InvalidRedirectLinkError}}),Object.defineProperty(t,"InvalidCozyUrlError",{enumerable:!0,get:function(){return h.InvalidCozyUrlError}}),Object.defineProperty(t,"InvalidProtocolError",{enumerable:!0,get:function(){return h.InvalidProtocolError}}),Object.defineProperty(t,"BlockedCozyError",{enumerable:!0,get:function(){return h.BlockedCozyError}}),Object.defineProperty(t,"cancelable",{enumerable:!0,get:function(){return y.cancelable}}),Object.defineProperty(t,"isQueryLoading",{enumerable:!0,get:function(){return y.isQueryLoading}}),Object.defineProperty(t,"hasQueryBeenLoaded",{enumerable:!0,get:function(){return y.hasQueryBeenLoaded}}),Object.defineProperty(t,"isQueriesLoading",{enumerable:!0,get:function(){return y.isQueriesLoading}}),Object.defineProperty(t,"hasQueriesBeenLoaded",{enumerable:!0,get:function(){return y.hasQueriesBeenLoaded}}),Object.defineProperty(t,"getQueryFromState",{enumerable:!0,get:function(){return v.getQueryFromState}}),Object.defineProperty(t,"dispatchCreate",{enumerable:!0,get:function(){return v.dispatchCreate}}),Object.defineProperty(t,"dispatchUpdate",{enumerable:!0,get:function(){return v.dispatchUpdate}}),Object.defineProperty(t,"dispatchDelete",{enumerable:!0,get:function(){return v.dispatchDelete}}),Object.defineProperty(t,"Registry",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"RealTimeQueries",{enumerable:!0,get:function(){return b.default}}),Object.defineProperty(t,"CozyProvider",{enumerable:!0,get:function(){return k.default}}),Object.defineProperty(t,"withMutation",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"withMutations",{enumerable:!0,get:function(){return O.default}}),Object.defineProperty(t,"Query",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(t,"queryConnect",{enumerable:!0,get:function(){return S.queryConnect}}),Object.defineProperty(t,"queryConnectFlat",{enumerable:!0,get:function(){return S.queryConnectFlat}}),Object.defineProperty(t,"withClient",{enumerable:!0,get:function(){return S.withClient}}),Object.defineProperty(t,"fetchPolicies",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(t,"BulkEditError",{enumerable:!0,get:function(){return D.BulkEditError}}),t.models=t.manifest=void 0;var o=a(n(18621)),u=a(n(37130)),c=a(n(97619)),s=a(n(62946)),l=a(n(59242)),d=n(71450),f=n(25367),p=n(11282),h=n(72004),y=n(88930),v=n(65972),m=a(n(10513)),b=a(n(1153)),g=r(n(86092));t.manifest=g;var k=a(n(63384)),_=a(n(43592)),O=a(n(18428)),w=a(n(18597)),S=n(378),x=r(n(4034));t.models=x;var E=a(n(39268)),P=n(24424);Object.keys(P).forEach(function(e){if(!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(i,e)))(!(e in t)||t[e]!==P[e])&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return P[e]}})});var C=n(63786);Object.keys(C).forEach(function(e){if(!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(i,e)))(!(e in t)||t[e]!==C[e])&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}})});var D=n(29822)},22853:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(60732)),i=(0,a.default)("cozy-client");a.default.suggest.deny("cozy-client","info");t.default=i},24424:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.createFakeClient=t.createMockClient=void 0;var a=r(n(90402)),i=r(n(68434)),o=r(n(82007)),u=r(n(64512)),c=r(n(80295)),s=r(n(82492)),l=r(n(18621)),d=n(65972),f=n(60359),p=n(71450);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var y=function(e,t,n){var r=n.definition,a=n.doctype,i=n.data,o=n.queryError,s=(0,c.default)(n,["definition","doctype","data","queryError"]);e.store.dispatch((0,d.initQuery)(t,r||(0,p.Q)(a))),o?e.store.dispatch((0,d.receiveQueryError)(t,o)):e.store.dispatch((0,d.receiveQueryResult)(t,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({data:i?i.map(function(e){return(0,f.normalizeDoc)(e,a)}):i},s)))},v=function(e){var t;return t=(0,o.default)(i.default.mark(function t(n){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",{data:null});case 2:if(!e[n.doctype]){t.next=6;break}return t.abrupt("return",{data:e[n.doctype]});case 6:return t.abrupt("return",{data:[]});case 7:case"end":return t.stop()}},t)})),function(e){return t.apply(this,arguments)}};t.createMockClient=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.queries,n=e.remote,r=e.clientOptions,a=e.clientFunctions,i=jest.fn().mockImplementation(v(n));return m({queries:t,remote:n,clientOptions:r,clientFunctions:(0,s.default)({query:i,save:jest.fn(),saveAll:jest.fn(),stackClient:{fetchJSON:jest.fn()}},a)})};var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.queries,n=e.remote,r=e.clientOptions,i=e.clientFunctions,o=new l.default(r||{});o.ensureStore();for(var u=0,c=Object.entries(t||{});u<c.length;u++){var d=(0,a.default)(c[u],2);y(o,d[0],d[1])}return o.query=v(n),(0,s.default)(o,i),o};t.createFakeClient=m},94564:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isAccountWithTrigger=t.buildAccount=t.getAccountName=t.getAccountLogin=t.setContractSyncStatusInAccount=t.getContractSyncStatusFromAccount=t.muteError=t.getMutedErrors=void 0;var i=a(n(68434)),o=a(n(82007)),u=a(n(64512)),c=a(n(82492)),s=n(71450),l=n(13965),d=n(86092);function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=function(e){return(null==e?void 0:e.mutedErrors)||[]};t.getMutedErrors=y;t.muteError=function(e,t){var n=y(e);return n.push({type:t,mutedAt:new Date().toISOString()}),h(h({},e),{},{mutedErrors:n})};t.getContractSyncStatusFromAccount=function(e,t){var n,r,a=(0,l.getHasManyItem)(e,"contracts",t);if(!a)throw Error("Cannot find contrat ".concat(t," in account"));return null===(n=null==a?void 0:null===(r=a.metadata)||void 0===r?void 0:r.imported)||void 0===n||n};t.setContractSyncStatusInAccount=function(e,t,n){return(0,l.updateHasManyItem)(e,"contracts",t,function(e){if(void 0===e)throw Error("Cannot find contrat ".concat(t," in account"));return(0,c.default)({},e,{metadata:{imported:n}})})};var v=function(e){if(e.identifier)return e.auth[e.identifier];if(e&&e.auth){var t,n=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(d.legacyLoginFields);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e.auth[r])return e.auth[r]}}catch(e){n.e(e)}finally{n.f()}}return null};t.getAccountLogin=v;t.getAccountName=function(e){return e?e.auth&&(e.auth.accountName||v(e))||e._id:null};t.buildAccount=function(e,t){return{auth:t,account_type:e.slug,identifier:(0,d.getIdentifier)(e.fields),state:null}};var m=(r=(0,o.default)(i.default.mark(function e(t,n){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query((0,s.Q)("io.cozy.triggers").where({"message.account":n._id}).indexFields(["message.account"]).limitBy(1));case 2:return r=e.sent,e.abrupt("return",r.data.length>0);case 4:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.isAccountWithTrigger=m},23963:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getAppDisplayName=t.getUrl=t.isInstalled=t.getStoreInstallationURL=t.getStoreURL=void 0;var a=r(n(27361)),i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.slug)throw Error("Expected app / konnector with the defined slug");var n=o(e,{slug:"store"});if(!n)return null;var r=n.links&&n.links.related;return r?"".concat(r,"#/discover/").concat(t.slug):null};t.getStoreURL=i;t.getStoreInstallationURL=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i(e,t);return n?"".concat(n,"/install"):null};var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.find(function(e){return e.slug===t.slug})};t.isInstalled=o;t.getUrl=function(e){return e.links&&e.links.related};t.getAppDisplayName=function(e,t){var n=(0,a.default)(e,"name_prefix"),r=(0,a.default)(e,"name"),i=(0,a.default)(e,["locales",t,"name"],r),o=(0,a.default)(e,["locales",t,"name_prefix"],n);return o&&"cozy"!==o.toLowerCase()?"".concat(o," ").concat(i):i}},88842:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.hasExtensionInstalledAttribute=void 0;var i=a(n(68434)),o=a(n(82007)),u=n(71450);var c=(r=(0,o.default)(i.default.mark(function e(t){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetchQueryAndGetFromState({definition:(0,u.Q)("io.cozy.settings").getById("io.cozy.settings.bitwarden"),options:{as:"io.cozy.settings/io.cozy.settings.bitwarden",singleDocData:!0}});case 3:return n=e.sent.data.extension_installed,e.abrupt("return",!!n);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",!1);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(e){return r.apply(this,arguments)});t.hasExtensionInstalledAttribute=c},47978:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isMagicLink=t.isOIDC=void 0;t.isOIDC=function(e){var t;return null!==(t=e.capabilities.can_auth_with_oidc)&&void 0!==t&&t};t.isMagicLink=function(e){var t;return null!==(t=e.capabilities.can_auth_with_magic_links)&&void 0!==t&&t}},40996:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isContact=t.getIndexByFamilyNameGivenNameEmailCozyUrl=t.getDefaultSortIndexValue=t.makeDefaultSortIndexValue=t.getDisplayName=t.makeDisplayName=t.getFullname=t.makeFullname=t.getPrimaryAddress=t.getPrimaryPhone=t.getPrimaryCozyDomain=t.getPrimaryCozy=t.getPrimaryEmail=t.getInitials=t.getPrimaryOrFirst=t.CONTACTS_DOCTYPE=void 0;var a=r(n(27361)),i=r(n(41609)),o=r(n(22853)),u="io.cozy.contacts";t.CONTACTS_DOCTYPE=u;var c=function(e){return function(t){return t&&t[e]&&0!==t[e].length&&t[e][0]?t[e].find(function(e){return e.primary})||t[e][0]:""}};t.getPrimaryOrFirst=c;t.getInitials=function(e){if(null!=e&&null!==(t=e.name)&&void 0!==t&&t.givenName||null!=e&&null!==(n=e.name)&&void 0!==n&&n.familyName)return["givenName","familyName"].map(function(t){return(0,a.default)(e,["name",t,0],"")}).join("").toUpperCase();var t,n,r=s(e);if(r)return r[0].toUpperCase();var i=d(e);return i?i[0].toUpperCase():""};var s=function(e){return Array.isArray(e.email)?c("email")(e).address||"":e.email};t.getPrimaryEmail=s;var l=function(e){return Array.isArray(e.cozy)?c("cozy")(e).url||"":e.url};t.getPrimaryCozy=l;var d=function(e){try{return new URL(l(e)).hostname.replace(/^(www.)/g,"")}catch(t){return l(e)}};t.getPrimaryCozyDomain=d;t.getPrimaryPhone=function(e){return c("phone")(e).number||""};t.getPrimaryAddress=function(e){return c("address")(e).formattedAddress||""};var f=["namePrefix","givenName","additionalName","familyName","nameSuffix"],p=function(e,t){var n=(null==t?void 0:t.attributesFullname)||f;return e.name?n.map(function(t){return e.name[t]}).filter(function(e){return void 0!==e}).join(" ").trim():""};t.makeFullname=p;t.getFullname=function(e){return(0,a.default)(e,"fullname")?e.fullname:p(e)};var h=function(e,t){var n=p(e,t),r=s(e),a=d(e);return n&&n.length>0?n:r&&r.length>0?r:a&&a.length>0?a:""};t.makeDisplayName=h;t.getDisplayName=function(e){return(0,a.default)(e,"displayName")?e.displayName:h(e)};var y=function(e){var t=[(0,a.default)(e,"name.familyName",""),(0,a.default)(e,"name.givenName",""),s(e),d(e)].join("").trim().toLowerCase();return 0===t.length?null:t};t.makeDefaultSortIndexValue=y;var v=function(e){var t=(0,a.default)(e,"indexes.byFamilyNameGivenNameEmailCozyUrl",null);return null!==t?(0,i.default)(t)?null:t:y(e)};t.getDefaultSortIndexValue=v;t.getIndexByFamilyNameGivenNameEmailCozyUrl=function(e){return o.default.warn("Deprecation: `getIndexByFamilyNameGivenNameEmailCozyUrl` is deprecated, please use `getDefaultSortIndexValue` instead"),v(e)};t.isContact=function(e){return e._type===u}},65314:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getEmojiByCountry=t.getAllNationalities=t.getNationalityByCodeISO=t.getAllCountryNames=t.getCountryNameByCodeISO=t.getAllCountries=t.checkCountryCode=t.isCountryCodeAlpha2=t.isCountryCodeAlpha3=t.isValidCountryCodeTranslation=t.COUNTRIES_ISO=void 0;var a=r(n(98235)),i=n(61774),o=r(n(22853)),u=[{code2:"AF",code3:"AFG",number:"004"},{code2:"AL",code3:"ALB",number:"008"},{code2:"DZ",code3:"DZA",number:"012"},{code2:"AD",code3:"AND",number:"020"},{code2:"AO",code3:"AGO",number:"024"},{code2:"AG",code3:"ATG",number:"028"},{code2:"AR",code3:"ARG",number:"032"},{code2:"AM",code3:"ARM",number:"051"},{code2:"AU",code3:"AUS",number:"036"},{code2:"AT",code3:"AUT",number:"040"},{code2:"AZ",code3:"AZE",number:"031"},{code2:"BS",code3:"BHS",number:"044"},{code2:"BH",code3:"BHR",number:"048"},{code2:"BD",code3:"BGD",number:"050"},{code2:"BB",code3:"BRB",number:"052"},{code2:"BY",code3:"BLR",number:"112"},{code2:"BE",code3:"BEL",number:"056"},{code2:"BZ",code3:"BLZ",number:"084"},{code2:"BJ",code3:"BEN",number:"204"},{code2:"BM",code3:"BMU",number:"060"},{code2:"BT",code3:"BTN",number:"064"},{code2:"BO",code3:"BOL",number:"068"},{code2:"BQ",code3:"BES",number:"535"},{code2:"BA",code3:"BIH",number:"070"},{code2:"BW",code3:"BWA",number:"072"},{code2:"BV",code3:"BVT",number:"074"},{code2:"BR",code3:"BRA",number:"076"},{code2:"IO",code3:"IOT",number:"086"},{code2:"BN",code3:"BRN",number:"096"},{code2:"BG",code3:"BGR",number:"100"},{code2:"BF",code3:"BFA",number:"854"},{code2:"BI",code3:"BDI",number:"108"},{code2:"CV",code3:"CPV",number:"132"},{code2:"KH",code3:"KHM",number:"116"},{code2:"CM",code3:"CMR",number:"120"},{code2:"CA",code3:"CAN",number:"124"},{code2:"KY",code3:"CYM",number:"136"},{code2:"CF",code3:"CAF",number:"140"},{code2:"TD",code3:"TCD",number:"148"},{code2:"CL",code3:"CHL",number:"152"},{code2:"CN",code3:"CHN",number:"156"},{code2:"CX",code3:"CXR",number:"162"},{code2:"CC",code3:"CCK",number:"166"},{code2:"CO",code3:"COL",number:"170"},{code2:"KM",code3:"COM",number:"174"},{code2:"CD",code3:"COD",number:"180"},{code2:"CG",code3:"COG",number:"178"},{code2:"CK",code3:"COK",number:"184"},{code2:"CR",code3:"CRI",number:"188"},{code2:"HR",code3:"HRV",number:"191"},{code2:"CU",code3:"CUB",number:"192"},{code2:"CW",code3:"CUW",number:"531"},{code2:"CY",code3:"CYP",number:"196"},{code2:"CZ",code3:"CZE",number:"203"},{code2:"CI",code3:"CIV",number:"384"},{code2:"DK",code3:"DNK",number:"208"},{code2:"DJ",code3:"DJI",number:"262"},{code2:"DM",code3:"DMA",number:"212"},{code2:"DO",code3:"DOM",number:"214"},{code2:"EC",code3:"ECU",number:"218"},{code2:"EG",code3:"EGY",number:"818"},{code2:"SV",code3:"SLV",number:"222"},{code2:"GQ",code3:"GNQ",number:"226"},{code2:"ER",code3:"ERI",number:"232"},{code2:"EE",code3:"EST",number:"233"},{code2:"SZ",code3:"SWZ",number:"748"},{code2:"ET",code3:"ETH",number:"231"},{code2:"FK",code3:"FLK",number:"238"},{code2:"FO",code3:"FRO",number:"234"},{code2:"FJ",code3:"FJI",number:"242"},{code2:"FI",code3:"FIN",number:"246"},{code2:"FR",code3:"FRA",number:"250"},{code2:"GF",code3:"GUF",number:"254"},{code2:"PF",code3:"PYF",number:"258"},{code2:"TF",code3:"ATF",number:"260"},{code2:"GA",code3:"GAB",number:"266"},{code2:"GM",code3:"GMB",number:"270"},{code2:"GE",code3:"GEO",number:"268"},{code2:"DE",code3:"DEU",number:"276"},{code2:"GH",code3:"GHA",number:"288"},{code2:"GI",code3:"GIB",number:"292"},{code2:"GR",code3:"GRC",number:"300"},{code2:"GL",code3:"GRL",number:"304"},{code2:"GD",code3:"GRD",number:"308"},{code2:"GP",code3:"GLP",number:"312"},{code2:"GU",code3:"GUM",number:"316"},{code2:"GT",code3:"GTM",number:"320"},{code2:"GG",code3:"GGY",number:"831"},{code2:"GN",code3:"GIN",number:"324"},{code2:"GW",code3:"GNB",number:"624"},{code2:"GY",code3:"GUY",number:"328"},{code2:"HT",code3:"HTI",number:"332"},{code2:"HM",code3:"HMD",number:"334"},{code2:"VA",code3:"VAT",number:"336"},{code2:"HN",code3:"HND",number:"340"},{code2:"HK",code3:"HKG",number:"344"},{code2:"HU",code3:"HUN",number:"348"},{code2:"IS",code3:"ISL",number:"352"},{code2:"IN",code3:"IND",number:"356"},{code2:"ID",code3:"IDN",number:"360"},{code2:"IR",code3:"IRN",number:"364"},{code2:"IQ",code3:"IRQ",number:"368"},{code2:"IE",code3:"IRL",number:"372"},{code2:"IM",code3:"IMN",number:"833"},{code2:"IL",code3:"ISR",number:"376"},{code2:"IT",code3:"ITA",number:"380"},{code2:"JM",code3:"JAM",number:"388"},{code2:"JP",code3:"JPN",number:"392"},{code2:"JE",code3:"JEY",number:"832"},{code2:"JO",code3:"JOR",number:"400"},{code2:"KZ",code3:"KAZ",number:"398"},{code2:"KE",code3:"KEN",number:"404"},{code2:"KI",code3:"KIR",number:"296"},{code2:"KP",code3:"PRK",number:"408"},{code2:"KR",code3:"KOR",number:"410"},{code2:"KW",code3:"KWT",number:"414"},{code2:"KG",code3:"KGZ",number:"417"},{code2:"LA",code3:"LAO",number:"418"},{code2:"LV",code3:"LVA",number:"428"},{code2:"LB",code3:"LBN",number:"422"},{code2:"LS",code3:"LSO",number:"426"},{code2:"LR",code3:"LBR",number:"430"},{code2:"LY",code3:"LBY",number:"434"},{code2:"LI",code3:"LIE",number:"438"},{code2:"LT",code3:"LTU",number:"440"},{code2:"LU",code3:"LUX",number:"442"},{code2:"MO",code3:"MAC",number:"446"},{code2:"MG",code3:"MDG",number:"450"},{code2:"MW",code3:"MWI",number:"454"},{code2:"MY",code3:"MYS",number:"458"},{code2:"MV",code3:"MDV",number:"462"},{code2:"ML",code3:"MLI",number:"466"},{code2:"MT",code3:"MLT",number:"470"},{code2:"MH",code3:"MHL",number:"584"},{code2:"MQ",code3:"MTQ",number:"474"},{code2:"MR",code3:"MRT",number:"478"},{code2:"MU",code3:"MUS",number:"480"},{code2:"YT",code3:"MYT",number:"175"},{code2:"MX",code3:"MEX",number:"484"},{code2:"FM",code3:"FSM",number:"583"},{code2:"MD",code3:"MDA",number:"498"},{code2:"MC",code3:"MCO",number:"492"},{code2:"MN",code3:"MNG",number:"496"},{code2:"ME",code3:"MNE",number:"499"},{code2:"MS",code3:"MSR",number:"500"},{code2:"MA",code3:"MAR",number:"504"},{code2:"MZ",code3:"MOZ",number:"508"},{code2:"MM",code3:"MMR",number:"104"},{code2:"NA",code3:"NAM",number:"516"},{code2:"NR",code3:"NRU",number:"520"},{code2:"NP",code3:"NPL",number:"524"},{code2:"NL",code3:"NLD",number:"528"},{code2:"NC",code3:"NCL",number:"540"},{code2:"NZ",code3:"NZL",number:"554"},{code2:"NI",code3:"NIC",number:"558"},{code2:"NE",code3:"NER",number:"562"},{code2:"NG",code3:"NGA",number:"566"},{code2:"NU",code3:"NIU",number:"570"},{code2:"NF",code3:"NFK",number:"574"},{code2:"MP",code3:"MNP",number:"580"},{code2:"NO",code3:"NOR",number:"578"},{code2:"OM",code3:"OMN",number:"512"},{code2:"PK",code3:"PAK",number:"586"},{code2:"PW",code3:"PLW",number:"585"},{code2:"PS",code3:"PSE",number:"275"},{code2:"PA",code3:"PAN",number:"591"},{code2:"PG",code3:"PNG",number:"598"},{code2:"PY",code3:"PRY",number:"600"},{code2:"PE",code3:"PER",number:"604"},{code2:"PH",code3:"PHL",number:"608"},{code2:"PN",code3:"PCN",number:"612"},{code2:"PL",code3:"POL",number:"616"},{code2:"PT",code3:"PRT",number:"620"},{code2:"PR",code3:"PRI",number:"630"},{code2:"QA",code3:"QAT",number:"634"},{code2:"MK",code3:"MKD",number:"807"},{code2:"RO",code3:"ROU",number:"642"},{code2:"RU",code3:"RUS",number:"643"},{code2:"RW",code3:"RWA",number:"646"},{code2:"RE",code3:"REU",number:"638"},{code2:"BL",code3:"BLM",number:"652"},{code2:"SH",code3:"SHN",number:"654"},{code2:"KN",code3:"KNA",number:"659"},{code2:"LC",code3:"LCA",number:"662"},{code2:"MF",code3:"MAF",number:"663"},{code2:"PM",code3:"SPM",number:"666"},{code2:"VC",code3:"VCT",number:"670"},{code2:"WS",code3:"WSM",number:"882"},{code2:"SM",code3:"SMR",number:"674"},{code2:"ST",code3:"STP",number:"678"},{code2:"SA",code3:"SAU",number:"682"},{code2:"SN",code3:"SEN",number:"686"},{code2:"RS",code3:"SRB",number:"688"},{code2:"SC",code3:"SYC",number:"690"},{code2:"SL",code3:"SLE",number:"694"},{code2:"SG",code3:"SGP",number:"702"},{code2:"SX",code3:"SXM",number:"534"},{code2:"SK",code3:"SVK",number:"703"},{code2:"SI",code3:"SVN",number:"705"},{code2:"SB",code3:"SLB",number:"090"},{code2:"SO",code3:"SOM",number:"706"},{code2:"ZA",code3:"ZAF",number:"710"},{code2:"GS",code3:"SGS",number:"239"},{code2:"SS",code3:"SSD",number:"728"},{code2:"ES",code3:"ESP",number:"724"},{code2:"LK",code3:"LKA",number:"144"},{code2:"SD",code3:"SDN",number:"729"},{code2:"SR",code3:"SUR",number:"740"},{code2:"SJ",code3:"SJM",number:"744"},{code2:"SE",code3:"SWE",number:"752"},{code2:"CH",code3:"CHE",number:"756"},{code2:"SY",code3:"SYR",number:"760"},{code2:"TW",code3:"TWN",number:"158"},{code2:"TJ",code3:"TJK",number:"762"},{code2:"TZ",code3:"TZA",number:"834"},{code2:"TH",code3:"THA",number:"764"},{code2:"TL",code3:"TLS",number:"626"},{code2:"TG",code3:"TGO",number:"768"},{code2:"TK",code3:"TKL",number:"772"},{code2:"TO",code3:"TON",number:"776"},{code2:"TT",code3:"TTO",number:"780"},{code2:"TN",code3:"TUN",number:"788"},{code2:"TR",code3:"TUR",number:"792"},{code2:"TM",code3:"TKM",number:"795"},{code2:"TC",code3:"TCA",number:"796"},{code2:"TV",code3:"TUV",number:"798"},{code2:"UG",code3:"UGA",number:"800"},{code2:"UA",code3:"UKR",number:"804"},{code2:"AE",code3:"ARE",number:"784"},{code2:"GB",code3:"GBR",number:"826"},{code2:"UM",code3:"UMI",number:"581"},{code2:"US",code3:"USA",number:"840"},{code2:"UY",code3:"URY",number:"858"},{code2:"UZ",code3:"UZB",number:"860"},{code2:"VU",code3:"VUT",number:"548"},{code2:"VE",code3:"VEN",number:"862"},{code2:"VN",code3:"VNM",number:"704"},{code2:"VG",code3:"VGB",number:"092"},{code2:"VI",code3:"VIR",number:"850"},{code2:"WF",code3:"WLF",number:"876"},{code2:"EH",code3:"ESH",number:"732"},{code2:"YE",code3:"YEM",number:"887"},{code2:"ZM",code3:"ZMB",number:"894"},{code2:"ZW",code3:"ZWE",number:"716"},{code2:"AX",code3:"ALA",number:"248"}];t.COUNTRIES_ISO=u;t.isValidCountryCodeTranslation=function(e,t){var n=(0,i.getLocalizer)(e).polyglot;return s(t)&&n.has("nationalities.".concat(t))&&n.has("countries.".concat(t))};var c=function(e){if(!e)return!1;var t=e.toUpperCase();return u.some(function(e){return e.code3===t})};t.isCountryCodeAlpha3=c;var s=function(e){if(!e)return!1;var t=e.toUpperCase();return u.some(function(e){return e.code2===t})};t.isCountryCodeAlpha2=s;t.checkCountryCode=function(e){return s(e)||c(e)};var l=function(e){var t=(0,i.getLocalizer)(e).t;return u.map(function(e){return{code2:e.code2,code3:e.code3,number:e.number,name:t("countries.".concat(e.code2)),nationality:t("nationalities.".concat(e.code2))}})};t.getAllCountries=l;var d=function(e){return function(t){var n,r=null==e?void 0:null===(n=e.toString())||void 0===n?void 0:n.toUpperCase();return/^[A-Z]{2,3}$/.test(r)?t.code2===r||t.code3===r:!!/^\d+$/.test(r)&&t.number===r}};t.getCountryNameByCodeISO=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{lang:"en"},n=l(t.lang).find(d(e));return n?n.name:(o.default.warn("Country with code ".concat(e," not found")),null)};t.getAllCountryNames=function(e){return l(e).map(function(e){return e.name})};t.getNationalityByCodeISO=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{lang:"en"},n=l(t.lang).find(d(e));return n?n.nationality:(o.default.warn("Nationality with code ".concat(e," not found")),null)};t.getAllNationalities=function(e){return l(e).map(function(e){return e.nationality})};t.getEmojiByCountry=function(e){if(!e)return null;if(!/^[a-z]{2}$/i.test(e))return o.default.error("Country argument must be an ISO 3166-1 alpha-2 string, but got '".concat(JSON.stringify(e),"' instead.")),null;if(!u.find(function(t){return t.code2===e.toUpperCase()}))return o.default.error("Country with code ".concat(e," not found in the list of countries")),null;var t=(0,a.default)(e.toUpperCase()).map(function(e){return e.codePointAt(0)+127397});return String.fromCodePoint.apply(String,(0,a.default)(t))}},61774:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getLocalizer=void 0;for(var a=r(n(54078)),i=r(n(20455)),o=r(n(40883)),u={en:i.default,fr:o.default},c={},s=0,l=["fr","en"];s<l.length;s++){var d=l[s],f=new a.default;f.extend(u[d]),c[d]=f}t.getLocalizer=function(e){var t=c[e]||c.en;return{t:t.t.bind(t),polyglot:t,lang:e}}},61645:function(e,t,n){var r,a,i=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAggregatesFromDACC=t.buildAggregateParams=t.sendMeasureToDACC=t.checkMeasureParams=t.isCorrectDateFormat=void 0;var o=i(n(68434)),u=i(n(82007)),c=i(n(33918));i(n(18621));var s=function(e){try{return!!new Date(Date.parse(e)).toISOString().startsWith(e)}catch(e){return!1}};t.isCorrectDateFormat=s;var l=function(e){var t=e.createdBy,n=e.measureName,r=e.startDate,a=e.value,i=e.group1,o=e.group2,u=e.group3;if(!t||"string"!=typeof t)throw Error("Missing or wrong type parameter: createdBy");if(!n||"string"!=typeof n)throw Error("Missing or wrong type parameter: measureName");if(!r)throw Error("Missing parameter: startDate");if(!s(r))throw Error("Date should be in YYYY-MM-DD format");if("number"!=typeof a)throw Error("Missing or wrong type parameter: value");if(i&&("object"!=typeof i||0===Object.keys(i).length)||o&&("object"!=typeof o||0===Object.keys(o).length)||u&&("object"!=typeof u||0===Object.keys(u).length))throw Error("Groups should be key-value objects");if(u&&(!o||!i)||o&&!i)throw Error("Group order must be respected")};t.checkMeasureParams=l;var d=(r=(0,u.default)(o.default.mark(function e(t,n,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l(r),e.next=4,t.getStackClient().fetchJSON("POST","/remote/".concat(n),{data:JSON.stringify(r),path:"measure"});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),(0,c.default)("error","Error while sending measure to remote doctype: ".concat(e.t0.message)),e.t0;case 10:case"end":return e.stop()}},e,null,[[0,6]])})),function(e,t,n){return r.apply(this,arguments)});t.sendMeasureToDACC=d;var f=function(e){var t=e.measureName;if(!t||"string"!=typeof t)throw Error("Missing or wrong type parameter: measureName");var n=e.startDate||new Date(0).toISOString(),r=e.endDate||new Date(Date.now()).toISOString();if(!s(n)||!s(r))throw(0,c.default)("error","Date should be in YYYY-MM-DD format but received: startDate: ".concat(n," | endDate: ").concat(r)),Error("Date should be in YYYY-MM-DD format");return{measureName:t,startDate:n,endDate:r}};t.buildAggregateParams=f;var p=(a=(0,u.default)(o.default.mark(function e(t,n,r){var a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=f(r),e.next=4,t.getStackClient().fetchJSON("POST","/remote/".concat(n),{data:JSON.stringify(a),path:"aggregate"});case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(0),(0,c.default)("error","Error while fetching aggregates to remote doctype: ".concat(e.t0.message)),e.t0;case 11:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,t,n){return a.apply(this,arguments)});t.fetchAggregatesFromDACC=p},60195:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.iconLabelPairs=t.THEME_OTHERS_LABELS=t.THEME_INVOICE_LABELS=t.THEME_FINANCE_LABELS=t.THEME_ACTIVITY_LABELS=t.THEME_TRANSPORT_LABELS=t.THEME_HOME_LABELS=t.THEME_HEALTH_LABELS=t.THEME_WORK_STUDY_LABELS=t.THEME_FAMILY_LABELS=t.THEME_IDENTITY_LABELS=void 0;t.THEME_IDENTITY_LABELS=["identity_photo","national_id_card","passport","residence_permit","electoral_card","family_record_book","birth_certificate","driver_license","citizen_registration_certificate","note_identity_document","other_identity_document"];t.THEME_FAMILY_LABELS=["family_record_book","birth_certificate","wedding","pacs","single_parent_benefit","divorce","large_family_card","caf","payment_proof_family_allowance","note_family_document","other_family_document","person_insurance"];t.THEME_WORK_STUDY_LABELS=["diploma","work_contract","pay_sheet","unemployment_benefit","employment_center_certificate","pension","work_disability_recognition","gradebook","student_card","school_attendance_certificate","school_insurance_certificate","resume","motivation_letter","expense_claim","note_work_document","other_work_document"];t.THEME_HEALTH_LABELS=["health_certificate","health_book","national_health_insurance_card","national_health_insurance_right_certificate","health_insurance_card","prescription","health_invoice","work_disability_recognition","pregnancy_medical_certificate","note_health_document","other_health_document"];t.THEME_HOME_LABELS=["phone_invoice","isp_invoice","telecom_invoice","energy_invoice","water_invoice","other_invoice","work_invoice","house_sale_agreeement","building_permit","technical_diagnostic_record","unfit_for_habitation_declaration","lease","rent_receipt","accommodation_proof","house_insurance","work_quote","condition_report","note_house_document","other_house_document","real_estate_insurance"];t.THEME_TRANSPORT_LABELS=["driver_license","vehicle_registration","car_insurance","transport_card","mechanic_invoice","transport_invoice","note_transport_document","other_transport_document"];t.THEME_ACTIVITY_LABELS=["personal_sporting_licence","fidelity_card","note_activity_document","other_activity_document"];t.THEME_FINANCE_LABELS=["fine","tax_certificate","tax_return","tax_notice","tax_timetable","real_estate_tax","pay_sheet","receipt","single_parent_benefit","other_tax_document","bank_details","bank_statement","loan_agreement","payment_proof_family_allowance","note_finance","expense_claim","other_bank_document","other_revenue"];t.THEME_INVOICE_LABELS=["phone_invoice","isp_invoice","telecom_invoice","energy_invoice","water_invoice","appliance_invoice","web_service_invoice","restaurant_invoice","work_invoice","transport_invoice","health_invoice","note_invoice","expense_claim","energy_contract","grocery_invoice","other_invoice"];t.THEME_OTHERS_LABELS=["other_administrative_document"];t.iconLabelPairs=[{icon:"bank-check",labels:["bank_details"]},{icon:"bank",labels:["other_administrative_document","other_tax_document","real_estate_tax","tax_certificate","tax_notice","tax_return","tax_timetable"]},{icon:"benefit",labels:["loan_agreement","other_revenue","pay_sheet","payment_proof_family_allowance","pension"]},{icon:"bill",labels:["other_invoice"]},{icon:"car",labels:["car_insurance","driver_license","other_transport_document","transport_card","transport_invoice","vehicle_registration"]},{icon:"child",labels:["birth_certificate"]},{icon:"email",labels:["receipt"]},{icon:"euro",labels:["other_bank_document"]},{icon:"exchange",labels:["bank_statement"]},{icon:"file-type-note",labels:["note_activity_document","note_family_document","note_finance","note_health_document","note_house_document","note_identity_document","note_invoice","note_transport_document","note_work_document"]},{icon:"fitness",labels:["other_activity_document","personal_sporting_licence"]},{icon:"globe",labels:["residence_permit"]},{icon:"gouv",labels:["electoral_card"]},{icon:"heart",labels:["health_book","health_certificate","health_insurance_card","health_invoice","national_health_insurance_card","national_health_insurance_right_certificate","other_health_document","person_insurance","pregnancy_medical_certificate","prescription"]},{icon:"home",labels:["accommodation_proof","building_permit","condition_report","house_insurance","house_sale_agreeement","lease","mechanic_invoice","other_house_document","real_estate_insurance","rent_receipt","technical_diagnostic_record","unfit_for_habitation_declaration","work_invoice","work_quote"]},{icon:"image",labels:["identity_photo"]},{icon:"justice",labels:["fine"]},{icon:"laudry",labels:["appliance_invoice"]},{icon:"lightning",labels:["energy_contract","energy_invoice"]},{icon:"people",labels:["national_id_card","other_identity_document","resume","work_disability_recognition"]},{icon:"plane",labels:["passport"]},{icon:"remboursement",labels:["expense_claim"]},{icon:"restaurant",labels:["restaurant_invoice"]},{icon:"school",labels:["diploma","gradebook"]},{icon:"shop",labels:["fidelity_card","grocery_invoice"]},{icon:"team",labels:["caf","citizen_registration_certificate","divorce","family_record_book","large_family_card","other_family_document","pacs","single_parent_benefit","wedding"]},{icon:"telecom",labels:["isp_invoice","telecom_invoice","web_service_invoice"]},{icon:"telephone",labels:["phone_invoice"]},{icon:"water",labels:["water_invoice"]},{icon:"work",labels:["employment_center_certificate","motivation_letter","other_work_document","school_attendance_certificate","school_insurance_certificate","student_card","unemployment_benefit","work_contract"]}]},48536:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.themesList=void 0;var r=n(60195),a=n(34259),i=function(e){return e.map(function(e){try{return a.Qualification.getByLabel(e)}catch(e){return console.log("error",e),null}}).filter(function(e){return e})},o=[{id:"theme1",label:"identity",icon:"people",items:i(r.THEME_IDENTITY_LABELS),defaultItems:["birth_certificate"]},{id:"theme2",label:"family",icon:"team",items:i(r.THEME_FAMILY_LABELS),defaultItems:["family_record_book"]},{id:"theme3",label:"work_study",icon:"work",items:i(r.THEME_WORK_STUDY_LABELS)},{id:"theme4",label:"health",icon:"heart",items:i(r.THEME_HEALTH_LABELS)},{id:"theme5",label:"home",icon:"home",items:i(r.THEME_HOME_LABELS)},{id:"theme6",label:"transport",icon:"car",items:i(r.THEME_TRANSPORT_LABELS),defaultItems:["driver_license"]},{id:"theme7",label:"activity",icon:"chess",items:i(r.THEME_ACTIVITY_LABELS)},{id:"theme8",label:"finance",icon:"bank",items:i(r.THEME_FINANCE_LABELS)},{id:"theme9",label:"invoice",icon:"bill",items:i(r.THEME_INVOICE_LABELS)},{id:"theme10",label:"others",icon:"dots",items:i(r.THEME_OTHERS_LABELS)}];t.themesList=o},29444:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isQualificationNote=t.getThemeByItem=void 0;var r=n(48536);t.getThemeByItem=function(e){var t,n=(t=e,r.themesList.find(function(e){return e.defaultItems&&e.defaultItems.includes(t.label)}));return n?n:r.themesList.find(function(t){return t.items.some(function(t){return t.label===e.label})})};t.isQualificationNote=function(e){return e.label.toLowerCase().startsWith("note_")}},41818:function(e,t,n){var r=n(14746);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Qualification",{enumerable:!0,get:function(){return a.Qualification}}),Object.defineProperty(t,"setQualification",{enumerable:!0,get:function(){return a.setQualification}}),Object.defineProperty(t,"getQualification",{enumerable:!0,get:function(){return a.getQualification}}),t.helpers=t.themes=t.locales=void 0;var a=n(34259),i=r(n(92984));t.locales=i;var o=r(n(48536));t.themes=o;var u=r(n(29444));t.helpers=u},92984:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getLocalizer=t.getBoundT=void 0;var a=r(n(64512)),i=r(n(54078)),o=r(n(28330)),u=r(n(6765)),c=n(65314);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}for(var d={en:o.default,fr:u.default},f={},p=0,h=["fr","en"];p<h.length;p++){var y=h[p],v=new i.default;v.extend(d[y]),f[y]=v}t.getBoundT=function(e){var t=m(e);return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=l(l({},n),{},{smart_count:(null==n?void 0:n.smart_count)||1}),a=null==n?void 0:n.country,i="foreign"!==a?(0,c.getEmojiByCountry)(a):null,o="foreign"===a?t("country.foreign"):null;return i||o?"".concat(t(e,r)," ").concat(i||o):t(e,r)}};var m=function(e){var t=f[e]||f.en;return t.t.bind(t)};t.getLocalizer=m},34259:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getIconByLabel=t.getQualification=t.setQualification=t.Qualification=void 0;var i=a(n(64512)),o=a(n(65105)),u=a(n(19723)),c=a(n(36968)),s=a(n(91966)),l=r(n(37504)),d=a(n(22853)),f=n(60195);function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var v=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,o.default)(this,e);var r=l.qualifications.find(function(e){return e.label===t});if(r){this.icon=n.icon||m(t),this.label=r.label;var a=n.purpose||r.purpose;a&&(this.purpose=a);var i=n.sourceCategory||r.sourceCategory;i&&(this.sourceCategory=i);var u=n.sourceSubCategory||r.sourceSubCategory;u&&(this.sourceSubCategory=u);var c=n.subjects||r.subjects;c&&(this.subjects=c)}else throw Error("No qualification found for the label ".concat(t))}return(0,u.default)(e,[{key:"checkAttributes",value:function(e){if(this.purpose!==e.purpose){if(this.purpose)throw Error("The purpose for the label ".concat(this.label," should be ").concat(this.purpose,". ")+"Please use this or open an issue on https://github.com/cozy/cozy-client/issues");!l.purposeKnownValues.includes(e.purpose)&&d.default.info("This purpose is not listed among the known values: ".concat(e.purpose,". ")+"Please open an issue on https://github.com/cozy/cozy-client/issues")}if(this.sourceCategory!==e.sourceCategory){if(this.sourceCategory)throw Error("The sourceCategory for the label ".concat(this.label," should be ").concat(this.sourceCategory,". ")+"Please use this or open an issue on https://github.com/cozy/cozy-client/issues");!l.sourceCategoryKnownValues.includes(e.sourceCategory)&&d.default.info("This sourceCategory is not listed among the known values: ".concat(e.sourceCategory,". ")+"Please open an issue on https://github.com/cozy/cozy-client/issues")}if(this.sourceSubCategory!==e.sourceSubCategory){if(this.sourceSubCategory)throw Error("The sourceSubCategory for the label ".concat(this.label," should be ").concat(this.sourceSubCategory,". ")+"Please use this or open an issue on https://github.com/cozy/cozy-client/issues");!l.sourceSubCategoryKnownValues.includes(e.sourceSubCategory)&&d.default.info("This sourceSubCategory is not listed among the known values: ".concat(e.sourceSubCategory,". ")+"Please open an issue on https://github.com/cozy/cozy-client/issues")}if((0,s.default)(this.subjects,e.subjects).length>0)throw Error("The subjects for the label ".concat(this.label," should include ").concat(this.subjects,". ")+"Please use this or open an issue on https://github.com/cozy/cozy-client/issues");var t=(0,s.default)(e.subjects,this.subjects);if(t.length>0){var n=(0,s.default)(t,l.subjectsKnownValues);n.length>0&&d.default.info("These subjects are not listed among the known values: ".concat(n,". ")+"Please open an issue on https://github.com/cozy/cozy-client/issues")}}},{key:"setPurpose",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{purpose:t}))}},{key:"setSourceCategory",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{sourceCategory:t}))}},{key:"setSourceSubCategory",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{sourceSubCategory:t}))}},{key:"setSubjects",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{subjects:t}))}},{key:"setIcon",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{icon:t}))}},{key:"toQualification",value:function(){return{icon:this.icon,label:this.label,purpose:this.purpose,sourceCategory:this.sourceCategory,sourceSubCategory:this.sourceSubCategory,subjects:this.subjects}}}]),e}();t.Qualification=v,v.getByLabel=function(e){return new v(e)};t.setQualification=function(e,t){if(t.label){var n=t;return new v(t.label).checkAttributes(t),!t.icon&&(n=new v(t.label,t).setIcon(m(t.label))),(0,c.default)(e,"metadata.qualification",n)}throw Error("You must set a label to qualify")};t.getQualification=function(e){var t,n=null==e?void 0:null===(t=e.metadata)||void 0===t?void 0:t.qualification;return n?new v(n.label,n.qualification).toQualification():null};var m=function(e){var t,n=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(f.iconLabelPairs);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.labels.includes(e))return r.icon}}catch(e){n.e(e)}finally{n.f()}return d.default.info("The ".concat(e," qualification does not seem to have an icon.\n    Please open an issue on https://github.com/cozy/cozy-client/issues")),""};t.getIconByLabel=m},67348:function(e,t,n){var r,a,i,o,u,c,s,l,d,f,p,h=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.normalize=function(e){var t=e._id||e.id;return C({_id:t,id:t,_type:e._type||x.DOCTYPE_FILES},e)},t.ensureFilePath=function(e,t){if(e.path)return e;if(!t||!t.path)throw Error("Could not define a file path for ".concat(e._id||e.id));return C({path:t.path+"/"+e.name},e)},t.getParentFolderId=function(e){var t=(0,g.default)(e,"attributes.dir_id");return""===t?null:t},t.downloadFile=t.copy=t.fetchBlobFileById=t.isFromKonnector=t.hasCertifications=t.hasQualifications=t.isPlainText=t.doMobileUpload=t.readMobileFile=t.uploadFileWithConflictStrategy=t.generateFileNameForRevision=t.generateNewFileNameOnConflict=t.overrideFileForPath=t.move=t.getFullpath=t.hasMetadataAttribute=t.fetchFilesByQualificationRules=t.saveFileQualification=t.isSharingShorcutNew=t.isSharingShortcutNew=t.isSharingShorcut=t.isSharingShortcut=t.getSharingShortcutTargetDoctype=t.getSharingShortcutTargetMime=t.getSharingShortcutStatus=t.isShortcut=t.shouldBeOpenedByOnlyOffice=t.isOnlyOfficeFile=t.isEncrypted=t.isNote=t.isDirectory=t.isFile=t.splitFilename=t.ALBUMS_DOCTYPE=void 0;var y=h(n(68434)),v=h(n(82007)),m=h(n(64512)),b=n(25976),g=h(n(27361)),k=h(n(47037)),_=h(n(18721)),O=h(n(10691)),w=n(34259),S=n(71450),x=n(87941);h(n(18621));var E=h(n(22853));function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach(function(t){(0,m.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var D="file";t.ALBUMS_DOCTYPE="io.cozy.photos.albums";var j=/(.+)(\..*)$/,A=function(e){if(!(0,k.default)(e.name))throw Error("file should have a name property");if("file"===e.type){var t=e.name.match(j);if(t)return{filename:t[1],extension:t[2]}}return{filename:e.name,extension:""}};t.splitFilename=A;var T=function(e){return e&&e.type===D};t.isFile=T;t.isDirectory=function(e){return e&&"directory"===e.type};var R=function(e){return!!(e&&e.name&&e.name.endsWith(".cozy-note"))&&e.type===D&&!!e.metadata&&void 0!==e.metadata.title&&void 0!==e.metadata.version||!1};t.isNote=R;var I=function(e){return!!e.encrypted};t.isEncrypted=I;var M=function(e){return T(e)&&!R(e)&&("text"===e.class||"spreadsheet"===e.class||"slide"===e.class)};t.isOnlyOfficeFile=M;t.shouldBeOpenedByOnlyOffice=function(e){return M(e)&&!e.name.endsWith(".txt")&&!e.name.endsWith(".md")};t.isShortcut=function(e){return e&&"shortcut"===e.class};var N=function(e){return(0,g.default)(e,"metadata.sharing.status")};t.getSharingShortcutStatus=N;t.getSharingShortcutTargetMime=function(e){return(0,g.default)(e,"metadata.target.mime")};t.getSharingShortcutTargetDoctype=function(e){return(0,g.default)(e,"metadata.target._type")};var F=function(e){return!!N(e)};t.isSharingShortcut=F;t.isSharingShorcut=function(e){return E.default.warn("Deprecation: `isSharingShorcut` is deprecated, please use `isSharingShortcut` instead"),F(e)};var L=function(e){return"new"===N(e)};t.isSharingShortcutNew=L;t.isSharingShorcutNew=function(e){return E.default.warn("Deprecation: `isSharingShorcutNew` is deprecated, please use `isSharingShortcutNew` instead"),L(e)};var B=(r=(0,v.default)(y.default.mark(function e(t,n,r){var a;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,w.setQualification)(n,r),e.abrupt("return",t.collection(x.DOCTYPE_FILES).updateMetadataAttribute(n._id,a.metadata));case 2:case"end":return e.stop()}},e)})),function(e,t,n){return r.apply(this,arguments)});t.saveFileQualification=B;var z=(a=(0,v.default)(y.default.mark(function e(t,n){var r,a,i,o;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.rules,a=n.count,i=(0,S.Q)(x.DOCTYPE_FILES).where(C({},r)).partialIndex({trashed:!1}).indexFields(["cozyMetadata.updatedAt","metadata.qualification"]).sortBy([{"cozyMetadata.updatedAt":"desc"}]).limitBy(a||1),e.next=4,t.query(i);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)});t.fetchFilesByQualificationRules=z;t.hasMetadataAttribute=function(e){var t=e.file,n=e.attribute;return(0,_.default)(t,"metadata.".concat(n))};var U=(i=(0,v.default)(y.default.mark(function e(t,n,r){var a,i;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw Error("You must provide a dirId");case 2:return e.next=4,t.query((0,S.Q)(x.DOCTYPE_FILES).getById(n));case 4:return a=e.sent.data,i=(0,O.default)(a.path,"/"),e.abrupt("return","".concat(i,"/").concat(r));case 8:case"end":return e.stop()}},e)})),function(e,t,n){return i.apply(this,arguments)});t.getFullpath=U;var q=(o=(0,v.default)(y.default.mark(function e(t,n,r){var a,i,o,u,c,s=arguments;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(s.length>3&&void 0!==s[3]?s[3]:{force:!1}).force,e.prev=1,"io.cozy.remote.nextcloud.files"!==n._type){e.next=10;break}if("io.cozy.remote.nextcloud.files"!==r._type){e.next=7;break}return e.next=6,t.collection("io.cozy.remote.nextcloud.files").move(n,r);case 6:case 9:case 13:return e.abrupt("return",{moved:void 0,deleted:null});case 7:return e.next=9,t.collection("io.cozy.remote.nextcloud.files").moveToCozy(n,r);case 10:if("io.cozy.remote.nextcloud.files"!==r._type){e.next=14;break}return e.next=13,t.collection("io.cozy.remote.nextcloud.files").moveFromCozy(r,n);case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(1),e.t0;case 19:return e.prev=19,e.next=22,t.collection(x.DOCTYPE_FILES).updateFileMetadata(n._id,{dir_id:r._id});case 22:return i=e.sent,e.abrupt("return",{moved:i.data,deleted:null});case 26:if(e.prev=26,e.t1=e.catch(19),!(409===e.t1.status&&a)){e.next=43;break}return e.next=31,U(t,r._id,n.name);case 31:return o=e.sent,e.next=34,t.collection(x.DOCTYPE_FILES).statByPath(o);case 34:return u=e.sent,e.next=37,t.collection(x.DOCTYPE_FILES).destroy(u.data);case 37:return e.next=39,t.collection(x.DOCTYPE_FILES).updateFileMetadata(n._id,{dir_id:r._id});case 39:return c=e.sent,e.abrupt("return",{moved:c.data,deleted:u.data.id});case 43:throw e.t1;case 44:case"end":return e.stop()}},e,null,[[1,16],[19,26]])})),function(e,t,n){return o.apply(this,arguments)});t.move=q;var G=(u=(0,v.default)(y.default.mark(function e(t,n,r,a){var i,o,u,c,s,l,d,f;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return!(i=n).endsWith("/")&&(i+="/"),o=t.collection(x.DOCTYPE_FILES),e.prev=3,e.next=6,o.statByPath(i+r.name);case 6:return c=(u=e.sent.data).id,s=u.dir_id,e.next=10,o.updateFile(r,{dirId:s,fileId:c,metadata:a});case 10:return l=e.sent,e.abrupt("return",l);case 14:if(e.prev=14,e.t0=e.catch(3),!/Not Found/.test(e.t0)){e.next=24;break}return e.next=19,o.ensureDirectoryExists(i);case 19:return d=e.sent,e.next=22,o.createFile(r,{dirId:d,metadata:a});case 22:return f=e.sent,e.abrupt("return",f);case 24:throw e.t0;case 25:case"end":return e.stop()}},e,null,[[3,14]])})),function(e,t,n,r){return u.apply(this,arguments)});t.overrideFileForPath=G;var Q=function(e,t){var n=(null==t?void 0:t.delimiter)||"_",r=new RegExp("(".concat(n,")([0-9]+)$")),a=e.match(r);if(!a)return"".concat(e).concat(n,"1");var i=parseInt(a[2]);return i++,e.replace(new RegExp("(".concat(n,")([0-9]+)$")),"".concat(n).concat(i))};t.generateNewFileNameOnConflict=Q;t.generateFileNameForRevision=function(e,t,n){var r=A(e),a=r.filename,i=r.extension;return"".concat(a,"_").concat(n(t.updated_at,"DD MMMM - HH[h]mm")).concat(i)};var H=(c=(0,v.default)(y.default.mark(function e(t,n,r){var a,i,o,u,c,s,l,d,f,p,h;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.name,i=r.dirId,o=r.conflictStrategy,u=r.conflictOptions,e.prev=1,e.next=4,U(t,i,a);case 4:return c=e.sent,e.next=7,t.collection(x.DOCTYPE_FILES).statByPath(c);case 7:if(s=e.sent.data.id,"erase"!==o){e.next=16;break}return e.next=12,t.collection(x.DOCTYPE_FILES).updateFile(n,C(C({},r),{},{fileId:s}));case 12:return l=e.sent,e.abrupt("return",l);case 16:return f=(d=A({name:a,type:"file"})).filename,p=d.extension,h=Q(f,u)+p,e.abrupt("return",H(t,n,C(C({},r),{},{name:h})));case 19:e.next=26;break;case 21:if(e.prev=21,e.t0=e.catch(1),!/Not Found/.test(e.t0.message)){e.next=25;break}return e.abrupt("return",t.collection(x.DOCTYPE_FILES).createFile(n,r));case 25:throw e.t0;case 26:case"end":return e.stop()}},e,null,[[1,21]])})),function(e,t,n){return c.apply(this,arguments)});t.uploadFileWithConflictStrategy=H;var J=(s=(0,v.default)(y.default.mark(function e(t){var n;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(e,n){var r=function(){var t=(0,v.default)(y.default.mark(function t(r){return y.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r.file(function(){var t=(0,v.default)(y.default.mark(function t(n){var r;return y.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(r=new FileReader).onloadend=(0,v.default)(y.default.mark(function t(){return y.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e(r.result);case 1:case"end":return t.stop()}},t)})),r.readAsArrayBuffer(n);case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.error("error getting fileentry file!"+e),n(e)});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),a=function(e){n(e)};window.resolveLocalFileSystemURL(t,r,a)}),e.abrupt("return",n);case 2:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)});t.readMobileFile=J;var Y=(l=(0,v.default)(y.default.mark(function e(t,n,r){var a;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(n);case 2:return a=e.sent,e.abrupt("return",H(t,a,r));case 4:case"end":return e.stop()}},e)})),function(e,t,n){return l.apply(this,arguments)});t.doMobileUpload=Y;t.isPlainText=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e?/^text\//.test(e):/\.(txt|md)$/.test(t)};t.hasQualifications=function(e){return(0,_.default)(e,"metadata.qualification")};t.hasCertifications=function(e){return(0,g.default)(e,"metadata.carbonCopy",!1)||(0,g.default)(e,"metadata.electronicSafe",!1)};t.isFromKonnector=function(e){return(0,_.default)(e,"cozyMetadata.sourceAccount")};var W=(d=(0,v.default)(y.default.mark(function e(t,n){var r,a,i;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.collection(x.DOCTYPE_FILES),e.next=3,r.fetchFileContentById(n);case 3:return a=e.sent,e.next=6,a.blob();case 6:return i=e.sent,e.abrupt("return",i);case 8:case"end":return e.stop()}},e)})),function(e,t){return d.apply(this,arguments)});t.fetchBlobFileById=W;var K=(f=(0,v.default)(y.default.mark(function e(t,n,r){var a,i,o,u;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!("io.cozy.remote.nextcloud.files"===n._type&&"io.cozy.remote.nextcloud.files"===r._type)){e.next=6;break}return e.next=4,t.collection("io.cozy.remote.nextcloud.files").copy(n,r);case 4:return a=e.sent,e.abrupt("return",a);case 6:if(!("io.cozy.remote.nextcloud.files"===n._type&&"io.cozy.files"===r._type)){e.next=11;break}return e.next=9,t.collection("io.cozy.remote.nextcloud.files").moveToCozy(n,r,{copy:!0});case 9:return i=e.sent,e.abrupt("return",i);case 11:if("io.cozy.remote.nextcloud.files"!==r._type){e.next=16;break}return e.next=14,t.collection("io.cozy.remote.nextcloud.files").moveFromCozy(r,n,{copy:!0});case 14:return o=e.sent,e.abrupt("return",o);case 16:return e.next=18,t.collection(x.DOCTYPE_FILES).copy(n._id,void 0,r._id);case 18:return u=e.sent,e.abrupt("return",u);case 22:throw e.prev=22,e.t0=e.catch(0),e.t0;case 25:case"end":return e.stop()}},e,null,[[0,22]])})),function(e,t,n){return f.apply(this,arguments)});t.copy=K;var V=(p=(0,v.default)(y.default.mark(function e(t){var n,r,a,i,o,u;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.client,r=t.file,a=t.url,i=t.webviewIntent,o=n.collection(x.DOCTYPE_FILES),!((0,b.isFlagshipApp)()&&i&&!I(r))){e.next=19;break}return e.next=5,null==i?void 0:i.call("isAvailable","downloadFile");case 5:if(e.t1=u=e.sent,e.t0=null!==e.t1,!e.t0){e.next=9;break}e.t0=void 0!==u;case 9:if(!e.t0){e.next=13;break}e.t2=u,e.next=14;break;case 13:e.t2=!1;case 14:if(!e.t2){e.next=19;break}return e.next=18,i.call("downloadFile",r);case 18:return e.abrupt("return",e.sent);case 19:if(!I(r)){e.next=21;break}return e.abrupt("return",o.forceFileDownload(a,r.name));case 21:return e.abrupt("return",o.download(r));case 22:case"end":return e.stop()}},e)})),function(e){return p.apply(this,arguments)});t.downloadFile=V},27899:function(e,t,n){var r,a,i,o=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getReferencedFolder=t.createFolderWithReference=t.ensureMagicFolder=t.MAGIC_FOLDERS=void 0;var u=o(n(68434)),c=o(n(82007)),s=o(n(89734));o(n(18621));var l=n(87941),d=n(71450),f="io.cozy.apps",p="administrative",h="photos",y={ADMINISTRATIVE:"".concat(f,"/").concat(p),PHOTOS:"".concat(f,"/").concat(h),PHOTOS_BACKUP:"".concat(f,"/").concat(h,"/mobile"),PHOTOS_UPLOAD:"".concat(f,"/").concat(h,"/upload"),NOTES:"".concat(f,"/notes"),HOME:"".concat(f,"/home"),PAPERS:"".concat(f,"/").concat(p,"/papers"),COACH_CO2:"".concat(f,"/").concat(p,"/coachco2")};t.MAGIC_FOLDERS=y;var v=(r=(0,c.default)(u.default.mark(function e(t,n,r){var a,i,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={_type:f,_id:n},e.next=3,b(t,a);case 3:if(!(i=e.sent)){e.next=6;break}return e.abrupt("return",i);case 6:if((o=Object.values(y)).includes(n)){e.next=9;break}throw Error("Cannot create Magic folder with id ".concat(n,". Allowed values are ").concat(o.join(", "),"."));case 9:if(r){e.next=11;break}throw Error("Magic folder default path must be defined");case 11:return e.abrupt("return",m(t,r,a));case 12:case"end":return e.stop()}},e)})),function(e,t,n){return r.apply(this,arguments)});t.ensureMagicFolder=v;var m=(a=(0,c.default)(u.default.mark(function e(t,n,r){var a,i,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.collection(l.DOCTYPE_FILES),e.next=3,a.ensureDirectoryExists(n);case 3:return i=e.sent,e.next=6,a.addReferencesTo(r,[{_id:i}]);case 6:return e.next=8,a.get(i);case 8:return o=e.sent.data,e.abrupt("return",o);case 11:case"end":return e.stop()}},e)})),function(e,t,n){return a.apply(this,arguments)});t.createFolderWithReference=m;var b=(i=(0,c.default)(u.default.mark(function e(t,n){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query((0,d.Q)(l.DOCTYPE_FILES).partialIndex({type:"directory",trashed:!1}).referencedBy(n));case 2:return r=e.sent.included,e.abrupt("return",r.length>0?(0,s.default)(r,"created_at").pop():null);case 5:case"end":return e.stop()}},e)})),function(e,t){return i.apply(this,arguments)});t.getReferencedFolder=b},93829:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.deltaLatitude=t.deltaLongitude=t.computeSphericalCenter=t.geodesicDistance=t.computeSpeed=void 0;function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}t.computeSpeed=function(e,t){return e&&t?Math.round(e/t*100)/100:0};var r=function(e){return e*Math.PI/180},a=function(e){return 180*e/Math.PI},i=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n};t.geodesicDistance=function(e,t){if((null==e?void 0:e.lon)===void 0||(null==e?void 0:e.lat)===void 0||(null==t?void 0:t.lon)===void 0||(null==t?void 0:t.lat)===void 0)return null;var n=r(e.lon),a=r(e.lat),o=r(t.lon),u=r(t.lat),c=2*Math.asin(Math.sqrt(Math.pow(Math.sin((u-a)/2),2)+Math.cos(a)*Math.cos(u)*Math.pow(Math.sin((o-n)/2),2)));return i(6378137*c,2)};t.computeSphericalCenter=function(e){if(e.length<1)return null;if(1===e.length)return e[0];var t=0,o=0,u=0,c,s=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}}(e))){i&&(e=i);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o,u=!0,c=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return u=e.done,e},e:function(e){c=!0,o=e},f:function(){try{!u&&null!=i.return&&i.return()}finally{if(c)throw o}}}}(e);try{for(s.s();!(c=s.n()).done;){var l=c.value,d=r(l.lon),f=r(l.lat),p=Math.cos(f)*Math.cos(d),h=Math.cos(f)*Math.sin(d),y=Math.sin(f);t+=p,o+=h,u+=y}}catch(e){s.e(e)}finally{s.f()}var v=t/e.length,m=o/e.length,b=u/e.length,g=a(Math.atan2(m,v));return{lat:i(a(Math.atan2(b,Math.sqrt(v*v+m*m))),13),lon:i(g,13)}};t.deltaLongitude=function(e,t){return i(a(t/(6378137*Math.cos(r(e)))),13)};t.deltaLatitude=function(e){return i(e/(40075e3/360),13)}},4034:function(e,t,n){var r=n(14746);Object.defineProperty(t,"__esModule",{value:!0}),t.geo=t.user=t.paper=t.dacc=t.sharing=t.timeseries=t.document=t.contact=t.utils=t.permission=t.note=t.account=t.konnectorFolder=t.folder=t.file=t.applications=t.instance=t.trigger=t.accounts=t.triggers=void 0;var a=r(n(20786));t.trigger=a;var i=r(n(5499));t.instance=i;var o=r(n(23963));t.applications=o;var u=r(n(67348));t.file=u;var c=r(n(27899));t.folder=c;var s=r(n(3857));t.konnectorFolder=s;var l=r(n(94564));t.account=l;var d=r(n(49666));t.note=d;var f=r(n(13001));t.permission=f;var p=r(n(1028));t.utils=p;var h=r(n(40996));t.contact=h;var y=r(n(41818));t.document=y;var v=r(n(48398));t.timeseries=v;var m=r(n(32672));t.sharing=m;var b=r(n(61645));t.dacc=b;var g=r(n(87067));t.paper=g;var k=r(n(51398));t.user=k;var _=r(n(93829));t.geo=_;t.triggers=a;t.accounts=l},5499:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.makeDiskInfos=t.hasPasswordDefinedAttribute=t.buildPremiumLink=t.hasAnOffer=t.shouldDisplayOffers=t.getUuid=t.isFreemiumUser=t.arePremiumLinksEnabled=t.isSelfHosted=void 0;var i=a(n(68434)),o=a(n(82007)),u=a(n(27361)),c=n(71450),s=5e10,l=function(e){return!(0,u.default)(e,"context.data.manager_url")};t.isSelfHosted=l;var d=function(e){return!!(0,u.default)(e,"context.data.enable_premium_links")};t.arePremiumLinksEnabled=d;var f=function(e){return parseInt((0,u.default)(e,"diskUsage.data.quota",!1))<=s};t.isFreemiumUser=f;var p=function(e){return(0,u.default)(e,"instance.data.uuid")};t.getUuid=p;t.shouldDisplayOffers=function(e){return!l(e)&&d(e)&&p(e)&&f(e)};t.hasAnOffer=function(e){return!l(e)&&d(e)&&p(e)&&!f(e)};t.buildPremiumLink=function(e){var t=(0,u.default)(e,"context.data.manager_url",!1),n=p(e);return t&&n?"".concat(t,"/cozy/instances/").concat(n,"/premium"):null};var h=(r=(0,o.default)(i.default.mark(function e(t){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetchQueryAndGetFromState({definition:(0,c.Q)("io.cozy.settings").getById("io.cozy.settings.instance"),options:{as:"io.cozy.settings/io.cozy.settings.instance",singleDocData:!0}});case 3:return n=e.sent.data.password_defined,e.abrupt("return",!!n);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",!1);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(e){return r.apply(this,arguments)});t.hasPasswordDefinedAttribute=h;var y=function(e){return 1e-9*e},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"".concat(e%1?e.toFixed(t):e)},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return{diskQuota:y(t),diskUsage:y(e),percentUsage:e/t*100}};t.makeDiskInfos=function(e,t){var n=m(+e,t?+t:void 0),r=n.diskQuota,a=n.diskUsage,i=n.percentUsage;return{humanDiskQuota:v(r),humanDiskUsage:v(a),percentUsage:Math.round(i).toString()}}},3857:function(e,t,n){var r,a,i,o,u,c,s,l=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.findKonnectorAccountFolderByReference=t.buildFolderPermission=t.buildFolderPath=t.statDirectoryByPath=t.createDirectoryByPath=t.ensureKonnectorFolder=void 0;var d=l(n(68434)),f=l(n(90402)),p=l(n(82007)),h=n(27899);l(n(18621));var y=n(94564),v=n(92984),m=n(71450),b="io.cozy.files";var g=(r=(0,p.default)(d.default.mark(function e(t,n){var r,a,i,o,u,c,s,l,p,m,g,w,S,x,E,P;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.konnector,a=n.account,i=n.lang,o=t.collection("io.cozy.permissions"),u=t.collection(b),c=(0,v.getLocalizer)(i),e.next=6,Promise.all([(0,h.ensureMagicFolder)(t,h.MAGIC_FOLDERS.ADMINISTRATIVE,c("MagicFolders.administrative")),(0,h.ensureMagicFolder)(t,h.MAGIC_FOLDERS.PHOTOS,c("MagicFolders.photos"))]);case 6:return s=e.sent,p=(l=(0,f.default)(s,2))[0],m=l[1],g=(0,y.getAccountName)(a),e.next=13,M({client:t,slug:r.slug,sourceAccountIdentifier:g});case 13:if(!(w=e.sent)){e.next=16;break}return e.abrupt("return",w);case 16:return e.next=18,N({client:t,slug:r.slug});case 18:if(!(S=e.sent)){e.next=23;break}return e.next=22,function(e){return F.apply(this,arguments)}({client:t,mainFolder:S,konnector:r,sourceAccountIdentifier:g});case 22:return e.abrupt("return",e.sent);case 23:return x=O(r,a,{administrative:p.path,photos:m.path}),e.next=26,_(t,x);case 26:if(e.t0=e.sent,e.t0){e.next=31;break}return e.next=30,k(t,x);case 30:e.t0=e.sent;case 31:return E=e.t0,e.next=34,u.statById(E.dir_id);case 34:return P=e.sent.data,e.next=38,Promise.all([o.add(r,D(E)),R({client:t,folder:E,konnector:r}),I({client:t,folder:E,sourceAccountIdentifier:g}),R({client:t,folder:P,konnector:r})]);case 38:return e.abrupt("return",E);case 39:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.ensureKonnectorFolder=g;var k=(a=(0,p.default)(d.default.mark(function e(t,n){var r;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(b).createDirectoryByPath(n);case 2:return r=e.sent.data,e.abrupt("return",r);case 5:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)});t.createDirectoryByPath=k;var _=(i=(0,p.default)(d.default.mark(function e(t,n){var r;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.collection(b).statByPath(n);case 3:if(!(r=e.sent).data.trashed){e.next=6;break}return e.abrupt("return",null);case 6:return e.abrupt("return",r.data);case 9:if(e.prev=9,e.t0=e.catch(0),!(e.t0&&404===e.t0.status)){e.next=13;break}return e.abrupt("return",null);case 13:throw Error(e.t0.message);case 14:case"end":return e.stop()}},e,null,[[0,9]])})),function(e,t){return i.apply(this,arguments)});t.statDirectoryByPath=_;var O=function(e,t){var n,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=j(((null==e?void 0:null===(n=e.folders)||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:r.defaultDir)||"$administrative/$konnector/$account").replace(/(\/+)/g,"/"),"/");!w(i)&&(i="$administrative/"+i);var o=i.split("/",1),u=x(i,o[0]),c=E(o[0],a),s=P(u,{konnector:e.name,account:(0,y.getAccountName)(t).replace(C,"-")});return"/".concat(c,"/").concat(s)};t.buildFolderPath=O;var w=function(e){return S.some(function(t){return e.startsWith(t)})},S=["$administrative","$photos"],x=function(e,t){var n=e.substring(t.length);return""===n&&(n="$konnector/$account"),n},E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return j((t[e.slice(1)]||"Administrative").replace(/(\/+)/g,"/"),"/")},P=function(e,t){return j(e.replace(/(\/+)/g,"/"),"/").split("/").map(function(e){return(null==t?void 0:t[e.slice(1)])||e}).join("/")},C=/\//g,D=function(e){return{saveFolder:{type:b,values:[e._id],verbs:["GET","PATCH","POST"]}}};t.buildFolderPermission=D;var j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\\s";return e.replace(new RegExp("^([".concat(t,"]*)(.*?)([").concat(t,"]*)$")),"$2")},A=function(e,t){var n;return!!(null===(n=e.referenced_by)||void 0===n?void 0:n.find(function(e){return"io.cozy.konnectors"===e.type&&e.id==="io.cozy.konnectors/"+t}))},T=function(e,t){var n;return!!(null===(n=e.referenced_by)||void 0===n?void 0:n.find(function(e){return"io.cozy.accounts.sourceAccountIdentifier"===e.type&&(!t||e.id===t)}))};var R=(o=(0,p.default)(d.default.mark(function e(t){var n,r,a,i;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.client,r=t.folder,a=t.konnector,i=n.collection(b),A(r,a.slug)){e.next=5;break}return e.next=5,i.addReferencesTo(a,[r]);case 5:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)});var I=(u=(0,p.default)(d.default.mark(function e(t){var n,r,a,i;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.client,r=t.folder,a=t.sourceAccountIdentifier,i=n.collection(b),T(r,a)){e.next=5;break}return e.next=5,i.addReferencesTo({_id:a,_type:"io.cozy.accounts.sourceAccountIdentifier"},[r]);case 5:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)});var M=(c=(0,p.default)(d.default.mark(function e(t){var n,r,a,i;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.slug,a=t.sourceAccountIdentifier,e.next=3,n.query((0,m.Q)(b).partialIndex({type:"directory",trashed:!1}).referencedBy({_type:"io.cozy.konnectors",_id:"io.cozy.konnectors/".concat(r)}));case 3:return i=e.sent.included,e.abrupt("return",i.find(function(e){return T(e,a)}));case 6:case"end":return e.stop()}},e)})),function(e){return c.apply(this,arguments)});t.findKonnectorAccountFolderByReference=M;var N=(s=(0,p.default)(d.default.mark(function e(t){var n,r,a;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.slug,e.next=3,n.query((0,m.Q)(b).partialIndex({type:"directory",trashed:!1}).referencedBy({_type:"io.cozy.konnectors",_id:"io.cozy.konnectors/".concat(r)}));case 3:return a=e.sent.included,e.abrupt("return",a.find(function(e){return!T(e)}));case 6:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)});function F(){return(F=(0,p.default)(d.default.mark(function e(t){var n,r,a,i,o,u;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.mainFolder,a=t.konnector,i=t.sourceAccountIdentifier,o=r.path+"/"+i,e.next=4,_(n,o);case 4:if(e.t0=e.sent,e.t0){e.next=9;break}return e.next=8,k(n,o);case 8:e.t0=e.sent;case 9:return u=e.t0,e.next=12,R({client:n,folder:u,konnector:a});case 12:return e.next=14,I({client:n,folder:u,sourceAccountIdentifier:i});case 14:return e.abrupt("return",u);case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}},86092:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.sanitizeCategories=h,t.areTermsValid=y,t.isPartnershipValid=v,t.sanitize=function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e);return!e.categories&&e.category&&"string"==typeof e.category&&(t.categories=[e.category],delete t.category),t.categories=h(t.categories),"object"==typeof e.name&&(t.name=e.name.en),e.available_version&&(t.availableVersion=e.available_version,delete t.available_version),e.latest_version&&(t.latestVersion=e.latestVersion,delete t.latest_version),t.terms&&!y(t.terms)&&delete t.terms,t.partnership&&!v(t.partnership)&&delete t.partnership,t.fields&&(t.fields=b(e.fields)),t},t.getIdentifier=t.sanitizeIdentifier=t.legacyLoginFields=t.ROLE_IDENTIFIER=void 0;var a=r(n(64512)),i=r(n(59242)),o=r(n(50361)),u=r(n(70894));function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var l="identifier";t.ROLE_IDENTIFIER=l;var d=["login","identifier","new_identifier","email"];t.legacyLoginFields=d;var f=["secret","dob","code","answer","access_token","refresh_token","appSecret"],p=["banking","cozy","energy","health","host_provider","insurance","isp","mes_infos","online_services","others","partners","press","productivity","ptnb","public_service","shopping","social","telecom","transport"];function h(e){if(!e)return["others"];var t=e.filter(function(e){return p.includes(e)});return t.length?t:["others"]}function y(e){return!!(e&&e.id&&e.url&&e.version)}function v(e){return!!(e&&e.description)}var m=function(e){var t=(0,o.default)(e),n=!1;for(var r in t)t[r].role===l&&(n?delete t[r].role:n=!0);if(n)return t;var a,i=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(d);try{for(i.s();!(a=i.n()).done;){var u=a.value;if(t[u])return t[u].role=l,t}}catch(e){i.e(e)}finally{i.f()}for(var s in t)if("password"!==t[s].type){t[s].role=l;break}return t};t.sanitizeIdentifier=m;t.getIdentifier=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,u.default)(m(e),function(e){return e.role===l})||null};var b=(0,i.default)([function(e){var t=(0,o.default)(e);return delete t.advancedFields,t},m,function(e){var t=(0,o.default)(e);for(var n in t){var r=t[n],a=void 0===r.required?r.isRequired:r.required;t[n].required="boolean"!=typeof a||a}return t},function(e){var t=(0,o.default)(e);for(var n in t){var r=t[n];"boolean"!=typeof r.encrypted&&(r.encrypted="password"===r.type||f.includes(n))}return t}])},49666:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchURL=t.generateUrlForNote=t.generatePrivateUrl=void 0;var i=a(n(68434)),o=a(n(82007)),u=n(72004),c=a(n(22853)),s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.returnUrl,a=new URL(e);return r&&a.searchParams.set("returnUrl",r),a.hash="#/n/".concat(t.id),a.toString()};t.generatePrivateUrl=s;t.generateUrlForNote=function(e,t){return c.default.warn("generateUrlForNote is deprecated. Please use models.note.generatePrivateUrl instead"),s(e,t)};var l=(r=(0,o.default)(i.default.mark(function e(t,n){var r,a,o,c,s,l,d,f,p,h,y,v=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=v.length>2&&void 0!==v[2]?v[2]:{},e.next=3,t.getStackClient().collection("io.cozy.notes").fetchURL({_id:n.id});case 3:if(o=(a=e.sent.data).note_id,c=a.subdomain,s=a.protocol,l=a.instance,d=a.sharecode,f=a.public_name,!d){e.next=18;break}return(h=[["id",o]]).push(["sharecode",d]),f&&h.push(["username",f]),e.abrupt("return",(0,u.generateWebLink)({cozyUrl:"".concat(s,"://").concat(l),searchParams:h,pathname:null!==(p=r.pathname)&&void 0!==p?p:"/public/",slug:"notes",subDomainType:c}));case 18:return e.abrupt("return",(0,u.generateWebLink)({cozyUrl:"".concat(s,"://").concat(l),pathname:null!==(y=r.pathname)&&void 0!==y?y:"",slug:"notes",subDomainType:c,hash:"/n/".concat(o)}));case 19:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.fetchURL=l},87067:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isForeignPaper=t.makeExpirationDescription=t.makeExpiresInMessage=t.makeExpiredMessage=t.formatContactValue=t.getTranslatedNameForContact=t.formatOtherMetadataValue=t.getTranslatedNameForOtherMetadata=t.formatInformationMetadataValue=t.getTranslatedNameForInformationMetadata=t.formatDateMetadataValue=t.getTranslatedNameForDateMetadata=t.getMetadataQualificationType=t.formatMetadataQualification=t.isExpiringSoon=t.isExpired=t.computeExpirationNoticeLink=t.computeExpirationNoticeDate=t.computeExpirationDate=t.isExpiring=t.KNOWN_BILLS_ATTRIBUTES_NAMES=t.KNOWN_OTHER_METADATA_NAMES=t.KNOWN_INFORMATION_METADATA_NAMES=t.KNOWN_DATE_METADATA_NAMES=void 0;var a=r(n(98235)),i=r(n(29422)),o=r(n(27546)),u=r(n(94581)),c=r(n(99580)),s=n(92984),l=n(61774),d=n(40996),f=r(n(27361)),p=n(65314),h={national_id_card:"https://www.service-public.fr/particuliers/vosdroits/N358",residence_permit:"https://www.service-public.fr/particuliers/vosdroits/N110",passport:"https://www.service-public.fr/particuliers/vosdroits/N360",driver_license:"https://permisdeconduire.ants.gouv.fr/demarches-en-ligne/perte-vol-deterioration-fin-de-validite-ou-changement-d-etat-civil"},y=["AObtentionDate","BObtentionDate","CObtentionDate","DObtentionDate","obtentionDate","expirationDate","referencedDate","issueDate","shootingDate","date","datetime"];t.KNOWN_DATE_METADATA_NAMES=y;var v=["number","bicNumber","country","refTaxIncome","contractType","netSocialAmount","employerName","vehicle.licenseNumber","vehicle.confidentialNumber","noticePeriod"];t.KNOWN_INFORMATION_METADATA_NAMES=v;var m=["contact","page","qualification"];t.KNOWN_OTHER_METADATA_NAMES=m;var b=["amount","subtype","employer"];t.KNOWN_BILLS_ATTRIBUTES_NAMES=b;var g=function(e){var t,n,r,a,i,o=null===(t=e.metadata)||void 0===t?void 0:null===(n=t.qualification)||void 0===n?void 0:n.label,u=null===(r=e.metadata)||void 0===r?void 0:r.country,c=null===(a=e.metadata)||void 0===a?void 0:a.expirationDate,s=null===(i=e.metadata)||void 0===i?void 0:i.noticePeriod;return"national_id_card"===o&&(!u||"fr"===u)&&!!c&&!!s||!1},k=function(e){var t,n,r=null===(t=e.metadata)||void 0===t?void 0:t.expirationDate,a=null===(n=e.metadata)||void 0===n?void 0:n.noticePeriod;return!!r&&!!a||!1},_=function(e){var t,n,r,a=null===(t=e.metadata)||void 0===t?void 0:null===(n=t.qualification)||void 0===n?void 0:n.label,i=null===(r=e.metadata)||void 0===r?void 0:r.referencedDate,o=e.created_at;return"personal_sporting_licence"===a&&(!!i||!!o)||!1};t.isExpiring=function(e){return!!(g(e)||k(e)||_(e))||!1};var O=function(e){if(g(e)||k(e)){var t;return new Date(null===(t=e.metadata)||void 0===t?void 0:t.expirationDate)}if(_(e)){var n,r=null===(n=e.metadata)||void 0===n?void 0:n.referencedDate,a=e.created_at;return(0,i.default)(new Date(null!=r?r:a),{days:365})}return null};t.computeExpirationDate=O;var w=function(e){if(g(e)||k(e)){var t;return parseInt(null===(t=e.metadata)||void 0===t?void 0:t.noticePeriod,10)}return _(e)?15:null},S=function(e){var t=O(e);if(null==t)return null;var n=w(e);return null==n?null:(0,o.default)(t,{days:n})};t.computeExpirationNoticeDate=S;t.computeExpirationNoticeLink=function(e){var t,n,r=null===(t=e.metadata)||void 0===t?void 0:null===(n=t.qualification)||void 0===n?void 0:n.label;return r&&h[r]||null};t.isExpired=function(e){var t=new Date,n=O(e);return null!=n&&n<=t};t.isExpiringSoon=function(e){var t=new Date,n=O(e),r=S(e);return null!=n&&null!=r&&r<=t&&t<n};var x=function(e){var t=e.metadata,n=e.knownMetadataPath,r=e.value||(0,f.default)(t,n,null)||null;return Object.keys(t).some(function(e){return n.startsWith(e)})||"contact"===n?{name:n,value:r}:null};t.formatMetadataQualification=function(e){var t=y.map(function(t){return x({metadata:e,knownMetadataPath:t})}).filter(Boolean).filter(function(e,t,n){return n.length>1?"datetime"!==e.name:e}),n=v.map(function(t){return x({metadata:e,knownMetadataPath:t})}).filter(Boolean),r=m.map(function(t){var n,r="qualification"===t?null===(n=e[t])||void 0===n?void 0:n.label:e[t];return x({metadata:e,knownMetadataPath:t,value:r})}).filter(Boolean);return[].concat((0,a.default)(t),(0,a.default)(n),(0,a.default)(r))};t.getMetadataQualificationType=function(e){if(y.includes(e))return"date";if(v.includes(e))return"information";if(m.includes(e))return"contact"===e?"contact":"other";return b.includes(e)?"bills":null};t.getTranslatedNameForDateMetadata=function(e,t){var n=t.lang;return(0,s.getLocalizer)(n)("Scan.qualification.date.title.".concat(e))};t.formatDateMetadataValue=function(e,t){var n=t.lang,r=t.f,a=(0,s.getLocalizer)(n);return e?"en"===n?r(e,"MM/DD/YYYY"):r(e,"DD/MM/YYYY"):a("Scan.qualification.noInfo")};t.getTranslatedNameForInformationMetadata=function(e,t){var n=t.lang,r=t.qualificationLabel,a=(0,s.getLocalizer)(n);return"number"===e?a("Scan.qualification.information.title.".concat(r,".").concat(e)):a("Scan.qualification.information.title.".concat(e))};t.formatInformationMetadataValue=function(e,t){var n=t.lang,r=t.name,a=t.qualificationLabel,i=(0,s.getLocalizer)(n),o=(0,l.getLocalizer)(n).t;return"number"==typeof e||e?"noticePeriod"===r?"".concat(e," ").concat(i("Scan.qualification.information.day",{smart_count:e})):"contractType"===r?i("Scan.attributes.contractType.".concat(e),{_:e}):"refTaxIncome"===r||"netSocialAmount"===r||"amount"===r||"number"===r&&"pay_sheet"===a?"".concat(e," "):"country"===r&&(0,p.isValidCountryCodeTranslation)(n,e)?o("countries.".concat(e)):e:i("Scan.qualification.noInfo")};t.getTranslatedNameForOtherMetadata=function(e,t){var n=t.lang;return(0,s.getLocalizer)(n)("Scan.qualification.".concat(e))};t.formatOtherMetadataValue=function(e,t){var n=t.lang,r=t.name,a=(0,s.getLocalizer)(n);return"qualification"===r?a("Scan.items.".concat(e),{smart_count:1}):a("Scan.qualification.".concat(e))};t.getTranslatedNameForContact=function(e){var t=e.lang;return(0,s.getLocalizer)(t)("Scan.qualification.contact")};t.formatContactValue=function(e){return e&&e.length>0?e.map(function(e){return"".concat((0,d.getDisplayName)(e))}).join(", "):""};t.makeExpiredMessage=function(e){var t=e.lang;return(0,s.getLocalizer)(t)("Scan.expiration.expired")};t.makeExpiresInMessage=function(e,t){var n=t.lang;return(0,s.getLocalizer)(n)("Scan.expiration.expiresIn",{duration:(0,u.default)(new Date(e),{locale:"fr"===n?c.default:void 0})})};t.makeExpirationDescription=function(e,t){var n=t.lang;return(0,s.getLocalizer)(n)("Scan.expiration.description",{duration:(0,u.default)(new Date(e),{locale:"fr"===n?c.default:void 0})})};t.isForeignPaper=function(e){var t;return null!==(t=e.metadata)&&void 0!==t&&!!t.country&&"fr"!==e.metadata.country.toLowerCase()}},13001:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isReadOnly=v,t.fetchOwn=m,t.isForType=g,t.isDocumentReadOnly=function(e){return _.apply(this,arguments)},t.isShortcutCreatedOnTheRecipientCozy=void 0;var a=r(n(64512)),i=r(n(68434)),o=r(n(82007)),u=r(n(98235)),c=r(n(25325)),s=r(n(27361));r(n(18621));var l=n(71450),d=n(67348),f=n(87941),p=r(n(22853));function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.writability;return e.verbs&&e.verbs.length>0&&0===(0,c.default)(e.verbs,["ALL"].concat((0,u.default)(void 0===n?["PATCH","POST","PUT","DELETE"]:n))).length}function m(e){return b.apply(this,arguments)}function b(){return(b=(0,o.default)(i.default.mark(function e(t){var n,r,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection("io.cozy.permissions"),e.next=3,n.fetchOwnPermissions();case 3:if(r=e.sent,a=(0,s.default)(r,"data.attributes.permissions")){e.next=7;break}throw"Can't get self permissions";case 7:return e.abrupt("return",Object.values(a));case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function g(e,t){return e.type===t||e.type+".*"===t}function k(){return(k=(0,o.default)(i.default.mark(function e(t){var n,r,a,u,c,s,p,h,v,b,k;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(k=function(){return(k=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.doc,r=t.client,!(o=(a=t.perms).find(function(e){if(!e.values)return!0;var t=n[e.selector||"id"];return e.values.includes(t)}))){e.next=6;break}return e.abrupt("return",o);case 6:if(c!==f.DOCTYPE_FILES){e.next=16;break}if(u=(0,d.getParentFolderId)(n),e.t0=u,!e.t0){e.next=13;break}return e.next=12,h(u);case 12:e.t0=e.sent;case 13:if(!(s=e.t0)){e.next=16;break}return e.abrupt("return",b({doc:s,perms:a,client:r}));case 16:return e.abrupt("return",void 0);case 17:case"end":return e.stop()}},e)}))).apply(this,arguments)},b=function(e){return k.apply(this,arguments)},v=function(){return(v=(0,o.default)(i.default.mark(function e(t){var n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,l.Q)(f.DOCTYPE_FILES).getById(t),e.next=3,r.query(n);case 3:return a=e.sent,e.abrupt("return",a&&a.data);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)},h=function(e){return v.apply(this,arguments)},n=t.document,r=t.client,a=t.permissions,u=n._id||n.id,c=n._type||n.type,s=y(y({},n),{},{id:u,type:c}),!a){e.next=12;break}e.t0=a,e.next=15;break;case 12:return e.next=14,m(r);case 14:e.t0=e.sent;case 15:return p=e.t0.filter(function(e){return g(e,c)}),e.abrupt("return",b({doc:s,client:r,perms:p}));case 18:case"end":return e.stop()}},e)}))).apply(this,arguments)}function _(){return(_=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.document,r=t.client,a=t.writability,void 0!==(o=t.permissions)){e.next=10;break}return e.next=7,m(r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=o;case 11:if(!((u=e.t0).length<=1)){e.next=16;break}e.t1=u[0],e.next=19;break;case 16:return e.next=18,function(e){return k.apply(this,arguments)}({document:n,client:r,permissions:u});case 18:e.t1=e.sent;case 19:if(!(c=e.t1)){e.next=24;break}return e.abrupt("return",v(c,{writability:a}));case 24:return p.default.warn("can't find the document in current attached permissions"),e.abrupt("return",void 0);case 26:case"end":return e.stop()}},e)}))).apply(this,arguments)}t.isShortcutCreatedOnTheRecipientCozy=function(e){if(!e.included)return!1;var t=e.included.find(function(e){return"io.cozy.sharings.members"===e.type});return!!t&&!!t.attributes.instance||!1}},32672:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getSharingLink=void 0;var i=a(n(68434)),o=a(n(64512)),u=a(n(82007)),c=n(87941);a(n(18621));var s=n(72004);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var f=(r=(0,u.default)(i.default.mark(function e(t,n){var r,a,o,u,l,f,p,h,y=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=(o=y.length>2&&void 0!==y[2]?y[2]:{}).ttl,l=o.password,f=d(d({_type:c.DOCTYPE_PERMISSIONS,permissions:{files:{type:c.DOCTYPE_FILES,values:n,verbs:["GET"]}}},u&&{ttl:u}),l&&{password:l}),e.next=4,t.save(f);case 4:return p=e.sent.data,h=(0,s.generateWebLink)({cozyUrl:t.getStackClient().uri,searchParams:[["sharecode",null==p?void 0:null===(r=p.attributes)||void 0===r?void 0:null===(a=r.shortcodes)||void 0===a?void 0:a.code]],pathname:"/public",slug:"drive",subDomainType:t.capabilities.flat_subdomains?"flat":"nested"}),e.abrupt("return",h);case 8:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.getSharingLink=f},48398:function(e,t,n){var r,a,i=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchTimeSeriesByIntervalAndSource=t.saveTimeSeries=void 0;var o=i(n(68434)),u=i(n(82007)),c=n(71450),s=function(e){if(!e.startDate||!e.endDate)throw Error("You must specify a startDate and endDate for the time serie");if(!Date.parse(e.startDate)||!Date.parse(e.endDate))throw Error("Invalid date format for the time serie");if(!e.dataType)throw Error("You must specify a dataType for the time serie");if(!e.series||!Array.isArray(e.series))throw Error("You must specify a series array for the time serie")};var l=(r=(0,u.default)(o.default.mark(function e(t,n){var r,a,i,u,c,l,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.dataType,a=n.series,i=n.startDate,u=n.endDate,c=n.source,l=n.theme,s({dataType:r,series:a,startDate:i,endDate:u,source:c}),d={_type:"io.cozy.timeseries.".concat(r),startDate:i,endDate:u,source:c,theme:l,series:a},e.abrupt("return",t.save(d));case 5:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.saveTimeSeries=l;var d=(a=(0,u.default)(o.default.mark(function e(t,n){var r,a,i,u,s,l,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.startDate,a=n.endDate,i=n.dataType,u=n.source,s=n.limit,l="io.cozy.timeseries.".concat(i),d=(0,c.Q)(l).where({source:u,startDate:{$gte:r},endDate:{$lte:a}}).indexFields(["source","startDate","endDate"]).sortBy([{source:"desc"},{startDate:"desc"},{endDate:"desc"}]).limitBy(s||5),e.abrupt("return",t.query(d));case 4:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)});t.fetchTimeSeriesByIntervalAndSource=d},20786:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.triggers=t.triggerStates=void 0;var a=r(n(64512)),i=n(94564),o=r(n(22853));function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var s=["CHALLENGE_ASKED","DISK_QUOTA_EXCEEDED","TERMS_VERSION_MISMATCH","USER_ACTION_NEEDED","USER_ACTION_NEEDED.CHANGE_PASSWORD","USER_ACTION_NEEDED.ACCOUNT_REMOVED","USER_ACTION_NEEDED.WEBAUTH_REQUIRED","USER_ACTION_NEEDED.SCA_REQUIRED","LOGIN_FAILED"],l={getLastExecution:function(e){var t;return null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_execution},getLastSuccess:function(e){var t;return null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_success},getLastsuccess:function(e){var t;return o.default.warn("Deprecated, please use getLastSuccess instead of getLastsuccess"),null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_success},isErrored:function(e){var t;return(null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.status)==="errored"},getLastErrorType:function(e){var t;return null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_error}};t.triggerStates=l;var d={isKonnectorWorker:function(e){return"konnector"===e.worker},isKonnector:function(e){return"konnector"===e.worker||"client"===e.worker},getKonnector:function(e){return d.isKonnector(e)?e.message&&e.message.konnector?e.message.konnector:e.message&&e.message.Data?JSON.parse(atob(e.message.Data)).konnector:void 0:null},getAccountId:function(e){var t,n,r=null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.Data;return r?JSON.parse(atob(r)).account:null==e?void 0:null===(n=e.message)||void 0===n?void 0:n.account},isLatestErrorMuted:function(e,t){var n=l.getLastErrorType(e),r=l.getLastSuccess(e),a=r?new Date(r):new Date;return(0,i.getMutedErrors)(t).some(function(e){return e.type===n&&(!r||new Date(e.mutedAt)>a)})},hasActionableError:function(e){var t;return s.includes(null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_error)},buildTriggerAttributes:function(e){var t=e.account,n=e.cron,r=e.folder,a=e.konnector,i={account:t._id,konnector:a.slug};r&&(i.folder_to_save=r._id);var o=a.clientSide?{type:"@client"}:{type:"@cron",arguments:void 0===n?"0 0 0 * * 0":n};return c(c({},{worker:"konnector",message:i}),o)}};t.triggers=d},51398:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.hasPassword=void 0;var i=a(n(68434)),o=a(n(82007)),u=n(5499),c=n(88842),s=n(47978);var l=(r=(0,o.default)(i.default.mark(function e(t){var n,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.hasExtensionInstalledAttribute)(t);case 2:return n=e.sent,e.next=5,(0,u.hasPasswordDefinedAttribute)(t);case 5:return r=e.sent,e.abrupt("return",!((0,s.isMagicLink)(t)||(0,s.isOIDC)(t))||n||r);case 7:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.hasPassword=l},1028:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getFlagshipDownloadLink=t.getCreatedByApp=t.hasBeenUpdatedByApp=void 0;var a=r(n(27361)),i=n(25976),o=r(n(71400));t.hasBeenUpdatedByApp=function(e,t){var n=(0,a.default)(e,"cozyMetadata.updatedByApps");return!!(n&&n.find(function(e){return e.slug===t}))};t.getCreatedByApp=function(e){return(0,a.default)(e,"cozyMetadata.createdByApp")};t.getFlagshipDownloadLink=function(e){if((0,i.isAndroid)()){var t=(0,o.default)("flagship.playstore-id")||"io.cozy.flagship.mobile";return"https://play.google.com/store/apps/details?id=".concat(t,"&hl=").concat(e)}if((0,i.isIOS)()){var n=(0,o.default)("flagship.appstore-id")||"id1600636174";return"https://apps.apple.com/".concat(e,"/app/").concat(n)}return(0,o.default)("flagship.download-link")||"https://cozy.io/".concat(e,"/download")}},39268:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={olderThan:function(e){return function(t){return!t||!t.lastUpdate||Date.now()-t.lastUpdate>e}},noFetch:function(){return!1}}},25888:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=function(){var e;function t(){(0,o.default)(this,t),this.pending={}}return(0,u.default)(t,[{key:"exec",value:(e=(0,i.default)(a.default.mark(function e(t,n){var r,i,o,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n(),(i=this.pending[r])?o=i:(o=t(),this.pending[r]=o),e.prev=3,e.next=6,o;case 6:return u=e.sent,e.abrupt("return",u);case 8:return e.prev=8,this.pending[r]=null,e.finish(8);case 11:case"end":return e.stop()}},e,this,[[3,,8,11]])})),function(t,n){return e.apply(this,arguments)})},{key:"get",value:function(e){var t=e(),n=this.pending[t];return n?n:null}}]),t}();t.default=c},71450:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.QueryDefinition=t.MutationTypes=t.Mutations=t.getDoctypeFromOperation=t.uploadFile=t.removeReferencedBy=t.addReferencedBy=t.removeReferencesTo=t.addReferencesTo=t.deleteDocument=t.updateDocuments=t.updateDocument=t.createDocument=t.isAGetByIdQuery=t.Q=void 0;var a=r(n(64512)),i=r(n(65105)),o=r(n(19723)),u=r(n(70894)),c=r(n(22853));function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,e),this.doctype=t.doctype,this.id=t.id,this.ids=t.ids,this.selector=t.selector,this.fields=t.fields,this.indexedFields=t.indexedFields,this.partialFilter=t.partialFilter,this.sort=t.sort,this.includes=t.includes,this.referenced=t.referenced,this.limit=t.limit,this.skip=t.skip,this.cursor=t.cursor,this.bookmark=t.bookmark}return(0,o.default)(e,[{key:"checkSortOrder",value:function(e){var t=e.sort,n=e.selector,r=e.indexedFields,a=this.sort||t,i=this.selector||n||{},o=this.indexedFields||r;if(!a)return;var u=o||Object.keys(i);if(!!u&&!(u.length<1)){if(a.length>u.length){c.default.warn("You should not sort on non-indexed fields.\n\n        Sort: ".concat(JSON.stringify(a),"\n\n        Indexed fields: ").concat(u));return}for(var s=0;s<a.length;s++)if(Object.keys(a[s])[0]!==u[s]){c.default.warn("The sort order should be the same than the indexed fields.\n\n          Sort: ".concat(JSON.stringify(a),"\n\n          Indexed fields: ").concat(u,"\n"));return}}}},{key:"checkSelector",value:function(e){(0,u.default)(e,["$exists",!1])&&c.default.warn('The "$exists: false" predicate should be defined as a partial index for better performance.\n\n        Selector: '.concat(JSON.stringify(e))),(0,u.default)(e,"$ne")&&c.default.info("The use of the $ne operator is more efficient with a partial index.\n\n        Selector: ".concat(JSON.stringify(e)));var t=(0,u.default)(e,function(e){return Array.isArray(e)});if(t&&!t.startsWith("$"))throw Error("You pass ".concat(JSON.stringify(e),", this is a valid mango operation, \n\n        but sift doesn't support it so CozyClient can not evaluate \n\n        the request in memory. You must use a MongoDB operator \n\n        like $in or $or operator instead, preferably in a partial index, \n\n        to avoid costly full-scan"))}},{key:"checkSelectFields",value:function(e){var t=e.fields,n=e.selector,r=e.partialFilter,a=this.fields||t,i=this.selector||n,o=this.partialFilter||r;if(!!a&&(!!i||!!o)){if(!Object.keys(l(l({},i),o)).every(function(e){return a.includes(e)}))throw Error("The .select should includes all the fields used in where or partialIndex.\n        Please fix this query: fields: ".concat(JSON.stringify(this.toDefinition())))}}},{key:"getById",value:function(t){if(!t)throw Error("getById called with undefined id");return new e(l(l({},this.toDefinition()),{},{id:t}))}},{key:"getByIds",value:function(t){return new e(l(l({},this.toDefinition()),{},{ids:t}))}},{key:"where",value:function(t){return this.checkSortOrder({selector:t}),this.checkSelector(t),this.checkSelectFields({selector:t}),new e(l(l({},this.toDefinition()),{},{selector:t}))}},{key:"select",value:function(t){return this.checkSelectFields({fields:t}),new e(l(l({},this.toDefinition()),{},{fields:t}))}},{key:"indexFields",value:function(t){return this.checkSortOrder({indexedFields:t}),new e(l(l({},this.toDefinition()),{},{indexedFields:t}))}},{key:"partialIndex",value:function(t){return this.checkSelectFields({partialFilter:t}),new e(l(l({},this.toDefinition()),{},{partialFilter:t}))}},{key:"sortBy",value:function(t){if(!Array.isArray(t))throw Error('Invalid sort, should be an array ([{ label: "desc"}, { name: "asc"}]), you passed '.concat(JSON.stringify(t),"."));return this.checkSortOrder({sort:t}),new e(l(l({},this.toDefinition()),{},{sort:t}))}},{key:"include",value:function(t){if(!Array.isArray(t))throw Error("include() takes an array of relationship names");return new e(l(l({},this.toDefinition()),{},{includes:t}))}},{key:"limitBy",value:function(t){return new e(l(l({},this.toDefinition()),{},{limit:t}))}},{key:"UNSAFE_noLimit",value:function(){return new e(l(l({},this.toDefinition()),{},{limit:null}))}},{key:"offset",value:function(t){return new e(l(l({},this.toDefinition()),{},{bookmark:void 0,cursor:void 0,skip:t}))}},{key:"offsetCursor",value:function(t){return new e(l(l({},this.toDefinition()),{},{bookmark:void 0,skip:void 0,cursor:t}))}},{key:"offsetBookmark",value:function(t){return new e(l(l({},this.toDefinition()),{},{skip:void 0,cursor:void 0,bookmark:t}))}},{key:"referencedBy",value:function(t){return new e(l(l({},this.toDefinition()),{},{referenced:t}))}},{key:"toDefinition",value:function(){return{doctype:this.doctype,id:this.id,ids:this.ids,selector:this.selector,fields:this.fields,indexedFields:this.indexedFields,partialFilter:this.partialFilter,sort:this.sort,includes:this.includes,referenced:this.referenced,limit:this.limit,skip:this.skip,cursor:this.cursor,bookmark:this.bookmark}}}]),e}();t.QueryDefinition=d;t.Q=function(e){return new d({doctype:e})};t.isAGetByIdQuery=function(e){if(!e)return!1;var t=Object.values(e);return 0!==t.length&&2===t.filter(function(e){return void 0!==e}).length&&void 0!==e.id};var f="CREATE_DOCUMENT",p="UPDATE_DOCUMENT",h="UPDATE_DOCUMENTS",y="DELETE_DOCUMENT",v="ADD_REFERENCES_TO",m="UPLOAD_FILE",b=function(e){return{mutationType:P.CREATE_DOCUMENT,document:e}};t.createDocument=b;var g=function(e){return{mutationType:P.UPDATE_DOCUMENT,document:e}};t.updateDocument=g;var k=function(e){return{mutationType:P.UPDATE_DOCUMENTS,documents:e}};t.updateDocuments=k;var _=function(e){return{mutationType:P.DELETE_DOCUMENT,document:e}};t.deleteDocument=_;var O=function(e,t){return{mutationType:P.ADD_REFERENCES_TO,referencedDocuments:t,document:e}};t.addReferencesTo=O;var w=function(e,t){return{mutationType:P.REMOVE_REFERENCES_TO,referencedDocuments:t,document:e}};t.removeReferencesTo=w;var S=function(e,t){return{mutationType:P.ADD_REFERENCED_BY,referencedDocuments:t,document:e}};t.addReferencedBy=S;var x=function(e,t){return{mutationType:P.REMOVE_REFERENCED_BY,referencedDocuments:t,document:e}};t.removeReferencedBy=x;var E=function(e,t){return{mutationType:P.UPLOAD_FILE,file:e,dirPath:t}};t.uploadFile=E;t.getDoctypeFromOperation=function(e){if(!e.mutationType)return e.doctype;var t=e.mutationType;switch(t){case f:case p:return e.document._type;case h:return e.documents[0]._type;case y:return e.document._type;case v:case m:throw Error("Not implemented");default:throw Error("Unknown mutationType ".concat(t))}};t.Mutations={createDocument:b,updateDocument:g,updateDocuments:k,deleteDocument:_,addReferencesTo:O,removeReferencesTo:w,addReferencedBy:S,removeReferencedBy:x,uploadFile:E};var P={CREATE_DOCUMENT:f,UPDATE_DOCUMENT:p,UPDATE_DOCUMENTS:h,DELETE_DOCUMENT:y,ADD_REFERENCES_TO:v,REMOVE_REFERENCES_TO:"REMOVE_REFERENCES_TO",ADD_REFERENCED_BY:"ADD_REFERENCED_BY",REMOVE_REFERENCED_BY:"REMOVE_REFERENCED_BY",UPLOAD_FILE:m};t.MutationTypes=P},20057:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(66604)),i=r(n(7739)),o=r(n(85564)),u=r(n(18446)),c=r(n(44908)),s=r(n(87185)),l=n(71450),d=function(e){var t=(0,i.default)(e,function(e){var t;return(t=e).id||t.ids?"idQueries":"others"}),n=t.idQueries,r=void 0===n?[]:n,a=t.others,d=r.length>0?new l.QueryDefinition({doctype:e[0].doctype,ids:(0,c.default)((0,o.default)(r.map(function(e){return e.id||e.ids})))}):[];return(0,s.default)(void 0===a?[]:a,u.default).concat(d)};t.default=function(e){var t=(0,i.default)(e,function(e){return e.doctype});return(0,o.default)(Object.values((0,a.default)(t,d)))}},10513:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.registryEndpoint=t.transformRegistryFormatToStackFormat=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(64512)),s=r(n(27361));n(35449);var l=r(n(47064)),d=n(20538);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}t.transformRegistryFormatToStackFormat=function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,c.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({id:(0,s.default)(e,"latest_version.manifest.source"),attributes:(0,s.default)(e,"latest_version.manifest")},e)};t.registryEndpoint="/registry/";var p=function(e){var t=new URLSearchParams(e).toString();return t?"?".concat(t):""},h=function(e){var t=e.type,n=t===d.APP_TYPE.KONNECTOR||"node"===t?"konnectors":"apps";return"/".concat(n)},y=function(){var e,t,n;function r(e){if((0,o.default)(this,r),!e.client)throw Error("Need to pass a client to instantiate a Registry API.");this.client=e.client}return(0,u.default)(r,[{key:"installApp",value:(e=(0,i.default)(a.default.mark(function e(t,n){var r,i,o,u,c,s,d;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.slug,i=t.terms,o={},(u=t.installed)&&(o.PermissionsAcked=u),n&&(o.Source=n),c=p(o),!i){e.next=9;break}return e.next=9,l.default.save(this.client,i);case 9:return s=t.installed?"PUT":"POST",d=h(t),e.abrupt("return",this.client.stackClient.fetchJSON(s,"".concat(d,"/").concat(r).concat(c)));case 12:case"end":return e.stop()}},e,this)})),function(t,n){return e.apply(this,arguments)})},{key:"uninstallApp",value:(t=(0,i.default)(a.default.mark(function e(t){var n,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.slug,r=h(t),e.abrupt("return",this.client.stackClient.fetchJSON("DELETE","".concat(r,"/").concat(n)));case 3:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"fetchApps",value:(n=(0,i.default)(a.default.mark(function e(t){var n,r,i,o,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.channel,r=t.type,o=new URLSearchParams({limit:void 0===(i=t.limit)?"200":i,versionsChannel:n,latestChannelVersion:n}).toString(),r&&(o+="&filter[type]=".concat(r)),e.next=6,this.client.stackClient.fetchJSON("GET","/registry?".concat(o));case 6:return u=e.sent.data,e.abrupt("return",u);case 9:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"fetchAppsInMaintenance",value:function(){return this.client.stackClient.fetchJSON("GET","/registry/maintenance")}},{key:"fetchApp",value:function(e){return this.client.stackClient.fetchJSON("GET","/registry/".concat(e))}},{key:"fetchAppVersion",value:function(e){if(!e.slug)throw Error("Need to pass a slug to use fetchAppVersion");var t=e.slug,n=e.channel,r=e.version,a=n||r&&"latest"!==r?n:"stable",i="/registry/".concat(t,"/");return a?i+="".concat(a,"/").concat(r||"latest"):i+="".concat(r),this.client.stackClient.fetchJSON("GET",i)}}]),r}();t.default=y},94158:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.extractAndMergeDocument=t.getCollectionFromSlice=t.getDocumentFromSlice=t.default=t.mergeDocumentsWithRelationships=void 0;var a=r(n(64512)),i=r(n(24350)),o=r(n(27361)),u=r(n(18446)),c=r(n(57557)),s=r(n(82492)),l=r(n(22853)),d=n(76305),f=n(71450),p=n(22249),h=n(98829);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m=function(e,t){var n=t._type;if(!n)throw Error("Document without _type");if(!(0,h.properId)(t))throw Error("Document without id");var r=(0,o.default)(e,[n,(0,h.properId)(t)]);return(0,u.default)(r,t)?e:v(v({},e),{},(0,a.default)({},n,v(v({},e[n]),{},(0,a.default)({},(0,h.properId)(t),b(r,t)))))},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=v(v({},e),t);return(e.relationships||t.relationships)&&(n.relationships=v(v({},e.relationships),t.relationships)),n};t.mergeDocumentsWithRelationships=b;t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!(0,d.isReceivingData)(t)&&!(0,p.isReceivingMutationResult)(t))return e;if(t&&t.definition&&t.definition.mutationType===f.MutationTypes.DELETE_DOCUMENT){var n=t.definition.document._id,r=t.definition.document._type;return v(v({},e),{},(0,a.default)({},r,(0,c.default)(e[r],n)))}var i=t.response,o=i.data,u=i.included;if(!o||Array.isArray(o)&&0===o.length)return e;var s=u?u.reduce(m,e):e;return Array.isArray(o)?g(o,s):m(s,o)};t.getDocumentFromSlice=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(!t)throw Error("getDocumentFromSlice: Cannot retrieve document with undefined doctype");if(!n)throw Error("getDocumentFromSlice: Cannot retrieve document with undefined id");return e[t]?e[t][n]?e[t][n]:null:null};t.getCollectionFromSlice=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!t)throw Error("getDocumentFromSlice: Cannot retrieve document with undefined doctype");return e[t]?Object.values(e[t]):null};var g=function(e,t){var n=e[0]._type;if(!n)throw l.default.info("Document without _type",e[0]),Error("Document without _type");var r=(0,i.default)(e,h.properId),a=Object.assign({},t);return a[n]=Object.assign({},t[n]),Object.values(r).map(function(e){var t=(0,h.properId)(e);a[n][t]?a[n][t]=(0,s.default)({},a[n][t],e):a[n][t]=e}),a};t.extractAndMergeDocument=g},98829:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.properId=void 0;t.properId=function(e){return e.id||e._id}},65972:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"initQuery",{enumerable:!0,get:function(){return f.initQuery}}),Object.defineProperty(t,"loadQuery",{enumerable:!0,get:function(){return f.loadQuery}}),Object.defineProperty(t,"resetQuery",{enumerable:!0,get:function(){return f.resetQuery}}),Object.defineProperty(t,"receiveQueryResult",{enumerable:!0,get:function(){return f.receiveQueryResult}}),Object.defineProperty(t,"receiveQueryError",{enumerable:!0,get:function(){return f.receiveQueryError}}),Object.defineProperty(t,"executeQueryFromState",{enumerable:!0,get:function(){return f.executeQueryFromState}}),Object.defineProperty(t,"initMutation",{enumerable:!0,get:function(){return p.initMutation}}),Object.defineProperty(t,"receiveMutationResult",{enumerable:!0,get:function(){return p.receiveMutationResult}}),Object.defineProperty(t,"receiveMutationError",{enumerable:!0,get:function(){return p.receiveMutationError}}),Object.defineProperty(t,"getStateRoot",{enumerable:!0,get:function(){return h.getStateRoot}}),Object.defineProperty(t,"getCollectionFromState",{enumerable:!0,get:function(){return h.getCollectionFromState}}),Object.defineProperty(t,"getDocumentFromState",{enumerable:!0,get:function(){return h.getDocumentFromState}}),Object.defineProperty(t,"getQueryFromStore",{enumerable:!0,get:function(){return h.getQueryFromStore}}),Object.defineProperty(t,"getQueryFromState",{enumerable:!0,get:function(){return h.getQueryFromState}}),Object.defineProperty(t,"getRawQueryFromState",{enumerable:!0,get:function(){return h.getRawQueryFromState}}),Object.defineProperty(t,"isQueryExisting",{enumerable:!0,get:function(){return h.isQueryExisting}}),Object.defineProperty(t,"dispatchCreate",{enumerable:!0,get:function(){return y.dispatchCreate}}),Object.defineProperty(t,"dispatchUpdate",{enumerable:!0,get:function(){return y.dispatchUpdate}}),Object.defineProperty(t,"dispatchDelete",{enumerable:!0,get:function(){return y.dispatchDelete}}),t.resetState=t.createStore=t.default=t.StoreProxy=void 0;var i=a(n(64512)),o=a(n(65105)),u=a(n(19723)),c=a(n(71400)),s=n(5525),l=a(n(53894)),d=a(n(94158)),f=r(n(76305)),p=n(22249),h=n(76790),y=n(45330);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var b="COZY_CLIENT.RESET_STATE";t.resetState=function(){return{type:b}};var g=function(){function e(t){(0,o.default)(this,e),this.state=t}return(0,u.default)(e,[{key:"readDocument",value:function(e,t){return this.state.documents[e][t]}},{key:"writeDocument",value:function(e){this.setState(function(t){return m(m({},t),{},{documents:m(m({},t.documents),{},(0,i.default)({},e._type,m(m({},t.documents[e._type]),{},(0,i.default)({},e._id,e))))})})}},{key:"setState",value:function(e){this.state=e(this.state)}},{key:"getState",value:function(){return this.state}}]),e}();t.StoreProxy=g;var k={documents:{},queries:{}},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;if(t.type==b)return k;if(!(0,f.isQueryAction)(t)&&!(0,p.isMutationAction)(t))return e;if(t.update){var n=new g(e);return t.update(n,t.response),{documents:n.getState().documents,queries:(0,f.default)(n.getState().queries,t,n.getState().documents)}}var r=(0,d.default)(e.documents,t),a=r!==e.documents;return{documents:r,queries:(0,f.default)(e.queries,t,r,a)}};t.default=_;var O=(0,c.default)("debug")&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||s.compose;t.createStore=function(){return(0,s.createStore)((0,s.combineReducers)({cozy:_}),O((0,s.applyMiddleware)(l.default)))}},22249:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.receiveMutationError=t.receiveMutationResult=t.initMutation=t.isReceivingMutationResult=t.isMutationAction=void 0;var a=r(n(64512));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var u="INIT_MUTATION",c="RECEIVE_MUTATION_RESULT",s="RECEIVE_MUTATION_ERROR";t.isMutationAction=function(e){return -1!==[u,c,s].indexOf(e.type)};t.isReceivingMutationResult=function(e){return e.type===c};t.initMutation=function(e,t){return{type:u,mutationId:e,definition:t}};t.receiveMutationResult=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return o(o({type:c,mutationId:e,response:t},n),{},{definition:r})};t.receiveMutationError=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{type:s,mutationId:e,error:t,definition:n}}},76305:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.QueryIDGenerator=t.getQueryFromSlice=t.resetQuery=t.receiveQueryError=t.receiveQueryResult=t.loadQuery=t.initQuery=t.default=t.updateData=t.makeSorterFromDefinition=t.executeQueryFromState=t.mergeSelectorAndPartialIndex=t.convert$gtNullSelectors=t.sortAndLimitDocsIds=t.isReceivingData=t.isQueryAction=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(90402)),u=r(n(64512)),c=r(n(98235)),s=r(n(66604)),l=r(n(7739)),d=r(n(91966)),f=r(n(25325)),p=r(n(57043)),h=r(n(68630)),y=r(n(44908)),v=r(n(75472)),m=r(n(47037)),b=r(n(27361)),g=r(n(14328)),k=r(n(71400)),_=n(94158),O=n(22249),w=n(98829),S=n(71450),x=r(n(22853)),E=n(76790);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var D="INIT_QUERY",j="LOAD_QUERY",A="RECEIVE_QUERY_RESULT",T="RECEIVE_QUERY_ERROR",R="RESET_QUERY",I=(0,k.default)("debug"),M=function(e){return -1!==[D,j,A,T,R].indexOf(e.type)};t.isQueryAction=M;t.isReceivingData=function(e){return e.type===A};var N={id:null,definition:null,fetchStatus:"pending",isFetching:null,lastFetch:null,lastUpdate:null,lastErrorUpdate:null,lastError:null,hasMore:!1,count:0,fetchedPagesCount:0,data:[],bookmark:null},F=function(e,t,n,r){var a,i=r.count,o=r.fetchedPagesCount,u=(0,c.default)(n);if(e.definition.sort&&t){var s=H(e.definition),l=t[e.definition.doctype];u=s(l?u.map(function(e){return l[e]}).filter(Boolean):[]).map(w.properId)}var d=e.definition.limit;return d&&(a=i<d?o>1?d*(o-1)+i:i:d*o,u=u.slice(0,a)),u};t.sortAndLimitDocsIds=F;var L=function(e,t,n,r){var a=r.count,i=r.fetchedPagesCount,o=(0,y.default)([].concat((0,c.default)(e.data),(0,c.default)(t.data.map(w.properId))));return F(e,n,o,{count:a,fetchedPagesCount:i})},B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;switch(t.type){case D:if(e.lastUpdate&&e.id===t.queryId&&e.definition===t.queryDefinition)return e;return C(C({},e),{},{id:t.queryId,definition:t.queryDefinition,options:t.options,fetchStatus:e.lastUpdate?e.fetchStatus:"pending"});case j:if("loading"===e.fetchStatus)return e;if("loaded"===e.fetchStatus&&t.backgroundFetching)return C(C({},e),{},{fetchStatus:"loaded",isFetching:!0});return C(C({},e),{},{fetchStatus:"loading"});case A:var r=t.response;if(!r.data)return C(C({},e),{},{fetchStatus:"loaded",isFetching:!t.backgroundFetching&&null,lastFetch:Date.now(),lastUpdate:Date.now()});var a=C({fetchStatus:"loaded",isFetching:!t.backgroundFetching&&null,lastFetch:Date.now(),lastUpdate:Date.now()},I&&{execution_stats:r.execution_stats});if(!Array.isArray(r.data))return C(C(C({},e),a),{},{hasMore:!1,count:1,data:[(0,w.properId)(r.data)]});var i=r.meta&&r.meta.count?r.meta.count:r.data.length;if(t.backgroundFetching)return C(C(C({},e),a),{},{bookmark:r.bookmark||null,hasMore:void 0!==r.next?r.next:e.hasMore,count:i,data:r.data.map(w.properId)});var o=e.fetchedPagesCount+1,u=L(e,r,n,{count:i,fetchedPagesCount:o});return C(C(C({},e),a),{},{bookmark:r.bookmark||null,hasMore:void 0!==r.next?r.next:e.hasMore,count:i,fetchedPagesCount:o,data:u});case T:return C(C({},e),{},{id:t.queryId,fetchStatus:"failed",isFetching:!t.backgroundFetching&&null,lastError:t.error,lastErrorUpdate:Date.now()});case R:return C(C({},N),{},{id:t.queryId,definition:e.definition,options:e.options});default:return e}},z=function e(t){for(var n={},r=0,a=Object.entries(t);r<a.length;r++){var i=(0,o.default)(a[r],2),u=i[0],c=i[1],s=(0,h.default)(c)?e(c):c;n["$gt"===u&&null===s?"$gtnull":u]=s}return n};t.convert$gtNullSelectors=z;var U=function(e){return C(C({},(0,b.default)(e,"selector")),(0,b.default)(e,"partialFilter"))};t.mergeSelectorAndPartialIndex=U;var q=function(e){if(e.selector||e.partialFilter){var t=U(e);return g.default.use({$gtnull:function(e,t){return!!t}}),(0,g.default)(z(t))}if(e.id){var n={_id:e.id};return(0,g.default)(n)}if(!e.ids)return null;else{var r={_id:{$in:e.ids}};return(0,g.default)(r)}};t.executeQueryFromState=function(e,t){var n=(0,E.getCollectionFromState)(e,t.doctype),r=!!t.id;if(!n)return{data:r?null:[]};var a=n.filter(G(t));return r?{data:a.length>0?a[0]:null}:{data:H(t)(a)}};var G=function(e){var t=e.doctype,n=q(e);return function(e){return e._type===t&&!e._deleted&&(!n||!!n(e))}},Q=function(e){return function(t){var n=(0,b.default)(t,e);return(0,m.default)(n)?n.toLowerCase():n}},H=function(e){var t=e.sort;if(!t)return function(e){return e};if(!Array.isArray(e.sort))return x.default.warn("Correct update of queries with a sort that is not an array is not supported. Use an array as argument of QueryDefinition::sort"),function(e){return e};var n=t.map(function(e){return Object.entries(e)[0]}),r=n.map(function(e){return e[0]}).map(Q),a=n.map(function(e){return e[1]});return function(e){return(0,v.default)(e,r,a)}};t.makeSorterFromDefinition=H;var J=function(e,t,n){var r=G(e.definition),a=(0,s.default)((0,l.default)(t,r),function(e){return e.map(w.properId)}),i=a.true,o=void 0===i?[]:i,u=a.false,c=e.data,h=e.options&&e.options.autoUpdate,y=!h||!1!==h.remove,v=!h||!1!==h.add,m=!h||!1!==h.update,b=y?(0,f.default)(c,void 0===u?[]:u):[],g=v?(0,d.default)(o,c):[],k=m?(0,f.default)(c,o):[],_=b.length||g.length||k.length,O=(0,d.default)((0,p.default)(c,g),b),S=e.fetchedPagesCount,x=F(e,n,O,{count:O.length,fetchedPagesCount:S});return C(C({},e),{},{data:x,count:x.length,fetchedPagesCount:S,lastUpdate:_?Date.now():e.lastUpdate})};t.updateData=J;var Y=function(e,t){return function(n){var r=(0,b.default)(e,"response.data")||(0,b.default)(e,"definition.document");return r?(!Array.isArray(r)&&(r=[r]),r.length&&n.definition.doctype===r[0]._type)?J(n,r,t):n:n}};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(t.type==D){var a=B(e[t.queryId],t,n);return a===e[t.queryId]?e:C(C({},e),{},(0,u.default)({},t.queryId,a))}if(M(t)){var i=Y(t,n);return(0,s.default)(e,function(e){return e.id==t.queryId?B(e,t,n):r?i(e):e})}if((0,O.isReceivingMutationResult)(t)){var o,c,l=t.updateQueries?(o=t,c=n,function(e){var t=o.updateQueries,n=o.response,r=t[e.id];if(!r)return e;var a=r(W(c,e.definition.doctype,e.data),n).map(w.properId);return C(C({},e),{},{data:a,count:a.length,lastUpdate:Date.now()})}):Y(t,n);return(0,s.default)(e,l)}return e};t.initQuery=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t.doctype)throw Error("Cannot init query with no doctype");return{type:D,queryId:e,queryDefinition:t,options:n}};t.loadQuery=function(e,t){return C({type:j,queryId:e},t)};t.receiveQueryResult=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return C({type:A,queryId:e,response:t},n)};t.receiveQueryError=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return C({type:T,queryId:e,error:t},n)};t.resetQuery=function(e){return{type:R,queryId:e}};var W=function(e,t,n){return n.map(function(n){return(0,_.getDocumentFromSlice)(e,t,n)})};t.getQueryFromSlice=function(e,t,n){if(!e||!e[t])return C(C({},N),{},{id:t,data:null});var r=e[t];return n?C(C({},r),{},{data:W(n,r.definition.doctype,r.data)}):r};var K=function(){function e(){(0,a.default)(this,e),this.idCounter=1}return(0,i.default)(e,[{key:"generateRandomId",value:function(){var e=this.idCounter;return this.idCounter++,e.toString()}},{key:"generateId",value:function(e){if(!(0,S.isAGetByIdQuery)(e))return this.generateRandomId();var t=e.id,n=e.doctype;return"".concat(n,"/").concat(t)}}]),e}();t.QueryIDGenerator=K,K.UNNAMED="unnamed"},45330:function(e,t,n){var r,a,i,o,u=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.dispatchDelete=t.dispatchUpdate=t.dispatchCreate=void 0;var c=u(n(68434)),s=u(n(82007)),l=u(n(64512)),d=n(71450),f=n(22249);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,l.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=function(e,t){return h({id:e._id,_type:t},e)};var v=(r=(0,s.default)(c.default.mark(function e(t,n){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof n.enhanceDocFn){e.next=4;break}return e.next=3,n.enhanceDocFn(t,{client:n.client});case 3:return e.abrupt("return",e.sent);case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)}),m=function(e,t,n){e.dispatch((0,f.receiveMutationResult)(e.generateRandomId(),{data:t},{},n(t)))};var b=(a=(0,s.default)(c.default.mark(function e(t,n,r){var a,i,o=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},i=y(r,n),e.next=4,v(i,{client:t,enhanceDocFn:null==a?void 0:a.enhanceDocFn});case 4:m(t,e.sent,d.Mutations.createDocument);case 6:case"end":return e.stop()}},e)})),function(e,t,n){return a.apply(this,arguments)});t.dispatchCreate=b;var g=(i=(0,s.default)(c.default.mark(function e(t,n,r){var a,i,o=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},i=y(r,n),e.next=4,v(i,{client:t,enhanceDocFn:null==a?void 0:a.enhanceDocFn});case 4:m(t,e.sent,d.Mutations.updateDocument);case 6:case"end":return e.stop()}},e)})),function(e,t,n){return i.apply(this,arguments)});t.dispatchUpdate=g;var k=(o=(0,s.default)(c.default.mark(function e(t,n,r){var a,i,o=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},i=y(h(h({},r),{},{_deleted:!0}),n),e.next=4,v(i,{client:t,enhanceDocFn:null==a?void 0:a.enhanceDocFn});case 4:m(t,e.sent,d.Mutations.deleteDocument);case 6:case"end":return e.stop()}},e)})),function(e,t,n){return o.apply(this,arguments)});t.dispatchDelete=k},76790:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isQueryExisting=t.getRawQueryFromState=t.getQueryFromState=t.getQueryFromStore=t.getDocumentFromState=t.getCollectionFromState=t.getStateRoot=void 0;var r=n(94158),a=n(76305),i=function(e){return e.cozy||{}};t.getStateRoot=i;t.getCollectionFromState=function(e,t){return(0,r.getCollectionFromSlice)(i(e).documents,t)};t.getDocumentFromState=function(e,t,n){return(0,r.getDocumentFromSlice)(i(e).documents,t,n)};t.getQueryFromStore=function(e,t){return o(e.getState(),t)};var o=function(e,t){return(0,a.getQueryFromSlice)(i(e).queries,t,i(e).documents)};t.getQueryFromState=o;t.getRawQueryFromState=function(e,t){return(0,a.getQueryFromSlice)(i(e).queries,t)};t.isQueryExisting=function(e,t){return void 0!==i(e).queries[t]}},47064:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(64512)),o=r(n(80295)),u=r(n(82007));function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var l="io.cozy.terms";function d(){return(d=(0,u.default)(a.default.mark(function e(t,n){var r,i,u,c,d,f;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.id,i=(0,o.default)(n,["id"]),e.next=3,t.query({doctype:l,selector:{termsId:r,version:i.version},limit:1});case 3:if(!((u=e.sent.data)&&u.length)){e.next=13;break}if(!((c=u[0]).termsId==r&&c.version==i.version&&c.url!=i.url)){e.next=11;break}return d=s(s({_type:l},c),{},{url:i.url}),e.next=11,t.save(d);case 11:e.next=16;break;case 13:return f=s(s({_type:l},i),{},{termsId:r,accepted:!0,acceptedAt:new Date}),e.next=16,t.save(f);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}t.default={save:function(e,t){return d.apply(this,arguments)}}},325:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.CozyClient=void 0;var a=r(n(25665)),i=r(n(27952)),o=r(n(12323)),u=r(n(65105)),c=function(e){(0,a.default)(c,e);var t,n,r=(t=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);return e=n?Reflect.construct(r,arguments,(0,o.default)(this).constructor):r.apply(this,arguments),(0,i.default)(this,e)});function c(){return(0,u.default)(this,c),r.apply(this,arguments)}return c}(function e(t){(0,u.default)(this,e),Object.assign(this,t)});t.CozyClient=c},41315:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n(71450);t.default={}},88930:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isReactNativeOfflineError=t.hasQueriesBeenLoaded=t.isQueriesLoading=t.hasQueryBeenLoaded=t.isQueryLoading=t.cancelable=void 0;var a=r(n(22853));t.cancelable=function(e){var t,n=new Promise(function(n,r){t=r,e.then(n),e.catch(r)});return n.cancel=function(){t({canceled:!0})},n};var i=function(e){return e?"loading"===e.fetchStatus||"pending"===e.fetchStatus:(a.default.warn("isQueryLoading called on falsy value."),!1)};t.isQueryLoading=i;var o=function(e){return e.lastFetch};t.hasQueryBeenLoaded=o;t.isQueriesLoading=function(e){return Object.values(e).some(function(e){return i(e)})};t.hasQueriesBeenLoaded=function(e){return Object.values(e).some(function(e){return o(e)})};t.isReactNativeOfflineError=function(e){return"Network request failed"===e.message}},43592:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(95297)),o=a(n(65105)),u=a(n(19723)),c=a(n(8997)),s=a(n(25665)),l=a(n(27952)),d=a(n(12323)),f=a(n(64512)),p=r(n(67294)),h=a(n(45697));t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r=n.displayName||n.name||"Component",a=function(a){(0,s.default)(m,a);var h,y,v=(h=m,y=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=(0,d.default)(h);return e=y?Reflect.construct(t,arguments,(0,d.default)(this).constructor):t.apply(this,arguments),(0,l.default)(this,e)});function m(n,a){var i;if((0,o.default)(this,m),i=v.call(this,n,a),(0,f.default)((0,c.default)(i),"mutate",function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];return i.client.mutate(e.apply(null,r),t)}),i.client=n.client||a.client,!i.client)throw Error('Could not find "client" in either the context or props of '.concat(r));return i}return(0,u.default)(m,[{key:"render",value:function(){var e=(0,f.default)({},t.name||"mutate",this.mutate);return p.default.createElement(n,(0,i.default)({},e,this.props))}}]),m}(p.Component);return(0,f.default)(a,"contextTypes",{client:h.default.object}),a.displayName="WithMutation(".concat(r,")"),a}}},18428:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(95297)),o=a(n(65105)),u=a(n(19723)),c=a(n(25665)),s=a(n(27952)),l=a(n(12323)),d=a(n(64512)),f=a(n(98235)),p=a(n(82492)),h=r(n(67294)),y=a(n(45697)),v=a(n(22853));function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}t.default=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){var n=e.displayName||e.name||"Component",r=function(r){(0,c.default)(g,r);var a,y,b=(a=g,y=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=(0,l.default)(a);return e=y?Reflect.construct(t,arguments,(0,l.default)(this).constructor):t.apply(this,arguments),(0,s.default)(this,e)});function g(e,r){(0,o.default)(this,g),c=b.call(this,e,r);var a,i,u,c,s=e.client||r.client;if(v.default.warn("Deprecation: withMutations will be removed in the near future, prefer to use withClient to access the client. See https://github.com/cozy/cozy-client/pull/638 for more information."),!s)throw Error('Could not find "client" in either the context or props of '.concat(n));return c.mutations=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,d.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({createDocument:s.create.bind(s),saveDocument:s.save.bind(s),deleteDocument:s.destroy.bind(s)},(a=t,i=s,u=e,p.default.apply(void 0,(0,f.default)(a.map(function(e){return"function"==typeof e?e(i,u):e}))))),c}return(0,u.default)(g,[{key:"render",value:function(){return h.default.createElement(e,(0,i.default)({},this.mutations,this.props))}}]),g}(h.Component);return(0,d.default)(r,"contextTypes",{client:y.default.object}),r.displayName="WithMutations(".concat(n,")"),r}}},28802:function(e,t,n){Object.defineProperty(t,"SearchEngine",{enumerable:!0,get:function(){return r.SearchEngine}});var r=n(42776)},42776:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.SearchEngine=void 0;var a=r(n(98235)),i=r(n(80295)),o=r(n(68434)),u=r(n(82007)),c=r(n(65105)),s=r(n(19723)),l=r(n(64512)),d=r(n(44921)),f=r(n(74450)),p=n(72916),h=n(13542),y=n(9183),v=n(11020),m=n(29315),b=n(15146),g=n(35585),k=n(56051),_=["id","field"];function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach(function(t){(0,l.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function S(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=n.return&&n.return()}finally{if(u)throw i}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var E=(0,f.default)("\uD83D\uDDC2 [Indexing]"),P=function(){var e,t,n,r,f,O,x;function P(e){(0,c.default)(this,P),(0,l.default)(this,"client",void 0),(0,l.default)(this,"searchIndexes",void 0),(0,l.default)(this,"debouncedReplication",void 0),(0,l.default)(this,"isLocalSearch",void 0),this.client=e,this.searchIndexes={},this.isLocalSearch=!!(0,y.getPouchLink)(this.client),E.info("Use local data on trusted device : ",this.isLocalSearch),this.debouncedReplication=function(){var t=(0,y.getPouchLink)(e);t&&t.startReplicationWithDebounce()},this.indexDocuments()}return(0,s.default)(P,[{key:"indexDocuments",value:(e=(0,u.default)(o.default.mark(function e(){var t,n,r,a,i,c=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client){e.next=2;break}return e.abrupt("return");case 2:if(t=0,n=0,this.isLocalSearch){e.next=22;break}r=S(h.SEARCHABLE_DOCTYPES),e.prev=5,r.s();case 7:if((a=r.n()).done){e.next=14;break}return i=a.value,e.next=11,this.indexDocsForSearch(i);case 11:this.searchIndexes[i]=e.sent;case 12:e.next=7;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:this.isLocalSearch&&(this.client.on("pouchlink:doctypesync:end",function(){var e=(0,u.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,k.isSearchedDoctype)(t)){e.next=4;break}return e.next=3,c.indexDocsForSearch(t);case 3:c.searchIndexes[t]=e.sent;case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.client.on("pouchlink:sync:start",function(){E.debug("Started pouch replication"),t=performance.now()}),this.client.on("pouchlink:sync:end",function(){E.debug("Ended pouch replication"),n=performance.now(),E.debug("Replication took ".concat((n-t).toFixed(2)))})),this.client.isLogged?this.afterLogin():this.client.on("login",function(){c.afterLogin()});case 24:case"end":return e.stop()}},e,this,[[5,16,19,22]])})),function(){return e.apply(this,arguments)})},{key:"afterLogin",value:function(){this.client.registerPlugin(p.RealtimePlugin,{}),this.handleUpdatedOrCreatedDoc=this.handleUpdatedOrCreatedDoc.bind(this),this.handleDeletedDoc=this.handleDeletedDoc.bind(this),this.subscribeDoctype(this.client,h.FILES_DOCTYPE),this.subscribeDoctype(this.client,h.CONTACTS_DOCTYPE),this.subscribeDoctype(this.client,h.APPS_DOCTYPE)}},{key:"subscribeDoctype",value:function(e,t){var n=e.plugins.realtime;n.subscribe("created",t,this.handleUpdatedOrCreatedDoc),n.subscribe("updated",t,this.handleUpdatedOrCreatedDoc),n.subscribe("deleted",t,this.handleDeletedDoc)}},{key:"handleUpdatedOrCreatedDoc",value:function(e){var t,n=e._type;if(!(0,k.isSearchedDoctype)(n))return;var r=null===(t=this.searchIndexes)||void 0===t?void 0:t[n];if(!!r)E.debug("[REALTIME] Update doc from index after update : ",e),this.indexDoc(r.index,e),this.isLocalSearch&&this.debouncedReplication()}},{key:"handleDeletedDoc",value:function(e){var t,n=e._type;if(!!(0,k.isSearchedDoctype)(n)&&!!(null===(t=this.searchIndexes)||void 0===t?void 0:t[n]))E.debug("[REALTIME] Remove doc from index after update : ",e),this.searchIndexes[n].index.remove(e._id),this.isLocalSearch&&this.debouncedReplication()}},{key:"buildSearchIndex",value:function(e,t){var n=performance.now(),r=h.SEARCH_SCHEMA[e],a=new d.default.Document({tokenize:"reverse",encode:(0,v.getSearchEncoder)(),minlength:3,document:{id:"_id",index:r,store:!0}}),i,o=S(this.isLocalSearch?(0,m.addFilePaths)(t):t);try{for(o.s();!(i=o.n()).done;){var u=i.value;this.indexDoc(a,u)}}catch(e){o.e(e)}finally{o.f()}var c=performance.now();return E.debug("Create ".concat(e," index took ").concat((c-n).toFixed(2)," ms")),a}},{key:"indexDoc",value:(t=(0,u.default)(o.default.mark(function e(t,n){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shouldIndexDoc(n)){e.next=9;break}if(r=n,!(0,k.isIOCozyFile)(n)){e.next=6;break}return e.next=5,(0,m.computeFileFullpath)(this.client,n);case 5:r=e.sent;case 6:t.add(r),e.next=10;break;case 9:t.remove(n._id);case 10:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"shouldIndexDoc",value:function(e){return!(0,k.isIOCozyFile)(e)||(0,m.shouldKeepFile)(e)}},{key:"getLocalLastSeq",value:(n=(0,u.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isLocalSearch){e.next=11;break}if(!(n=(0,y.getPouchLink)(this.client))){e.next=8;break}return e.next=5,n.getDbInfo(t);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=null;case 9:return r=e.t0,e.abrupt("return",(null==r?void 0:r.update_seq)||0);case 11:return e.abrupt("return",-1);case 12:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"queryLocalOrRemoteDocs",value:(r=(0,u.default)(o.default.mark(function e(t){var n,r,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],r=performance.now(),!(!this.isLocalSearch&&t===h.FILES_DOCTYPE)){e.next=8;break}return e.next=5,(0,g.queryFilesForSearch)(this.client);case 5:n=e.sent,e.next=11;break;case 8:return e.next=10,(0,g.queryAllDocs)(this.client,t);case 10:n=e.sent;case 11:return a=performance.now(),E.debug("Query ".concat(n.length," ").concat(t," took ").concat((a-r).toFixed(2)," ms")),e.abrupt("return",n);case 14:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"initialIndexation",value:(f=(0,u.default)(o.default.mark(function e(t){var n,r,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryLocalOrRemoteDocs(t);case 2:return n=e.sent,r=this.buildSearchIndex(t,n),e.next=6,this.getLocalLastSeq(t);case 6:return a=e.sent,this.searchIndexes[t]={index:r,lastSeq:a,lastUpdated:new Date().toISOString()},e.abrupt("return",this.searchIndexes[t]);case 9:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"incrementalIndexation",value:(O=(0,u.default)(o.default.mark(function e(t,n){var r,a,i,u,c,s,l;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,y.getPouchLink)(this.client),!(!this.isLocalSearch||!r)){e.next=3;break}return e.abrupt("return",n);case 3:return a=n.lastSeq||0,e.next=6,r.getChanges(t,{include_docs:!0,since:a});case 6:u=S((i=e.sent).results);try{for(u.s();!(c=u.n()).done;)(s=c.value).deleted?n.index.remove(s.id):(l=w(w({},s.doc),{},{_type:t}),this.indexDoc(n.index,l))}catch(e){u.e(e)}finally{u.f()}return n.lastSeq=i.last_seq,n.lastUpdated=new Date().toISOString(),e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return O.apply(this,arguments)})},{key:"indexDocsForSearch",value:(x=(0,u.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.searchIndexes[t]){e.next=3;break}return e.abrupt("return",this.initialIndexation(t));case 3:return e.abrupt("return",this.incrementalIndexation(t,n));case 4:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"search",value:function(e){if(!this.searchIndexes)return E.warn("[SEARCH] No search index available"),[];var t=this.searchOnIndexes(e),n=this.deduplicateAndFlatten(t),r=this.sortSearchResults(n),a=this.limitSearchResults(r),i=[],o,u=S(a);try{for(u.s();!(o=u.n()).done;){var c=o.value,s=(0,b.normalizeSearchResult)(this.client,c,e);i.push(s)}}catch(e){u.e(e)}finally{u.f()}return i.filter(function(e){return e.title})}},{key:"searchOnIndexes",value:function(e){var t=this,n=[],r=function(r){var a=t.searchIndexes[r];if(!a)return E.warn("[SEARCH] No search index available for ",r),"continue";var i=a.index.search(e,1e4,{limit:1e4,enrich:!0}).map(function(e){return w(w({},e),{},{doctype:r})});n=n.concat(i)};for(var a in this.searchIndexes)if("continue"===r(a))continue;return n}},{key:"deduplicateAndFlatten",value:function(e){var t=e.flatMap(function(e){return e.result.map(function(t){return w(w({},t),{},{field:e.field,doctype:e.doctype})})}),n=new Map;return t.forEach(function(e){var t,r=e.id,a=e.field,o=(0,i.default)(e,_);n.has(r)?null===(t=n.get(r))||void 0===t||t.fields.push(a):n.set(r,w({id:r,fields:[a]},o))}),(0,a.default)(n.values())}},{key:"compareStrings",value:function(e,t){return e.localeCompare(t,void 0,{numeric:!0})}},{key:"sortSearchResults",value:function(e){var t=this;return e.sort(function(e,n){var r=h.DOCTYPE_ORDER[e.doctype]-h.DOCTYPE_ORDER[n.doctype];if(0!==r)return r;if(e.doctype===h.APPS_DOCTYPE&&(0,k.isIOCozyApp)(e.doc)&&(0,k.isIOCozyApp)(n.doc))return t.compareStrings(e.doc.slug,n.doc.slug);if(e.doctype===h.CONTACTS_DOCTYPE&&(0,k.isIOCozyContact)(e.doc)&&(0,k.isIOCozyContact)(n.doc))return t.compareStrings(e.doc.displayName,n.doc.displayName);if(e.doctype===h.FILES_DOCTYPE&&(0,k.isIOCozyFile)(e.doc)&&(0,k.isIOCozyFile)(n.doc))return t.sortFiles(e,n);return 0})}},{key:"sortFiles",value:function(e,t){return(0,k.isIOCozyFile)(e.doc)&&(0,k.isIOCozyFile)(t.doc)?e.fields.includes("name")&&t.fields.includes("name")?e.doc.type!==t.doc.type?"directory"===e.doc.type?-1:1:this.compareStrings(e.doc.name,t.doc.name):e.fields.includes("name")?-1:1:0}},{key:"limitSearchResults",value:function(e){return e.slice(0,h.LIMIT_DOCTYPE_SEARCH)}}]),P}();t.SearchEngine=P},13542:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_FILE=t.TYPE_DIRECTORY=t.TRASH_DIR_ID=t.SHARED_DRIVES_DIR_ID=t.SEARCH_SCHEMA=t.SEARCHABLE_DOCTYPES=t.ROOT_DIR_ID=t.LIMIT_DOCTYPE_SEARCH=t.FILES_DOCTYPE=t.DOCTYPE_ORDER=t.CONTACTS_DOCTYPE=t.APPS_DOCTYPE=void 0;var i=a(n(64512));t.SEARCHABLE_DOCTYPES=["io.cozy.files","io.cozy.contacts","io.cozy.apps"];t.SEARCH_SCHEMA={"io.cozy.files":["name","path"],"io.cozy.contacts":["displayName","fullname","email[]:address","address[]:formattedAddress","phone[]:number","cozy[]:url","birthday","company","jobTitle"],"io.cozy.apps":["slug","name"]};var o="io.cozy.files";t.FILES_DOCTYPE=o;var u="io.cozy.contacts";t.CONTACTS_DOCTYPE=u;var c="io.cozy.apps";t.APPS_DOCTYPE=c;t.TYPE_DIRECTORY="directory";t.TYPE_FILE="file";t.ROOT_DIR_ID="io.cozy.files.root-dir";t.TRASH_DIR_ID="io.cozy.files.trash-dir";t.SHARED_DRIVES_DIR_ID="io.cozy.files.shared-drives-dir";t.LIMIT_DOCTYPE_SEARCH=100;var s=(r={},(0,i.default)(r,c,0),(0,i.default)(r,u,1),(0,i.default)(r,o,2),r);t.DOCTYPE_ORDER=s},9183:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getPouchLink=void 0;var a=r(n(70999));t.getPouchLink=function(e){return e&&e.links.find(function(e){return e instanceof a.default})||null}},11020:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.getSearchEncoder=void 0;var r=n(1465);t.getSearchEncoder=function(){return r.encode}},29315:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.shouldKeepFile=t.normalizeFileWithFolders=t.computeFileFullpath=t.addFilePaths=void 0;var i=a(n(68434)),o=a(n(82007)),u=a(n(98235)),c=a(n(64512)),s=n(13542),l=n(35585),d=n(56051);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,c.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}t.normalizeFileWithFolders=function(e,t){var n,r=t.type===s.TYPE_DIRECTORY,a="";if(r)a=null!==(n=t.path)&&void 0!==n?n:"";else{var i=e.find(function(e){return e._id===t.dir_id});a=i&&i.path?i.path:""}return p(p({},t),{},{_type:"io.cozy.files",path:a})};t.addFilePaths=function(e){var t=(0,u.default)(e),n=t.filter(function(e){return(0,d.isIOCozyFile)(e)});if(n.length>0){var r=new Map;return n.forEach(function(e){e.type===s.TYPE_DIRECTORY&&r.set(e._id,e.path||"")}),n.map(function(e){if(e.type===s.TYPE_FILE){var t=r.get(e.dir_id)||"";return p(p({},e),{},{path:t?"".concat(t,"/").concat(e.name):""})}return e})}return t};t.shouldKeepFile=function(e){var t,n=!e.trashed&&!/^\/\.cozy_trash/.test(null!==(t=e.path)&&void 0!==t?t:""),r=e._id!==s.ROOT_DIR_ID,a=e._id!==s.SHARED_DRIVES_DIR_ID;return n&&r&&a};var h=(r=(0,o.default)(i.default.mark(function e(t,n){var r,a,o,u,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.type!==s.TYPE_DIRECTORY){e.next=2;break}return e.abrupt("return",n);case 2:if(!n.path){e.next=7;break}if(!(null!==(r=n.path)&&void 0!==r&&r.includes(n.name))){e.next=5;break}return e.abrupt("return",n);case 5:return a="".concat(n.path,"/").concat(n.name),e.abrupt("return",p(p({},n),{},{path:a}));case 7:return o=p({},n),e.next=10,(0,l.queryDocById)(t,s.FILES_DOCTYPE,n.dir_id);case 10:return(u=e.sent)&&(c="".concat(u.path,"/").concat(n.name),o.path=c),e.abrupt("return",o);case 13:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.computeFileFullpath=h},15146:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeSearchResult=t.cleanFilePath=void 0;var a=r(n(64512)),i=n(16396),o=n(13542),u=n(56051);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}t.normalizeSearchResult=function(e,t,n){var r=l(t.doc),a=p(e,r),i=h(e,r,a),o=y(e,r,i),u=d(r),c=f(e,{fields:t.fields,doc:r,query:n});return{doc:r,slug:a,title:u,subTitle:c,url:i,secondaryUrl:o}};var l=function(e){if(!(0,u.isIOCozyFile)(e))return e;var t=e.path,n=e.name;if(!t)return e;var r=t;return t.endsWith("/".concat(n))&&(r=t.slice(0,-n.length-1)),s(s({},e),{},{path:r})};t.cleanFilePath=l;var d=function(e){return(0,u.isIOCozyFile)(e)?e.name:(0,u.isIOCozyContact)(e)?e.displayName||e.fullname||null:(0,u.isIOCozyApp)(e)?e.name:null},f=function(e,t){var n=t.fields,r=t.doc,a=t.query;if((0,u.isIOCozyFile)(r))return null!==(i=r.path)&&void 0!==i?i:null;if((0,u.isIOCozyContact)(r)){var i,c,s,l,d=n.find(function(e){return"displayName"!==e&&"fullname"!==e});if(!d)return null;if(d.includes("[]:")){var f=d.split("[]:");if(2!==f.length)return null;var p=f[0],h=f[1],y=r[p],v=Array.isArray(y)&&y.find(function(e){var t="object"==typeof e&&null!==e&&h in e&&e[h];return"string"==typeof t&&t.includes(a)});if(!v)return null;l=v[h]}else l=r[d];return null!==(c=null===(s=l)||void 0===s?void 0:s.toString())&&void 0!==c?c:null}if(r._type===o.APPS_DOCTYPE)try{var m=e.getInstanceOptions().locale||"en";if(r.locales[m])return r.locales[m].short_description}catch(e){return r.name}return null},p=function(e,t){if((0,u.isIOCozyFile)(t)){if(i.models.file.isNote(t)){var n,r=e.getStackClient().uri,a=null===(n=t.cozyMetadata)||void 0===n?void 0:n.createdOn;return a&&a!=="".concat(r,"/")?"drive":"notes"}return"drive"}return(0,u.isIOCozyContact)(t)?"contacts":(0,u.isIOCozyApp)(t)?t.slug:null},h=function(e,t,n){var r="";if((0,u.isIOCozyFile)(t)){var a=t.type===o.TYPE_DIRECTORY,c=a?t._id:t.dir_id,s="/folder/".concat(c);r=i.models.file.isNote(t)?"notes"===n?"/n/".concat(t._id):"/note/".concat(t._id):i.models.file.shouldBeOpenedByOnlyOffice(t)?"/onlyoffice/".concat(t._id,"?redirectLink=drive").concat(s):a?s:"".concat(s,"/file/").concat(t._id)}return((0,u.isIOCozyContact)(t)&&(r="/".concat(t._id)),n)?(0,i.generateWebLink)({cozyUrl:e.getStackClient().uri,slug:n,subDomainType:e.getInstanceOptions().subdomain,hash:r,pathname:"",searchParams:[]}):null},y=function(e,t,n){if(!(0,u.isIOCozyFile)(t)||!n)return null;var r="/folder/".concat(t.dir_id);return(0,i.generateWebLink)({cozyUrl:e.getStackClient().uri,slug:"drive",subDomainType:e.getInstanceOptions().subdomain,hash:r,pathname:"",searchParams:[]})}},35585:function(e,t,n){var r,a,i,o=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.queryFilesForSearch=t.queryDocById=t.queryAllDocs=void 0;var u=o(n(68434)),c=o(n(64512)),s=o(n(82007)),l=n(16396),d=n(13542),f=n(29315);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var h=(r=(0,s.default)(u.default.mark(function e(t){var n,r,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getStackClient().fetchJSON("GET","/data/io.cozy.files/_all_docs?Fields=_id,trashed,dir_id,name,path,type,mime,class,metadata.title,metadata.version&DesignDocs=false&include_docs=true");case 2:return r=(n=e.sent.rows.map(function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,c.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({id:e.id},e.doc)})).filter(function(e){return e.type===d.TYPE_DIRECTORY}),a=n.filter(function(e){return(0,f.shouldKeepFile)(e)}).map(function(e){return(0,f.normalizeFileWithFolders)(r,e)}),e.abrupt("return",a);case 8:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.queryFilesForSearch=h;var y=(a=(0,s.default)(u.default.mark(function e(t,n){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.queryAll((0,l.Q)(n).limitBy(null)));case 1:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)});t.queryAllDocs=y;var v=(i=(0,s.default)(u.default.mark(function e(t,n,r){var a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query((0,l.Q)(n).getById(r),{singleDocData:!0});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}},e)})),function(e,t,n){return i.apply(this,arguments)});t.queryDocById=v},56051:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isSearchedDoctype=t.isIOCozyFile=t.isIOCozyContact=t.isIOCozyApp=void 0;var r=n(13542);t.isIOCozyFile=function(e){return e._type===r.FILES_DOCTYPE};t.isIOCozyContact=function(e){return e._type===r.CONTACTS_DOCTYPE};t.isIOCozyApp=function(e){return e._type===r.APPS_DOCTYPE};var a=Object.keys(r.SEARCH_SCHEMA);t.isSearchedDoctype=function(e){return!!e&&a.includes(e)}},8969:function(e,t,n){var r,a,i=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.startApp=t.default=t.checkApp=void 0;var o=i(n(68434)),u=i(n(82007)),c=n(54878),s=function(){return window.startApp},l=function(e){var t=e.appId,n=e.uri;return(0,c.isAndroidApp)()?{package:t}:n},d={};var f=d.startApp=(r=(0,u.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.startApp,e.next=3,d.checkApp(t);case 3:if(!e.sent){e.next=9;break}return r=l(t),e.abrupt("return",new Promise(function(e,t){if(!s()){t(Error("Cordova plugin 'com.lampa.startapp' is not installed. This plugin is needed to start a native app. Required by cozy-bar"));return}n.set(r).start(e,t)}));case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.startApp=f;var p=d.checkApp=(a=(0,u.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.startApp,r=l(t),e.abrupt("return",new Promise(function(e,t){if(!s()){t(Error("Cordova plugin 'com.lampa.startapp' is not installed."));return}n.set(r).check(function(t){return e("OK"===t||t)},function(n){!1===n||0===n.indexOf("NameNotFoundException")?e(!1):t(n)})}));case 3:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)});t.checkApp=p;t.default=d},31555:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isCordova=void 0;t.isCordova=function(){return"undefined"!=typeof window&&void 0!==window.cordova}},34586:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.openDeeplinkOrRedirect=void 0;var n=function(e,t,n){var r=document.createElement("iframe");return r.src=t,r.id="hiddenIframe_".concat(n),r.style.display="none",e.appendChild(r),r},r=function(e,t){var r=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);window.addEventListener("blur",o);var a=n(document.body,"about:blank",r),i=setTimeout(function(){t(),window.removeEventListener("blur",o),a.parentElement.removeChild(a)},500);function o(){clearTimeout(i),window.removeEventListener("blur",o),a.parentElement.removeChild(a)}a.contentWindow.location.href=e},a=function(e,t){for(var n=setTimeout(function(){t(),r.removeEventListener("blur",a)},500),r=window;r!=r.parent;)r=r.parent;function a(){clearTimeout(n),r.removeEventListener("blur",a)}r.addEventListener("blur",a),window.location=e},i=function(e,t){navigator.msLaunchUri(e,void 0,t)},o=function(){var e=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t=navigator.userAgent.toLowerCase(),n=t.includes("safari")&&!t.includes("chrome")||Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,r=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,a=r&&(t.includes("os 12_2")||t.includes("os 12_3"));return{isOpera:e,isFirefox:void 0!==window.InstallTrigger,isSafari:n,isChrome:!!window.chrome&&!e,isIOS122:a,isIOS:r}};t.openDeeplinkOrRedirect=function(e,t){if(navigator.msLaunchUri)i(e,t);else{var n=o();n.isChrome||n.isIOS&&!n.isIOS122?a(e,t):n.isSafari&&!n.isIOS122||n.isFirefox?r(e,t):t()}}},26082:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getDeviceName=void 0;var a=r(n(48403)),i=n(31555),o=n(28715),u=n(54878),c="Device",s=function(e){for(var t=0,n=["iPhone","iPad","Watch","AppleTV"];t<n.length;t++){var r=n[t];if(e.match(new RegExp(r)))return r}return c};t.getDeviceName=function(){if(!(0,o.hasDevicePlugin)())return(0,i.isCordova)()&&console.warn("You should install `cordova-plugin-device`."),c;var e=window.device,t=e.manufacturer,n=e.model,r=(0,u.isIOSApp)()?s(n):n;return"".concat((0,a.default)(t)," ").concat(r)}},70574:function(e,t,n){var r,a,i=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isFlagshipOfflineSupported=t.isFlagshipApp=t.getFlagshipMetadata=t.FlagshipRoutes=void 0;var o=i(n(33918));t.FlagshipRoutes=a,(r=a||(t.FlagshipRoutes=a={})).Home="home",r.Cozyapp="cozyapp",r.Authenticate="authenticate",r.Onboarding="onboarding",r.Stack="stack";var u=function(){return"undefined"!=typeof window?window:void(0,o.default)("error",'"window" is not defined. This means that getGlobalWindow() shouldn\'t have been called and investigation should be done to prevent this call')};t.getFlagshipMetadata=function(){var e,t,n;return null!==(e=null===(t=u())||void 0===t?void 0:null===(n=t.cozy)||void 0===n?void 0:n.flagship)&&void 0!==e?e:{}};t.isFlagshipApp=function(){var e,t;return(null===(e=u())||void 0===e?void 0:null===(t=e.cozy)||void 0===t?void 0:t.flagship)!==void 0};t.isFlagshipOfflineSupported=function(){var e,t,n;return null===(e=u())||void 0===e?void 0:null===(t=e.cozy)||void 0===t?void 0:null===(n=t.flagship)||void 0===n?void 0:n.offline_available}},25976:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"checkApp",{enumerable:!0,get:function(){return i.checkApp}}),Object.defineProperty(t,"getDeviceName",{enumerable:!0,get:function(){return a.getDeviceName}}),Object.defineProperty(t,"getFlagshipMetadata",{enumerable:!0,get:function(){return l.getFlagshipMetadata}}),Object.defineProperty(t,"getPlatform",{enumerable:!0,get:function(){return r.getPlatform}}),Object.defineProperty(t,"hasDevicePlugin",{enumerable:!0,get:function(){return o.hasDevicePlugin}}),Object.defineProperty(t,"hasInAppBrowserPlugin",{enumerable:!0,get:function(){return o.hasInAppBrowserPlugin}}),Object.defineProperty(t,"hasNetworkInformationPlugin",{enumerable:!0,get:function(){return o.hasNetworkInformationPlugin}}),Object.defineProperty(t,"hasSafariPlugin",{enumerable:!0,get:function(){return o.hasSafariPlugin}}),Object.defineProperty(t,"isAndroid",{enumerable:!0,get:function(){return r.isAndroid}}),Object.defineProperty(t,"isAndroidApp",{enumerable:!0,get:function(){return r.isAndroidApp}}),Object.defineProperty(t,"isCordova",{enumerable:!0,get:function(){return u.isCordova}}),Object.defineProperty(t,"isFlagshipApp",{enumerable:!0,get:function(){return l.isFlagshipApp}}),Object.defineProperty(t,"isFlagshipOfflineSupported",{enumerable:!0,get:function(){return l.isFlagshipOfflineSupported}}),Object.defineProperty(t,"isIOS",{enumerable:!0,get:function(){return r.isIOS}}),Object.defineProperty(t,"isIOSApp",{enumerable:!0,get:function(){return r.isIOSApp}}),Object.defineProperty(t,"isMobile",{enumerable:!0,get:function(){return r.isMobile}}),Object.defineProperty(t,"isMobileApp",{enumerable:!0,get:function(){return r.isMobileApp}}),Object.defineProperty(t,"isWebApp",{enumerable:!0,get:function(){return r.isWebApp}}),Object.defineProperty(t,"nativeLinkOpen",{enumerable:!0,get:function(){return c.nativeLinkOpen}}),Object.defineProperty(t,"openDeeplinkOrRedirect",{enumerable:!0,get:function(){return s.openDeeplinkOrRedirect}}),Object.defineProperty(t,"startApp",{enumerable:!0,get:function(){return i.startApp}});var r=n(54878),a=n(26082),i=n(8969),o=n(28715),u=n(31555),c=n(9526),s=n(34586),l=n(70574)},9526:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.nativeLinkOpen=void 0;var i=a(n(68434)),o=a(n(82007)),u=n(28715);var c=(r=(0,o.default)(i.default.mark(function e(t){var n,r,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.url,e.next=3,(0,u.hasSafariPlugin)();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}e.t0=window.SafariViewController;case 6:if(!e.t0){e.next=10;break}window.SafariViewController.show({url:n,transition:"curl"},function(e){"closed"===e.event&&window.SafariViewController.hide()},function(){window.SafariViewController.hide()}),e.next=11;break;case 10:(0,u.hasInAppBrowserPlugin)()?(r="_blank",a="clearcache=yes,zoom=no",window.cordova.InAppBrowser.open(n,r,a)):window.location=n;case 11:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.nativeLinkOpen=c},54878:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isWebApp=t.isMobileApp=t.isMobile=t.isIOSApp=t.isIOS=t.isAndroidApp=t.isAndroid=t.getPlatform=void 0;var r=n(31555),a=function(){return(0,r.isCordova)()?window.cordova.platformId:"web"};t.getPlatform=a;var i=function(e){return a()===e};t.isIOSApp=function(){return i("ios")};t.isAndroidApp=function(){return i("android")};t.isWebApp=function(){return i("web")};t.isMobileApp=function(){return(0,r.isCordova)()};var o=function(){return window.navigator.userAgent&&window.navigator.userAgent.indexOf("Android")>=0};t.isAndroid=o;var u=function(){return window.navigator.userAgent&&/iPad|iPhone|iPod/.test(window.navigator.userAgent)};t.isIOS=u;t.isMobile=function(){return o()||u()}},28715:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.hasSafariPlugin=t.hasNetworkInformationPlugin=t.hasInAppBrowserPlugin=t.hasDevicePlugin=void 0;var r=n(31555);t.hasDevicePlugin=function(){return(0,r.isCordova)()&&void 0!==window.device};t.hasInAppBrowserPlugin=function(){return(0,r.isCordova)()&&void 0!==window.cordova.InAppBrowser};t.hasSafariPlugin=function(){return new Promise(function(e){if(!(0,r.isCordova)()||void 0===window.SafariViewController){e(!1);return}window.SafariViewController.isAvailable(function(t){return e(t)})})};t.hasNetworkInformationPlugin=function(){return(0,r.isCordova)()&&void 0!==window.navigator.connection}},73221:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(25665)),u=r(n(27952)),c=r(n(12323)),s=r(n(67294)),l=r(n(36049)),d=r(n(24394)),f=function(e){var t=e.name,n=e.onChange;return s.default.createElement("input",{type:"checkbox",checked:(0,d.default)(t),onChange:function(e){return(0,d.default)(t,JSON.parse(e.target.checked))&&n&&n()}})},p=function(e){var t=e.children,n=e.onClick;return s.default.createElement("button",{type:"button",onClick:n,style:{position:"absolute",top:"100%",left:"0"}},t)},h=(0,l.default)(function(){var e=d.default.list();return s.default.createElement("div",null,e.map(function(e){return s.default.createElement("div",{key:e},e.replace(/[a-z][A-Z]/g,function(e){return e[0]+" "+e[1].toLowerCase()})," : ",s.default.createElement(f,{onChange:function(){},name:e}))}))}),y=function(e){(0,o.default)(l,e);var t,n,r=(t=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,c.default)(t);return e=n?Reflect.construct(r,arguments,(0,c.default)(this).constructor):r.apply(this,arguments),(0,u.default)(this,e)});function l(e){var t;return(0,a.default)(this,l),(t=r.call(this,e)).state={folded:!0},t}return(0,i.default)(l,[{key:"render",value:function(){var e,t=this;return(0,d.default)("switcher")&&s.default.createElement("div",{className:"flag-switcher",style:(e=this.state,{borderBottomLeftRadius:".5rem",padding:".5rem",position:"absolute",zIndex:1e3,color:"white",background:"rgba(74,68,90,0.85)",top:0,right:0,transform:"translateY(".concat(e.folded?"-100%":"0",")")})},s.default.createElement(p,{onClick:function(){return t.setState(function(e){return{folded:!e.folded}})}},this.state.folded?"Show":"Hide"," flags"),s.default.createElement("button",{onClick:function(){return t.setState({date:Date.now()})}},"refresh"),"\xa0",s.default.createElement("button",{onClick:function(){return d.default.reset()&&(0,d.default)("switcher",!0)&&t.forceUpdate()}},"reset"),s.default.createElement(h,null))}}]),l}(s.default.Component);t.default=y,y.List=h},36049:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(8997)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(64512)),d=r(n(67294)),f=r(n(24394)),p=f.default.store;t.default=function(e){var t,n=function(t){(0,u.default)(h,t);var n,r,f=(n=h,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(n);return e=r?Reflect.construct(t,arguments,(0,s.default)(this).constructor):t.apply(this,arguments),(0,c.default)(this,e)});function h(){var e;(0,a.default)(this,h);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=f.call.apply(f,[this].concat(n)),(0,l.default)((0,o.default)(e),"handleChange",function(){e.forceUpdate()}),e}return(0,i.default)(h,[{key:"componentDidMount",value:function(){p.on("change",this.handleChange)}},{key:"componentWillUnmount",value:function(){p.removeListener("change",this.handleChange)}},{key:"render",value:function(){return d.default.createElement(e,this.props)}}]),h}(d.default.Component);return(0,l.default)(n,"displayName",void 0),n.displayName="withFlags(".concat(null!==(t=e.displayName)&&void 0!==t?t:e.name,")"),n}},24394:function(e,t,n){var r,a,i,o=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.resetFlags=t.listFlags=t.initializeFromRemote=t.initializeFromDOM=t.initialize=t.getTemplateData=t.enable=t.default=void 0;var u=o(n(68434)),c=o(n(65105)),s=o(n(19723)),l=o(n(82007)),d=o(n(90402)),f=n(71450),p=o(n(10916));function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var y=new p.default,v=function(e,t){return 1==arguments.length?y.get(e):(y.set(e,t),t)},m=function(){return y.keys().sort()};t.listFlags=m;var b=function(){m().forEach(function(e){return y.remove(e)})};t.resetFlags=b;var g=function(e){if(Array.isArray(e)){if(0===e.length)return;console.log("flags.enable: Deprecation warning: prefer to use an object { flag1: true, flag2: true } instead of an array when using flags.enable"),t=e.map(function(e){return[e,!0]})}else"object"==typeof e&&(t=Object.entries(e));if(!!t){var t,n,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}}(e))){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=n.return&&n.return()}finally{if(u)throw i}}}}(t);try{for(r.s();!(n=r.n()).done;){var a=(0,d.default)(n.value,2),i=a[0],o=a[1];v(i,o)}}catch(e){r.e(e)}finally{r.f()}}};t.enable=g;var k=(r=(0,l.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query((0,f.Q)("io.cozy.settings").getById("io.cozy.settings.flags"));case 2:g(e.sent.data.attributes);case 5:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.initializeFromRemote=k;var _=function(e){if("undefined"==typeof document)return null;var t,n=document.querySelector("[data-cozy]"),r=document.querySelector("[data-cozy-".concat(e,"]"));try{if(n)return JSON.parse(n.dataset.cozy)[e];if(!r)return null;else{;return console.warn('Prefer to use [data-cozy] to store template data. <div data-cozy="{{.CozyData}}></div>. "'),JSON.parse(r.dataset["cozy".concat((t=e)[0].toUpperCase()+t.slice(1))])}}catch(e){return null}};t.getTemplateData=_;var O=(a=(0,l.default)(u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=_("flags")){e.next=3;break}return e.abrupt("return",!1);case 3:return g(t),e.abrupt("return",!0);case 5:case"end":return e.stop()}},e)})),function(){return a.apply(this,arguments)});t.initializeFromDOM=O;var w=(i=(0,l.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O();case 2:if(!1!=e.sent){e.next=6;break}return e.next=6,k(t);case 6:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)});t.initialize=w;var S=function(){var e,t,n;function r(e){(0,c.default)(this,r),this.client=e,this.handleLogin=this.handleLogin.bind(this),this.handleLogout=this.handleLogout.bind(this),this.client.on("login",this.handleLogin),this.client.on("logout",this.handleLogout),this.setupInitializing(),e.isLogged&&this.handleLogin()}return(0,s.default)(r,[{key:"refresh",value:(e=(0,l.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.initializeFromRemote(this.client);case 2:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"setupInitializing",value:function(){var e=this;this.initializing=new Promise(function(t){e.resolveInitializing=t})}},{key:"handleLogin",value:(t=(0,l.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.initialize(this.client);case 2:this.resolveInitializing(),this.client.emit("plugin:flag:login");case 4:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"handleLogout",value:(n=(0,l.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:v.reset(),this.setupInitializing(),this.client.emit("plugin:flag:logout");case 3:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})}]),r}();S.pluginName="flags",v.store=y,v.list=m,v.reset=b,v.enable=g,v.initializeFromRemote=k,v.initializeFromDOM=O,v.initialize=w,v.plugin=S;t.default=v},71400:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(73221)),i=r(n(36049)),o=r(n(24394)),u=r(n(99975));o.default.connect=i.default,o.default.FlagSwitcher=a.default,o.default.useFlag=u.default,"undefined"!=typeof __ENABLED_FLAGS__&&o.default.enable(__ENABLED_FLAGS__);var c=o.default;t.default=c},6465:function(e,t){function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){c=!0,o=e},f:function(){try{!u&&null!=n.return&&n.return()}finally{if(c)throw o}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.prefix=t.getKey=t.default=void 0;function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var a="flag__";t.prefix=a;var i=function(e){return a+e};t.getKey=i;var o=function(){return Object.keys(localStorage).filter(function(e){return 0===e.indexOf(a)}).map(function(e){return e.replace(a,"")})},u=function(e){var t=localStorage.getItem(i(e));return t?JSON.parse(t):t},c=function(e){return localStorage.removeItem(i(e))};t.default={getAll:function(){var e={},t,r=n(o());try{for(r.s();!(t=r.n()).done;){var a=t.value;e[a]=u(a)}}catch(e){r.e(e)}finally{r.f()}return e},getItem:u,setItem:function(e,t){var n=JSON.stringify(t);return localStorage.setItem(i(e),n)},clearAll:function(){var e,t=n(o());try{for(t.s();!(e=t.n()).done;){var r=e.value;c(r)}}catch(e){t.e(e)}finally{t.f()}},removeItem:c}},10916:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(90402)),i=r(n(65105)),o=r(n(19723)),u=r(n(37203)),c=r(n(6465)),s=function(){function e(){(0,i.default)(this,e),this.store={},"undefined"!=typeof localStorage&&(this.longtermStore=c.default),this.restore()}return(0,o.default)(e,[{key:"restore",value:function(){if(!!this.longtermStore)for(var e=this.longtermStore.getAll(),t=0,n=Object.entries(e);t<n.length;t++){var r=(0,a.default)(n[t],2),i=r[0],o=r[1];this.store[i]=o,this.emit("change",i)}}},{key:"keys",value:function(){return Object.keys(this.store)}},{key:"get",value:function(e){if(this.store.hasOwnProperty(e))return this.store[e];if("string"==typeof e){for(var t=e.split("."),n=t.length,r=n-1;r>0;r--){var a=t.slice(0,r).join(".");if(this.store.hasOwnProperty(a))return t.slice(r,n).reduce(function(e,t){return e&&e.hasOwnProperty(t)?e[t]:null},this.store[a])}}return null}},{key:"set",value:function(e,t){this.longtermStore&&this.longtermStore.setItem(e,t),this.store[e]=t,this.emit("change",e)}},{key:"remove",value:function(e){delete this.store[e],this.longtermStore&&this.longtermStore.removeItem(e),this.emit("change",e)}}]),e}();u.default.mixin(s);t.default=s},99975:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=(0,i.useState)((0,o.default)(e)),n=(0,a.default)(t,2),r=n[0],u=n[1];return(0,i.useEffect)(function(){var t=function(t){t===e&&u((0,o.default)(e))};return o.default.store.on("change",t),function(){o.default.store.removeListener("change",t)}},[u,e]),r};var a=r(n(90402)),i=n(67294),o=r(n(24394))},46553:function(e){var t=function(e){return Object.assign(this,e),this};t.prototype.toString=function(){throw Error("Cannot convert Secret to string")},e.exports=t},33918:function(e,t,n){var r=n(34155);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var i=n(46553),o=n(87593),u=o.filterLevel,c=o.filterSecrets,s=r.env.LOG_LEVEL||"debug",l=n(36865),d=[u,c],f=function(){var e,t=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}(e))){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){c=!0,o=e},f:function(){try{!u&&null!=n.return&&n.return()}finally{if(c)throw o}}}}(d);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(!1===n.apply(null,arguments))return!0}}catch(e){t.e(e)}finally{t.f()}return!1};function p(e,t,n,r){if(!f(s,e,t,n,r))console.log(l(e,t,n,r))}p.addFilter=function(e){return d.push(e)},p.setLevel=function(e){s=e};["debug","info","warn","error","ok","critical"].forEach(function(e){p[e]=function(t,n,r){return p(e,t,n,r)}}),e.exports=p,p.setNoRetry=function(e){return e?e.no_retry=!0:e={no_retry:!0},e.no_retry},p.Secret=i,p.namespace=function(e){return function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e;p(t,n,r,a)}}},87593:function(e,t,n){var r={secret:0,debug:10,info:20,warn:30,error:40,ok:50,critical:50},a=n(46553);e.exports={filterSecrets:function(e,t,n){if("secret"!==t&&n instanceof a)throw Error("You should log a secret with log.secret")},filterLevel:function(e,t){return r[t]>=r[e]}}},36865:function(e,t,n){var r=n(62481),a=n(62481);e.exports=a},62481:function(e,t,n){var r=n(64530);e.exports=function(e,t,n,a){var i={time:new Date,type:e,label:n,namespace:a};"object"==typeof t?(t&&t.no_retry&&(i.no_retry=t.no_retry),t&&t.message&&(i.message=t.message)):i.message=t,i.message&&i.message.stack&&(i.message=i.message.stack);var o=i;try{o=r(i).substr(0,65535)}catch(e){console.log(e.message,"cozy-logger: Failed to convert message to JSON")}return o}},7756:function(e,t,n){var r=n(26465),a={debug:1,info:2,warn:3,error:4};function i(){this.enabled=!0,this.defaultResult=!0,this.clear()}function o(e,t){return e.n.test?e.n.test(t):e.n==t}r.mixin(i),i.prototype.allow=function(e,t){return this._white.push({n:e,l:a[t]}),this},i.prototype.deny=function(e,t){return this._black.push({n:e,l:a[t]}),this},i.prototype.clear=function(){return this._white=[],this._black=[],this},i.prototype.test=function(e,t){var n,r=Math.max(this._white.length,this._black.length);for(n=0;n<r;n++){if(this._white[n]&&o(this._white[n],e)&&a[t]>=this._white[n].l)return!0;if(this._black[n]&&o(this._black[n],e)&&a[t]<=this._black[n].l)return!1}return this.defaultResult},i.prototype.write=function(e,t,n){if(!this.enabled||this.test(e,t))return this.emit("item",e,t,n)},e.exports=i},94731:function(e,t,n){var r=n(26465),a=n(7756),i=new r,o=Array.prototype.slice;(t=e.exports=function(e){var n=function t(){return i.write(e,void 0,o.call(arguments)),t};return n.debug=function(){return i.write(e,"debug",o.call(arguments)),n},n.info=function(){return i.write(e,"info",o.call(arguments)),n},n.warn=function(){return i.write(e,"warn",o.call(arguments)),n},n.error=function(){return i.write(e,"error",o.call(arguments)),n},n.group=function(){return i.write(e,"group",o.call(arguments)),n},n.groupEnd=function(){return i.write(e,"groupEnd",o.call(arguments)),n},n.log=n.debug,n.suggest=t.suggest,n.format=i.format,n}).defaultBackend=t.defaultFormatter=null,t.pipe=function(e){return i.pipe(e)},t.end=t.unpipe=t.disable=function(e){return i.unpipe(e)},t.Transform=r,t.Filter=a,t.suggest=new a,t.enable=function(){return t.defaultFormatter?i.pipe(t.suggest).pipe(t.defaultFormatter).pipe(t.defaultBackend):i.pipe(t.suggest).pipe(t.defaultBackend)}},26465:function(e,t,n){function r(){}n(37203).mixin(r),r.prototype.write=function(e,t,n){this.emit("item",e,t,n)},r.prototype.end=function(){this.emit("end"),this.removeAllListeners()},r.prototype.pipe=function(e){var t=this;function n(){e.write.apply(e,Array.prototype.slice.call(arguments))}function r(){e._isStdio||e.end()}return t.emit("unpipe",e),e.emit("pipe",t),t.on("item",n),t.on("end",r),t.when("unpipe",function(a){var i=a===e||void 0===a;return i&&(t.removeListener("item",n),t.removeListener("end",r),e.emit("unpipe")),i}),e},r.prototype.unpipe=function(e){return this.emit("unpipe",e),this},r.prototype.format=function(){throw Error("Warning: .format() is deprecated in Minilog v2! Use .pipe() instead. For example:\nvar Minilog = require('minilog');\nMinilog\n  .pipe(Minilog.backends.console.formatClean)\n  .pipe(Minilog.backends.console);")},r.mixin=function(e){var t,n=r.prototype;for(t in n)n.hasOwnProperty(t)&&(e.prototype[t]=n[t])},e.exports=r},93601:function(e,t,n){var r=n(26465),a=[],i=new r;i.write=function(e,t,n){a.push([e,t,n])},i.get=function(){return a},i.empty=function(){a=[]},e.exports=i},90115:function(e,t,n){var r=n(26465),a=/\n+$/,i=new r;i.write=function(e,t,n){var r=n.length-1;if("undefined"!=typeof console&&!!console.log){if(console.log.apply)return console.log.apply(console,[e,t].concat(n));if(JSON&&JSON.stringify){n[r]&&"string"==typeof n[r]&&(n[r]=n[r].replace(a,""));try{for(r=0;r<n.length;r++)n[r]=JSON.stringify(n[r])}catch(e){}console.log(n.join(" "))}}},i.formatters=["color","minilog"],i.color=n(82035),i.minilog=n(26687),e.exports=i},82035:function(e,t,n){var r=n(26465),a=n(20477),i={debug:["cyan"],info:["purple"],warn:["yellow",!0],error:["red",!0]},o=new r;o.write=function(e,t,n){var r=console.log;console[t]&&console[t].apply&&(r=console[t]).apply(console,["%c"+e+" %c"+t,a("gray"),a.apply(a,i[t])].concat(n))},o.pipe=function(){},e.exports=o},26687:function(e,t,n){var r=n(26465),a=n(20477),i={debug:["gray"],info:["purple"],warn:["yellow",!0],error:["red",!0]},o=new r;o.write=function(e,t,n){var r=console.log;"debug"!=t&&console[t]&&(r=console[t]);var o=0;if("info"!=t){for(;o<n.length&&"string"==typeof n[o];o++);r.apply(console,["%c"+e+" "+n.slice(0,o).join(" "),a.apply(a,i[t])].concat(n.slice(o)))}else r.apply(console,["%c"+e,a.apply(a,i[t])].concat(n))},o.pipe=function(){},e.exports=o},20477:function(e){var t={black:"#000",red:"#c23621",green:"#25bc26",yellow:"#bbbb00",blue:"#492ee1",magenta:"#d338d3",cyan:"#33bbc8",gray:"#808080",purple:"#708"};e.exports=function(e,n){return n?"color: #fff; background: "+t[e]+";":"color: "+t[e]+";"}},74450:function(e,t,n){var r=n(94731),a=r.enable,i=r.disable,o="undefined"!=typeof navigator&&/chrome/i.test(navigator.userAgent),u="undefined"!=typeof navigator&&"ReactNative"===navigator.product,c=n(90115);if(r.defaultBackend=o||u?c.minilog:c,"undefined"!=typeof window){try{r.enable(JSON.parse(window.localStorage.minilogSettings))}catch(e){}if(window.location&&window.location.search){var s=RegExp("[?&]minilog=([^&]*)").exec(window.location.search);s&&r.enable(decodeURIComponent(s[1]))}}r.enable=function(){a.call(r,!0);try{window.localStorage.minilogSettings=JSON.stringify(!0)}catch(e){}return this},r.disable=function(){i.call(r);try{delete window.localStorage.minilogSettings}catch(e){}return this},(t=e.exports=r).backends={array:n(93601),browser:r.defaultBackend,localStorage:n(19377),jQuery:n(85791)}},85791:function(e,t,n){var r=n(26465),a=new Date().valueOf().toString(36);function i(e){this.url=e.url||"",this.cache=[],this.timer=null,this.interval=e.interval||3e4,this.enabled=!0,this.jQuery=window.jQuery,this.extras={}}r.mixin(i),i.prototype.write=function(e,t,n){!this.timer&&this.init(),this.cache.push([e,t].concat(n))},i.prototype.init=function(){if(this.enabled&&this.jQuery){var e=this;this.timer=setTimeout(function(){var t,n,r=[],i=e.url;if(0==e.cache.length)return e.init();for(t=0;t<e.cache.length;t++)try{JSON.stringify(e.cache[t]),r.push(e.cache[t])}catch(e){}e.jQuery.isEmptyObject(e.extras)?(n=JSON.stringify({logs:r}),i=e.url+"?client_id="+a):n=JSON.stringify(e.jQuery.extend({logs:r},e.extras)),e.jQuery.ajax(i,{type:"POST",cache:!1,processData:!1,data:n,contentType:"application/json",timeout:1e4}).success(function(t){t.interval&&(e.interval=Math.max(1e3,t.interval))}).error(function(){e.interval=3e4}).always(function(){e.init()}),e.cache=[]},this.interval)}},i.prototype.end=function(){},i.jQueryWait=function(e){if("undefined"!=typeof window&&(window.jQuery||window.$))return e(window.jQuery||window.$);"undefined"!=typeof window&&setTimeout(function(){i.jQueryWait(e)},200)},e.exports=i},19377:function(e,t,n){var r=n(26465),a=!1,i=new r;i.write=function(e,t,n){if("undefined"!=typeof window&&"undefined"!=typeof JSON&&JSON.stringify&&JSON.parse)try{!a&&(a=window.localStorage.minilog?JSON.parse(window.localStorage.minilog):[]),a.push([new Date().toString(),e,t,n]),window.localStorage.minilog=JSON.stringify(a)}catch(e){}},e.exports=i},16151:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=function(){function e(t){(0,a.default)(this,e),this.tokenType=t.tokenType||t.token_type,this.accessToken=t.accessToken||t.access_token,this.refreshToken=t.refreshToken||t.refresh_token,this.scope=t.scope}return(0,i.default)(e,[{key:"toAuthHeader",value:function(){return"Bearer "+this.accessToken}},{key:"toBasicAuth",value:function(){return"user:".concat(this.accessToken,"@")}},{key:"toJSON",value:function(){return{tokenType:this.tokenType,accessToken:this.accessToken,refreshToken:this.refreshToken,scope:this.scope}}}],[{key:"fromJSON",value:function(t){return new e({tokenType:t.tokenType,accessToken:t.accessToken,refreshToken:t.refreshToken,scope:t.scope})}}]),e}();t.default=o},65730:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isExpiredTokenError=t.getReplicationURL=void 0;var i=a(n(98235)),o=a(n(68434)),u=a(n(82007)),c=a(n(65105)),s=a(n(19723)),l=a(n(25665)),d=a(n(27952)),f=a(n(12323)),p=a(n(64512)),h=n(206),y=a(n(17561)),v=a(n(36721)),m=a(n(57557)),b=a(n(91747)),g=a(n(66604)),k=a(n(35905)),_=a(n(27361)),O=a(n(23279)),w=a(n(17955)),S=n(12503),x=r(n(71241)),E=a(n(77050)),P=n(54481),C=a(n(1797)),D=n(19820),j=n(2105),A=n(81309);function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach(function(t){(0,p.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}y.default.plugin(v.default);var M=w.default.find,N=w.default.allDocs,F=w.default.withoutDesignDocuments,L=function(e,t){if(!t.ok)throw Error("Pouch response is not OK");return I(I({},e),(0,m.default)(t,"ok"))},B={replicationInterval:3e4},z=function(e){return(0,m.default)(e,"_type")},U=function(e,t,n){var r,a,i=t.toBasicAuth();var o=(r=e,a=i,r.replace("//","//".concat(a)));return"".concat(o,"/data/").concat(n)};t.getReplicationURL=U;var q=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]},G=/Expired token/,Q=function(e){return G.test(e.error)};t.isExpiredTokenError=Q;var H=function(e){(0,l.default)(ec,e);var t,n,r,a,p,v,R,G,H,J,Y,W,K,V,$,Z,X,ee,et,en,er,ea,ei,eo,eu=(t=ec,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,f.default)(t);return e=n?Reflect.construct(r,arguments,(0,f.default)(this).constructor):r.apply(this,arguments),(0,d.default)(this,e)});function ec(e){(0,c.default)(this,ec);var t,n,r=(0,b.default)({},e,B);n=eu.call(this,r);var a=r.doctypes,i=r.doctypesReplicationOptions,o=r.periodicSync,u=r.initialSync,s=r.syncDebounceDelayInMs,l=r.syncDebounceMaxDelayInMs;if(n.options=r,!a)throw Error("PouchLink must be instantiated with doctypes it manages. Ex: ['io.cozy.bills']");return n.doctypes=a,n.doctypesReplicationOptions=i,n.indexes={},n.storage=new P.PouchLocalStorage((null===(t=r.platform)||void 0===t?void 0:t.storage)||j.platformWeb.storage),n.initialSync=null!=u&&u,n.periodicSync=null==o||o,n.replicationStatus=n.replicationStatus||{},n.startReplicationDebounced=(0,O.default)(n._startReplication,s||1e4,{maxWait:l||6e5}),n}return(0,s.default)(ec,[{key:"getReplicationURL",value:function(e){var t=this.client&&this.client.stackClient.uri,n=this.client&&this.client.stackClient.token;if(!n)throw Error("Can't get replication URL since the stack client doesn't have a token");if(!t)throw Error("Can't get replication URL since the stack client doesn't have a URI");return U(t,n,e)}},{key:"registerClient",value:(r=(0,u.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.client=t;case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"migrateAdapter",value:(a=(0,u.default)(o.default.mark(function e(t){var n,r,a,i,u,c,s,l,d,f,p,h,v;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.fromAdapter,r=t.toAdapter,a=t.url,i=t.plugins,e.prev=1,u=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(i);try{for(u.s();!(c=u.n()).done;)s=c.value,y.default.plugin(s)}catch(e){u.e(e)}finally{u.f()}return e.next=6,this.storage.getPersistedSyncedDoctypes();case 6:l=e.sent,d=0,f=Object.keys(l);case 8:if(!(d<f.length)){e.next=19;break}return p=f[d],h=(0,A.getPrefix)(a),v=(0,A.getDatabaseName)(h,p),e.next=14,(0,D.migratePouch)({dbName:v,fromAdapter:n,toAdapter:r});case 14:return e.next=16,this.storage.destroyWarmedUpQueries();case 16:d++,e.next=8;break;case 19:return e.next=21,this.storage.persistAdapterName("indexeddb");case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(1),console.error("PouchLink: PouchDB migration failed. ",e.t0);case 26:case"end":return e.stop()}},e,this,[[1,23]])})),function(e){return a.apply(this,arguments)})},{key:"onLogin",value:(p=(0,u.default)(o.default.mark(function e(){var t,n,r=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client){e.next=3;break}return C.default.warn("PouchLink: no client registered, can't login"),e.abrupt("return");case 3:if(t=(0,A.getPrefix)(this.client.stackClient.uri),!(this.pouches&&this.pouches.options&&this.pouches.options.prefix!==t)){e.next=15;break}return e.prev=7,e.next=10,this.pouches.destroy();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),C.default.warn("Error while destroying pouch DBs",e.t0);case 15:if(t){e.next=17;break}throw Error("PouchLink: Prefix is required");case 17:return e.next=20,this.storage.getAdapterName();case 20:if(e.sent){e.next=24;break}return n=(0,_.default)(this.options,"pouch.options.adapter"),e.next=24,this.storage.persistAdapterName(n);case 24:return this.pouches=new E.default(this.doctypes,{pouch:this.options.pouch,getReplicationURL:this.getReplicationURL.bind(this),doctypesReplicationOptions:this.doctypesReplicationOptions,onError:function(e){return r.onSyncError(e)},onSync:this.handleOnSync.bind(this),onDoctypeSyncStart:this.handleDoctypeSyncStart.bind(this),onDoctypeSyncEnd:this.handleDoctypeSyncEnd.bind(this),prefix:t,executeQuery:this.executeQuery.bind(this),platform:this.options.platform}),e.next=27,this.pouches.init();case 27:this.client&&this.initialSync&&this.startReplication();case 28:case"end":return e.stop()}},e,this,[[7,12]])})),function(){return p.apply(this,arguments)})},{key:"reset",value:(v=(0,u.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pouches){e.next=3;break}return e.next=3,this.pouches.destroy();case 3:this.pouches=null,this.client=null;case 5:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"handleOnSync",value:function(e){var t,n=(0,g.default)(e,(t=this.client,function(e,n){return e.map(function(e){return x.normalizeDoc(e,n,t)})}));this.client&&this.client.setData(n),this.options.onSync&&this.options.onSync.call(this,n);this.client.emit("pouchlink:sync:end")}},{key:"handleDoctypeSyncStart",value:function(e){this.replicationStatus[e]="replicating",this.client.emit("pouchlink:doctypesync:start",e)}},{key:"handleDoctypeSyncEnd",value:function(e){this.replicationStatus[e]="idle",this.client.emit("pouchlink:doctypesync:end",e)}},{key:"_startReplication",value:function(){this.client.emit("pouchlink:sync:start"),this.periodicSync?this.pouches.startReplicationLoop():this.pouches.replicateOnce(),this.options.onStartReplication&&this.options.onStartReplication.apply(this)}},{key:"startReplication",value:function(){return this.startReplicationDebounced.cancel(),this._startReplication()}},{key:"startReplicationWithDebounce",value:function(){if(this.periodicSync)throw Error("createDebounceableReplication cannot be called when periodic sync is configured");return this.startReplicationDebounced()}},{key:"stopReplication",value:function(){this.pouches.stopReplicationLoop(),this.options.onStopReplication&&this.options.onStopReplication.apply(this),this.client.emit("pouchlink:sync:stop")}},{key:"onSyncError",value:(R=(0,u.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Q(t)){e.next=14;break}return e.prev=1,e.next=4,this.client.stackClient.refreshToken();case 4:return this.startReplication(),e.abrupt("return");case 8:e.prev=8,e.t0=e.catch(1),C.default.warn("Could not refresh token, replication has stopped",e.t0),this.options.onSyncError&&this.options.onSyncError.call(this,e.t0);case 12:e.next=16;break;case 14:C.default.warn("CozyPouchLink: Synchronization error",t),this.options.onSyncError&&this.options.onSyncError.call(this,t);case 16:case"end":return e.stop()}},e,this,[[1,8]])})),function(e){return R.apply(this,arguments)})},{key:"getSyncInfo",value:function(e){return this.pouches.getSyncInfo(e)}},{key:"getPouch",value:function(e){return this.pouches.getPouch(e)}},{key:"supportsOperation",value:function(e){var t=(0,h.getDoctypeFromOperation)(e);return(!e.mutationType||!this.doctypesReplicationOptions||!this.doctypesReplicationOptions[t]||"fromRemote"!==this.doctypesReplicationOptions[t].strategy)&&!!this.getPouch(t)}},{key:"request",value:(G=(0,u.default)(o.default.mark(function e(t){var n,r,a,i=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:null,r=i.length>2&&void 0!==i[2]?i[2]:q,a=(0,h.getDoctypeFromOperation)(t),this.pouches){e.next=6;break}return e.abrupt("return",r(t));case 6:if("not_synced"!==this.pouches.getSyncStatus(a)){e.next=9;break}return e.abrupt("return",r(t));case 9:return e.next=11,this.needsToWaitWarmup(a);case 11:if(!e.sent){e.next=14;break}return e.abrupt("return",r(t));case 14:if(this.supportsOperation(t)){e.next=17;break}return e.abrupt("return",r(t));case 17:if(!t.mutationType){e.next=21;break}return e.abrupt("return",this.executeMutation(t,n,r));case 21:return e.abrupt("return",this.executeQuery(t));case 22:case"end":return e.stop()}},e,this)})),function(e){return G.apply(this,arguments)})},{key:"getChanges",value:(H=(0,u.default)(o.default.mark(function e(t,n){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return r=this.getPouch(t),e.abrupt("return",r.changes(n));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return H.apply(this,arguments)})},{key:"getDbInfo",value:(J=(0,u.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return n=this.getPouch(t),e.abrupt("return",n.info());case 4:case"end":return e.stop()}},e,this)})),function(e){return J.apply(this,arguments)})},{key:"sanitizeJsonApi",value:function(e){var t=z(e);return(0,m.default)(t,["attributes","meta"])}},{key:"persistCozyData",value:(Y=(0,u.default)(o.default.mark(function e(t){var n,r,a,i,u=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u.length>1&&void 0!==u[1]&&u[1],(r=this.sanitizeJsonApi(t)).cozyLocalOnly=!0,e.next=5,this.getExistingDocument(t._id,t._type);case 5:return(a=e.sent)&&(r._rev=a._rev),i=this.pouches.getPouch(t._type),e.next=10,i.put(r);case 10:case"end":return e.stop()}},e,this)})),function(e){return Y.apply(this,arguments)})},{key:"getExistingDocument",value:(W=(0,u.default)(o.default.mark(function e(t,n){var r,a,i,u=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]&&u[2],e.prev=1,a=this.pouches.getPouch(n),e.next=5,a.get(t);case 5:return i=e.sent,e.abrupt("return",i);case 9:if(e.prev=9,e.t0=e.catch(1),!("not_found"===e.t0.name&&!r)){e.next=15;break}return e.abrupt("return",null);case 15:throw e.t0;case 16:case"end":return e.stop()}},e,this,[[1,9]])})),function(e,t){return W.apply(this,arguments)})},{key:"needsToWaitWarmup",value:(K=(0,u.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.doctypesReplicationOptions&&this.doctypesReplicationOptions[t]&&this.doctypesReplicationOptions[t].warmupQueries)){e.next=4;break}return e.next=3,this.pouches.areQueriesWarmedUp(t,this.doctypesReplicationOptions[t].warmupQueries);case 3:return e.abrupt("return",!e.sent);case 4:return e.abrupt("return",!1);case 5:case"end":return e.stop()}},e,this)})),function(e){return K.apply(this,arguments)})},{key:"hasIndex",value:function(e){return!!this.indexes[e]}},{key:"createIndex",value:(V=(0,u.default)(o.default.mark(function e(t){var n,r,a,i,u,c,s,l=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=l.length>1&&void 0!==l[1]?l[1]:{}).partialFilter,a=n.indexName,i=n.doctype,u="".concat(i,"/").concat(a),c=this.pouches.getPouch(i),e.next=5,c.createIndex({index:{fields:t,ddoc:a,indexName:a,partial_filter_selector:r}});case 5:return s=e.sent,this.indexes[u]=s,e.abrupt("return",s);case 8:case"end":return e.stop()}},e,this)})),function(e){return V.apply(this,arguments)})},{key:"findExistingIndex",value:function(e,t,n){var r="".concat(e,"/").concat(n);return this.indexes[r]}},{key:"ensureIndex",value:($=(0,u.default)(o.default.mark(function e(t,n){var r,a,u,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.indexedFields,a=n.partialFilter,r?a&&(r=(r=Array.from(new Set([].concat((0,i.default)(r),(0,i.default)(Object.keys(a)))))).filter(function(e){return"$and"!==e&&"$or"!==e})):r=(0,S.getIndexFields)(n),u=(0,S.getIndexNameFromFields)(r,a),c=this.findExistingIndex(t,n,u)){e.next=10;break}return e.next=7,this.createIndex(r,{partialFilter:a,indexName:u,doctype:t});case 7:return e.abrupt("return",e.sent);case 10:return e.abrupt("return",c);case 11:case"end":return e.stop()}},e,this)})),function(e,t){return $.apply(this,arguments)})},{key:"executeQuery",value:(Z=(0,u.default)(o.default.mark(function e(t){var n,r,a,u,c,s,l,d,f,p,h,y,v,m,b,g;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.doctype,r=t.selector,a=t.sort,u=t.fields,c=t.limit,s=t.id,l=t.ids,d=t.skip,f=t.indexedFields,p=t.partialFilter,h=this.getPouch(n),!s){e.next=9;break}return e.next=5,h.get(s);case 5:y=e.sent,v=!1,e.next=38;break;case 9:if(!l){e.next=18;break}return e.next=12,N(h,{include_docs:!0,keys:l});case 12:(y=F(y=e.sent)).total_rows=null,v=!0,e.next=38;break;case 18:if(!(!r&&!p&&!u&&!a)){e.next=26;break}return e.next=21,N(h,{include_docs:!0,limit:c});case 21:y=F(y=e.sent),v=!0,e.next=38;break;case 26:return m=w.default.normalizeFindSelector({selector:r,sort:a,indexedFields:f,partialFilter:p}),b={sort:a,selector:m,fields:u?[].concat((0,i.default)(u),["_id","_rev"]):void 0,limit:c,skip:d},e.next=30,this.ensureIndex(n,I(I({},b),{},{indexedFields:f,partialFilter:p}));case 30:return g=e.sent,b.use_index=g.id,e.next=34,M(h,b);case 34:(y=e.sent).offset=d,y.limit=c,v=!0;case 38:return e.abrupt("return",x.fromPouchResult({res:y,withRows:v,doctype:n,client:this.client}));case 39:case"end":return e.stop()}},e,this)})),function(e){return Z.apply(this,arguments)})},{key:"executeMutation",value:(X=(0,u.default)(o.default.mark(function e(t,n,r){var a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.mutationType,e.next=e.t0===h.MutationTypes.CREATE_DOCUMENT?3:e.t0===h.MutationTypes.UPDATE_DOCUMENT?7:e.t0===h.MutationTypes.UPDATE_DOCUMENTS?11:e.t0===h.MutationTypes.DELETE_DOCUMENT?15:e.t0===h.MutationTypes.ADD_REFERENCES_TO?19:23;break;case 3:return e.next=5,this.createDocument(t);case 5:case 9:case 13:case 17:case 21:return a=e.sent,e.abrupt("break",24);case 7:return e.next=9,this.updateDocument(t);case 11:return e.next=13,this.updateDocuments(t);case 15:return e.next=17,this.deleteDocument(t);case 19:return e.next=21,this.addReferencesTo(t);case 23:return e.abrupt("return",r(t,n));case 24:return e.abrupt("return",x.fromPouchResult({res:a,withRows:!1,doctype:(0,h.getDoctypeFromOperation)(t),client:this.client}));case 25:case"end":return e.stop()}},e,this)})),function(e,t,n){return X.apply(this,arguments)})},{key:"createDocument",value:(ee=(0,u.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dbMethod("post",t);case 2:return n=e.sent,e.abrupt("return",L(t.document,n));case 4:case"end":return e.stop()}},e,this)})),function(e){return ee.apply(this,arguments)})},{key:"updateDocument",value:(et=(0,u.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dbMethod("put",t);case 2:return n=e.sent,e.abrupt("return",L(t.document,n));case 4:case"end":return e.stop()}},e,this)})),function(e){return et.apply(this,arguments)})},{key:"updateDocuments",value:(en=(0,u.default)(o.default.mark(function e(t){var n,r,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.documents,e.next=3,this.dbMethod("bulkDocs",t);case 3:if(r=e.sent,a=(0,k.default)(r,n,function(e,t){return I(I({},t),{},{_id:e.id,_rev:e.rev})}),!r.find(function(e){return!e.ok})){e.next=7;break}throw new h.BulkEditError(r,a);case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}},e,this)})),function(e){return en.apply(this,arguments)})},{key:"deleteDocument",value:(er=(0,u.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dbMethod("remove",t);case 2:return n=e.sent,r=I(I({},t.document),{},{_id:n.id,_rev:n.rev,_deleted:!0}),e.abrupt("return",L(r,n));case 5:case"end":return e.stop()}},e,this)})),function(e){return er.apply(this,arguments)})},{key:"addReferencesTo",value:(ea=(0,u.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("addReferencesTo is not implemented in CozyPouchLink");case 1:case"end":return e.stop()}},e)})),function(e){return ea.apply(this,arguments)})},{key:"dbMethod",value:(ei=(0,u.default)(o.default.mark(function e(t,n){var r,a,i,u,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,h.getDoctypeFromOperation)(n),a=n.document,i=n.documents,u=this.getPouch(r),e.prev=3,!i){e.next=10;break}return e.next=7,u[t](i.map(function(e){return z(e)}));case 7:case 13:c=e.sent,e.next=17;break;case 10:if(!a){e.next=16;break}return e.next=13,u[t](z(a));case 16:throw Error("A mutation should either have document or documents member.");case 17:return e.abrupt("return",c);case 20:throw e.prev=20,e.t0=e.catch(3),Error("Coud not apply mutation: ".concat(e.t0.message));case 23:case"end":return e.stop()}},e,this,[[3,20]])})),function(e,t){return ei.apply(this,arguments)})},{key:"syncImmediately",value:(eo=(0,u.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pouches){e.next=3;break}return C.default.warn("Cannot sync immediately, no PouchManager"),e.abrupt("return");case 3:this.pouches.syncImmediately();case 4:case"end":return e.stop()}},e,this)})),function(){return eo.apply(this,arguments)})}]),ec}(h.CozyLink);(0,p.default)(H,"getPouchAdapterName",function(e){return new P.PouchLocalStorage(e||j.platformWeb.storage).getAdapterName()});t.default=H},77050:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(17204)),s=r(n(84486)),l=r(n(27361)),d=n(25976),f=n(54481),p=r(n(65826)),h=r(n(1797)),y=n(2105),v=n(51722),m=n(81309),b=function(e){return e.options.as},g=function(){var e,t,n,r,g,k,_,O,w,S;function x(e,t){var n,r,a,i;(0,o.default)(this,x),this.options=t,this.doctypes=e,this.storage=new f.PouchLocalStorage((null===(n=t.platform)||void 0===n?void 0:n.storage)||y.platformWeb.storage),this.PouchDB=(null===(r=t.platform)||void 0===r?void 0:r.pouchAdapter)||y.platformWeb.pouchAdapter,this.isOnline=(null===(a=t.platform)||void 0===a?void 0:a.isOnline)||y.platformWeb.isOnline,this.events=(null===(i=t.platform)||void 0===i?void 0:i.events)||y.platformWeb.events}return(0,u.default)(x,[{key:"init",value:(e=(0,i.default)(a.default.mark(function e(){var t,n,r=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,l.default)(this.options,"pouch.plugins",[]),!(n=(0,l.default)(this.options,"pouch.options",{})).view_update_changes_batch_size&&(n.view_update_changes_batch_size=1e3),(0,s.default)(t,function(e){return r.PouchDB.plugin(e)}),this.pouches=(0,c.default)(this.doctypes.map(function(e){return[e,new r.PouchDB((0,m.getDatabaseName)(r.options.prefix,e),n)]})),e.next=7,this.storage.getPersistedSyncedDoctypes();case 7:return this.syncedDoctypes=e.sent,e.next=10,this.storage.getPersistedWarmedUpQueries();case 10:this.warmedUpQueries=e.sent,this.getReplicationURL=this.options.getReplicationURL,this.doctypesReplicationOptions=this.options.doctypesReplicationOptions||{},this.listenerLaunched=!1,this.ensureDatabasesExistDone=!1,this.startReplicationLoop=this.startReplicationLoop.bind(this),this.stopReplicationLoop=this.stopReplicationLoop.bind(this),this.replicateOnce=this.replicateOnce.bind(this),this.executeQuery=this.options.executeQuery,this.replications=void 0;case 20:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"addListeners",value:function(){!this.listenerLaunched&&((0,d.isMobileApp)()&&(this.events.addEventListener("pause",this.stopReplicationLoop),this.events.addEventListener("resume",this.startReplicationLoop)),this.events.addEventListener("online",this.startReplicationLoop),this.events.addEventListener("offline",this.stopReplicationLoop),this.listenerLaunched=!0)}},{key:"removeListeners",value:function(){this.listenerLaunched&&((0,d.isMobileApp)()&&(this.events.removeEventListener("pause",this.stopReplicationLoop),this.events.removeEventListener("resume",this.startReplicationLoop)),this.events.removeEventListener("online",this.startReplicationLoop),this.events.removeEventListener("offline",this.stopReplicationLoop),this.listenerLaunched=!1)}},{key:"destroy",value:(t=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopReplicationLoop(),this.removeListeners(),e.next=4,this.clearSyncedDoctypes();case 4:return e.next=6,this.clearWarmedUpQueries();case 6:return e.next=8,this.storage.destroy();case 8:return e.abrupt("return",(0,m.allSettled)(Object.values(this.pouches).map(function(e){return e.destroy()})));case 9:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"ensureDatabasesExist",value:(n=(0,i.default)(a.default.mark(function e(){var t=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.ensureDatabasesExistDone){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.abrupt("return",Promise.all(Object.values(this.pouches).map(function(e){return e.info()})).then(function(){h.default.info("PouchManager: ensure databases exist done"),t.ensureDatabasesExistDone=!0}));case 3:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"startReplicationLoop",value:(r=(0,i.default)(a.default.mark(function e(){var t;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureDatabasesExist();case 2:if(!this.replicationLoop){e.next=5;break}return h.default.warn("Replication loop already started"),e.abrupt("return");case 5:return t=this.options.replicationDelay||3e4,this.replicationLoop=new p.default(this.replicateOnce,t),this.replicationLoop.start(),this.addListeners(),e.abrupt("return",this.replicationLoop);case 11:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"stopReplicationLoop",value:function(){this.replicationLoop&&(h.default.info("PouchManager: Stop replication loop"),this.replicationLoop.stop(),this.replicationLoop=null)}},{key:"syncImmediately",value:function(){if(!this.replicationLoop){h.default.warn("No replication loop, cannot syncImmediately");return}this.replicationLoop.scheduleImmediateTask()}},{key:"replicateOnce",value:(g=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.replicateOnce)(this));case 1:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"handleReplicationError",value:function(e){var t="";e instanceof AggregateError&&(t=(0,m.formatAggregatedError)(e)),h.default.warn("PouchManager: Error during replication - ".concat(e.message).concat(t)),this.stopReplicationLoop(),this.options.onError&&this.options.onError(e)}},{key:"cancelCurrentReplications",value:function(){if(!this.replications){h.default.warn("PouchManager: No current replications");return}Object.values(this.replications).forEach(function(e){return e.cancel&&e.cancel()})}},{key:"waitForCurrentReplications",value:function(){return this.replications?Promise.all(Object.values(this.replications)):Promise.resolve()}},{key:"getPouch",value:function(e){return this.pouches[e]}},{key:"updateSyncInfo",value:(k=(0,i.default)(a.default.mark(function e(t){var n,r=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:"synced",this.syncedDoctypes[t]={date:new Date().toISOString(),status:n},e.next=4,this.storage.persistSyncedDoctypes(this.syncedDoctypes);case 4:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"getSyncInfo",value:function(e){return this.syncedDoctypes&&this.syncedDoctypes[e]}},{key:"getSyncStatus",value:function(e){var t=this.getSyncInfo(e);return(null==t?void 0:t.status)||"not_synced"}},{key:"clearSyncedDoctypes",value:(_=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.syncedDoctypes={},e.next=3,this.storage.destroySyncedDoctypes();case 3:case"end":return e.stop()}},e,this)})),function(){return _.apply(this,arguments)})},{key:"warmupQueries",value:(O=(0,i.default)(a.default.mark(function e(t,n){var r=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return!this.warmedUpQueries[t]&&(this.warmedUpQueries[t]=[]),e.prev=1,e.next=4,Promise.all(n.map(function(){var e=(0,i.default)(a.default.mark(function e(n){var i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=b(n),r.warmedUpQueries[t].includes(i)){e.next=5;break}return e.next=4,r.executeQuery(n.definition().toDefinition());case 4:r.warmedUpQueries[t].push(i);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 4:return e.next=6,this.storage.persistWarmedUpQueries(this.warmedUpQueries);case 6:h.default.log("PouchManager: warmupQueries for "+t+" are done"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),h.default.error("PouchManager: Could not warm up queries for "+t,e.t0),delete this.warmedUpQueries[t];case 13:case"end":return e.stop()}},e,this,[[1,9]])})),function(e,t){return O.apply(this,arguments)})},{key:"checkToWarmupDoctype",value:function(e,t){!this.warmedUpQueries[e]&&t.warmupQueries&&this.warmupQueries(e,t.warmupQueries)}},{key:"areQueriesWarmedUp",value:(w=(0,i.default)(a.default.mark(function e(t,n){var r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.getPersistedWarmedUpQueries();case 2:return r=e.sent,e.abrupt("return",n.every(function(e){return r[t]&&r[t].includes(b(e))}));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return w.apply(this,arguments)})},{key:"clearWarmedUpQueries",value:(S=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.warmedUpQueries={},e.next=3,this.storage.destroyWarmedUpQueries();case 3:case"end":return e.stop()}},e,this)})),function(){return S.apply(this,arguments)})}]),x}();t.default=g},17955:function(e,t,n){var r,a,i,o,u=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=u(n(68434)),s=u(n(98235)),l=u(n(82007)),d=u(n(64512)),f=u(n(82492)),p=u(n(10240)),h=u(n(1797));function y(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,d.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var g={},k=["cordova-sqlite","websql"];g.isAdapterBugged=function(e){return k.includes(e)},g.withoutDesignDocuments=function(e){var t=e.rows.filter(function(e){return!(0,p.default)(e.id,"_design/")});return b(b({},e),{},{rows:t,total_rows:t.length})},g.getDocs=(r=(0,l.default)(c.default.mark(function e(t,n){var r,a,i,o,u,l=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null===(r=l.length>2&&void 0!==l[2]?l[2]:{}).limit&&delete r.limit,a=r.limit,i="allDocs"===n?"rows":"docs",g.isAdapterBugged(t.adapter)&&(void 0===a||a>999)&&(r.limit=999,r.skip=r.skip||0),e.next=7,t[n](r);case 7:if((o=e.sent)[i].length!==r.limit){e.next=16;break}if(r.skip=(r.skip?r.skip:0)+r.limit,r.limit=a?a-r.limit:void 0,!(r.limit>0||void 0===r.limit)){e.next=16;break}return e.next=14,g.getDocs(t,n,r);case 14:return u=e.sent,e.abrupt("return",b(b({},o),{},(0,d.default)({},i,[].concat((0,s.default)(o[i]),(0,s.default)(u[i])))));case 16:return e.abrupt("return",o);case 17:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)}),g.allDocs=(a=(0,l.default)(c.default.mark(function e(t){var n,r=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",g.getDocs(t,"allDocs",n));case 2:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)}),g.find=(i=(0,l.default)(c.default.mark(function e(t){var n,r=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",g.getDocs(t,"find",n));case 2:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)}),g.isDesignDocument=function(e){return(0,p.default)(e._id,"_design")},g.isDeletedDocument=function(e){return e._deleted},g.insertBulkDocs=(o=(0,l.default)(c.default.mark(function e(t,n){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.bulkDocs(n,{new_edits:!1}));case 1:case"end":return e.stop()}},e)})),function(e,t){return o.apply(this,arguments)}),g.normalizeFindSelector=function(e){var t=e.selector,n=e.sort,r=e.indexedFields,a=e.partialFilter,i=t||{};if(r){var o,u=y(r);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!Object.keys(i).includes(c)){var s=JSON.stringify(t);h.default.warn("".concat(c," was missing in selector, it has been automatically added from indexed fields. Please consider adding this field to your query's selector as required by PouchDB. The query's selector is: ").concat(s)),i[c]={$gt:null}}}}catch(e){u.e(e)}finally{u.f()}}if(n){var l,d=y(n.flatMap(function(e){return Object.keys(e)}));try{for(d.s();!(l=d.n()).done;){var p=l.value;if(!Object.keys(i).includes(p)){var v=JSON.stringify(t);h.default.warn("".concat(p," was missing in selector, it has been automatically added from sorted fields. Please consider adding this field to your query's selector as required by PouchDB. The query's selector is: ").concat(v)),i[p]={$gt:null}}}}catch(e){d.e(e)}finally{d.f()}}var m=a?(0,f.default)(b({},i),a):i;return Object.keys(m).length>0?m:{_id:{$gt:null}}};t.default=g},70999:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a.default}});var a=r(n(65730))},71241:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.fromPouchResult=t.normalizeDoc=void 0;var a=r(n(64512)),i=n(206);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var c=function(e,t,n){var r=e._id||e.id,a=e.relationships,i=e.referenced_by,o=e.rev||e._rev,c=u(u({},e),{},{id:r,_id:r,_rev:o,_type:t,relationships:u(u({},a),{},{referenced_by:i})});return c.rev&&delete c.rev,s(c,t,n),c};t.normalizeDoc=c;var s=function(e,t,n){if("io.cozy.apps"===t){var r=(0,i.generateWebLink)({cozyUrl:n.getStackClient().uri,slug:e.slug,subDomainType:n.capabilities.flat_subdomains?"flat":"nested",pathname:"",hash:"",searchParams:[]});e.links={self:"/apps/".concat(e.slug),related:r,icon:"/apps/".concat(e.slug,"/icon/").concat(e.version)}}},l=function(e){return!!e};t.fromPouchResult=function(e){var t=e.res,n=e.withRows,r=e.doctype,a=e.client;if(t.cozyPouchData)return{data:t.cozyPouchData};if(!n)return{data:Array.isArray(t)?t.map(function(e){return c(e,r,a)}):c(t,r,a)};var i=t.rows?t.rows.map(function(e){return e.doc}).filter(l):t.docs,o=t.offset||0;return{data:i.map(function(e){return c(e,r,a)}),meta:{count:i.length},skip:o,next:o+i.length<t.total_rows||i.length>=t.limit}}},54481:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.PouchLocalStorage=t.LOCALSTORAGE_STORAGE_KEYS=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c={SYNCED:"cozy-client-pouch-link-synced",WARMUPEDQUERIES:"cozy-client-pouch-link-warmupedqueries",LASTSEQUENCES:"cozy-client-pouch-link-lastreplicationsequence",LASTREPLICATEDDOCID:"cozy-client-pouch-link-lastreplicateddocid",ADAPTERNAME:"cozy-client-pouch-link-adaptername"};t.LOCALSTORAGE_STORAGE_KEYS=c;var s=function(){var e,t,n,r,s,d,f,p,h,y,v,m,b,g,k,_,O,w;function S(e){(0,o.default)(this,S),l(e),this.storageEngine=e}return(0,u.default)(S,[{key:"destroy",value:(e=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.storageEngine.destroy();case 1:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"persistLastReplicatedDocID",value:(t=(0,i.default)(a.default.mark(function e(t,n){var r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllLastReplicatedDocID();case 2:return(r=e.sent)[t]=n,e.next=6,this.storageEngine.setItem(c.LASTREPLICATEDDOCID,JSON.stringify(r));case 6:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"getAllLastReplicatedDocID",value:(n=(0,i.default)(a.default.mark(function e(){var t;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageEngine.getItem(c.LASTREPLICATEDDOCID);case 2:return t=e.sent,e.abrupt("return",t?JSON.parse(t):{});case 4:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"getLastReplicatedDocID",value:(r=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllLastReplicatedDocID();case 2:return n=e.sent,e.abrupt("return",n[t]);case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"destroyAllLastReplicatedDocID",value:(s=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageEngine.removeItem(c.LASTREPLICATEDDOCID);case 2:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"persistSyncedDoctypes",value:(d=(0,i.default)(a.default.mark(function e(t){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageEngine.setItem(c.SYNCED,JSON.stringify(t));case 2:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"getPersistedSyncedDoctypes",value:(f=(0,i.default)(a.default.mark(function e(){var t,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageEngine.getItem(c.SYNCED);case 2:if(!("object"!=typeof(n=(t=e.sent)?JSON.parse(t):{}))){e.next=6;break}return e.abrupt("return",{});case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"destroySyncedDoctypes",value:(p=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageEngine.removeItem(c.SYNCED);case 2:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"persistDoctypeLastSequence",value:(h=(0,i.default)(a.default.mark(function e(t,n){var r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllLastSequences();case 2:return(r=e.sent)[t]=n,e.next=6,this.storageEngine.setItem(c.LASTSEQUENCES,JSON.stringify(r));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"getAllLastSequences",value:(y=(0,i.default)(a.default.mark(function e(){var t;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageEngine.getItem(c.LASTSEQUENCES);case 2:return t=e.sent,e.abrupt("return",t?JSON.parse(t):{});case 4:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"getDoctypeLastSequence",value:(v=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllLastSequences();case 2:return n=e.sent,e.abrupt("return",n[t]);case 4:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"destroyAllDoctypeLastSequence",value:(m=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageEngine.removeItem(c.LASTSEQUENCES);case 2:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)})},{key:"destroyDoctypeLastSequence",value:(b=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllLastSequences();case 2:return n=e.sent,delete n[t],e.next=6,this.storageEngine.setItem(c.LASTSEQUENCES,JSON.stringify(n));case 6:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"persistWarmedUpQueries",value:(g=(0,i.default)(a.default.mark(function e(t){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageEngine.setItem(c.WARMUPEDQUERIES,JSON.stringify(t));case 2:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"getPersistedWarmedUpQueries",value:(k=(0,i.default)(a.default.mark(function e(){var t;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageEngine.getItem(c.WARMUPEDQUERIES);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",{});case 5:return e.abrupt("return",JSON.parse(t));case 6:case"end":return e.stop()}},e,this)})),function(){return k.apply(this,arguments)})},{key:"destroyWarmedUpQueries",value:(_=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageEngine.removeItem(c.WARMUPEDQUERIES);case 2:case"end":return e.stop()}},e,this)})),function(){return _.apply(this,arguments)})},{key:"getAdapterName",value:(O=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageEngine.getItem(c.ADAPTERNAME);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return O.apply(this,arguments)})},{key:"persistAdapterName",value:(w=(0,i.default)(a.default.mark(function e(t){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageEngine.setItem(c.ADAPTERNAME,t);case 2:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})}]),S}();t.PouchLocalStorage=s;var l=function(e){var t=["setItem","getItem","removeItem"].filter(function(t){return!e[t]});if(t.length>0){var n=t.join(", ");throw Error("Provided storageEngine is missing the following methods: ".concat(n))}}},1797:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(60732)),i=(0,a.default)("cozy-pouch-link");a.default.suggest.deny("cozy-pouch-link","info");t.default=i},65826:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(1797)),s=function(e){return new Promise(function(t){return setTimeout(t,e)})},l=function(){var e,t,n,r,l;function d(e,t,n,r){(0,o.default)(this,d),this.task=e,this.delay=t,this.round=this.round.bind(this),this.immediateTasks=[],this.started=!1,this.afterRound=n,this.sleep=r||s}return(0,u.default)(d,[{key:"start",value:function(){if(!this.started)this.round(),this.started=!0}},{key:"stop",value:function(){if(!!this.started)this.currentTask&&this.currentTask.cancel&&this.currentTask.cancel(),clearTimeout(this.timeout),this.clearImmediateTasks(),this.started=!1}},{key:"waitForCurrent",value:(e=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.currentTask;case 2:return e.abrupt("return");case 3:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"runImmediateTasks",value:(t=(0,i.default)(a.default.mark(function e(){var t;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.immediateTasks.length>0)){e.next=6;break}return t=this.immediateTasks.shift(),e.next=4,this.runTask(t);case 4:e.next=0;break;case 6:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"scheduleImmediateTask",value:(n=(0,i.default)(a.default.mark(function e(){var t,n=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:null,this.started){e.next=4;break}return c.default.warn("Cannot schedule immediate task, loop is not started"),e.abrupt("return");case 4:this.immediateTasks.push(t||this.task),!this.currentTask&&(clearTimeout(this.timeout),this.round());case 6:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"clearImmediateTasks",value:function(){this.immediateTasks.splice(0,this.runImmediateTasks.length)}},{key:"runTask",value:(r=(0,i.default)(a.default.mark(function e(t){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.currentTask=t(),e.next=4,this.currentTask;case 4:e.next=11;break;case 6:throw e.prev=6,e.t0=e.catch(0),this.stop(),c.default.warn("Could not runTask, stopped the loop",e.t0),e.t0;case 11:return e.prev=11,this.currentTask=null,e.finish(11);case 14:case"end":return e.stop()}},e,this,[[0,6,11,14]])})),function(e){return r.apply(this,arguments)})},{key:"round",value:(l=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._rounding){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,this._rounding=!0,!(this.immediateTasks.length>0)){e.next=9;break}return e.next=7,this.runImmediateTasks();case 7:return e.next=9,this.sleep(this.delay);case 9:return e.next=11,this.runTask(this.task);case 11:this.started&&(this.timeout=setTimeout(this.round,this.delay));case 12:return e.prev=12,this._rounding=!1,this.afterRound&&this.afterRound(),e.finish(12);case 16:case"end":return e.stop()}},e,this,[[2,,12,16]])})),function(){return l.apply(this,arguments)})}]),d}();t.default=l},12503:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getIndexFields=t.getIndexNameFromFields=t.makeKeyFromPartialFilter=void 0;var a=r(n(98235)),i=r(n(90402)),o=r(n(91175)),u=function e(t){return"object"!=typeof t||null===t?String(t):Object.entries(t).map(function(t){var n=(0,i.default)(t,2),r=n[0],a=n[1];if(Array.isArray(a)&&a.every(function(e){return"string"==typeof e}))return"".concat(r,"_(").concat(a.join("_"),")");if(Array.isArray(a))return"(".concat(a.map(function(t){return"".concat(e(t))}).join(")_".concat(r,"_(")),")");if("object"==typeof a)return"".concat(r,"_").concat(e(a));else return"".concat(r,"_").concat(a)}).join(")_and_(")};t.makeKeyFromPartialFilter=u;t.getIndexNameFromFields=function(e,t){var n="by_".concat(e.join("_and_"));return t?"".concat(n,"_filter_(").concat(u(t),")"):n};var c={_id:{$gt:null}};t.getIndexFields=function(e){var t=e.selector,n=void 0===t?c:t,r=e.sort,i=e.partialFilter;return Array.from(new Set([].concat((0,a.default)((void 0===r?[]:r).map(function(e){return(0,o.default)(Object.keys(e))})),(0,a.default)(n?Object.keys(n):[]),(0,a.default)(i?Object.keys(i):[]))))}},19820:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.migratePouch=void 0;var i=a(n(68434)),o=a(n(82007)),u=a(n(17561));var c=(r=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,c,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:var i;return n=t.dbName,r=t.fromAdapter,a=t.toAdapter,o=new u.default(n,{adapter:r,location:"default"}),i=n,c="".concat(i,"_indexeddb"),s=new u.default(c,{adapter:a,location:"default"}),e.next=6,o.replicate.to(s,{batch_size:1e3});case 6:return e.next=8,o.destroy();case 8:return o=null,e.abrupt("return",s);case 10:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.migratePouch=c},2105:function(e,t,n){var r,a,i,o,u,c=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.platformWeb=void 0;var s=c(n(68434)),l=c(n(82007)),d=c(n(17561)),f=n(54481);var p=(r=(0,l.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.localStorage.getItem(t));case 1:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});var h=(a=(0,l.default)(s.default.mark(function e(t,n){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.localStorage.setItem(t,n));case 1:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)});var y=(i=(0,l.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.localStorage.removeItem(t));case 1:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)});var v=(o=(0,l.default)(s.default.mark(function e(){var t,n,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=Object.values(f.LOCALSTORAGE_STORAGE_KEYS);case 1:if(!(t<n.length)){e.next=8;break}return r=n[t],e.next=5,y(r);case 5:t++,e.next=1;break;case 8:case"end":return e.stop()}},e)})),function(){return o.apply(this,arguments)});var m=(u=(0,l.default)(s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.navigator.onLine);case 1:case"end":return e.stop()}},e)})),function(){return u.apply(this,arguments)}),b={storage:{getItem:p,setItem:h,removeItem:y,destroy:v},events:{addEventListener:function(e,t){document.addEventListener(e,t)},removeEventListener:function(e,t){document.removeEventListener(e,t)}},pouchAdapter:d.default,isOnline:m};t.platformWeb=b},20444:function(e,t,n){var r,a,i=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchRemoteLastSequence=t.fetchRemoteInstance=t.isDatabaseUnradableError=t.isDatabaseNotFoundError=t.DATABASE_RESERVED_DOCTYPE_ERROR=t.DATABASE_NOT_FOUND_ERROR=void 0;var o=i(n(68434)),u=i(n(82007)),c=i(n(16151)),s="Database does not exist";t.DATABASE_NOT_FOUND_ERROR=s;var l="Reserved doctype";t.DATABASE_RESERVED_DOCTYPE_ERROR=l;t.isDatabaseNotFoundError=function(e){return e.message===s};t.isDatabaseUnradableError=function(e){return e.message===l};var d=(r=(0,u.default)(o.default.mark(function e(t){var n,r,a,i,u,d,f=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:{},r=new c.default({accessToken:t.password}),Object.keys(n).forEach(function(e){t.searchParams.set(e,n[e])}),a="".concat(t.protocol,"//").concat(t.href.substring(t.href.indexOf("@")+1)),(i=new Headers).append("Accept","application/json"),i.append("Content-Type","application/json"),i.append("Authorization",r.toAuthHeader()),e.next=10,fetch(a,{headers:i,credentials:"include"});case 10:return u=e.sent,e.next=13,u.json();case 13:if(d=e.sent,!u.ok){e.next=16;break}return e.abrupt("return",d);case 16:if(404!==u.status){e.next=18;break}throw Error(s);case 18:if(!(403===u.status&&d.error.includes("message=reserved doctype"))){e.next=20;break}throw Error(l);case 20:throw Error("Error (".concat(u.status,") while fetching remote instance: ").concat(JSON.stringify(d)));case 21:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.fetchRemoteInstance=d;var f=(a=(0,u.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new URL("".concat(t,"/_changes")),e.next=3,d(n,{limit:1,descending:!0});case 3:return r=e.sent,e.abrupt("return",r.last_seq);case 5:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)});t.fetchRemoteLastSequence=f},51722:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.replicateOnce=void 0;var i=a(n(68434)),o=a(n(82007)),u=a(n(17204)),c=a(n(27361)),s=a(n(35161)),l=a(n(10240)),d=a(n(4788)),f=a(n(1797)),p=n(20444),h=n(67927),y=n(81309);function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var m=(r=(0,o.default)(i.default.mark(function e(t){var n,r,a,m,b,g,k,_,O,w,S,x,E,P;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.isOnline();case 2:if(e.sent){e.next=5;break}return f.default.info("PouchManager: The device is offline so the replication has been skipped"),e.abrupt("return",Promise.resolve());case 5:return f.default.info("PouchManager: Starting replication iteration"),t.replications=(0,s.default)(t.pouches,function(){var e=(0,o.default)(i.default.mark(function e(n,r){var a,o,u,s,d,y,v;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f.default.info("PouchManager: Starting replication for "+r),a=function(){return t.getReplicationURL(r)},o="synced"!==t.getSyncStatus(r),u=function(e){return!(0,l.default)(e._id,"_design")},s="",!o){e.next=13;break}return e.next=8,(0,p.fetchRemoteLastSequence)(a());case 8:return d=e.sent,e.next=11,t.storage.persistDoctypeLastSequence(r,d);case 11:e.next=16;break;case 13:return e.next=15,t.storage.getDoctypeLastSequence(r);case 15:s=e.sent;case 16:return(y=(0,c.default)(t.doctypesReplicationOptions,r,{})).initialReplication=o,y.filter=u,y.since=s,y.doctype=r,t.options.onDoctypeSyncStart&&t.options.onDoctypeSyncStart(r),e.next=24,(0,h.startReplication)(n,y,a,t.storage);case 24:if(v=e.sent,!s){e.next=28;break}return e.next=28,t.storage.destroyDoctypeLastSequence(r);case 28:return e.next=30,t.updateSyncInfo(r);case 30:return t.checkToWarmupDoctype(r,y),t.options.onDoctypeSyncEnd&&t.options.onDoctypeSyncEnd(r),e.abrupt("return",v);case 33:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),n=Object.keys(t.pouches),r=Object.values(t.replications),e.prev=9,e.next=12,(0,y.allSettled)(r);case 12:a=e.sent;if(!t.options.onSync){e.next=51;break}b=(m=(0,d.default)(n,a)).filter(function(e){return"fulfilled"===e[1].status}).map(function(e){return[e[0],e[1].value]}),g=m.filter(function(e){return"rejected"===e[1].status}).map(function(e){return[e[0],e[1].reason]}),k=a.filter(function(e){return"rejected"===e.status&&!(0,p.isDatabaseNotFoundError)(e.reason)&&!(0,p.isDatabaseUnradableError)(e.reason)}),_=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(g.filter(function(e){return(0,p.isDatabaseNotFoundError)(e[1])||(0,p.isDatabaseUnradableError)(e[1])})),e.prev=21,_.s();case 23:if((O=_.n()).done){e.next=30;break}return w=O.value[0],e.next=28,t.updateSyncInfo(w,"not_complete");case 28:e.next=23;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(21),_.e(e.t0);case 35:return e.prev=35,_.f(),e.finish(35);case 38:if(!(k.length>0)){e.next=45;break}throw x=(S=k.map(function(e){return e.reason})).join("\n"),f.default.debug("ReplicateOnce's promises failed with the following errors",x),AggregateError(S,"Failed with blocking errors");case 45:f.default.debug("ReplicateOnce's promises succeed with no blocking errors");case 46:E=(0,u.default)(b),P=(0,u.default)(g),f.default.debug("Doctypes replications in error: ",Object.keys(P)),f.default.debug("Doctypes replications in success: ",Object.keys(E)),t.options.onSync(E);case 51:return a.cancel=t.cancelCurrentReplications,e.abrupt("return",a);case 55:e.prev=55,e.t1=e.catch(9),t.handleReplicationError(e.t1);case 58:case"end":return e.stop()}},e,null,[[9,55],[21,32,35,38]])})),function(e){return r.apply(this,arguments)});t.replicateOnce=m},67927:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.replicateAllDocs=t.startReplication=void 0;var i=a(n(68434)),o=a(n(82007)),u=a(n(64512)),c=a(n(80295)),s=a(n(17955)),l=a(n(10240)),d=a(n(1797)),f=n(20444);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=s.default.isDesignDocument,v=s.default.isDeletedDocument;t.startReplication=function(e,t,n,r){var a,u={},s=new Promise(function(s,l){var f=n(),p=t.strategy,m=t.initialReplication,g=(t.warmupQueries,t.doctype),k=h(h({batch_size:1e3},(0,c.default)(t,["strategy","initialReplication","warmupQueries","doctype"])),{},{selector:{cozyLocalOnly:{$exists:!1}}});if(m&&"toRemote"!==p){(0,o.default)(i.default.mark(function t(){var n;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return d.default.info("PouchManager: Start first replication for ".concat(g)),t.next=3,b({db:e,baseUrl:f,doctype:g,storage:r});case 3:u=t.sent,d.default.info("PouchManager: End first replication for ".concat(g));return t.abrupt("return",s(u));case 8:case"end":return t.stop()}},t)}))();return}(a="fromRemote"===p?e.replicate.from(f,k):"toRemote"===p?e.replicate.to(f,k):e.sync(f,k)).on("change",function(e){var t=e.change?e.change:e;t.docs&&t.docs.filter(function(e){return!y(e)&&!v(e)}).forEach(function(e){u[e._id]=e})}),a.on("error",l).on("complete",function(){s(Object.values(u))})});return s.cancel=function(){a&&a.cancel()},s};var m=function(e){return e.map(function(e){return e.doc}).filter(function(e){return!e._deleted&&!(0,l.default)(e._id,"_design")})};var b=(r=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u,c,l,d,p,h,y;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.db,r=t.baseUrl,a=t.doctype,o=t.storage,u=new URL("".concat(r,"/_all_docs")),c=1e3,l=!0,e.next=6,o.getLastReplicatedDocID(a);case 6:d=e.sent,p=[];case 8:if(!l){e.next=42;break}if(d){e.next=26;break}return e.next=12,(0,f.fetchRemoteInstance)(u,{limit:c,include_docs:!0});case 12:if(0!==(p=m(e.sent.rows)).length){e.next=18;break}l=!1,e.next=24;break;case 18:return d=p[p.length-1]._id,p.length<c&&(l=!1),e.next=22,s.default.insertBulkDocs(n,p);case 22:return e.next=24,o.persistLastReplicatedDocID(a,d);case 24:e.next=40;break;case 26:return e.next=28,(0,f.fetchRemoteInstance)(u,{include_docs:!0,limit:c,startkey_docid:d});case 28:if(!((y=m((h=e.sent).rows)).length<2)){e.next=32;break}return e.abrupt("return",p);case 32:return y.shift(),d=y[y.length-1]._id,e.next=36,s.default.insertBulkDocs(n,y);case 36:return e.next=38,o.persistLastReplicatedDocID(a,d);case 38:p=p.concat(y),h.rows.length<c&&(l=!1);case 40:e.next=8;break;case 42:return e.abrupt("return",p);case 43:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.replicateAllDocs=b},81309:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.allSettled=t.formatAggregatedError=t.getPrefix=t.getDatabaseName=void 0;t.getDatabaseName=function(e,t){return"".concat(e,"_").concat(t)};t.getPrefix=function(e){return e.replace(/^https?:\/\//,"")};t.formatAggregatedError=function(e){return e.errors.map(function(e,t){return"\n["+t+"]: "+e.message+"\n"+e.stack}).join("\n")};t.allSettled=function(e){return Promise.all(e.filter(function(e){return!!e}).map(function(e){return e.then(function(e){return{status:"fulfilled",value:e}}).catch(function(e){return{status:"rejected",reason:e}})}))}},88477:function(e,t,n){var r=n(34155),a=n(14746),i=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n(54765)),u=i(n(90402)),c=i(n(98235)),s=i(n(80295)),l=i(n(68434)),d=i(n(82007)),f=i(n(65105)),p=i(n(19723)),h=i(n(64512)),y=i(n(66604)),v=i(n(17204)),m=i(n(85564)),b=i(n(45578)),g=i(n(4788)),k=i(n(84486)),_=i(n(27361)),O=i(n(37203)),w=a(n(2779)),S=n(71791),x=i(n(13945)),E=n(30130),P=n(72887),C=n(64157),D=n(87549),j=n(51245),A=i(n(6436)),T=a(n(72662)),R=i(n(83549)),I=i(n(81390)),M=n(6505),N=i(n(9211)),F=n(27146),L=i(n(81602)),B=n(77621),z=i(n(67266)),U=i(n(8665)),q=n(48550);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach(function(t){(0,h.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function H(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return J(e,t)}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Y=function(e){return{get:function(t,n){return L.default.warn(e),t[n]}}},W=function(e){var t;if(e&&"undefined"!=typeof window&&null!==(t=window.cozy)&&void 0!==t&&t.isSecureProtocol){var n,r=new URL(e);return r.protocol="https:",(n=r.toString()).endsWith("/")?n.slice(0,-1):n}return e},K="creation",V="update",$=function(){var e,t,n,a,i,O,R,G,J,$,Z,X,ee,et,en,er,ea,ei,eo,eu,ec,es,el;function ed(){var e,t,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,f.default)(this,ed),(0,h.default)(this,"fetchQueryAndGetFromState",(e=(0,d.default)(l.default.mark(function e(t){var r,a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.definition,a=t.options,e.prev=1,e.next=4,n.query(r,a);case 4:return e.abrupt("return",n.getQueryFromState(a.as,a));case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:case"end":return e.stop()}},e,null,[[1,7]])})),function(t){return e.apply(this,arguments)}));var a=r.link,i=r.links,o=r.schema,u=r.appMetadata,c=r.capabilities,p=(0,s.default)(r,["link","links","schema","appMetadata","capabilities"]);a&&L.default.warn("`link` is deprecated, use `links`"),this.appMetadata=void 0===u?{}:u,this.loginPromise=null,p.uri=W(p.uri),this.options=p,this.queryIdGenerator=new B.QueryIDGenerator,this.isLogged=!1,this.instanceOptions={},this.handleRevocationChange=this.handleRevocationChange.bind(this),this.handleTokenRefresh=this.handleTokenRefresh.bind(this),this.createClient();var y=this.getStackClient();if(y.on("error",function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.emit.apply(n,["error"].concat(t))}),this.setLinks(Array.isArray(t=a||i||new x.default)?t:[t]),this.schema=new I.default(void 0===o?{}:o,y),this.capabilities=c||null,this.plugins={},!(this.stackClient instanceof w.OAuthClient))try{this.loadInstanceOptionsFromDOM()}catch(e){}this._promiseCache=new U.default,p.uri&&p.token&&this.login(),this.storeAccesors=null,!1!==p.store&&this.ensureStore()}return(0,p.default)(ed,[{key:"emit",value:function(){}},{key:"on",value:function(){}},{key:"removeListener",value:function(){}},{key:"registerPlugin",value:function(e,t){if(!e.pluginName)throw Error("Cannot register a plugin whose class does not have `pluginName` attribute.");if(this.plugins[e.pluginName])throw Error("Cannot register plugin ".concat(e.pluginName,". A plugin with the same name has already been registered."));var n=new e(this,t);return this.plugins[e.pluginName]=n,n}},{key:"addSchema",value:function(e){this.schema.add(e)}},{key:"registerClientOnLinks",value:function(){var e,t=H(this.links);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.registerClient)try{n.registerClient(this)}catch(e){L.default.warn(e)}}}catch(e){t.e(e)}finally{t.f()}}},{key:"login",value:function(e){return this.isLogged&&!this.isRevoked?(L.default.warn("CozyClient is already logged."),this.loginPromise):this.loginPromise=this._login(e)}},{key:"_login",value:(e=(0,d.default)(l.default.mark(function e(t){var n,r,a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.emit("beforeLogin"),this.registerClientOnLinks(),t&&(t.uri&&this.stackClient.setUri(t.uri),t.token&&this.stackClient.setToken(t.token)),n=H(this.links),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=13;break}if(!(a=r.value).onLogin){e.next=11;break}return e.next=11,a.onLogin();case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:if(this.isLogged=!0,this.isRevoked=!1,!(this.stackClient instanceof w.OAuthClient)){e.next=26;break}return e.next=26,this.loadInstanceOptionsFromStack();case 26:this.emit("login");case 27:case"end":return e.stop()}},e,this,[[4,15,18,21]])})),function(t){return e.apply(this,arguments)})},{key:"logout",value:(t=(0,d.default)(l.default.mark(function e(){var t,n,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLogged){e.next=3;break}return L.default.warn("CozyClient isn't logged."),e.abrupt("return");case 3:if(this.emit("beforeLogout"),this.isLogged=!1,!(this.stackClient instanceof w.OAuthClient)){e.next=17;break}if(e.prev=6,!(this.stackClient.unregister&&(!this.stackClient.isRegistered||this.stackClient.isRegistered()))){e.next=10;break}return e.next=10,this.stackClient.unregister();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),L.default.warn("Impossible to unregister client on stack: ".concat(e.t0));case 15:case 20:e.next=25;break;case 17:return e.prev=17,e.next=20,this.stackClient.fetch("DELETE","/auth/login");case 22:e.prev=22,e.t1=e.catch(17),L.default.warn("Impossible to log out: ".concat(e.t1));case 25:t=H(this.links),e.prev=26,t.s();case 28:if((n=t.n()).done){e.next=41;break}if(!(r=n.value).reset){e.next=39;break}return e.prev=31,e.next=34,r.reset();case 34:e.next=39;break;case 36:e.prev=36,e.t2=e.catch(31),L.default.warn(e.t2);case 39:e.next=28;break;case 41:e.next=46;break;case 43:e.prev=43,e.t3=e.catch(26),t.e(e.t3);case 46:return e.prev=46,t.f(),e.finish(46);case 49:this.store&&this.dispatch((0,T.resetState)()),this.emit("logout");case 51:case"end":return e.stop()}},e,this,[[6,12],[17,22],[26,43,46,49],[31,36]])})),function(){return t.apply(this,arguments)})},{key:"collection",value:function(e){return this.getStackClient().collection(e)}},{key:"fetch",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.getStackClient().fetch(e,t,n,r)}},{key:"all",value:function(e){return L.default.warn("\nclient.all is deprecated, prefer to use the Q helper to build a new QueryDefinition.\n\nimport { Q } from 'cozy-client'\nclient.query(Q('io.cozy.bills'))"),(0,D.Q)(e)}},{key:"find",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return L.default.warn("client.find(doctype, selector) is deprecated, please use Q(doctype).where(selector) to build the same query."),new D.QueryDefinition({doctype:e,selector:t})}},{key:"get",value:function(e,t){return L.default.warn("client.get(".concat(e,", id) is deprecated, please use Q(").concat(e,").getById(id) to build the same query.")),new D.QueryDefinition({doctype:e,id:t})}},{key:"create",value:(n=(0,d.default)(l.default.mark(function e(t,n,r){var a,i,o,u=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:{},n._type,o=Q({_type:t},(0,s.default)(n,["_type"])),e.next=5,this.schema.validate(o);case 5:if(!(!0!==e.sent)){e.next=8;break}throw Error("Validation failed");case 8:return e.abrupt("return",this.mutate(this.getDocumentSavePlan(o,r),a));case 9:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"validate",value:function(e){return this.schema.validate(e)}},{key:"save",value:(a=(0,d.default)(l.default.mark(function e(t){var n,r,a,i,o=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:{},r=t._type,a=(0,s.default)(t,["_type"]),r){e.next=4;break}throw Error("The document must have a `_type` property");case 4:return i=Q({_type:r},a),e.next=7,this.schema.validate(i);case 7:if(!(!0!==e.sent)){e.next=10;break}throw Error("Validation failed");case 10:return e.abrupt("return",this.mutate(this.getDocumentSavePlan(i),n));case 11:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"saveAll",value:(i=(0,d.default)(l.default.mark(function e(t){var n=this,r,a,i,o,u=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:{},!(1!==Array.from(new Set(t.map(function(e){return e._type}))).length)){e.next=4;break}throw Error("saveAll can only save documents with the same doctype");case 4:return e.next=6,Promise.all(t.map(function(e){return n.schema.validate(e)}));case 6:if(!((a=e.sent.filter(function(e){return!0!==e})).length>0)){e.next=11;break}throw L.default.warn("There has been some validation errors while bulk saving",a),Error("Validation failed for at least one doc");case 11:return i=t.map(function(e){return n.prepareDocumentForSave(e)}),o=D.Mutations.updateDocuments(i),e.abrupt("return",this.mutate(o,r));case 14:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"ensureCozyMetadata",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{event:K};if(void 0===this.appMetadata)return e;if(e._type){var r=this.schema.getDoctypeSchema(e._type);t=(0,_.default)(r,"doctypeVersion")}var a=this.appMetadata,i=a.slug,o=a.sourceAccount,u=a.sourceAccountIdentifier,s=a.version,l=new Date().toISOString(),d=(0,_.default)(e,"cozyMetadata",{});return n.event===K?d=Q({metadataVersion:1,doctypeVersion:t,createdByApp:i,sourceAccount:o,sourceAccountIdentifier:u,createdAt:l,createdByAppVersion:s,updatedAt:l,updatedByApps:i?[{date:l,slug:i,version:s}]:[]},d):n.event===V&&(d=Q(Q({},d),{},{updatedAt:l,updatedByApps:[{date:l,slug:i,version:s}].concat((0,c.default)((0,_.default)(e,"cozyMetadata.updatedByApps",[]).filter(function(e){return e.slug!==i})))})),Q(Q({},e),{},{cozyMetadata:d})}},{key:"prepareDocumentForSave",value:function(e){var t=!e._rev;return this.ensureCozyMetadata((0,C.dehydrate)(e),{event:t?K:V})}},{key:"getDocumentSavePlan",value:function(e,t){var n=this,r=!e._rev,a=this.prepareDocumentForSave(e),i=r?D.Mutations.createDocument(a):D.Mutations.updateDocument(a);if(!(t&&Object.values(t).filter(function(e){return Array.isArray(e)?e.length>0:e}).length>0))return i;for(var o=0,c=Object.keys(t);o<c.length;o++){var s,l,d=c[o],f=e._type,p=this.schema.getRelationship(f,d);if(!((s=p.type).prototype.addReferences&&s.prototype.removeReferences)){;throw l=p.name,Error('The "'.concat(l,'" relationship does not support references. If you need to add references to a document, its relationship class must have the methods {add,remove}References'))}}if(t&&!r)throw Error("Unable to save external relationships on a not-new document");return[i,function(e){var r=n.hydrateDocument(e.data);return Object.entries(t).map(function(e){var t=(0,u.default)(e,2),n=t[0],a=t[1];return r[n].addReferences(a)})}]}},{key:"triggerHook",value:function(e,t){if(ed.hooks){var n,r=H((ed.hooks[t._type]||{})[e]||[]);try{for(r.s();!(n=r.n()).done;)(0,n.value)(this,t)}catch(e){r.e(e)}finally{r.f()}}}},{key:"destroy",value:(O=(0,d.default)(l.default.mark(function e(t){var n,r,a=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.triggerHook("before:destroy",t);case 3:return e.next=5,this.mutate(D.Mutations.deleteDocument(t),n);case 5:return r=e.sent,e.next=8,this.triggerHook("after:destroy",t);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)})),function(e){return O.apply(this,arguments)})},{key:"upload",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.mutate(D.Mutations.uploadFile(e,t),n)}},{key:"ensureQueryExists",value:function(e,t,n){this.ensureStore(),("loaded"!==(0,T.getQueryFromState)(this.store.getState(),e).fetchStatus||!t.skip&&!t.bookmark)&&this.dispatch((0,T.initQuery)(e,t,n))}},{key:"query",value:(R=(0,d.default)(l.default.mark(function e(t){var n=this,r,a,i,o,u,c,d,f,p,h=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(r=h.length>1&&void 0!==h[1]?h[1]:{}).update,i=r.executeFromStore,o=(0,s.default)(r,["update","executeFromStore"]),this.ensureStore(),u=o.as||this.queryIdGenerator.generateId(t),c=this.getQueryFromState(u,o),!(void 0!==o.enabled)||!("boolean"!=typeof o.enabled)){e.next=8;break}throw Error("option.enabled should be a boolean for this query: ".concat(JSON.stringify(t)));case 8:if(!o.fetchPolicy){e.next=14;break}if(o.as){e.next=11;break}throw Error("Cannot use `fetchPolicy` without naming the query, please use `as` to name the query");case 11:if(o.fetchPolicy(c)){e.next=14;break}return e.abrupt("return");case 14:if(!(c&&Object.keys(c).length>0)||"loading"!==c.fetchStatus){e.next=17;break}return e.abrupt("return",this._promiseCache.get(function(){return(0,z.default)(t)}));case 17:return this.ensureQueryExists(u,t,o),e.prev=18,d=void 0!==o.backgroundFetching?o.backgroundFetching:this.options.backgroundFetching,this.dispatch((0,T.loadQuery)(u,{backgroundFetching:d})),f=i?function(){return Promise.resolve((0,T.executeQueryFromState)(n.store.getState(),t))}:function(){return n.requestQuery(t)},e.next=24,this._promiseCache.exec(f,function(){return(0,z.default)(t)});case 24:return p=e.sent,this.dispatch((0,T.receiveQueryResult)(u,p,{update:a,backgroundFetching:d})),e.abrupt("return",p);case 29:if(e.prev=29,e.t0=e.catch(18),this.dispatch((0,T.receiveQueryError)(u,e.t0)),!o.onError){e.next=36;break}o.onError(e.t0),e.next=41;break;case 36:if(!this.options.onError){e.next=40;break}this.options.onError(e.t0),e.next=41;break;case 40:throw e.t0;case 41:case"end":return e.stop()}},e,this,[[18,29]])})),function(e){return R.apply(this,arguments)})},{key:"queryAll",value:(G=(0,d.default)(l.default.mark(function e(t){var n,r,a,i,o,u,s=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=s.length>1&&void 0!==s[1]?s[1]:{}).as||this.queryIdGenerator.generateId(t),a=Q(Q({},n),{},{as:r}),e.prev=3,e.next=6,this.query(t,a);case 6:o=(i=e.sent).data;case 8:if(!(i&&i.next)){e.next=22;break}if(!i.bookmark){e.next=15;break}return e.next=12,this.query(t.offsetBookmark(i.bookmark),a);case 12:i=e.sent,e.next=19;break;case 15:return u=(0,T.getRawQueryFromState)(this.store.getState(),r),e.next=18,this.query(t.offset(u.data.length),a);case 18:i=e.sent;case 19:o.push.apply(o,(0,c.default)(i.data)),e.next=8;break;case 22:return e.abrupt("return",o);case 25:return e.prev=25,e.t0=e.catch(3),L.default.log("queryAll error for ".concat(e.t0.toString())),e.abrupt("return",[]);case 29:case"end":return e.stop()}},e,this,[[3,25]])})),function(e){return G.apply(this,arguments)})},{key:"watchQuery",value:function(){return L.default.warn("client.watchQuery is deprecated, please use client.makeObservableQuery."),this.makeObservableQuery.apply(this,arguments)}},{key:"makeObservableQuery",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.ensureStore();var n=t.as||this.queryIdGenerator.generateId(e);return this.ensureQueryExists(n,e),new N.default(n,e,this,t)}},{key:"mutate",value:(J=(0,d.default)(l.default.mark(function e(t){var n,r,a,i,o,u,c=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=c.length>1&&void 0!==c[1]?c[1]:{}).update,a=n.updateQueries,i=(0,s.default)(n,["update","updateQueries"]),this.ensureStore(),o=i.as||this.queryIdGenerator.generateId(t),this.dispatch((0,T.initMutation)(o,t)),e.prev=5,e.next=8,this.requestMutation(t);case 8:return u=e.sent,this.dispatch((0,T.receiveMutationResult)(o,u,{update:r,updateQueries:a},t)),e.abrupt("return",u);case 13:throw e.prev=13,e.t0=e.catch(5),this.dispatch((0,T.receiveMutationError)(o,e.t0,t)),e.t0;case 17:case"end":return e.stop()}},e,this,[[5,13]])})),function(e){return J.apply(this,arguments)})},{key:"requestQuery",value:($=(0,d.default)(l.default.mark(function e(t){var n,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.chain.request(t);case 2:return n=e.sent,e.next=5,this.persistVirtualDocuments(t,n.data);case 5:if(t.includes){e.next=7;break}return e.abrupt("return",n);case 7:return e.next=9,this.fetchRelationships(n,this.getIncludesRelationships(t));case 9:return r=e.sent,e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)})),function(e){return $.apply(this,arguments)})},{key:"persistVirtualDocuments",value:(Z=(0,d.default)(l.default.mark(function e(t,n){var r,a,i,o;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=["io.cozy.files.shortcuts"].includes(t.doctype),"io.cozy.apps_registry"!==t.doctype){e.next=6;break}return e.next=5,this.persistVirtualDocument({_type:"io.cozy.apps_registry",_id:t.id,cozyPouchData:n},r);case 5:return e.abrupt("return",e.sent);case 6:if(Array.isArray(n)){e.next=11;break}return e.next=9,this.persistVirtualDocument(n,r);case 9:e.next=28;break;case 11:a=H(n),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=20;break}return o=i.value,e.next=18,this.persistVirtualDocument(o,r);case 18:e.next=14;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(12),a.e(e.t0);case 25:return e.prev=25,a.f(),e.finish(25);case 28:case"end":return e.stop()}},e,this,[[12,22,25,28]])})),function(e,t){return Z.apply(this,arguments)})},{key:"persistVirtualDocument",value:(X=(0,d.default)(l.default.mark(function e(t,n){var r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!t||t.cozyLocalOnly)){e.next=2;break}return e.abrupt("return");case 2:if(!(!(null!==(r=t.meta)&&void 0!==r&&r.rev)&&!t._rev||n)){e.next=5;break}return e.next=5,this.chain.persistCozyData(t);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return X.apply(this,arguments)})},{key:"fetchRelationships",value:(ee=(0,d.default)(l.default.mark(function e(t,n){var r,a,i,o,c,s,d,f,p,h,y,v,_,O,w,S,x,E,C,j=this;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!(r=!Array.isArray(t.data))&&0===t.data.length)){e.next=3;break}return e.abrupt("return",t);case 3:return a=r?[t.data]:t.data,i=new Map,o=[],c=[],a.forEach(function(e){return(0,k.default)(n,function(t,n){try{var r=t.type.query(e,j,t),a=e._id;i.set(r,[a,n]),r instanceof D.QueryDefinition?c.push(r):o.push(r)}catch(e){}})}),s=(0,A.default)(c),e.next=11,Promise.all(s.map(function(e){return j.chain.request(e)}));case 11:d=e.sent,f=(0,b.default)((0,m.default)(o),"_id"),p=(0,m.default)(d.map(function(e){return e.included||e.data})).concat(f).filter(Boolean),h={},y=H((0,g.default)(s,d));try{for(y.s();!(v=y.n()).done;)O=(_=(0,u.default)(v.value,2))[0],w=_[1],(S=i.get(O))&&(E=(x=(0,u.default)(S,2))[0],C=x[1],h[E]=h[E]||{},h[E][C]=(0,P.responseToRelationship)(w))}catch(e){y.e(e)}finally{y.f()}return e.abrupt("return",Q(Q({},(0,P.attachRelationships)(t,h)),{},{included:p}));case 18:case"end":return e.stop()}},e)})),function(e,t){return ee.apply(this,arguments)})},{key:"requestMutation",value:(et=(0,d.default)(l.default.mark(function e(t){var n,r,a,i,u=this;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=8;break}return r=(n=(0,o.default)(t))[0],a=n.slice(1),e.next=4,this.requestMutation(r);case 4:return i=e.sent,e.next=7,Promise.all(a.map(function(e){var t="function"==typeof e?e(i):e;return u.requestMutation(t)}));case 7:return e.abrupt("return",i);case 8:return e.abrupt("return",this.chain.request(t));case 9:case"end":return e.stop()}},e,this)})),function(e){return et.apply(this,arguments)})},{key:"getIncludesRelationships",value:function(e){var t=this,n=e.includes,r=e.doctype;return n?(0,v.default)(n.map(function(e){return[e,t.schema.getRelationship(r,e)]})):{}}},{key:"hydrateDocuments",value:function(e,t){var n=this;if(!1===this.options.autoHydrate)return t;var r=this.schema.getDoctypeSchema(e);return r.relationships?t.map(function(e){return n.hydrateDocument(e,r)}):t}},{key:"hydrateDocument",value:function(e,t){if(!e)return e;var n=t||this.schema.getDoctypeSchema(e._type);return Q(Q({},e),this.hydrateRelationships(e,n.relationships))}},{key:"hydrateRelationships",value:function(e,t){var n=this.getRelationshipStoreAccessors();return(0,y.default)(t,function(t,r){return(0,E.create)(e,t,n)})}},{key:"makeNewDocument",value:function(e){return this.hydrateDocument({_type:e})}},{key:"generateRandomId",value:function(){return this.queryIdGenerator.generateRandomId()}},{key:"getAssociation",value:function(e,t){return(0,E.create)(e,this.schema.getRelationship(e._type,t),this.getRelationshipStoreAccessors())}},{key:"getRelationshipStoreAccessors",value:function(){var e=this;return!this.storeAccesors&&(this.storeAccessors={get:this.getDocumentFromState.bind(this),save:function(t,n){return e.save.call(e,t,n)},dispatch:this.dispatch.bind(this),query:function(t,n){return e.query.call(e,t,n)},mutate:function(t,n){return e.mutate.call(e,t,n)}}),this.storeAccessors}},{key:"getCollectionFromState",value:function(e){try{return(0,T.getCollectionFromState)(this.store.getState(),e)}catch(t){return L.default.warn("Could not getCollectionFromState",e,t.message),null}}},{key:"getDocumentFromState",value:function(e,t){try{return(0,T.getDocumentFromState)(this.store.getState(),e,t)}catch(n){return L.default.warn("Could not getDocumentFromState",e,t,n.message),null}}},{key:"getQueryFromState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.hydrated||!1,r=t.singleDocData||!1;try{var a=(0,T.getQueryFromState)(this.store.getState(),e),i=a.definition&&a.definition.doctype,o=a.definition&&a.definition.id;if(!n&&!r)return a;var u=n&&i?this.hydrateDocuments(i,a.data):a.data;return Q(Q({},a),{},{data:o&&r?u[0]:u})}catch(t){return L.default.warn("Could not get query from state. queryId: ".concat(e,", error: ").concat(t.message)),null}}},{key:"register",value:function(e){return this.getStackClient().setUri(e),this.startOAuthFlow(j.authFunction)}},{key:"isReactNative",value:function(){return"undefined"!=typeof navigator&&"ReactNative"==navigator.product}},{key:"startOAuthFlow",value:(en=(0,d.default)(l.default.mark(function e(t){var n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getStackClient(),e.next=3,n.register();case 3:return e.next=5,this.certifyFlagship();case 5:return e.abrupt("return",this.authorize({openURLCallback:t}));case 6:case"end":return e.stop()}},e,this)})),function(e){return en.apply(this,arguments)})},{key:"certifyFlagship",value:(er=(0,d.default)(l.default.mark(function e(){var t;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.getStackClient()).oauthOptions.shouldRequireFlagshipPermissions){e.next=4;break}return e.next=4,(0,q.certifyFlagship)(t.oauthOptions.certificationConfig,this);case 4:case"end":return e.stop()}},e,this)})),function(){return er.apply(this,arguments)})},{key:"authorize",value:(ea=(0,d.default)(l.default.mark(function e(){var t,n,r,a,i,o,u,c,s,d,f,p,h,y,v,m=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0===(n=(t=m.length>0&&void 0!==m[0]?m[0]:{}).openURLCallback)?j.authFunction:n,i=void 0===(a=t.sessionCode)?void 0:a,u=void 0===(o=t.pkceCodes)?{}:o,e.prev=1,c=u.codeVerifier,s=u.codeChallenge,f=(d=this.getStackClient()).generateStateCode(),p=d.getAuthCodeURL({stateCode:f,scopes:void 0,sessionCode:i,codeChallenge:s}),e.next=8,r(p);case 8:return h=e.sent,y=d.getAccessCodeFromURL(h,f),e.next=12,d.fetchAccessToken(y,void 0,void 0,c);case 12:return v=e.sent,d.setToken(v),e.abrupt("return",{token:v,infos:d.oauthOptions,client:d.oauthOptions});case 17:throw e.prev=17,e.t0=e.catch(1),e.t0.message===S.REGISTRATION_ABORT&&this.getStackClient().unregister(),e.t0;case 21:case"end":return e.stop()}},e,this,[[1,17]])})),function(){return ea.apply(this,arguments)})},{key:"renewAuthorization",value:function(){return this.authorize({openURLCallback:j.authFunction})}},{key:"setStore",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.force;if(void 0===e)throw Error("Store is undefined");if(this.store&&!(void 0!==n&&n))throw Error("Client already has a store, it is forbidden to change store.\nsetStore must be called before any query is executed. Try to\ncall setStore earlier in your code, preferably just after the\ninstantiation of the client.");this.store=e}},{key:"ensureStore",value:function(){!this.store&&this.setStore((0,T.createStore)())}},{key:"checkForRevocation",value:(ei=(0,d.default)(l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.stackClient instanceof w.OAuthClient)){e.next=4;break}return e.abrupt("return",this.stackClient.checkForRevocation());case 4:throw"checkForRevocation is only implemented for OAutClient";case 5:case"end":return e.stop()}},e,this)})),function(){return ei.apply(this,arguments)})},{key:"handleRevocationChange",value:function(e){e?(this.isRevoked=!0,this.emit("revoked")):(this.isRevoked=!1,this.emit("unrevoked"))}},{key:"handleTokenRefresh",value:function(e){this.emit("tokenRefreshed"),this.options.onTokenRefresh&&(Y("Using onTokenRefresh is deprecated, please use events like this: cozyClient.on('tokenRefreshed', token => console.log('Token has been refreshed', token)). https://git.io/fj3M3"),this.options.onTokenRefresh(e))}},{key:"createClient",value:function(){this.options.client&&L.default.warn("CozyClient: Using options.client is deprecated, please use options.stackClient.");var e=void 0===this.options.warningForCustomHandlers||this.options.warningForCustomHandlers,t=this.options.client||this.options.stackClient,n={onRevocationChange:this.handleRevocationChange,onTokenRefresh:this.handleTokenRefresh};if(t){this.stackClient=t,!t.options&&(t.options={});for(var r=0,a=Object.keys(n);r<a.length;r++){var i=a[r];t.options[i]?e&&L.default.warn("You passed a stackClient with its own ".concat(i,". It is not supported, unexpected things might happen.")):t.options[i]=n[i]}}else{var o=Q(Q({},this.options),n);this.stackClient=this.options.oauth?new w.OAuthClient(o):new w.default(o)}this.client=new Proxy(this.stackClient,Y("Using cozyClient.client is deprecated, please use cozyClient.stackClient."))}},{key:"getClient",value:function(){return L.default.warn("CozyClient: getClient() is deprecated, please use getStackClient()."),this.getStackClient()}},{key:"getStackClient",value:function(){return!this.stackClient&&this.createClient(),this.stackClient}},{key:"reducer",value:function(){return T.default}},{key:"dispatch",value:function(e){return this.store.dispatch(e)}},{key:"getInstanceOptions",value:function(){return this.instanceOptions}},{key:"loadInstanceOptionsFromDOM",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[role=application]",t=document.querySelector(e);if(!(t instanceof HTMLElement))throw Error("The selector that is passed does not return an HTMLElement");var n=t.dataset,r=n.cozy,a=(0,s.default)(n,["cozy"]);this.instanceOptions=Q(Q({},JSON.parse(void 0===r?"{}":r)),a),this.capabilities=this.instanceOptions.capabilities||null}},{key:"loadInstanceOptionsFromStack",value:(eo=(0,d.default)(l.default.mark(function e(){var t,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.query((0,D.Q)("io.cozy.settings").getById("io.cozy.settings.capabilities"));case 2:return t=e.sent.data,e.next=6,this.query((0,D.Q)("io.cozy.settings").getById("io.cozy.settings.instance"));case 6:n=e.sent.data,this.instanceOptions={capabilities:t,locale:n.locale,tracking:n.tracking},this.capabilities=this.instanceOptions.capabilities||null;case 10:case"end":return e.stop()}},e,this)})),function(){return eo.apply(this,arguments)})},{key:"setData",value:function(e){var t=this;this.ensureStore(),Object.entries(e).forEach(function(e){var n=(0,u.default)(e,2),r=(n[0],n[1]);t.dispatch((0,T.receiveQueryResult)(null,{data:r}))})}},{key:"setOnError",value:function(e){if(this.options&&this.options.onError)throw Error("On Error is already defined");this.options.onError=e}},{key:"toJSON",value:function(){return new F.CozyClient({uri:this.options.uri})}},{key:"setAppMetadata",value:function(e){this.appMetadata=Q(Q({},this.appMetadata),e)}},{key:"setLinks",value:function(e){if(this.links=e||[new x.default],this.registerClientOnLinks(),this.chain=(0,M.chain)(this.links),this.isLogged){var t,n=H(this.links);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.onLogin&&r.onLogin()}}catch(e){n.e(e)}finally{n.f()}}}},{key:"getSettings",value:(eu=(0,d.default)(l.default.mark(function e(t,n){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.getSettings)(this,t,n));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return eu.apply(this,arguments)})},{key:"saveAfterFetchSettings",value:(ec=(0,d.default)(l.default.mark(function e(t,n,r){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.saveAfterFetchSettings)(this,t,n,r));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n){return ec.apply(this,arguments)})},{key:"resetQuery",value:(es=(0,d.default)(l.default.mark(function e(t){var n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(0,T.isQueryExisting)(this.store.getState(),t)){e.next=3;break}return e.abrupt("return",Promise.resolve(null));case 3:return this.dispatch((0,T.resetQuery)(t)),n=this.getQueryFromState(t),e.next=7,this.query(n.definition,{as:t});case 7:return e.abrupt("return",e.sent);case 10:throw e.prev=10,e.t0=e.catch(0),e.t0;case 13:case"end":return e.stop()}},e,this,[[0,10]])})),function(e){return es.apply(this,arguments)})}],[{key:"fromOldClient",value:function(e,t){return new ed(Q({uri:e._url,token:e._token.token},t))}},{key:"fromOldOAuthClient",value:(el=(0,d.default)(l.default.mark(function e(t,n){var r,a,i;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._oauth){e.next=12;break}return e.next=3,t.authorize();case 3:if(a={oauth:(r=e.sent).client,token:r.token,scope:r.token.scope},!(i=new ed(Q(Q({uri:t._url},a),n))).loginPromise){e.next=9;break}return e.next=9,i.loginPromise;case 9:return e.abrupt("return",i);case 12:throw Error("Cannot instantiate a new client: old client is not an OAuth client. CozyClient.fromOldClient might be more suitable.");case 13:case"end":return e.stop()}},e)})),function(e,t){return el.apply(this,arguments)})},{key:"fromEnv",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e||(void 0!==r?r.env:{}),a=n.COZY_URL,i=n.COZY_CREDENTIALS;if(!a||!i)throw Error("Env used to instantiate CozyClient must have COZY_URL and COZY_CREDENTIALS");try{t.oauth=JSON.parse(i)}catch(e){t.token=i.trim()}return t.uri=a.trim(),new ed(Q({},t))}},{key:"fromDOM",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"[role=application]",n=document.querySelector(t);if(!(n instanceof HTMLElement))throw Error("Cannot find an HTMLElement corresponding to ".concat(t));if(!n||!n.dataset)throw Error("Found no data in ".concat(t," to instantiate cozyClient"));var r=n.dataset.cozy?JSON.parse(n.dataset.cozy):Q({},n.dataset),a=r.domain,i=r.token;if((!a||!i)&&(a=a||r.cozyDomain,i=i||r.cozyToken),!a||!i)throw Error("Found no data in ".concat(n.dataset," to instantiate cozyClient"));return new ed(Q({uri:"".concat(window.location.protocol,"//").concat(a),token:i,capabilities:r.capabilities},e))}},{key:"registerHook",value:function(e,t,n){var r=ed.hooks[e]=ed.hooks[e]||{};r[t]=r[t]||[],r[t].push(n)}}]),ed}();$.hooks=$.hooks||{},$.fetchPolicies=R.default,$.version="50.4.0",O.default.mixin($);t.default=$},6505:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.chain=t.default=void 0;var a=r(n(98235)),i=r(n(68434)),o=r(n(82007)),u=r(n(65105)),c=r(n(19723)),s=function(){var e,t,n;function r(e,t){(0,u.default)(this,r),"function"==typeof e&&(this.request=e),"function"==typeof t&&(this.persistCozyData=t)}return(0,c.default)(r,[{key:"request",value:(e=(0,o.default)(i.default.mark(function e(t,n,r){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("request is not implemented");case 1:case"end":return e.stop()}},e)})),function(t,n,r){return e.apply(this,arguments)})},{key:"persistCozyData",value:(t=(0,o.default)(i.default.mark(function e(t,n){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("persistCozyData is not implemented");case 1:case"end":return e.stop()}},e)})),function(e,n){return t.apply(this,arguments)})},{key:"reset",value:(n=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("reset is not implemented");case 1:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})}]),r}();t.default=s;var l=function(e){return"function"==typeof e?new s(e):e},d=new s(function(e,t){if(t)return t;if(e.execute)return e.execute();throw Error("No link could handle operation ".concat(JSON.stringify(e)))},function(e,t){});t.chain=function(e){return[].concat((0,a.default)(e),[d]).map(l).reduce(f)};var f=function(e,t){return new s(function(n,r,a){return e.request(n,r,function(e,n){return t.request(e,n,a)})},function(n,r){return e.persistCozyData(n,function(e){return t.persistCozyData(e,r)})})}},9211:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(64512)),u=r(n(27361)),c=n(72662),s=Object.prototype.hasOwnProperty,l=function(){function e(t,n,r,i){var u=this;if((0,a.default)(this,e),(0,o.default)(this,"handleStoreChange",function(){var e=u.currentRawResult();!function(e,t){if(d(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var a=0;a<n.length;a++)if(!s.call(t,n[a])||!d(e[n[a]],t[n[a]]))return!1;return!0}(e,u.lastResult)&&(u.lastResult=e,u.notifyObservers())}),!t||!n||!r)throw Error("ObservableQuery takes 3 arguments: queryId, definition and client");this.queryId=t,this.definition=n,this.client=r,this.observers={},this.idCounter=1,this.lastResult=this.currentRawResult(),this.options=i}return(0,i.default)(e,[{key:"currentResult",value:function(){return this.client.getQueryFromState(this.queryId,{hydrated:(0,u.default)(this.options,"hydrated",!0),singleDocData:!0})}},{key:"fetch",value:function(){return this.client.query(this.definition,{as:this.queryId})}},{key:"fetchMore",value:function(){var e=this.currentRawResult();return e.bookmark?this.client.query(this.definition.offsetBookmark(e.bookmark),{as:this.queryId}):this.client.query(this.definition.offset(e.data.length),{as:this.queryId})}},{key:"currentRawResult",value:function(){return(0,c.getRawQueryFromState)(this.getStore().getState(),this.queryId)}},{key:"notifyObservers",value:function(){var e=this;Object.keys(this.observers).forEach(function(t){return e.observers[t]()})}},{key:"subscribeToStore",value:function(){if(this._unsubscribeStore)throw Error("ObservableQuery instance is already subscribed to store.");this._unsubscribeStore=this.getStore().subscribe(this.handleStoreChange)}},{key:"unsubscribeFromStore",value:function(){if(!this._unsubscribeStore)throw Error("ObservableQuery instance is not subscribed to store");this._unsubscribeStore()}},{key:"subscribe",value:function(e){var t=this,n=this.idCounter;return this.idCounter++,this.observers[n]=e,1===Object.keys(this.observers).length&&this.subscribeToStore(),function(){return t.unsubscribe(n)}}},{key:"unsubscribe",value:function(e){if(!this.observers[e])throw Error("Cannot unsubscribe unknown callbackId ".concat(e));delete this.observers[e],0===Object.keys(this.observers).length&&(this.unsubscribeFromStore(),this._unsubscribeStore=null)}},{key:"getStore",value:function(){return this.client.store}}]),e}();function d(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}t.default=l},57244:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(65105)),o=a(n(19723)),u=a(n(25665)),c=a(n(27952)),s=a(n(12323)),l=a(n(64512)),d=r(n(67294)),f=a(n(45697)),p=a(n(95460)),h=f.default.shape({subscribe:f.default.func.isRequired,dispatch:f.default.func.isRequired,getState:f.default.func.isRequired}),y=function(e){(0,u.default)(a,e);var t,n,r=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function a(e,t){var n;if((0,i.default)(this,a),n=r.call(this,e,t),!e.client)throw Error("CozyProvider was not passed a client instance.");return e.store&&e.client.setStore(e.store),n}return(0,o.default)(a,[{key:"getChildContext",value:function(){return{store:this.props.store||this.context.store||this.props.client.store,client:this.props.client}}},{key:"render",value:function(){return d.default.createElement(p.default.Provider,{value:this.getChildContext()},this.props.children)}}]),a}(d.Component);t.default=y,(0,l.default)(y,"propTypes",{store:h,client:f.default.object.isRequired,children:f.default.oneOfType([f.default.element,f.default.arrayOf(f.default.element)]).isRequired}),(0,l.default)(y,"childContextTypes",{store:f.default.object,client:f.default.object.isRequired}),(0,l.default)(y,"contextTypes",{store:f.default.object})},63890:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.computeChildrenArgs=t.getQueryAttributes=t.default=t.fetchQuery=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(8997)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(64512)),d=r(n(80295)),f=n(67294);r(n(88477));var p=r(n(45697));r(n(9211));function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,l.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var v={},m=function(e,t){return t.fetch?t.fetch():e.query(t.definition,{as:t.queryId})};t.fetchQuery=m;var b=function(e,t){var n=e.create.bind(e),r=e.save.bind(e),a=e.destroy.bind(e),i=e.getAssociation.bind(e),o="function"==typeof t.query?t.query(e,t):t.query,u=e.makeObservableQuery(o,t),c=u.fetchMore.bind(u),s=t.mutations,l=(0,d.default)(t,["mutations"]),f="function"==typeof s?s(e,u,l):s,p=u.fetch?u.fetch.bind(u):null;return{client:e,observableQuery:u,queryDefinition:o,createDocument:n,saveDocument:r,deleteDocument:a,getAssociation:i,fetchMore:c,fetch:p,mutations:f}};t.getQueryAttributes=b;var g=function(e){var t=e.observableQuery,n=e.fetchMore,r=e.fetch,a=e.createDocument,i=e.saveDocument,o=e.deleteDocument,u=e.getAssociation,c=e.mutations;return[y({fetchMore:n,fetch:r},t.currentResult()),y({createDocument:a,saveDocument:i,deleteDocument:o,getAssociation:u},c)]};t.computeChildrenArgs=g;var k=function(e){(0,u.default)(d,e);var t,n,r=(t=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function d(e,t){(0,a.default)(this,d),n=r.call(this,e,t),(0,l.default)((0,o.default)(n),"onQueryChange",function(){n.recomputeChildrenArgs(),n.setState(v)});var n,i=t.client;if(!t.client)throw Error("Query should be used with client in context (use CozyProvider to set context)");return n.client=i,n.observableQuery=null,n.queryUnsubscribe=null,Object.assign((0,o.default)(n),b(i,e)),n.recomputeChildrenArgs(),n}return(0,i.default)(d,[{key:"componentDidMount",value:function(){this.queryUnsubscribe=this.observableQuery.subscribe(this.onQueryChange),!1!==this.props.enabled&&this.executeQueryRespectingFetchPolicy()}},{key:"executeQueryRespectingFetchPolicy",value:function(){if(this.props.fetchPolicy){var e=this.client.getQueryFromState(this.props.as);this.props.fetchPolicy&&"function"==typeof this.props.fetchPolicy&&this.props.fetchPolicy(e)&&m(this.client,this.observableQuery)}else m(this.client,this.observableQuery)}},{key:"componentDidUpdate",value:function(e){!1===e.enabled&&!1!==this.props.enabled&&this.executeQueryRespectingFetchPolicy()}},{key:"componentWillUnmount",value:function(){this.queryUnsubscribe&&this.queryUnsubscribe()}},{key:"recomputeChildrenArgs",value:function(){this.childrenArgs=g(this)}},{key:"render",value:function(){return(0,this.props.children)(this.childrenArgs[0],this.childrenArgs[1])}}]),d}(f.Component);t.default=k,k.contextTypes={client:p.default.object,store:p.default.object};var _=p.default.object;k.propTypes={query:p.default.oneOfType([p.default.func,_]).isRequired,enabled:p.default.bool,as:p.default.string,children:p.default.func.isRequired,fetchPolicy:p.default.func},k.defaultProps={enabled:!0}},12887:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=n(67294),u=r(n(2705)),c=n(8752),s=n(90688),l=(0,o.memo)(function(e){var t=e.doctype,n=(0,u.default)();return(0,o.useEffect)(function(){var e,r=n.plugins.realtime;if(!r)throw Error("You must include the realtime plugin to use RealTimeQueries");var o={};"io.cozy.files"===t&&(o.enhanceDocFn=s.ensureFilePath);var u=function(e){(0,c.dispatchCreate)(n,t,e,o)},l=function(e){(0,c.dispatchUpdate)(n,t,e,o)},d=function(e){(0,c.dispatchDelete)(n,t,e,o)};return(e=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.subscribe("created",t,u);case 2:return e.next=4,r.subscribe("updated",t,l);case 4:return e.next=6,r.subscribe("deleted",t,d);case 6:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})(),function(){r.unsubscribe("created",t,u),r.unsubscribe("updated",t,l),r.unsubscribe("deleted",t,d)}},[n,t]),null});t.default=l},81390:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(64512)),s=r(n(24350)),l=r(n(66604)),d=r(n(82492)),f=r(n(84238)),p=r(n(71843)),h=n(30130);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,c.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m=function(e){var t=(0,l.default)(e.relationships||{},function(e,t){return v(v({},e),{},{name:t,type:(0,h.resolveClass)(e.doctype,e.type)})});return v(v({},e),{},{relationships:(0,f.default)(t)>0?(0,s.default)(t,"name"):null})},b=function(e,t){if(!e)throw Error(t)},g=function(e,t){var n=(0,p.default)(e,t,function(e){return e.name});b(0===n.length,"Duplicated names in schemas being added: ".concat(n.map(function(e){return e.name}).join(", ")));var r=(0,p.default)(e,t,function(e){return e.doctype});b(0===r.length,"Duplicated doctypes in schemas being added: ".concat(r.map(function(e){return e.name}).join(", ")))},k=function(){var e,t;function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,o.default)(this,n),this.byDoctype={},this.add(e),this.client=t}return(0,u.default)(n,[{key:"add",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,l.default)(e,function(e,t){return v({name:t},m(e))});g(Object.values(t),Object.values(this.byDoctype)),(0,d.default)(this.byDoctype,(0,s.default)(t,function(e){return e.doctype}))}},{key:"getDoctypeSchema",value:function(e){var t=this.byDoctype[e];return!t&&(t=m({name:e,doctype:e}),this.byDoctype[e]=t),t}},{key:"getRelationship",value:function(e,t){if(!e)throw TypeError("Invalid doctype ".concat(e));var n=this.getDoctypeSchema(e);if(!n)throw Error("Cannot find doctype ".concat(e," in schema"));if(!n.relationships)throw Error("Schema for doctype ".concat(e," has no relationships"));return n.relationships[t]}},{key:"validate",value:(e=(0,i.default)(a.default.mark(function e(t){var n,r,i,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},r=this.byDoctype[t._type]){e.next=4;break}return e.abrupt("return",!0);case 4:if(r.attributes){e.next=6;break}return e.abrupt("return",!0);case 6:e.t0=a.default.keys(r.attributes);case 7:if((e.t1=e.t0()).done){e.next=15;break}return i=e.t1.value,e.next=11,this.validateAttribute(t,i,r.attributes[i]);case 11:!0!==(o=e.sent)&&(n[i]=o),e.next=7;break;case 15:if(0!==Object.keys(n).length){e.next=17;break}return e.abrupt("return",!0);case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"validateAttribute",value:(t=(0,i.default)(a.default.mark(function e(t,n,r){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.unique&&this.client)){e.next=6;break}return e.next=3,this.client.collection(t._type).checkUniquenessOf(n,t[n]);case 3:if(!(!0!==e.sent)){e.next=6;break}return e.abrupt("return","must be unique");case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)})),function(e,n,r){return t.apply(this,arguments)})}]),n}();t.default=k},13945:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.transformBulkDocsResponse=void 0;var a=r(n(80295)),i=r(n(68434)),o=r(n(82007)),u=r(n(65105)),c=r(n(19723)),s=r(n(25665)),l=r(n(27952)),d=r(n(12323)),f=r(n(64512)),p=r(n(35905)),h=n(87549),y=r(n(6505)),v=n(71791),m=n(48544),b=r(n(81602)),g=n(64374);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach(function(t){(0,f.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var O=function(e){var t=e.selector,n=e.partialFilter,r=e.sort,a=e.fields;return!!t||!!n||!!r||!!a||!1},w=function(e,t){var n=(0,p.default)(e,t,function(e,t){return e.ok?_(_({},t),{},{_id:e.id,_rev:e.rev}):t});if(e.find(function(e){return!e.ok}))throw new m.BulkEditError(e,n);return{data:n}};t.transformBulkDocsResponse=w;var S=function(e){(0,s.default)(k,e);var t,n,r,f,p,y,m=(t=k,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,d.default)(t);return e=n?Reflect.construct(r,arguments,(0,d.default)(this).constructor):r.apply(this,arguments),(0,l.default)(this,e)});function k(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.client,r=t.stackClient,a=t.platform;return(0,u.default)(this,k),e=m.call(this),n&&b.default.warn("Using options.client is deprecated, prefer options.stackClient"),e.stackClient=r||n,e.isOnline=null==a?void 0:a.isOnline,e}return(0,c.default)(k,[{key:"registerClient",value:function(e){this.stackClient=e.stackClient||e.client}},{key:"reset",value:(r=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.stackClient=null;case 1:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"request",value:(f=(0,o.default)(i.default.mark(function e(t,n,r){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.isOnline,!e.t0){e.next=5;break}return e.next=4,this.isOnline();case 4:e.t0=!e.sent;case 5:if(!e.t0){e.next=7;break}return e.abrupt("return",r(t));case 7:if(e.prev=7,!t.mutationType){e.next=12;break}return e.next=11,this.executeMutation(t,n,r);case 11:case 14:return e.abrupt("return",e.sent);case 12:return e.next=14,this.executeQuery(t);case 17:if(e.prev=17,e.t1=e.catch(7),!(0,g.isReactNativeOfflineError)(e.t1)){e.next=21;break}return e.abrupt("return",r(t));case 21:throw e.t1;case 22:case"end":return e.stop()}},e,this,[[7,17]])})),function(e,t,n){return f.apply(this,arguments)})},{key:"persistCozyData",value:(p=(0,o.default)(i.default.mark(function e(t,n){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n(t));case 1:case"end":return e.stop()}},e)})),function(e,t){return p.apply(this,arguments)})},{key:"executeQuery",value:function(e){var t=e.doctype,n=e.selector,r=e.id,i=e.ids,o=e.referenced,u=(0,a.default)(e,["doctype","selector","id","ids","referenced"]);if(!t)throw b.default.warn("Bad query",e),Error("No doctype found in a query definition");var c=this.stackClient.collection(t);return r?c.get(r,e):i?c.getAll(i):o?c.findReferencedBy(o,u):O(e)?c.find(n,u):c.all(u)}},{key:"executeMutation",value:(y=(0,o.default)(i.default.mark(function e(t,n,r){var o,u,c,s,l;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=t.mutationType,u=t.document,c=t.documents,s=(0,a.default)(t,["mutationType","document","documents"]),e.t0=o,e.next=e.t0===h.MutationTypes.CREATE_DOCUMENT?4:e.t0===h.MutationTypes.UPDATE_DOCUMENTS?5:e.t0===h.MutationTypes.UPDATE_DOCUMENT?9:e.t0===h.MutationTypes.DELETE_DOCUMENT?10:e.t0===h.MutationTypes.ADD_REFERENCES_TO?11:e.t0===h.MutationTypes.REMOVE_REFERENCES_TO?12:e.t0===h.MutationTypes.ADD_REFERENCED_BY?13:e.t0===h.MutationTypes.REMOVE_REFERENCED_BY?18:e.t0===h.MutationTypes.UPLOAD_FILE?23:24;break;case 4:return e.abrupt("return",this.stackClient.collection(u._type).create(u));case 5:return e.next=7,this.stackClient.collection(c[0]._type).updateAll(c);case 7:return l=e.sent,e.abrupt("return",w(l,c));case 9:return e.abrupt("return",this.stackClient.collection(u._type).update(u));case 10:return e.abrupt("return",this.stackClient.collection(u._type).destroy(u));case 11:return e.abrupt("return",this.stackClient.collection(s.referencedDocuments[0]._type).addReferencesTo(u,s.referencedDocuments));case 12:return e.abrupt("return",this.stackClient.collection(s.referencedDocuments[0]._type).removeReferencesTo(u,s.referencedDocuments));case 13:if(u._type!==v.DOCTYPE_FILES){e.next=17;break}return e.abrupt("return",this.stackClient.collection(v.DOCTYPE_FILES).addReferencedBy(u,s.referencedDocuments));case 17:case 22:throw Error("The document type should be io.cozy.files");case 18:if(u._type!==v.DOCTYPE_FILES){e.next=22;break}return e.abrupt("return",this.stackClient.collection(v.DOCTYPE_FILES).removeReferencedBy(u,s.referencedDocuments));case 23:return e.abrupt("return",this.stackClient.collection(v.DOCTYPE_FILES).upload(s.file,s.dirPath));case 24:return e.abrupt("return",r(t,n));case 25:case"end":return e.stop()}},e,this)})),function(e,t,n){return y.apply(this,arguments)})}]),k}(y.default);t.default=S},97491:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(25665)),s=r(n(27952)),l=r(n(12323)),d=r(n(6505)),f=function(e){(0,c.default)(h,e);var t,n,r,d,f,p=(t=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,l.default)(t);return e=n?Reflect.construct(r,arguments,(0,l.default)(this).constructor):r.apply(this,arguments),(0,s.default)(this,e)});function h(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.webviewIntent;return(0,o.default)(this,h),(e=p.call(this)).webviewIntent=n,e}return(0,u.default)(h,[{key:"registerClient",value:function(e){}},{key:"reset",value:(r=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"request",value:(d=(0,i.default)(a.default.mark(function e(t,n,r){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.webviewIntent.call("flagshipLinkRequest",t));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n){return d.apply(this,arguments)})},{key:"persistCozyData",value:(f=(0,i.default)(a.default.mark(function e(t,n){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)})),function(e,t){return f.apply(this,arguments)})}]),h}(d.default);t.default=f},99658:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723));n(87549);var o=function(){function e(t,n,r,i){(0,a.default)(this,e);var o=i.dispatch,u=i.get,c=i.query,s=i.mutate,l=i.save;this.target=t,this.name=n,this.doctype=r,this.get=u,this.query=c,this.mutate=s,this.save=l,this.dispatch=o}return(0,i.default)(e,[{key:"raw",get:function(){throw Error("A relationship must define its raw getter")}},{key:"data",get:function(){throw Error("A relationship must define its data getter")}}],[{key:"query",value:function(e,t,n){throw Error("A custom relationship must define its query() function")}}]),e}();t.default=o},35702:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.updateRelationship=t.updateHasManyItem=t.removeHasManyItem=t.setHasManyItem=t.getHasManyItems=t.getHasManyItem=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(8997)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(64512)),d=r(n(98235)),f=r(n(27361)),p=r(n(82492)),h=n(87549),y=n(72662),v=r(n(99658)),m=r(n(81602));function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach(function(t){(0,l.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var k=function(e,t,n){var r=-1===t?e.length:t;return[].concat((0,d.default)(e.slice(0,r)),[n],(0,d.default)(e.slice(r+1)))},_=function(e){(0,u.default)(p,e);var t,n,r=(t=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function p(){var e;(0,a.default)(this,p);for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),(0,l.default)((0,o.default)(e),"updateRelationshipData",function(t){return function(n,r){var a=(0,y.getDocumentFromState)(r(),e.target._type,e.target._id);n((0,y.receiveQueryResult)(null,{data:g(g({},a),{},{relationships:g(g({},a.relationships),{},(0,l.default)({},e.name,t(a.relationships[e.name])))})}))}}),e}return(0,i.default)(p,[{key:"fetchMore",value:function(){throw"Not implemented"}},{key:"exists",value:function(e){return this.existsById(e._id)}},{key:"containsById",value:function(e){return void 0!==this.getRelationship().data.find(function(t){return e===t._id})}},{key:"existsById",value:function(e){return!!(this.containsById(e)&&this.get(this.doctype,e))}},{key:"add",value:function(e){var t=(Array.isArray(e)?e:[e]).map(function(e){return e._id});return this.addById(t)}},{key:"remove",value:function(e){var t=(Array.isArray(e)?e:[e]).map(function(e){return e._id});return this.removeById(t)}},{key:"addTargetRelationships",value:function(e){var t,n=this;!this.target.relationships&&(this.target.relationships={}),!this.target.relationships[this.name]&&(this.target.relationships[this.name]={data:[]});var r=(Array.isArray(e)?e:[e]).filter(function(e){return!n.existsById(e)}).map(function(e){return{_id:e,_type:n.doctype}});(t=this.target.relationships[this.name].data).push.apply(t,(0,d.default)(r)),this.updateMetaCount()}},{key:"addById",value:function(e){return this.addTargetRelationships(e),this.save(this.target)}},{key:"removeTargetRelationships",value:function(e){var t=Array.isArray(e)?e:[e];this.target.relationships[this.name].data=this.target.relationships[this.name].data.filter(function(e){var n=e._id;return!t.includes(n)}),this.updateMetaCount()}},{key:"removeById",value:function(e){return this.removeTargetRelationships(e),this.save(this.target)}},{key:"updateMetaCount",value:function(){void 0!==(0,f.default)(this.target.relationships[this.name],"meta.count")&&(this.target.relationships[this.name].meta=g(g({},this.target.relationships[this.name].meta),{},{count:this.target.relationships[this.name].data.length}))}},{key:"getRelationship",value:function(){var e=this.target[this.name],t=(0,f.default)(this.target,"relationships.".concat(this.name));return t?t:(e&&e.length&&m.default.warn("You're trying to access data on a relationship that appear to not be loaded yet. You may want to use 'include()' on your query"),{data:[],next:!0,meta:{count:0}})}},{key:"updateTargetRelationship",value:function(e,t){var n=e.readDocument(this.target._type,this.target._id);e.writeDocument(this.updateRelationship(n,t))}},{key:"updateRelationship",value:function(e,t){return p.updateRelationship(e,this.name,t)}},{key:"dehydrate",value:function(e){return g(g({},e),{},{relationships:g(g({},e.relationships),{},(0,l.default)({},this.name,{data:this.raw}))})}},{key:"raw",get:function(){return this.getRelationship().data}},{key:"data",get:function(){var e=this;return this.getRelationship().data.map(function(t){var n=t._id,r=t._type;return e.get(r,n)}).filter(Boolean)}},{key:"hasMore",get:function(){return this.getRelationship().next}},{key:"count",get:function(){var e=this.getRelationship();return e.meta?e.meta.count:e.data.length}}],[{key:"query",value:function(e,t,n){var r=(0,f.default)(e,"relationships.".concat(n.name,".data"),[]).map(function(e){return e._id});return new h.QueryDefinition({doctype:n.doctype,ids:r})}}]),p}(v.default),O=_.getHasManyItem=function(e,t,n){return(0,f.default)(e,"relationships.".concat(t,".data"),[]).find(function(e){return e._id==n})};t.getHasManyItem=O;var w=_.getHasManyItems=function(e,t){return(0,f.default)(e,"relationships.".concat(t,".data"),[])};t.getHasManyItems=w;var S=_.setHasManyItem=function(e,t,n,r){var a=_.getHasManyItems(e,t),i=a.findIndex(function(e){return e._id===n}),o=(0,p.default)({},a[i],r),u=k(a,i,o);return _.updateRelationship(e,t,function(e){return(0,p.default)({},e,{data:u})})};t.setHasManyItem=S;var x=_.removeHasManyItem=function(e,t,n){var r=_.getHasManyItems(e,t).filter(function(e){return e._id!==n});return _.updateRelationship(e,t,function(){return{data:r}})};t.removeHasManyItem=x;var E=_.updateHasManyItem=function(e,t,n,r){var a=r(_.getHasManyItem(e,t,n));return _.setHasManyItem(e,t,n,a)};t.updateHasManyItem=E;var P=_.updateRelationship=function(e,t,n){return g(g({},e),{},{relationships:g(g({},e.relationships),{},(0,l.default)({},t,g(g({},e.relationships?e.relationships[t]:{}),n(e.relationships?e.relationships[t]:{}))))})};t.updateRelationship=P;t.default=_},2501:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.getFileDatetime=void 0;var a=r(n(68434)),i=r(n(98235)),o=r(n(64512)),u=r(n(82007)),c=r(n(65105)),s=r(n(19723)),l=r(n(59655)),d=r(n(25665)),f=r(n(27952)),p=r(n(12323)),h=r(n(90402)),y=r(n(27361)),v=r(n(57557)),m=r(n(44908)),b=n(87549),g=n(72662),k=n(71791);r(n(99658));var _=r(n(35702));function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var S=function(e,t){var n=(0,h.default)(e,3),r=n[0],a=n[1],i=n[2];return[i?[r,a,i]:[r,a],t]},x=function(e){var t;return(null===(t=e.metadata)||void 0===t?void 0:t.datetime)||e.created_at};t.getFileDatetime=x;var E=function(e){(0,d.default)(O,e);var t,n,r,o,h,_=(t=O,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,p.default)(t);return e=n?Reflect.construct(r,arguments,(0,p.default)(this).constructor):r.apply(this,arguments),(0,f.default)(this,e)});function O(){return(0,c.default)(this,O),_.apply(this,arguments)}return(0,s.default)(O,[{key:"fetchMore",value:(r=(0,u.default)(a.default.mark(function e(){var t,n,r,o=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.QueryDefinition({doctype:k.DOCTYPE_FILES}),r=(n=this.getRelationship().data)[n.length-1],e.next=5,this.dispatch(function(){var e=(0,u.default)(a.default.mark(function e(u,c){var s,l,d;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=x((0,g.getDocumentFromState)(c(),r._type,r._id)),l=S([o.target._type,o.target._id,s],n[n.length-1]._id),e.next=5,o.query(t.referencedBy(o.target).offsetCursor(l));case 5:return(d=e.sent).data.shift(),e.next=9,o.dispatch(o.updateRelationshipData(function(e){return w(w({},e),{},{data:[].concat((0,i.default)(e.data),(0,i.default)(d.data)),next:d.next})}));case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"addById",value:(o=(0,u.default)(a.default.mark(function e(t){var n,r,i=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Array.isArray(t)?t:[t],this.addTargetRelationships(n),r=n.map(function(e){return{_id:e,_type:i.doctype}}),e.next=5,this.mutate(this.addReferences(r));case 5:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"removeById",value:(h=(0,u.default)(a.default.mark(function e(t){var n,r,i=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Array.isArray(t)?t:[t],this.removeTargetRelationships(t),r=n.map(function(e){return{_id:e,_type:i.doctype}}),e.next=5,this.mutate(this.removeReferences(r));case 5:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"addReferences",value:function(e){if(this.target._type===k.DOCTYPE_FILES)return b.Mutations.addReferencedBy(this.target,e);if(e[0]._type===k.DOCTYPE_FILES)return b.Mutations.addReferencesTo(this.target,e);throw Error("Either the document or the references should be io.cozy.files")}},{key:"removeReferences",value:function(e){if(this.target._type===k.DOCTYPE_FILES)return b.Mutations.removeReferencedBy(this.target,e);if(e[0]._type===k.DOCTYPE_FILES)return b.Mutations.removeReferencesTo(this.target,e);throw Error("Either the document or the references should be io.cozy.files")}},{key:"dehydrate",value:function(e){return(0,v.default)(e,[this.name,"relationships.".concat(this.name)])}},{key:"data",get:function(){var e=this;return this.target._type===k.DOCTYPE_FILES?(0,y.default)(this.target,"referenced_by",[]).map(function(t){var n=t.id,r=t.type;return e.get(r,n)}).filter(Boolean):(0,l.default)((0,p.default)(O.prototype),"data",this)}}],[{key:"query",value:function(e,t,n){if(e._type===k.DOCTYPE_FILES){var r=(0,y.default)(e,"relationships.referenced_by.data",[]),a=(0,m.default)(r.filter(function(e){return e.type===n.doctype}).map(function(e){return e.id}));return a.length>0?(0,b.Q)(n.doctype).getByIds(a):null}var i=S([e._type,e._id],"");return(0,b.Q)(n.doctype).referencedBy(e).offsetCursor(i)}}]),O}(_.default);t.default=E},37828:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(64512)),i=r(n(65105)),o=r(n(19723)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=n(87549),d=r(n(99658));function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=function(e){(0,u.default)(d,e);var t,n,r=(t=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function d(){return(0,i.default)(this,d),r.apply(this,arguments)}return(0,o.default)(d,[{key:"addById",value:function(e){this.getRelationship().push(e)}},{key:"removeById",value:function(e){var t=this.getRelationship(),n=t.indexOf(e);-1!==n&&t.splice(n,1)}},{key:"existsById",value:function(e){return -1!==this.getRelationship().indexOf(e)}},{key:"getRelationship",value:function(){return this.target[this.name]=this.target[this.name]||[],this.target[this.name]}},{key:"dehydrate",value:function(e){return p(p({},e),{},(0,a.default)({},this.name,this.raw||[]))}},{key:"raw",get:function(){return this.target[this.name]}},{key:"data",get:function(){var e=this,t=this.doctype;return(this.raw||[]).map(function(n){return e.get(t,n)})}}],[{key:"query",value:function(e,t,n){var r=e[n.name];return r&&r>0?(0,l.Q)(n.doctype).getByIds(r):null}}]),d}(d.default);t.default=h},32740:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(59655)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(35702)),d=n(87549),f=function(e){(0,u.default)(l,e);var t,n,r=(t=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function l(){return(0,a.default)(this,l),r.apply(this,arguments)}return(0,i.default)(l,[{key:"data",get:function(){var e=this;return(0,o.default)((0,s.default)(l.prototype),"data",this).filter(function(t){return t.slug===e.target.slug})}}],[{key:"query",value:function(e,t){return(0,d.Q)("io.cozy.triggers").where({worker:"konnector"})}}]),l}(l.default);t.default=f},52727:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(64512)),i=r(n(65105)),o=r(n(19723)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(27361)),d=r(n(36968)),f=n(87549),p=r(n(99658)),h=r(n(81602));function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m=function(e){(0,u.default)(p,e);var t,n,r=(t=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function p(){return(0,i.default)(this,p),r.apply(this,arguments)}return(0,o.default)(p,[{key:"add",value:function(e){return this.setRelationship(e),this.save(this.target)}},{key:"remove",value:function(){return this.setRelationship(void 0),this.save(this.target)}},{key:"setRelationship",value:function(e){if(e&&e._type!==this.doctype)throw Error("Tried to associate a ".concat(e._type," document to a HasOne relationship on ").concat(this.doctype," document"));var t="relationships[".concat(this.name,"].data");e?(0,d.default)(this.target,t,{_id:e._id,_type:e._type}):(0,d.default)(this.target,t,void 0)}},{key:"set",value:function(e){h.default.warn("set is deprecated for has-one relationships. Use `add` instead."),this.setRelationship(e)}},{key:"unset",value:function(){h.default.warn("unset is deprecated for has-one relationships. Use `remove` instead."),this.setRelationship(void 0)}},{key:"dehydrate",value:function(e){return this.raw?v(v({},e),{},{relationships:v(v({},e.relationships),{},(0,a.default)({},this.name,{data:this.raw}))}):e}},{key:"raw",get:function(){return(0,l.default)(this.target,"relationships[".concat(this.name,"].data"),null)}},{key:"data",get:function(){return this.raw?this.get(this.doctype,this.raw._id):null}}],[{key:"query",value:function(e,t,n){var r=(0,l.default)(e,"relationships.".concat(n.name,".data"),{});return r&&r._id?(0,f.Q)(n.doctype).getById(r._id):null}}]),p}(p.default);t.default=m},85731:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.BelongsToInPlace=t.default=void 0;var a=r(n(64512)),i=r(n(65105)),o=r(n(19723)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(99658)),d=n(87549);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=function(e){(0,u.default)(l,e);var t,n,r=(t=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function l(){return(0,i.default)(this,l),r.apply(this,arguments)}return(0,o.default)(l,[{key:"dehydrate",value:function(e){return p(p({},e),{},(0,a.default)({},this.name,this.raw||void 0))}},{key:"raw",get:function(){return this.target[this.name]}},{key:"data",get:function(){return this.get(this.doctype,this.raw)}}],[{key:"query",value:function(e,t,n){var r=e[n.name];return t.getDocumentFromState(n.doctype,r)||(0,d.Q)(n.doctype).getById(r)}}]),l}(l.default);t.default=h;t.BelongsToInPlace=h},72887:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getReferencedById=t.getReferencedBy=t.isReferencedById=t.isReferencedBy=t.create=t.resolveClass=t.attachRelationships=t.responseToRelationship=t.pickTypeAndId=void 0;var a=r(n(64512)),i=r(n(78718)),o=r(n(35937)),u=r(n(99658)),c=r(n(52727)),s=r(n(85731)),l=r(n(35702)),d=r(n(37828)),f=r(n(2501));function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=function(e){return(0,i.default)(e,"_type","_id")};t.pickTypeAndId=y;t.responseToRelationship=function(e){var t,n;return(0,o.default)({data:(t=y,Array.isArray(n=e.data)?n.map(t):t(n)),meta:e.meta,next:e.next,skip:e.skip,bookmark:e.bookmark})};var v=function(e,t){return h(h({},e),{},{relationships:h(h({},e.relationships),t)})};t.attachRelationships=function(e,t){if(Array.isArray(e.data))return h(h({},e),{},{data:e.data.map(function(e){return v(e,t[e._id])})});var n=e.data;return h(h({},e),{},{data:v(n,t[n._id])})};var m={"io.cozy.files:has-many":f.default,"has-many":l.default,"belongs-to-in-place":s.default,"has-one":c.default,"has-one-in-place":s.default,"has-many-in-place":d.default};t.resolveClass=function(e,t){if(void 0===t)throw Error("Undefined type for "+e);if("string"!=typeof t)return t;var n=m["".concat(e,":").concat(t)]||m[t];if(n)return n;throw Error("Unknown association '".concat(t,"'"))};t.create=function(e,t,n){var r=t.name,a=t.type,i=t.doctype;if(e[r]instanceof u.default)throw Error("Association ".concat(r," already exists"));return new a(e,r,i,n)};t.isReferencedBy=function(e,t){var n,r;return((null==e?void 0:null===(n=e.relationships)||void 0===n?void 0:null===(r=n.referenced_by)||void 0===r?void 0:r.data)||(null==e?void 0:e.referenced_by)||[]).some(function(e){return e.type===t})};t.isReferencedById=function(e,t,n){var r,a;return((null==e?void 0:null===(r=e.relationships)||void 0===r?void 0:null===(a=r.referenced_by)||void 0===a?void 0:a.data)||(null==e?void 0:e.referenced_by)||[]).some(function(e){return e.type===t&&e.id===n})};t.getReferencedBy=function(e,t){var n,r;return((null==e?void 0:null===(n=e.relationships)||void 0===n?void 0:null===(r=n.referenced_by)||void 0===r?void 0:r.data)||(null==e?void 0:e.referenced_by)||[]).filter(function(e){return e.type===t})};t.getReferencedById=function(e,t,n){var r,a;return((null==e?void 0:null===(r=e.relationships)||void 0===r?void 0:null===(a=r.referenced_by)||void 0===a?void 0:a.data)||(null==e?void 0:e.referenced_by)||[]).filter(function(e){return e.type===t&&e.id===n})}},30130:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"HasManyFiles",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"HasMany",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"HasOne",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"HasOneInPlace",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"HasManyInPlace",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"HasManyTriggers",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"Association",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"resolveClass",{enumerable:!0,get:function(){return d.resolveClass}}),Object.defineProperty(t,"create",{enumerable:!0,get:function(){return d.create}}),Object.defineProperty(t,"isReferencedBy",{enumerable:!0,get:function(){return d.isReferencedBy}}),Object.defineProperty(t,"isReferencedById",{enumerable:!0,get:function(){return d.isReferencedById}}),Object.defineProperty(t,"getReferencedBy",{enumerable:!0,get:function(){return d.getReferencedBy}}),Object.defineProperty(t,"getReferencedById",{enumerable:!0,get:function(){return d.getReferencedById}});var a=r(n(2501)),i=r(n(35702)),o=r(n(52727)),u=r(n(85731)),c=r(n(37828)),s=r(n(32740)),l=r(n(99658)),d=n(72887)},51245:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.authFunction=t.authenticateWithCordova=void 0;var i=a(n(68434)),o=a(n(82007)),u=n(71791),c=n(25976),s="undefined"!=typeof window?window:null,l=function(e){return new Promise(function(t,n){s.SafariViewController.show({url:e,transition:"curl"},function(e){"closed"===e.event&&n(Error(u.REGISTRATION_ABORT))},function(e){console.log("KO: "+e),n(Error(u.REGISTRATION_ABORT))});var r=s.handleOpenURL;s.handleOpenURL=function(e){s.SafariViewController.hide(),t(e),r&&(s.handleOpenURL=r)}})},d=function(e){return new Promise(function(t,n){var r=s.cordova.InAppBrowser.open(e,"_blank","clearcache=yes,zoom=no"),a=function(){r.removeEventListener("loadstart",i),r.removeEventListener("exit",o)},i=function(e){var n=e.url,i=/\?access_code=(.+)$/.test(n),o=/\?state=(.+)$/.test(n);(i||o)&&(t(n),a(),r.close())},o=function(){n(Error(u.REGISTRATION_ABORT)),a(),r.close()};r.addEventListener("loadstart",i),r.addEventListener("exit",o)})};var f=(r=(0,o.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=(0,c.isIOSApp)(),!e.t0){e.next=5;break}return e.next=4,(0,c.hasSafariPlugin)();case 4:e.t0=e.sent;case 5:if(!e.t0){e.next=9;break}return e.abrupt("return",l(t));case 9:if(!(0,c.hasInAppBrowserPlugin)()){e.next=13;break}return e.abrupt("return",d(t));case 13:return console.log(t),e.abrupt("return",new Promise(function(e){setTimeout(function(){e(prompt("Paste the url here:"))},5e3)}));case 15:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.authenticateWithCordova=f;t.authFunction=f},71791:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DOCTYPE_PERMISSIONS=t.DOCTYPE_FILES=t.REGISTRATION_ABORT=void 0;t.REGISTRATION_ABORT="REGISTRATION_ABORT";t.DOCTYPE_FILES="io.cozy.files";t.DOCTYPE_PERMISSIONS="io.cozy.permissions"},97682:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.APP_TYPE=void 0;t.APP_TYPE={KONNECTOR:"konnector",WEBAPP:"webapp"}},95460:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.clientContext=void 0;var a=n(67294);r(n(88477));var i=(0,a.createContext)({client:null,store:null});t.clientContext=i;t.default=i},48544:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.BulkEditError=void 0;var a=r(n(64512)),i=r(n(65105)),o=r(n(19723)),u=r(n(25665)),c=r(n(27952)),s=r(n(12323)),l=r(n(15500)),d=r(n(35905));function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=function(e){(0,u.default)(a,e);var t,n,r=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function a(e,t){var n;return(0,i.default)(this,a),(n=r.call(this,"Error while bulk saving")).name="BulkEditError",n.results=(0,d.default)(e,t,function(e,t){return p(p({},e),{},{doc:t})}),n}return(0,o.default)(a,[{key:"getUpdatedDocuments",value:function(){return this.results.filter(function(e){return e.ok}).map(function(e){return e.doc})}},{key:"getErrors",value:function(){return this.results.filter(function(e){return!e.ok})}}]),a}((0,l.default)(Error));t.BulkEditError=h},48550:function(e,t,n){var r,a,i,o=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.certifyFlagship=void 0;var u=o(n(68434)),c=o(n(82007));o(n(88477));var s=n(75763);var l=(r=(0,c.default)(u.default.mark(function e(t){var n,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.getStackClient(),e.next=4,n.fetchJSON("POST","/auth/clients/".concat(n.oauthOptions.clientID,"/challenge"),null,{headers:{Authorization:n.registrationAccessTokenToAuthHeader()}});case 4:return r=e.sent,e.abrupt("return",r.nonce);case 8:throw e.prev=8,e.t0=e.catch(0),Error("[FLAGSHIP_CERTIFICATION] Something went wrong while requesting a challenge from CozyStack:\n"+e.t0.message);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(e){return r.apply(this,arguments)});var d=(a=(0,c.default)(u.default.mark(function e(t,n,r){var a,i,o,c,s;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.platform,i=t.attestation,o=t.keyId,c=t.issuer,s=r.getStackClient(),e.next=5,s.fetchJSON("POST","/auth/clients/".concat(s.oauthOptions.clientID,"/attestation"),{platform:a,attestation:i,challenge:n,keyId:o,issuer:c},{headers:{Authorization:s.registrationAccessTokenToAuthHeader()}});case 5:e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),Error("[FLAGSHIP_CERTIFICATION] Something went wrong while giving attestation to CozyStack:\n"+e.t0.message);case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,t,n){return a.apply(this,arguments)});var f=(i=(0,c.default)(u.default.mark(function e(t,n){var r,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("[FLAGSHIP_CERTIFICATION] Certification configuration is not set");case 2:return e.prev=2,e.next=5,l(n);case 5:return r=e.sent,e.next=8,(0,s.getAppAttestationFromStore)(r,t);case 8:return a=e.sent,e.next=11,d(a,r,n);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.warn('[FLAGSHIP_CERTIFICATION] Automatic certification for URI "'.concat(n.stackClient.uri,'" failed. This is expected on dev environments and non-official phones. Cozy-stack will continue with manual certification through 2FA')),console.warn(e.t0.message);case 17:case"end":return e.stop()}},e,null,[[2,13]])})),function(e,t){return i.apply(this,arguments)});t.certifyFlagship=f},75763:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getAppAttestationFromStore=void 0;var i=a(n(68434)),o=a(n(82007));var u=(r=(0,o.default)(i.default.mark(function e(t,n){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("getAppAttestationFromStore can only be called from a React Native container");case 1:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.getAppAttestationFromStore=u},64831:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.dehydrate=void 0;var a=r(n(90402)),i=n(30130);t.dehydrate=function(e){return Object.entries(e).reduce(function(e,t){var n=(0,a.default)(t,2),r=n[0],o=n[1],u=e;if(o instanceof i.Association){if(o.dehydrate)u=o.dehydrate(u);else throw Error("Association on key ".concat(r," should have a dehydrate method"))}else u[r]=o;return u},{})}},64157:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"deconstructCozyWebLinkWithSlug",{enumerable:!0,get:function(){return r.deconstructCozyWebLinkWithSlug}}),Object.defineProperty(t,"deconstructRedirectLink",{enumerable:!0,get:function(){return r.deconstructRedirectLink}}),Object.defineProperty(t,"generateWebLink",{enumerable:!0,get:function(){return r.generateWebLink}}),Object.defineProperty(t,"ensureFirstSlash",{enumerable:!0,get:function(){return r.ensureFirstSlash}}),Object.defineProperty(t,"rootCozyUrl",{enumerable:!0,get:function(){return r.rootCozyUrl}}),Object.defineProperty(t,"InvalidRedirectLinkError",{enumerable:!0,get:function(){return r.InvalidRedirectLinkError}}),Object.defineProperty(t,"InvalidCozyUrlError",{enumerable:!0,get:function(){return r.InvalidCozyUrlError}}),Object.defineProperty(t,"InvalidProtocolError",{enumerable:!0,get:function(){return r.InvalidProtocolError}}),Object.defineProperty(t,"BlockedCozyError",{enumerable:!0,get:function(){return r.BlockedCozyError}}),Object.defineProperty(t,"dehydrate",{enumerable:!0,get:function(){return a.dehydrate}}),Object.defineProperty(t,"editSettings",{enumerable:!0,get:function(){return i.editSettings}}),Object.defineProperty(t,"getQuery",{enumerable:!0,get:function(){return i.getQuery}}),Object.defineProperty(t,"getSettings",{enumerable:!0,get:function(){return i.getSettings}}),Object.defineProperty(t,"normalizeSettings",{enumerable:!0,get:function(){return i.normalizeSettings}}),Object.defineProperty(t,"saveAfterFetchSettings",{enumerable:!0,get:function(){return i.saveAfterFetchSettings}});var r=n(40902),a=n(64831),i=n(55463)},90688:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.ensureFilePath=void 0;var i=a(n(68434)),o=a(n(64512)),u=a(n(82007)),c=n(87549),s=a(n(88477));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var d=function(e){return{definition:function(){return(0,c.Q)("io.cozy.files").getById(e)},options:{as:"io.cozy.files/".concat(e),singleDocData:!0,fetchPolicy:s.default.fetchPolicies.olderThan(3e4)}}};var f=(r=(0,u.default)(i.default.mark(function e(t){var n,r,a,u,c=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:{},!t.path){e.next=3;break}return e.abrupt("return",t);case 3:return r=d(t.dir_id),e.next=6,n.client.fetchQueryAndGetFromState({definition:r.definition(),options:r.options});case 6:if(!(!(a=e.sent).data||!a.data.path)){e.next=9;break}throw Error("Could not define a file path for ".concat(t._id||t.id));case 9:return u=a.data.path+"/"+t.name,e.abrupt("return",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({path:u},t));case 11:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.ensureFilePath=f},55463:function(e,t,n){var r,a,i=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getQuery=t.extractKeys=t.editSettings=t.normalizeSettings=t.saveAfterFetchSettings=t.getSettings=void 0;var o=i(n(90402)),u=i(n(64512)),c=i(n(68434)),s=i(n(82007));i(n(88477));var l=i(n(83549)),d=n(87549);function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=l.default.olderThan(36e5);var v=(r=(0,s.default)(c.default.mark(function e(t,n,r){var a,i;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=w(n),e.next=3,t.fetchQueryAndGetFromState({definition:a.definition,options:a.options});case 3:return i=b(e.sent.data),e.abrupt("return",O(i,r));case 6:case"end":return e.stop()}},e)})),function(e,t,n){return r.apply(this,arguments)});t.getSettings=v;var m=(a=(0,s.default)(c.default.mark(function e(t,n,r,a){var i,o,u,s;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=w(n),e.next=3,t.fetchQueryAndGetFromState({definition:i.definition,options:i.options});case 3:return o=b(e.sent.data),u=void 0,u="function"==typeof r?r(O(o,a)):h(h({},O(o,Object.keys(r))),r),s=g(n,o,u),e.next=10,t.save(s);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e)})),function(e,t,n,r){return a.apply(this,arguments)});t.saveAfterFetchSettings=m;var b=function(e){return(Array.isArray(e)?e[0]:e)||{}};t.normalizeSettings=b;var g=function(e,t,n){var r=E(e);return"instance"===e?k(t,n):_(t,r,n)};t.editSettings=g;var k=function(e,t){for(var n=h(h({_id:e._id,_type:e._type,_rev:e.meta.rev},e),{},{attributes:h({},e.attributes)}),r=0,a=Object.entries(t);r<a.length;r++){var i=(0,o.default)(a[r],2),u=i[0],c=i[1];n[u]=c,n.attributes[u]=c}return n},_=function(e,t,n){for(var r=h({_type:t},e),a=0,i=Object.entries(n);a<i.length;a++){var u=(0,o.default)(i[a],2),c=u[0],s=u[1];r[c]=s}return r},O=function(e,t){var n={},r,a=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;n[i]=e[i]}}catch(e){a.e(e)}finally{a.f()}return n};t.extractKeys=O;var w=function(e){return"instance"===e?x(e):"passwords"===e?x("bitwarden"):S(e)};t.getQuery=w;var S=function(e){var t=E(e);return{definition:(0,d.Q)(t).limitBy(1),options:{as:t,fetchPolicy:y,singleDocData:!0}}},x=function(e){var t="io.cozy.settings",n=E(e);return{definition:(0,d.Q)(t).getById(n),options:{as:"".concat(t,"/").concat(n),fetchPolicy:y,singleDocData:!0}}},E=function(e){return["instance","bitwarden"].includes(e)?"io.cozy.settings.".concat(e):"passwords"===e?"io.cozy.settings.bitwarden":"io.cozy.".concat(e,".settings")}},40902:function(e,t,n){var r,a,i,o=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.rootCozyUrl=t.InvalidCozyUrlError=t.BlockedCozyError=t.InvalidProtocolError=t.InvalidRedirectLinkError=t.deconstructRedirectLink=t.deconstructCozyWebLinkWithSlug=t.generateWebLink=t.ensureFirstSlash=void 0;var u=o(n(98235)),c=o(n(54765)),s=o(n(68434)),l=o(n(82007)),d=o(n(65105)),f=o(n(25665)),p=o(n(27952)),h=o(n(12323)),y=o(n(15500)),v=o(n(90402));function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=(0,h.default)(e);return n=t?Reflect.construct(r,arguments,(0,h.default)(this).constructor):r.apply(this,arguments),(0,p.default)(this,n)}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var g=function(e){return e?e.startsWith("/")?e:"/"+e:"/"};t.ensureFirstSlash=g;t.generateWebLink=function(e){var t=e.cozyUrl,n=e.searchParams,r=e.pathname,a=e.hash,i=e.slug,o=e.subDomainType,u=new URL(t);u.host="nested"===o?"".concat(i,".").concat(u.host):u.host.split(".").map(function(e,t){return 0===t?e+"-"+i:e}).join("."),u.pathname=g(r),u.hash=g(a);var c,s=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(n||[]);try{for(s.s();!(c=s.n()).done;){var l=(0,v.default)(c.value,2),d=l[0],f=l[1];u.searchParams.set(d,f)}}catch(e){s.e(e)}finally{s.f()}return u.toString()};t.deconstructCozyWebLinkWithSlug=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat",n=new URL(e),r="nested"===t?n.host.split(".")[0]:n.host.split(".")[0].split("-")[1],a="nested"===t?n.host.split(".")[1]:n.host.split(".")[0].split("-")[0];return{cozyBaseDomain:n.host.split(".").slice("nested"===t?2:1).join("."),cozyName:a,pathname:n.pathname,hash:n.hash,protocol:n.protocol,searchParams:n.searchParams.toString(),slug:r}};t.deconstructRedirectLink=function(e){var t=e.split("#"),n=(0,v.default)(t,2),r=n[0],a=n[1],i=r.split(/\/(.*)/),o=(0,v.default)(i,2),u=o[0],c=o[1];if(!u.match(/^[a-z0-9]+$/))throw new k(e);return{slug:u,pathname:c,hash:a}};var k=function(e){(0,f.default)(n,e);var t=m(n);function n(e){var r;return(0,d.default)(this,n),(r=t.call(this,"Invalid redirect link ".concat(e))).redirectLink=e,r}return n}((0,y.default)(Error));t.InvalidRedirectLinkError=k;var _=function(e){(0,f.default)(n,e);var t=m(n);function n(e){var r;return(0,d.default)(this,n),(r=t.call(this,"Invalid URL protocol ".concat(e.protocol))).url=e,r}return n}((0,y.default)(Error));t.InvalidProtocolError=_;var O=function(e){(0,f.default)(n,e);var t=m(n);function n(e){var r;return(0,d.default)(this,n),(r=t.call(this,"Blocked cozy ".concat(e.toString()))).url=e,r}return n}((0,y.default)(Error));t.BlockedCozyError=O;var w=function(e){(0,f.default)(n,e);var t=m(n);function n(e){var r;return(0,d.default)(this,n),(r=t.call(this,"URL ".concat(e.toString()," does not seem to be a valid Cozy URL"))).url=e,r}return n}((0,y.default)(Error));t.InvalidCozyUrlError=w;var S=function(e){var t=e.protocol,n=e.hostname,r=e.port;return(""!==t?"".concat(t,"//"):"https://")+n+(""!==r?":".concat(r):"")};var x=(r=(0,l.default)(s.default.mark(function e(t){var n,r,a,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(S(t)+"/.well-known/change-password");case 2:if(r=(n=e.sent).status,a=n.url,404!==r){e.next=6;break}throw new w(t);case 6:return e.next=8,P(n);case 8:if(!e.sent){e.next=10;break}throw new O(t);case 10:return i=t.origin!==new URL(a).origin,e.abrupt("return",200===r&&!i);case 12:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});var E=(a=(0,l.default)(s.default.mark(function e(t){var n,r,a,i,o,l,d,f;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(["http:","https:"].includes(t.protocol)){e.next=2;break}throw new _(t);case 2:return e.next=4,x(t);case 4:if(!e.sent){e.next=6;break}return e.abrupt("return",new URL(S({protocol:t.protocol,hostname:t.hostname,port:t.port})));case 6:if(!/^[^.-][^.]+-[^.-]+\./.test(t.hostname)){e.next=14;break}return n=t.hostname.split("."),a=(r=(0,c.default)(n))[0],i=r.slice(1),o=[a.replace(/-.+/,"")].concat((0,u.default)(i)).join("."),l=new URL(S({protocol:t.protocol,hostname:o,port:t.port})),e.next=12,x(l);case 12:if(!e.sent){e.next=14;break}return e.abrupt("return",l);case 14:return d=t.hostname.split(".").splice(1).join("."),f=new URL(S({protocol:t.protocol,hostname:d,port:t.port})),e.next=18,x(f);case 18:if(!e.sent){e.next=20;break}return e.abrupt("return",f);case 20:throw new w(t);case 21:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)});t.rootCozyUrl=E;var P=(i=(0,l.default)(s.default.mark(function e(t){var n,r,a,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(503!==t.status)){e.next=2;break}return e.abrupt("return",!1);case 2:return a=(r=t.headers.get("content-type"))&&r.indexOf("json")>=0,e.next=6,a?t.json():t.text();case 6:if(!(null!=(i=e.sent)&&null!==(n=i.some)&&void 0!==n&&n.call(i,function(e){return"Blocked"===e.title}))){e.next=9;break}return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)})},81656:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.queryConnectFlat=t.queryConnect=t.withClient=void 0;var i=a(n(64512)),o=a(n(95297)),u=r(n(67294)),c=a(n(45697)),s=a(n(47745)),l=a(n(63890)),d=a(n(2705)),f=n(70),p=a(n(81602));function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}t.withClient=function(e){var t=function(t){var n=(0,d.default)();return u.default.createElement(e,(0,o.default)({},t,{client:n}))};return t.displayName="withClient(".concat(e.displayName||e.name,")"),t};var v=function(e,t,n){if(!t)throw Error("withQuery has no options for ".concat(e," (wrapping ").concat(n.name,")"));return function(n){var r=function(r,a){if(!a.client)throw Error("Should be used with client in context (use CozyProvider to set context)");var o="function"==typeof t?t(r):t;return t.doc?(p.default.warn("queryOpts.doc is deprecated"),u.default.createElement(n,y((0,i.default)({},e,o.doc),r))):u.default.createElement(l.default,o,function(t){return u.default.createElement(n,y((0,i.default)({},e,t),r))})};return r.contextTypes={client:c.default.object},r.displayName="withQuery(".concat(n.displayName||n.name,")"),r}};t.queryConnect=function(e){return function(t){var n=Object.keys(e).map(function(n){return v(n,e[n],t)});return s.default.apply(null,n)(t)}};t.queryConnectFlat=function(e){return function(t){var n=function(n){var r=(0,f.useQueries)(e);return u.default.createElement(t,(0,o.default)({},n,r))};return n.displayName="queryConnectFlat(".concat(t.displayName||t.name,")"),n}}},94615:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(67294);t.default=function(){var e=(0,r.useRef)();return(0,r.useEffect)(function(){return e.current=!0,function(){e.current=!1}},[]),e}},20842:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(90402)),i=n(67294),o=r(n(94615));t.default=function(e){var t=(0,o.default)(),n=(0,i.useState)(e),r=(0,a.default)(n,2),u=r[0],c=r[1];return[u,(0,i.useCallback)(function(e){t.current&&c(e)},[])]}},92534:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useAppLinkWithStoreFallback",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"useCapabilities",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"useFetchShortcut",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"useClient",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"useQuery",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"useQueries",{enumerable:!0,get:function(){return s.useQueries}}),Object.defineProperty(t,"useAppsInMaintenance",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"useQueryAll",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"useMutation",{enumerable:!0,get:function(){return f.useMutation}}),Object.defineProperty(t,"useInstanceInfo",{enumerable:!0,get:function(){return p.useInstanceInfo}}),Object.defineProperty(t,"useSettings",{enumerable:!0,get:function(){return h.useSettings}});var i=a(n(26469)),o=a(n(41692)),u=a(n(61814)),c=a(n(2705)),s=r(n(70)),l=a(n(9810)),d=a(n(92797)),f=n(13554),p=n(13975),h=n(33756)},26469:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(90402)),u=n(67294),c=n(87549),s=n(13114);t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=(0,u.useState)("loading"),l=(0,o.default)(r,2),d=l[0],f=l[1],p=(0,u.useState)(!0),h=(0,o.default)(p,2),y=h[0],v=h[1],m=(0,u.useState)(null),b=(0,o.default)(m,2),g=b[0],k=b[1];return(0,u.useEffect)(function(){var r;(r=(0,i.default)(a.default.mark(function r(){var i,o,u;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.query((0,c.Q)("io.cozy.apps"));case 3:i=r.sent,o={slug:e},v(!!(u=(0,s.isInstalled)(i.data,o))),u?k((0,s.getUrl)(u)+n):k((0,s.getStoreURL)(i.data,o)),f("loaded"),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(0),f("errored");case 14:case"end":return r.stop()}},r,null,[[0,11]])})),function(){return r.apply(this,arguments)})()},[t,e,n]),{fetchStatus:d,isInstalled:y,url:g}}},9810:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(70)),i=n(87549),o=r(n(88477));t.default=function(){return(0,a.default)((0,i.Q)("io.cozy.apps_registry").getById("maintenance"),{as:"io.cozy.apps_registry/maintenance",fetchPolicy:o.default.fetchPolicies.olderThan(6e5),singleDocData:!1}).data||[]}},41692:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(90402)),u=n(67294),c=r(n(27361)),s=n(87549);t.default=function(e){var t=(0,u.useState)(),n=(0,o.default)(t,2),r=n[0],l=n[1],d=(0,u.useState)("idle"),f=(0,o.default)(d,2),p=f[0],h=f[1];return(0,u.useEffect)(function(){var t,n=(t=(0,i.default)(a.default.mark(function t(){var n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h("loading"),t.prev=1,t.next=4,e.query((0,s.Q)("io.cozy.settings").getById("io.cozy.settings.capabilities"));case 4:n=t.sent,l((0,c.default)(n,"data",{})),h("loaded"),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),h("failed");case 12:case"end":return t.stop()}},t,null,[[1,9]])})),function(){return t.apply(this,arguments)});e.capabilities?(l(e.capabilities),h("loaded")):n()},[e]),{capabilities:r,fetchStatus:p}}},2705:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(67294),i=r(n(95460));r(n(88477));t.default=function(){return(0,a.useContext)(i.default).client}},61814:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(90402)),u=n(67294),c=n(87549),s=r(n(88477));t.default=function(e,t){var n=(0,u.useState)(null),r=(0,o.default)(n,2),l=r[0],d=r[1],f=(0,u.useState)(null),p=(0,o.default)(f,2),h=p[0],y=p[1],v=(0,u.useState)("idle"),m=(0,o.default)(v,2),b=m[0],g=m[1];return(0,u.useEffect)(function(){var n;(n=(0,i.default)(a.default.mark(function n(){var r,i,o,u,l,f;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return g("loading"),n.prev=1,n.next=4,e.fetchQueryAndGetFromState({definition:(0,c.Q)("io.cozy.files.shortcuts").getById(t),options:{as:"io.cozy.files.shortcuts/".concat(t),fetchPolicy:s.default.fetchPolicies.olderThan(6e5),singleDocData:!0}});case 4:if(!(l=null==(u=n.sent)?void 0:null===(r=u.data)||void 0===r?void 0:null===(i=r.metadata)||void 0===i?void 0:null===(o=i.target)||void 0===o?void 0:o.app)){n.next=13;break}return n.next=9,e.getStackClient().getIconURL({type:"app",slug:l,priority:"stack"});case 9:y(n.sent),n.next=16;break;case 13:f=new URL(u.data.url),y("".concat(e.getStackClient().uri,"/bitwarden/icons/").concat(f.host,"/icon.png"));case 16:d({data:u.data}),g("loaded"),n.next=23;break;case 20:n.prev=20,n.t0=n.catch(1),g("failed");case 23:case"end":return n.stop()}},n,null,[[1,20]])})),function(){return n.apply(this,arguments)})()},[e,t]),{shortcutInfos:l,shortcutImg:h,fetchStatus:b}}},13975:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.useInstanceInfo=void 0;var a=r(n(70)),i=r(n(88477)),o=n(87549),u=n(64374);t.useInstanceInfo=function(){var e=c("io.cozy.settings.instance"),t=(0,a.default)(e.definition,e.options),n=c("io.cozy.settings.context"),r=(0,a.default)(n.definition,n.options),i=c("io.cozy.settings.disk-usage"),o=(0,a.default)(i.definition,i.options);return{isLoaded:null!==(0,u.hasQueryBeenLoaded)(t)&&null!==(0,u.hasQueryBeenLoaded)(r)&&null!==(0,u.hasQueryBeenLoaded)(o),instance:{data:t.data},context:{data:r.data},diskUsage:{data:o.data}}};var c=function(e){return{definition:(0,o.Q)("io.cozy.settings").getById(e),options:{as:"io.cozy.settings/".concat(e),fetchPolicy:i.default.fetchPolicies.olderThan(54e4),singleDocData:!0}}}},13554:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.useMutation=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(90402)),u=n(67294),c=r(n(45697)),s=r(n(2705)),l=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.onSuccess,r=void 0===n?void 0:n,c=t.onError,l=void 0===c?void 0:c,d=(0,s.default)(),f=(0,u.useState)("pending"),p=(0,o.default)(f,2),h=p[0],y=p[1],v=(0,u.useState)(),m=(0,o.default)(v,2),b=m[0],g=m[1],k=(0,u.useState)(),_=(0,o.default)(k,2),O=_[0],w=_[1];return{mutate:(0,u.useCallback)((e=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g(void 0),y("loading"),e.prev=2,e.next=5,d.save(t);case 5:if(w((n=e.sent).data),"function"!=typeof r){e.next=10;break}return e.next=10,r(n.data);case 10:y("loaded"),e.next=20;break;case 13:if(e.prev=13,e.t0=e.catch(2),y("failed"),g(e.t0),"function"!=typeof l){e.next=20;break}return e.next=20,l(e.t0);case 20:case"end":return e.stop()}},e,null,[[2,13]])})),function(t){return e.apply(this,arguments)}),[d,l,r]),mutationStatus:h,error:b,data:O}};t.useMutation=l,l.propTypes={onSuccess:c.default.func,onError:c.default.func}},70:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.useQueries=void 0;var a=r(n(90402)),i=r(n(64512)),o=n(67294),u=n(70471),c=r(n(27361)),s=r(n(2705)),l=r(n(81602)),d=n(95460);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n(87549);var h=(0,u.createSelectorHook)(d.clientContext),y=function(e,t){if(!h)throw Error("You must use react-redux > 7.1.0 to use useQuery (uses useSelector) under the hood");if(!e)throw l.default.warn("Bad query",e),Error("Bad query");var n,r=t.as,a=t.enabled,i=void 0===a||a;var u=i?"function"==typeof(n=e)?n():n:null;if(!r)throw Error("You must specify options.as when using useQuery");var d=(0,s.default)(),f=h(function(){return void 0===t.singleDocData&&null!=u&&u.id&&l.default.warn("useQuery options.singleDocData will pass to true in a next version of cozy-client, please add it now to prevent any problem in the future."),d.getQueryFromState(r,{hydrated:(0,c.default)(t,"hydrated",!0),singleDocData:(0,c.default)(t,"singleDocData",!1)})});(0,o.useEffect)(function(){if(!1!==i)d.query(u,t)},[r,i]);var y=(0,o.useCallback)(function(){var e,t=d.getQueryFromState(r);return d.query((e=t).bookmark?e.definition.offsetBookmark(e.bookmark):e.definition.offset(e.data.length),{as:r})},[r,d]),v=(0,o.useCallback)(function(){return d.query(u,t)},[d,u,t]);return p(p({},f),{},{fetchMore:y,fetch:v})};t.useQueries=function(e){for(var t={},n=0,r=Object.entries(e);n<r.length;n++){var i=(0,a.default)(r[n],2),o=i[0],u=i[1];t[o]=y(u.query,u)}return t};t.default=y},92797:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(90402)),u=n(67294);n(87549);var c=r(n(70)),s=r(n(20842));t.default=function(e,t){var n=(0,s.default)(!1),r=(0,o.default)(n,2),l=r[0],d=r[1],f=(0,c.default)(e,t);return(0,u.useEffect)(function(){var e;(e=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("loaded"===f.fetchStatus&&f.hasMore&&!l)){e.next=5;break}return d(!0),e.next=4,f.fetchMore();case 4:d(!1);case 5:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})()},[f.hasMore,f.fetchStatus,l]),f}},33756:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.useSettings=void 0;var a=r(n(80295)),i=n(67294),o=n(64157),u=n(13554),c=r(n(70)),s=n(64374),l=n(55463);t.useSettings=function(e,t){var n=(0,o.getQuery)(e),r=(0,c.default)(n.definition,n.options),d=r.data,f=(0,a.default)(r,["data"]),p=(0,u.useMutation)(),h=p.mutate,y=(0,a.default)(p,["mutate"]),v=(0,i.useCallback)(function(t){var n=(0,o.normalizeSettings)(d);return h((0,o.editSettings)(e,n,t))},[h,d,e]),m=(0,o.normalizeSettings)(d),b=(0,s.hasQueryBeenLoaded)(f)?(0,l.extractKeys)(m,t):void 0;return{query:f,values:b,save:v,mutation:y}}},206:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0});var i={CozyLink:!0,StackLink:!0,WebFlagshipLink:!0,compose:!0,QueryDefinition:!0,Q:!0,Mutations:!0,MutationTypes:!0,getDoctypeFromOperation:!0,Association:!0,HasMany:!0,HasOne:!0,HasOneInPlace:!0,HasManyInPlace:!0,HasManyTriggers:!0,isReferencedBy:!0,isReferencedById:!0,getReferencedBy:!0,getReferencedById:!0,deconstructCozyWebLinkWithSlug:!0,deconstructRedirectLink:!0,dehydrate:!0,generateWebLink:!0,ensureFirstSlash:!0,rootCozyUrl:!0,InvalidRedirectLinkError:!0,InvalidCozyUrlError:!0,InvalidProtocolError:!0,BlockedCozyError:!0,cancelable:!0,isQueryLoading:!0,hasQueryBeenLoaded:!0,isQueriesLoading:!0,hasQueriesBeenLoaded:!0,getQueryFromState:!0,dispatchCreate:!0,dispatchUpdate:!0,dispatchDelete:!0,Registry:!0,RealTimeQueries:!0,manifest:!0,CozyProvider:!0,withMutation:!0,withMutations:!0,Query:!0,queryConnect:!0,queryConnectFlat:!0,withClient:!0,models:!0,fetchPolicies:!0,BulkEditError:!0};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"CozyLink",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"StackLink",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"WebFlagshipLink",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"compose",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"QueryDefinition",{enumerable:!0,get:function(){return d.QueryDefinition}}),Object.defineProperty(t,"Q",{enumerable:!0,get:function(){return d.Q}}),Object.defineProperty(t,"Mutations",{enumerable:!0,get:function(){return d.Mutations}}),Object.defineProperty(t,"MutationTypes",{enumerable:!0,get:function(){return d.MutationTypes}}),Object.defineProperty(t,"getDoctypeFromOperation",{enumerable:!0,get:function(){return d.getDoctypeFromOperation}}),Object.defineProperty(t,"Association",{enumerable:!0,get:function(){return f.Association}}),Object.defineProperty(t,"HasMany",{enumerable:!0,get:function(){return f.HasMany}}),Object.defineProperty(t,"HasOne",{enumerable:!0,get:function(){return f.HasOne}}),Object.defineProperty(t,"HasOneInPlace",{enumerable:!0,get:function(){return f.HasOneInPlace}}),Object.defineProperty(t,"HasManyInPlace",{enumerable:!0,get:function(){return f.HasManyInPlace}}),Object.defineProperty(t,"HasManyTriggers",{enumerable:!0,get:function(){return f.HasManyTriggers}}),Object.defineProperty(t,"isReferencedBy",{enumerable:!0,get:function(){return p.isReferencedBy}}),Object.defineProperty(t,"isReferencedById",{enumerable:!0,get:function(){return p.isReferencedById}}),Object.defineProperty(t,"getReferencedBy",{enumerable:!0,get:function(){return p.getReferencedBy}}),Object.defineProperty(t,"getReferencedById",{enumerable:!0,get:function(){return p.getReferencedById}}),Object.defineProperty(t,"deconstructCozyWebLinkWithSlug",{enumerable:!0,get:function(){return h.deconstructCozyWebLinkWithSlug}}),Object.defineProperty(t,"deconstructRedirectLink",{enumerable:!0,get:function(){return h.deconstructRedirectLink}}),Object.defineProperty(t,"dehydrate",{enumerable:!0,get:function(){return h.dehydrate}}),Object.defineProperty(t,"generateWebLink",{enumerable:!0,get:function(){return h.generateWebLink}}),Object.defineProperty(t,"ensureFirstSlash",{enumerable:!0,get:function(){return h.ensureFirstSlash}}),Object.defineProperty(t,"rootCozyUrl",{enumerable:!0,get:function(){return h.rootCozyUrl}}),Object.defineProperty(t,"InvalidRedirectLinkError",{enumerable:!0,get:function(){return h.InvalidRedirectLinkError}}),Object.defineProperty(t,"InvalidCozyUrlError",{enumerable:!0,get:function(){return h.InvalidCozyUrlError}}),Object.defineProperty(t,"InvalidProtocolError",{enumerable:!0,get:function(){return h.InvalidProtocolError}}),Object.defineProperty(t,"BlockedCozyError",{enumerable:!0,get:function(){return h.BlockedCozyError}}),Object.defineProperty(t,"cancelable",{enumerable:!0,get:function(){return y.cancelable}}),Object.defineProperty(t,"isQueryLoading",{enumerable:!0,get:function(){return y.isQueryLoading}}),Object.defineProperty(t,"hasQueryBeenLoaded",{enumerable:!0,get:function(){return y.hasQueryBeenLoaded}}),Object.defineProperty(t,"isQueriesLoading",{enumerable:!0,get:function(){return y.isQueriesLoading}}),Object.defineProperty(t,"hasQueriesBeenLoaded",{enumerable:!0,get:function(){return y.hasQueriesBeenLoaded}}),Object.defineProperty(t,"getQueryFromState",{enumerable:!0,get:function(){return v.getQueryFromState}}),Object.defineProperty(t,"dispatchCreate",{enumerable:!0,get:function(){return v.dispatchCreate}}),Object.defineProperty(t,"dispatchUpdate",{enumerable:!0,get:function(){return v.dispatchUpdate}}),Object.defineProperty(t,"dispatchDelete",{enumerable:!0,get:function(){return v.dispatchDelete}}),Object.defineProperty(t,"Registry",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"RealTimeQueries",{enumerable:!0,get:function(){return b.default}}),Object.defineProperty(t,"CozyProvider",{enumerable:!0,get:function(){return k.default}}),Object.defineProperty(t,"withMutation",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"withMutations",{enumerable:!0,get:function(){return O.default}}),Object.defineProperty(t,"Query",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(t,"queryConnect",{enumerable:!0,get:function(){return S.queryConnect}}),Object.defineProperty(t,"queryConnectFlat",{enumerable:!0,get:function(){return S.queryConnectFlat}}),Object.defineProperty(t,"withClient",{enumerable:!0,get:function(){return S.withClient}}),Object.defineProperty(t,"fetchPolicies",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(t,"BulkEditError",{enumerable:!0,get:function(){return D.BulkEditError}}),t.models=t.manifest=void 0;var o=a(n(88477)),u=a(n(6505)),c=a(n(13945)),s=a(n(97491)),l=a(n(59242)),d=n(87549),f=n(30130),p=n(72887),h=n(64157),y=n(64374),v=n(72662),m=a(n(74165)),b=a(n(12887)),g=r(n(1423));t.manifest=g;var k=a(n(57244)),_=a(n(96310)),O=a(n(84170)),w=a(n(63890)),S=n(81656),x=r(n(66225));t.models=x;var E=a(n(83549)),P=n(58762);Object.keys(P).forEach(function(e){if(!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(i,e)))(!(e in t)||t[e]!==P[e])&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return P[e]}})});var C=n(92534);Object.keys(C).forEach(function(e){if(!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(i,e)))(!(e in t)||t[e]!==C[e])&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}})});var D=n(48544)},81602:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(60732)),i=(0,a.default)("cozy-client");a.default.suggest.deny("cozy-client","info");t.default=i},58762:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.createFakeClient=t.createMockClient=void 0;var a=r(n(90402)),i=r(n(68434)),o=r(n(82007)),u=r(n(64512)),c=r(n(80295)),s=r(n(82492)),l=r(n(88477)),d=n(72662),f=n(2779),p=n(87549);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var y=function(e,t,n){var r=n.definition,a=n.doctype,i=n.data,o=n.queryError,s=(0,c.default)(n,["definition","doctype","data","queryError"]);e.store.dispatch((0,d.initQuery)(t,r||(0,p.Q)(a))),o?e.store.dispatch((0,d.receiveQueryError)(t,o)):e.store.dispatch((0,d.receiveQueryResult)(t,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({data:i?i.map(function(e){return(0,f.normalizeDoc)(e,a)}):i},s)))},v=function(e){var t;return t=(0,o.default)(i.default.mark(function t(n){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",{data:null});case 2:if(!e[n.doctype]){t.next=6;break}return t.abrupt("return",{data:e[n.doctype]});case 6:return t.abrupt("return",{data:[]});case 7:case"end":return t.stop()}},t)})),function(e){return t.apply(this,arguments)}};t.createMockClient=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.queries,n=e.remote,r=e.clientOptions,a=e.clientFunctions,i=jest.fn().mockImplementation(v(n));return m({queries:t,remote:n,clientOptions:r,clientFunctions:(0,s.default)({query:i,save:jest.fn(),saveAll:jest.fn(),stackClient:{fetchJSON:jest.fn()}},a)})};var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.queries,n=e.remote,r=e.clientOptions,i=e.clientFunctions,o=new l.default(r||{});o.ensureStore();for(var u=0,c=Object.entries(t||{});u<c.length;u++){var d=(0,a.default)(c[u],2);y(o,d[0],d[1])}return o.query=v(n),(0,s.default)(o,i),o};t.createFakeClient=m},47980:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isAccountWithTrigger=t.buildAccount=t.getAccountName=t.getAccountLogin=t.setContractSyncStatusInAccount=t.getContractSyncStatusFromAccount=t.muteError=t.getMutedErrors=void 0;var i=a(n(68434)),o=a(n(82007)),u=a(n(64512)),c=a(n(82492)),s=n(87549),l=n(35702),d=n(1423);function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=function(e){return(null==e?void 0:e.mutedErrors)||[]};t.getMutedErrors=y;t.muteError=function(e,t){var n=y(e);return n.push({type:t,mutedAt:new Date().toISOString()}),h(h({},e),{},{mutedErrors:n})};t.getContractSyncStatusFromAccount=function(e,t){var n,r,a=(0,l.getHasManyItem)(e,"contracts",t);if(!a)throw Error("Cannot find contrat ".concat(t," in account"));return null===(n=null==a?void 0:null===(r=a.metadata)||void 0===r?void 0:r.imported)||void 0===n||n};t.setContractSyncStatusInAccount=function(e,t,n){return(0,l.updateHasManyItem)(e,"contracts",t,function(e){if(void 0===e)throw Error("Cannot find contrat ".concat(t," in account"));return(0,c.default)({},e,{metadata:{imported:n}})})};var v=function(e){if(e.identifier)return e.auth[e.identifier];if(e&&e.auth){var t,n=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(d.legacyLoginFields);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e.auth[r])return e.auth[r]}}catch(e){n.e(e)}finally{n.f()}}return null};t.getAccountLogin=v;t.getAccountName=function(e){return e?e.auth&&(e.auth.accountName||v(e))||e._id:null};t.buildAccount=function(e,t){return{auth:t,account_type:e.slug,identifier:(0,d.getIdentifier)(e.fields),state:null}};var m=(r=(0,o.default)(i.default.mark(function e(t,n){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query((0,s.Q)("io.cozy.triggers").where({"message.account":n._id}).indexFields(["message.account"]).limitBy(1));case 2:return r=e.sent,e.abrupt("return",r.data.length>0);case 4:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.isAccountWithTrigger=m},13114:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getAppDisplayName=t.getUrl=t.isInstalled=t.getStoreInstallationURL=t.getStoreURL=void 0;var a=r(n(27361)),i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.slug)throw Error("Expected app / konnector with the defined slug");var n=o(e,{slug:"store"});if(!n)return null;var r=n.links&&n.links.related;return r?"".concat(r,"#/discover/").concat(t.slug):null};t.getStoreURL=i;t.getStoreInstallationURL=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i(e,t);return n?"".concat(n,"/install"):null};var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.find(function(e){return e.slug===t.slug})};t.isInstalled=o;t.getUrl=function(e){return e.links&&e.links.related};t.getAppDisplayName=function(e,t){var n=(0,a.default)(e,"name_prefix"),r=(0,a.default)(e,"name"),i=(0,a.default)(e,["locales",t,"name"],r),o=(0,a.default)(e,["locales",t,"name_prefix"],n);return o&&"cozy"!==o.toLowerCase()?"".concat(o," ").concat(i):i}},60841:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.hasExtensionInstalledAttribute=void 0;var i=a(n(68434)),o=a(n(82007)),u=n(87549);var c=(r=(0,o.default)(i.default.mark(function e(t){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetchQueryAndGetFromState({definition:(0,u.Q)("io.cozy.settings").getById("io.cozy.settings.bitwarden"),options:{as:"io.cozy.settings/io.cozy.settings.bitwarden",singleDocData:!0}});case 3:return n=e.sent.data.extension_installed,e.abrupt("return",!!n);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",!1);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(e){return r.apply(this,arguments)});t.hasExtensionInstalledAttribute=c},50300:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isMagicLink=t.isOIDC=void 0;t.isOIDC=function(e){var t;return null!==(t=e.capabilities.can_auth_with_oidc)&&void 0!==t&&t};t.isMagicLink=function(e){var t;return null!==(t=e.capabilities.can_auth_with_magic_links)&&void 0!==t&&t}},63892:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isContact=t.getIndexByFamilyNameGivenNameEmailCozyUrl=t.getDefaultSortIndexValue=t.makeDefaultSortIndexValue=t.getDisplayName=t.makeDisplayName=t.getFullname=t.makeFullname=t.getPrimaryAddress=t.getPrimaryPhone=t.getPrimaryCozyDomain=t.getPrimaryCozy=t.getPrimaryEmail=t.getInitials=t.getPrimaryOrFirst=t.CONTACTS_DOCTYPE=void 0;var a=r(n(27361)),i=r(n(41609)),o=r(n(81602)),u="io.cozy.contacts";t.CONTACTS_DOCTYPE=u;var c=function(e){return function(t){return t&&t[e]&&0!==t[e].length&&t[e][0]?t[e].find(function(e){return e.primary})||t[e][0]:""}};t.getPrimaryOrFirst=c;t.getInitials=function(e){if(null!=e&&null!==(t=e.name)&&void 0!==t&&t.givenName||null!=e&&null!==(n=e.name)&&void 0!==n&&n.familyName)return["givenName","familyName"].map(function(t){return(0,a.default)(e,["name",t,0],"")}).join("").toUpperCase();var t,n,r=s(e);if(r)return r[0].toUpperCase();var i=d(e);return i?i[0].toUpperCase():""};var s=function(e){return Array.isArray(e.email)?c("email")(e).address||"":e.email};t.getPrimaryEmail=s;var l=function(e){return Array.isArray(e.cozy)?c("cozy")(e).url||"":e.url};t.getPrimaryCozy=l;var d=function(e){try{return new URL(l(e)).hostname.replace(/^(www.)/g,"")}catch(t){return l(e)}};t.getPrimaryCozyDomain=d;t.getPrimaryPhone=function(e){return c("phone")(e).number||""};t.getPrimaryAddress=function(e){return c("address")(e).formattedAddress||""};var f=["namePrefix","givenName","additionalName","familyName","nameSuffix"],p=function(e,t){var n=(null==t?void 0:t.attributesFullname)||f;return e.name?n.map(function(t){return e.name[t]}).filter(function(e){return void 0!==e}).join(" ").trim():""};t.makeFullname=p;t.getFullname=function(e){return(0,a.default)(e,"fullname")?e.fullname:p(e)};var h=function(e,t){var n=p(e,t),r=s(e),a=d(e);return n&&n.length>0?n:r&&r.length>0?r:a&&a.length>0?a:""};t.makeDisplayName=h;t.getDisplayName=function(e){return(0,a.default)(e,"displayName")?e.displayName:h(e)};var y=function(e){var t=[(0,a.default)(e,"name.familyName",""),(0,a.default)(e,"name.givenName",""),s(e),d(e)].join("").trim().toLowerCase();return 0===t.length?null:t};t.makeDefaultSortIndexValue=y;var v=function(e){var t=(0,a.default)(e,"indexes.byFamilyNameGivenNameEmailCozyUrl",null);return null!==t?(0,i.default)(t)?null:t:y(e)};t.getDefaultSortIndexValue=v;t.getIndexByFamilyNameGivenNameEmailCozyUrl=function(e){return o.default.warn("Deprecation: `getIndexByFamilyNameGivenNameEmailCozyUrl` is deprecated, please use `getDefaultSortIndexValue` instead"),v(e)};t.isContact=function(e){return e._type===u}},74632:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getEmojiByCountry=t.getAllNationalities=t.getNationalityByCodeISO=t.getAllCountryNames=t.getCountryNameByCodeISO=t.getAllCountries=t.checkCountryCode=t.isCountryCodeAlpha2=t.isCountryCodeAlpha3=t.isValidCountryCodeTranslation=t.COUNTRIES_ISO=void 0;var a=r(n(98235)),i=n(84854),o=r(n(81602)),u=[{code2:"AF",code3:"AFG",number:"004"},{code2:"AL",code3:"ALB",number:"008"},{code2:"DZ",code3:"DZA",number:"012"},{code2:"AD",code3:"AND",number:"020"},{code2:"AO",code3:"AGO",number:"024"},{code2:"AG",code3:"ATG",number:"028"},{code2:"AR",code3:"ARG",number:"032"},{code2:"AM",code3:"ARM",number:"051"},{code2:"AU",code3:"AUS",number:"036"},{code2:"AT",code3:"AUT",number:"040"},{code2:"AZ",code3:"AZE",number:"031"},{code2:"BS",code3:"BHS",number:"044"},{code2:"BH",code3:"BHR",number:"048"},{code2:"BD",code3:"BGD",number:"050"},{code2:"BB",code3:"BRB",number:"052"},{code2:"BY",code3:"BLR",number:"112"},{code2:"BE",code3:"BEL",number:"056"},{code2:"BZ",code3:"BLZ",number:"084"},{code2:"BJ",code3:"BEN",number:"204"},{code2:"BM",code3:"BMU",number:"060"},{code2:"BT",code3:"BTN",number:"064"},{code2:"BO",code3:"BOL",number:"068"},{code2:"BQ",code3:"BES",number:"535"},{code2:"BA",code3:"BIH",number:"070"},{code2:"BW",code3:"BWA",number:"072"},{code2:"BV",code3:"BVT",number:"074"},{code2:"BR",code3:"BRA",number:"076"},{code2:"IO",code3:"IOT",number:"086"},{code2:"BN",code3:"BRN",number:"096"},{code2:"BG",code3:"BGR",number:"100"},{code2:"BF",code3:"BFA",number:"854"},{code2:"BI",code3:"BDI",number:"108"},{code2:"CV",code3:"CPV",number:"132"},{code2:"KH",code3:"KHM",number:"116"},{code2:"CM",code3:"CMR",number:"120"},{code2:"CA",code3:"CAN",number:"124"},{code2:"KY",code3:"CYM",number:"136"},{code2:"CF",code3:"CAF",number:"140"},{code2:"TD",code3:"TCD",number:"148"},{code2:"CL",code3:"CHL",number:"152"},{code2:"CN",code3:"CHN",number:"156"},{code2:"CX",code3:"CXR",number:"162"},{code2:"CC",code3:"CCK",number:"166"},{code2:"CO",code3:"COL",number:"170"},{code2:"KM",code3:"COM",number:"174"},{code2:"CD",code3:"COD",number:"180"},{code2:"CG",code3:"COG",number:"178"},{code2:"CK",code3:"COK",number:"184"},{code2:"CR",code3:"CRI",number:"188"},{code2:"HR",code3:"HRV",number:"191"},{code2:"CU",code3:"CUB",number:"192"},{code2:"CW",code3:"CUW",number:"531"},{code2:"CY",code3:"CYP",number:"196"},{code2:"CZ",code3:"CZE",number:"203"},{code2:"CI",code3:"CIV",number:"384"},{code2:"DK",code3:"DNK",number:"208"},{code2:"DJ",code3:"DJI",number:"262"},{code2:"DM",code3:"DMA",number:"212"},{code2:"DO",code3:"DOM",number:"214"},{code2:"EC",code3:"ECU",number:"218"},{code2:"EG",code3:"EGY",number:"818"},{code2:"SV",code3:"SLV",number:"222"},{code2:"GQ",code3:"GNQ",number:"226"},{code2:"ER",code3:"ERI",number:"232"},{code2:"EE",code3:"EST",number:"233"},{code2:"SZ",code3:"SWZ",number:"748"},{code2:"ET",code3:"ETH",number:"231"},{code2:"FK",code3:"FLK",number:"238"},{code2:"FO",code3:"FRO",number:"234"},{code2:"FJ",code3:"FJI",number:"242"},{code2:"FI",code3:"FIN",number:"246"},{code2:"FR",code3:"FRA",number:"250"},{code2:"GF",code3:"GUF",number:"254"},{code2:"PF",code3:"PYF",number:"258"},{code2:"TF",code3:"ATF",number:"260"},{code2:"GA",code3:"GAB",number:"266"},{code2:"GM",code3:"GMB",number:"270"},{code2:"GE",code3:"GEO",number:"268"},{code2:"DE",code3:"DEU",number:"276"},{code2:"GH",code3:"GHA",number:"288"},{code2:"GI",code3:"GIB",number:"292"},{code2:"GR",code3:"GRC",number:"300"},{code2:"GL",code3:"GRL",number:"304"},{code2:"GD",code3:"GRD",number:"308"},{code2:"GP",code3:"GLP",number:"312"},{code2:"GU",code3:"GUM",number:"316"},{code2:"GT",code3:"GTM",number:"320"},{code2:"GG",code3:"GGY",number:"831"},{code2:"GN",code3:"GIN",number:"324"},{code2:"GW",code3:"GNB",number:"624"},{code2:"GY",code3:"GUY",number:"328"},{code2:"HT",code3:"HTI",number:"332"},{code2:"HM",code3:"HMD",number:"334"},{code2:"VA",code3:"VAT",number:"336"},{code2:"HN",code3:"HND",number:"340"},{code2:"HK",code3:"HKG",number:"344"},{code2:"HU",code3:"HUN",number:"348"},{code2:"IS",code3:"ISL",number:"352"},{code2:"IN",code3:"IND",number:"356"},{code2:"ID",code3:"IDN",number:"360"},{code2:"IR",code3:"IRN",number:"364"},{code2:"IQ",code3:"IRQ",number:"368"},{code2:"IE",code3:"IRL",number:"372"},{code2:"IM",code3:"IMN",number:"833"},{code2:"IL",code3:"ISR",number:"376"},{code2:"IT",code3:"ITA",number:"380"},{code2:"JM",code3:"JAM",number:"388"},{code2:"JP",code3:"JPN",number:"392"},{code2:"JE",code3:"JEY",number:"832"},{code2:"JO",code3:"JOR",number:"400"},{code2:"KZ",code3:"KAZ",number:"398"},{code2:"KE",code3:"KEN",number:"404"},{code2:"KI",code3:"KIR",number:"296"},{code2:"KP",code3:"PRK",number:"408"},{code2:"KR",code3:"KOR",number:"410"},{code2:"KW",code3:"KWT",number:"414"},{code2:"KG",code3:"KGZ",number:"417"},{code2:"LA",code3:"LAO",number:"418"},{code2:"LV",code3:"LVA",number:"428"},{code2:"LB",code3:"LBN",number:"422"},{code2:"LS",code3:"LSO",number:"426"},{code2:"LR",code3:"LBR",number:"430"},{code2:"LY",code3:"LBY",number:"434"},{code2:"LI",code3:"LIE",number:"438"},{code2:"LT",code3:"LTU",number:"440"},{code2:"LU",code3:"LUX",number:"442"},{code2:"MO",code3:"MAC",number:"446"},{code2:"MG",code3:"MDG",number:"450"},{code2:"MW",code3:"MWI",number:"454"},{code2:"MY",code3:"MYS",number:"458"},{code2:"MV",code3:"MDV",number:"462"},{code2:"ML",code3:"MLI",number:"466"},{code2:"MT",code3:"MLT",number:"470"},{code2:"MH",code3:"MHL",number:"584"},{code2:"MQ",code3:"MTQ",number:"474"},{code2:"MR",code3:"MRT",number:"478"},{code2:"MU",code3:"MUS",number:"480"},{code2:"YT",code3:"MYT",number:"175"},{code2:"MX",code3:"MEX",number:"484"},{code2:"FM",code3:"FSM",number:"583"},{code2:"MD",code3:"MDA",number:"498"},{code2:"MC",code3:"MCO",number:"492"},{code2:"MN",code3:"MNG",number:"496"},{code2:"ME",code3:"MNE",number:"499"},{code2:"MS",code3:"MSR",number:"500"},{code2:"MA",code3:"MAR",number:"504"},{code2:"MZ",code3:"MOZ",number:"508"},{code2:"MM",code3:"MMR",number:"104"},{code2:"NA",code3:"NAM",number:"516"},{code2:"NR",code3:"NRU",number:"520"},{code2:"NP",code3:"NPL",number:"524"},{code2:"NL",code3:"NLD",number:"528"},{code2:"NC",code3:"NCL",number:"540"},{code2:"NZ",code3:"NZL",number:"554"},{code2:"NI",code3:"NIC",number:"558"},{code2:"NE",code3:"NER",number:"562"},{code2:"NG",code3:"NGA",number:"566"},{code2:"NU",code3:"NIU",number:"570"},{code2:"NF",code3:"NFK",number:"574"},{code2:"MP",code3:"MNP",number:"580"},{code2:"NO",code3:"NOR",number:"578"},{code2:"OM",code3:"OMN",number:"512"},{code2:"PK",code3:"PAK",number:"586"},{code2:"PW",code3:"PLW",number:"585"},{code2:"PS",code3:"PSE",number:"275"},{code2:"PA",code3:"PAN",number:"591"},{code2:"PG",code3:"PNG",number:"598"},{code2:"PY",code3:"PRY",number:"600"},{code2:"PE",code3:"PER",number:"604"},{code2:"PH",code3:"PHL",number:"608"},{code2:"PN",code3:"PCN",number:"612"},{code2:"PL",code3:"POL",number:"616"},{code2:"PT",code3:"PRT",number:"620"},{code2:"PR",code3:"PRI",number:"630"},{code2:"QA",code3:"QAT",number:"634"},{code2:"MK",code3:"MKD",number:"807"},{code2:"RO",code3:"ROU",number:"642"},{code2:"RU",code3:"RUS",number:"643"},{code2:"RW",code3:"RWA",number:"646"},{code2:"RE",code3:"REU",number:"638"},{code2:"BL",code3:"BLM",number:"652"},{code2:"SH",code3:"SHN",number:"654"},{code2:"KN",code3:"KNA",number:"659"},{code2:"LC",code3:"LCA",number:"662"},{code2:"MF",code3:"MAF",number:"663"},{code2:"PM",code3:"SPM",number:"666"},{code2:"VC",code3:"VCT",number:"670"},{code2:"WS",code3:"WSM",number:"882"},{code2:"SM",code3:"SMR",number:"674"},{code2:"ST",code3:"STP",number:"678"},{code2:"SA",code3:"SAU",number:"682"},{code2:"SN",code3:"SEN",number:"686"},{code2:"RS",code3:"SRB",number:"688"},{code2:"SC",code3:"SYC",number:"690"},{code2:"SL",code3:"SLE",number:"694"},{code2:"SG",code3:"SGP",number:"702"},{code2:"SX",code3:"SXM",number:"534"},{code2:"SK",code3:"SVK",number:"703"},{code2:"SI",code3:"SVN",number:"705"},{code2:"SB",code3:"SLB",number:"090"},{code2:"SO",code3:"SOM",number:"706"},{code2:"ZA",code3:"ZAF",number:"710"},{code2:"GS",code3:"SGS",number:"239"},{code2:"SS",code3:"SSD",number:"728"},{code2:"ES",code3:"ESP",number:"724"},{code2:"LK",code3:"LKA",number:"144"},{code2:"SD",code3:"SDN",number:"729"},{code2:"SR",code3:"SUR",number:"740"},{code2:"SJ",code3:"SJM",number:"744"},{code2:"SE",code3:"SWE",number:"752"},{code2:"CH",code3:"CHE",number:"756"},{code2:"SY",code3:"SYR",number:"760"},{code2:"TW",code3:"TWN",number:"158"},{code2:"TJ",code3:"TJK",number:"762"},{code2:"TZ",code3:"TZA",number:"834"},{code2:"TH",code3:"THA",number:"764"},{code2:"TL",code3:"TLS",number:"626"},{code2:"TG",code3:"TGO",number:"768"},{code2:"TK",code3:"TKL",number:"772"},{code2:"TO",code3:"TON",number:"776"},{code2:"TT",code3:"TTO",number:"780"},{code2:"TN",code3:"TUN",number:"788"},{code2:"TR",code3:"TUR",number:"792"},{code2:"TM",code3:"TKM",number:"795"},{code2:"TC",code3:"TCA",number:"796"},{code2:"TV",code3:"TUV",number:"798"},{code2:"UG",code3:"UGA",number:"800"},{code2:"UA",code3:"UKR",number:"804"},{code2:"AE",code3:"ARE",number:"784"},{code2:"GB",code3:"GBR",number:"826"},{code2:"UM",code3:"UMI",number:"581"},{code2:"US",code3:"USA",number:"840"},{code2:"UY",code3:"URY",number:"858"},{code2:"UZ",code3:"UZB",number:"860"},{code2:"VU",code3:"VUT",number:"548"},{code2:"VE",code3:"VEN",number:"862"},{code2:"VN",code3:"VNM",number:"704"},{code2:"VG",code3:"VGB",number:"092"},{code2:"VI",code3:"VIR",number:"850"},{code2:"WF",code3:"WLF",number:"876"},{code2:"EH",code3:"ESH",number:"732"},{code2:"YE",code3:"YEM",number:"887"},{code2:"ZM",code3:"ZMB",number:"894"},{code2:"ZW",code3:"ZWE",number:"716"},{code2:"AX",code3:"ALA",number:"248"}];t.COUNTRIES_ISO=u;t.isValidCountryCodeTranslation=function(e,t){var n=(0,i.getLocalizer)(e).polyglot;return s(t)&&n.has("nationalities.".concat(t))&&n.has("countries.".concat(t))};var c=function(e){if(!e)return!1;var t=e.toUpperCase();return u.some(function(e){return e.code3===t})};t.isCountryCodeAlpha3=c;var s=function(e){if(!e)return!1;var t=e.toUpperCase();return u.some(function(e){return e.code2===t})};t.isCountryCodeAlpha2=s;t.checkCountryCode=function(e){return s(e)||c(e)};var l=function(e){var t=(0,i.getLocalizer)(e).t;return u.map(function(e){return{code2:e.code2,code3:e.code3,number:e.number,name:t("countries.".concat(e.code2)),nationality:t("nationalities.".concat(e.code2))}})};t.getAllCountries=l;var d=function(e){return function(t){var n,r=null==e?void 0:null===(n=e.toString())||void 0===n?void 0:n.toUpperCase();return/^[A-Z]{2,3}$/.test(r)?t.code2===r||t.code3===r:!!/^\d+$/.test(r)&&t.number===r}};t.getCountryNameByCodeISO=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{lang:"en"},n=l(t.lang).find(d(e));return n?n.name:(o.default.warn("Country with code ".concat(e," not found")),null)};t.getAllCountryNames=function(e){return l(e).map(function(e){return e.name})};t.getNationalityByCodeISO=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{lang:"en"},n=l(t.lang).find(d(e));return n?n.nationality:(o.default.warn("Nationality with code ".concat(e," not found")),null)};t.getAllNationalities=function(e){return l(e).map(function(e){return e.nationality})};t.getEmojiByCountry=function(e){if(!e)return null;if(!/^[a-z]{2}$/i.test(e))return o.default.error("Country argument must be an ISO 3166-1 alpha-2 string, but got '".concat(JSON.stringify(e),"' instead.")),null;if(!u.find(function(t){return t.code2===e.toUpperCase()}))return o.default.error("Country with code ".concat(e," not found in the list of countries")),null;var t=(0,a.default)(e.toUpperCase()).map(function(e){return e.codePointAt(0)+127397});return String.fromCodePoint.apply(String,(0,a.default)(t))}},84854:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getLocalizer=void 0;for(var a=r(n(54078)),i=r(n(16300)),o=r(n(61127)),u={en:i.default,fr:o.default},c={},s=0,l=["fr","en"];s<l.length;s++){var d=l[s],f=new a.default;f.extend(u[d]),c[d]=f}t.getLocalizer=function(e){var t=c[e]||c.en;return{t:t.t.bind(t),polyglot:t,lang:e}}},88799:function(e,t,n){var r,a,i=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAggregatesFromDACC=t.buildAggregateParams=t.sendMeasureToDACC=t.checkMeasureParams=t.isCorrectDateFormat=void 0;var o=i(n(68434)),u=i(n(82007)),c=i(n(33918));i(n(88477));var s=function(e){try{return!!new Date(Date.parse(e)).toISOString().startsWith(e)}catch(e){return!1}};t.isCorrectDateFormat=s;var l=function(e){var t=e.createdBy,n=e.measureName,r=e.startDate,a=e.value,i=e.group1,o=e.group2,u=e.group3;if(!t||"string"!=typeof t)throw Error("Missing or wrong type parameter: createdBy");if(!n||"string"!=typeof n)throw Error("Missing or wrong type parameter: measureName");if(!r)throw Error("Missing parameter: startDate");if(!s(r))throw Error("Date should be in YYYY-MM-DD format");if("number"!=typeof a)throw Error("Missing or wrong type parameter: value");if(i&&("object"!=typeof i||0===Object.keys(i).length)||o&&("object"!=typeof o||0===Object.keys(o).length)||u&&("object"!=typeof u||0===Object.keys(u).length))throw Error("Groups should be key-value objects");if(u&&(!o||!i)||o&&!i)throw Error("Group order must be respected")};t.checkMeasureParams=l;var d=(r=(0,u.default)(o.default.mark(function e(t,n,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l(r),e.next=4,t.getStackClient().fetchJSON("POST","/remote/".concat(n),{data:JSON.stringify(r),path:"measure"});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),(0,c.default)("error","Error while sending measure to remote doctype: ".concat(e.t0.message)),e.t0;case 10:case"end":return e.stop()}},e,null,[[0,6]])})),function(e,t,n){return r.apply(this,arguments)});t.sendMeasureToDACC=d;var f=function(e){var t=e.measureName;if(!t||"string"!=typeof t)throw Error("Missing or wrong type parameter: measureName");var n=e.startDate||new Date(0).toISOString(),r=e.endDate||new Date(Date.now()).toISOString();if(!s(n)||!s(r))throw(0,c.default)("error","Date should be in YYYY-MM-DD format but received: startDate: ".concat(n," | endDate: ").concat(r)),Error("Date should be in YYYY-MM-DD format");return{measureName:t,startDate:n,endDate:r}};t.buildAggregateParams=f;var p=(a=(0,u.default)(o.default.mark(function e(t,n,r){var a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=f(r),e.next=4,t.getStackClient().fetchJSON("POST","/remote/".concat(n),{data:JSON.stringify(a),path:"aggregate"});case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(0),(0,c.default)("error","Error while fetching aggregates to remote doctype: ".concat(e.t0.message)),e.t0;case 11:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,t,n){return a.apply(this,arguments)});t.fetchAggregatesFromDACC=p},468:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.iconLabelPairs=t.THEME_OTHERS_LABELS=t.THEME_INVOICE_LABELS=t.THEME_FINANCE_LABELS=t.THEME_ACTIVITY_LABELS=t.THEME_TRANSPORT_LABELS=t.THEME_HOME_LABELS=t.THEME_HEALTH_LABELS=t.THEME_WORK_STUDY_LABELS=t.THEME_FAMILY_LABELS=t.THEME_IDENTITY_LABELS=void 0;t.THEME_IDENTITY_LABELS=["identity_photo","national_id_card","passport","residence_permit","electoral_card","family_record_book","birth_certificate","driver_license","citizen_registration_certificate","note_identity_document","other_identity_document"];t.THEME_FAMILY_LABELS=["family_record_book","birth_certificate","wedding","pacs","single_parent_benefit","divorce","large_family_card","caf","payment_proof_family_allowance","note_family_document","other_family_document","person_insurance"];t.THEME_WORK_STUDY_LABELS=["diploma","work_contract","pay_sheet","unemployment_benefit","employment_center_certificate","pension","work_disability_recognition","gradebook","student_card","school_attendance_certificate","school_insurance_certificate","resume","motivation_letter","expense_claim","note_work_document","other_work_document"];t.THEME_HEALTH_LABELS=["health_certificate","health_book","national_health_insurance_card","national_health_insurance_right_certificate","health_insurance_card","prescription","health_invoice","work_disability_recognition","pregnancy_medical_certificate","note_health_document","other_health_document"];t.THEME_HOME_LABELS=["phone_invoice","isp_invoice","telecom_invoice","energy_invoice","water_invoice","other_invoice","work_invoice","house_sale_agreeement","building_permit","technical_diagnostic_record","unfit_for_habitation_declaration","lease","rent_receipt","accommodation_proof","house_insurance","work_quote","condition_report","note_house_document","other_house_document","real_estate_insurance"];t.THEME_TRANSPORT_LABELS=["driver_license","vehicle_registration","car_insurance","transport_card","mechanic_invoice","transport_invoice","note_transport_document","other_transport_document"];t.THEME_ACTIVITY_LABELS=["personal_sporting_licence","fidelity_card","note_activity_document","other_activity_document"];t.THEME_FINANCE_LABELS=["fine","tax_certificate","tax_return","tax_notice","tax_timetable","real_estate_tax","pay_sheet","receipt","single_parent_benefit","other_tax_document","bank_details","bank_statement","loan_agreement","payment_proof_family_allowance","note_finance","expense_claim","other_bank_document","other_revenue"];t.THEME_INVOICE_LABELS=["phone_invoice","isp_invoice","telecom_invoice","energy_invoice","water_invoice","appliance_invoice","web_service_invoice","restaurant_invoice","work_invoice","transport_invoice","health_invoice","note_invoice","expense_claim","energy_contract","grocery_invoice","other_invoice"];t.THEME_OTHERS_LABELS=["other_administrative_document"];t.iconLabelPairs=[{icon:"bank-check",labels:["bank_details"]},{icon:"bank",labels:["other_administrative_document","other_tax_document","real_estate_tax","tax_certificate","tax_notice","tax_return","tax_timetable"]},{icon:"benefit",labels:["loan_agreement","other_revenue","pay_sheet","payment_proof_family_allowance","pension"]},{icon:"bill",labels:["other_invoice"]},{icon:"car",labels:["car_insurance","driver_license","other_transport_document","transport_card","transport_invoice","vehicle_registration"]},{icon:"child",labels:["birth_certificate"]},{icon:"email",labels:["receipt"]},{icon:"euro",labels:["other_bank_document"]},{icon:"exchange",labels:["bank_statement"]},{icon:"file-type-note",labels:["note_activity_document","note_family_document","note_finance","note_health_document","note_house_document","note_identity_document","note_invoice","note_transport_document","note_work_document"]},{icon:"fitness",labels:["other_activity_document","personal_sporting_licence"]},{icon:"globe",labels:["residence_permit"]},{icon:"gouv",labels:["electoral_card"]},{icon:"heart",labels:["health_book","health_certificate","health_insurance_card","health_invoice","national_health_insurance_card","national_health_insurance_right_certificate","other_health_document","person_insurance","pregnancy_medical_certificate","prescription"]},{icon:"home",labels:["accommodation_proof","building_permit","condition_report","house_insurance","house_sale_agreeement","lease","mechanic_invoice","other_house_document","real_estate_insurance","rent_receipt","technical_diagnostic_record","unfit_for_habitation_declaration","work_invoice","work_quote"]},{icon:"image",labels:["identity_photo"]},{icon:"justice",labels:["fine"]},{icon:"laudry",labels:["appliance_invoice"]},{icon:"lightning",labels:["energy_contract","energy_invoice"]},{icon:"people",labels:["national_id_card","other_identity_document","resume","work_disability_recognition"]},{icon:"plane",labels:["passport"]},{icon:"remboursement",labels:["expense_claim"]},{icon:"restaurant",labels:["restaurant_invoice"]},{icon:"school",labels:["diploma","gradebook"]},{icon:"shop",labels:["fidelity_card","grocery_invoice"]},{icon:"team",labels:["caf","citizen_registration_certificate","divorce","family_record_book","large_family_card","other_family_document","pacs","single_parent_benefit","wedding"]},{icon:"telecom",labels:["isp_invoice","telecom_invoice","web_service_invoice"]},{icon:"telephone",labels:["phone_invoice"]},{icon:"water",labels:["water_invoice"]},{icon:"work",labels:["employment_center_certificate","motivation_letter","other_work_document","school_attendance_certificate","school_insurance_certificate","student_card","unemployment_benefit","work_contract"]}]},28374:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.themesList=void 0;var r=n(468),a=n(4217),i=function(e){return e.map(function(e){try{return a.Qualification.getByLabel(e)}catch(e){return console.log("error",e),null}}).filter(function(e){return e})},o=[{id:"theme1",label:"identity",icon:"people",items:i(r.THEME_IDENTITY_LABELS),defaultItems:["birth_certificate"]},{id:"theme2",label:"family",icon:"team",items:i(r.THEME_FAMILY_LABELS),defaultItems:["family_record_book"]},{id:"theme3",label:"work_study",icon:"work",items:i(r.THEME_WORK_STUDY_LABELS)},{id:"theme4",label:"health",icon:"heart",items:i(r.THEME_HEALTH_LABELS)},{id:"theme5",label:"home",icon:"home",items:i(r.THEME_HOME_LABELS)},{id:"theme6",label:"transport",icon:"car",items:i(r.THEME_TRANSPORT_LABELS),defaultItems:["driver_license"]},{id:"theme7",label:"activity",icon:"chess",items:i(r.THEME_ACTIVITY_LABELS)},{id:"theme8",label:"finance",icon:"bank",items:i(r.THEME_FINANCE_LABELS)},{id:"theme9",label:"invoice",icon:"bill",items:i(r.THEME_INVOICE_LABELS)},{id:"theme10",label:"others",icon:"dots",items:i(r.THEME_OTHERS_LABELS)}];t.themesList=o},53479:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isQualificationNote=t.getThemeByItem=void 0;var r=n(28374);t.getThemeByItem=function(e){var t,n=(t=e,r.themesList.find(function(e){return e.defaultItems&&e.defaultItems.includes(t.label)}));return n?n:r.themesList.find(function(t){return t.items.some(function(t){return t.label===e.label})})};t.isQualificationNote=function(e){return e.label.toLowerCase().startsWith("note_")}},12189:function(e,t,n){var r=n(14746);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Qualification",{enumerable:!0,get:function(){return a.Qualification}}),Object.defineProperty(t,"setQualification",{enumerable:!0,get:function(){return a.setQualification}}),Object.defineProperty(t,"getQualification",{enumerable:!0,get:function(){return a.getQualification}}),t.helpers=t.themes=t.locales=void 0;var a=n(4217),i=r(n(37689));t.locales=i;var o=r(n(28374));t.themes=o;var u=r(n(53479));t.helpers=u},37689:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getLocalizer=t.getBoundT=void 0;var a=r(n(64512)),i=r(n(54078)),o=r(n(60080)),u=r(n(76785)),c=n(74632);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}for(var d={en:o.default,fr:u.default},f={},p=0,h=["fr","en"];p<h.length;p++){var y=h[p],v=new i.default;v.extend(d[y]),f[y]=v}t.getBoundT=function(e){var t=m(e);return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=l(l({},n),{},{smart_count:(null==n?void 0:n.smart_count)||1}),a=null==n?void 0:n.country,i="foreign"!==a?(0,c.getEmojiByCountry)(a):null,o="foreign"===a?t("country.foreign"):null;return i||o?"".concat(t(e,r)," ").concat(i||o):t(e,r)}};var m=function(e){var t=f[e]||f.en;return t.t.bind(t)};t.getLocalizer=m},4217:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getIconByLabel=t.getQualification=t.setQualification=t.Qualification=void 0;var i=a(n(64512)),o=a(n(65105)),u=a(n(19723)),c=a(n(36968)),s=a(n(91966)),l=r(n(5825)),d=a(n(81602)),f=n(468);function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var v=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,o.default)(this,e);var r=l.qualifications.find(function(e){return e.label===t});if(r){this.icon=n.icon||m(t),this.label=r.label;var a=n.purpose||r.purpose;a&&(this.purpose=a);var i=n.sourceCategory||r.sourceCategory;i&&(this.sourceCategory=i);var u=n.sourceSubCategory||r.sourceSubCategory;u&&(this.sourceSubCategory=u);var c=n.subjects||r.subjects;c&&(this.subjects=c)}else throw Error("No qualification found for the label ".concat(t))}return(0,u.default)(e,[{key:"checkAttributes",value:function(e){if(this.purpose!==e.purpose){if(this.purpose)throw Error("The purpose for the label ".concat(this.label," should be ").concat(this.purpose,". ")+"Please use this or open an issue on https://github.com/cozy/cozy-client/issues");!l.purposeKnownValues.includes(e.purpose)&&d.default.info("This purpose is not listed among the known values: ".concat(e.purpose,". ")+"Please open an issue on https://github.com/cozy/cozy-client/issues")}if(this.sourceCategory!==e.sourceCategory){if(this.sourceCategory)throw Error("The sourceCategory for the label ".concat(this.label," should be ").concat(this.sourceCategory,". ")+"Please use this or open an issue on https://github.com/cozy/cozy-client/issues");!l.sourceCategoryKnownValues.includes(e.sourceCategory)&&d.default.info("This sourceCategory is not listed among the known values: ".concat(e.sourceCategory,". ")+"Please open an issue on https://github.com/cozy/cozy-client/issues")}if(this.sourceSubCategory!==e.sourceSubCategory){if(this.sourceSubCategory)throw Error("The sourceSubCategory for the label ".concat(this.label," should be ").concat(this.sourceSubCategory,". ")+"Please use this or open an issue on https://github.com/cozy/cozy-client/issues");!l.sourceSubCategoryKnownValues.includes(e.sourceSubCategory)&&d.default.info("This sourceSubCategory is not listed among the known values: ".concat(e.sourceSubCategory,". ")+"Please open an issue on https://github.com/cozy/cozy-client/issues")}if((0,s.default)(this.subjects,e.subjects).length>0)throw Error("The subjects for the label ".concat(this.label," should include ").concat(this.subjects,". ")+"Please use this or open an issue on https://github.com/cozy/cozy-client/issues");var t=(0,s.default)(e.subjects,this.subjects);if(t.length>0){var n=(0,s.default)(t,l.subjectsKnownValues);n.length>0&&d.default.info("These subjects are not listed among the known values: ".concat(n,". ")+"Please open an issue on https://github.com/cozy/cozy-client/issues")}}},{key:"setPurpose",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{purpose:t}))}},{key:"setSourceCategory",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{sourceCategory:t}))}},{key:"setSourceSubCategory",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{sourceSubCategory:t}))}},{key:"setSubjects",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{subjects:t}))}},{key:"setIcon",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{icon:t}))}},{key:"toQualification",value:function(){return{icon:this.icon,label:this.label,purpose:this.purpose,sourceCategory:this.sourceCategory,sourceSubCategory:this.sourceSubCategory,subjects:this.subjects}}}]),e}();t.Qualification=v,v.getByLabel=function(e){return new v(e)};t.setQualification=function(e,t){if(t.label){var n=t;return new v(t.label).checkAttributes(t),!t.icon&&(n=new v(t.label,t).setIcon(m(t.label))),(0,c.default)(e,"metadata.qualification",n)}throw Error("You must set a label to qualify")};t.getQualification=function(e){var t,n=null==e?void 0:null===(t=e.metadata)||void 0===t?void 0:t.qualification;return n?new v(n.label,n.qualification).toQualification():null};var m=function(e){var t,n=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(f.iconLabelPairs);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.labels.includes(e))return r.icon}}catch(e){n.e(e)}finally{n.f()}return d.default.info("The ".concat(e," qualification does not seem to have an icon.\n    Please open an issue on https://github.com/cozy/cozy-client/issues")),""};t.getIconByLabel=m},72912:function(e,t,n){var r,a,i,o,u,c,s,l,d,f,p,h=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.normalize=function(e){var t=e._id||e.id;return C({_id:t,id:t,_type:e._type||x.DOCTYPE_FILES},e)},t.ensureFilePath=function(e,t){if(e.path)return e;if(!t||!t.path)throw Error("Could not define a file path for ".concat(e._id||e.id));return C({path:t.path+"/"+e.name},e)},t.getParentFolderId=function(e){var t=(0,g.default)(e,"attributes.dir_id");return""===t?null:t},t.downloadFile=t.copy=t.fetchBlobFileById=t.isFromKonnector=t.hasCertifications=t.hasQualifications=t.isPlainText=t.doMobileUpload=t.readMobileFile=t.uploadFileWithConflictStrategy=t.generateFileNameForRevision=t.generateNewFileNameOnConflict=t.overrideFileForPath=t.move=t.getFullpath=t.hasMetadataAttribute=t.fetchFilesByQualificationRules=t.saveFileQualification=t.isSharingShorcutNew=t.isSharingShortcutNew=t.isSharingShorcut=t.isSharingShortcut=t.getSharingShortcutTargetDoctype=t.getSharingShortcutTargetMime=t.getSharingShortcutStatus=t.isShortcut=t.shouldBeOpenedByOnlyOffice=t.isOnlyOfficeFile=t.isEncrypted=t.isNote=t.isDirectory=t.isFile=t.splitFilename=t.ALBUMS_DOCTYPE=void 0;var y=h(n(68434)),v=h(n(82007)),m=h(n(64512)),b=n(25976),g=h(n(27361)),k=h(n(47037)),_=h(n(18721)),O=h(n(10691)),w=n(4217),S=n(87549),x=n(71791);h(n(88477));var E=h(n(81602));function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach(function(t){(0,m.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var D="file";t.ALBUMS_DOCTYPE="io.cozy.photos.albums";var j=/(.+)(\..*)$/,A=function(e){if(!(0,k.default)(e.name))throw Error("file should have a name property");if("file"===e.type){var t=e.name.match(j);if(t)return{filename:t[1],extension:t[2]}}return{filename:e.name,extension:""}};t.splitFilename=A;var T=function(e){return e&&e.type===D};t.isFile=T;t.isDirectory=function(e){return e&&"directory"===e.type};var R=function(e){return!!(e&&e.name&&e.name.endsWith(".cozy-note"))&&e.type===D&&!!e.metadata&&void 0!==e.metadata.title&&void 0!==e.metadata.version||!1};t.isNote=R;var I=function(e){return!!e.encrypted};t.isEncrypted=I;var M=function(e){return T(e)&&!R(e)&&("text"===e.class||"spreadsheet"===e.class||"slide"===e.class)};t.isOnlyOfficeFile=M;t.shouldBeOpenedByOnlyOffice=function(e){return M(e)&&!e.name.endsWith(".txt")&&!e.name.endsWith(".md")};t.isShortcut=function(e){return e&&"shortcut"===e.class};var N=function(e){return(0,g.default)(e,"metadata.sharing.status")};t.getSharingShortcutStatus=N;t.getSharingShortcutTargetMime=function(e){return(0,g.default)(e,"metadata.target.mime")};t.getSharingShortcutTargetDoctype=function(e){return(0,g.default)(e,"metadata.target._type")};var F=function(e){return!!N(e)};t.isSharingShortcut=F;t.isSharingShorcut=function(e){return E.default.warn("Deprecation: `isSharingShorcut` is deprecated, please use `isSharingShortcut` instead"),F(e)};var L=function(e){return"new"===N(e)};t.isSharingShortcutNew=L;t.isSharingShorcutNew=function(e){return E.default.warn("Deprecation: `isSharingShorcutNew` is deprecated, please use `isSharingShortcutNew` instead"),L(e)};var B=(r=(0,v.default)(y.default.mark(function e(t,n,r){var a;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,w.setQualification)(n,r),e.abrupt("return",t.collection(x.DOCTYPE_FILES).updateMetadataAttribute(n._id,a.metadata));case 2:case"end":return e.stop()}},e)})),function(e,t,n){return r.apply(this,arguments)});t.saveFileQualification=B;var z=(a=(0,v.default)(y.default.mark(function e(t,n){var r,a,i,o;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.rules,a=n.count,i=(0,S.Q)(x.DOCTYPE_FILES).where(C({},r)).partialIndex({trashed:!1}).indexFields(["cozyMetadata.updatedAt","metadata.qualification"]).sortBy([{"cozyMetadata.updatedAt":"desc"}]).limitBy(a||1),e.next=4,t.query(i);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)});t.fetchFilesByQualificationRules=z;t.hasMetadataAttribute=function(e){var t=e.file,n=e.attribute;return(0,_.default)(t,"metadata.".concat(n))};var U=(i=(0,v.default)(y.default.mark(function e(t,n,r){var a,i;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw Error("You must provide a dirId");case 2:return e.next=4,t.query((0,S.Q)(x.DOCTYPE_FILES).getById(n));case 4:return a=e.sent.data,i=(0,O.default)(a.path,"/"),e.abrupt("return","".concat(i,"/").concat(r));case 8:case"end":return e.stop()}},e)})),function(e,t,n){return i.apply(this,arguments)});t.getFullpath=U;var q=(o=(0,v.default)(y.default.mark(function e(t,n,r){var a,i,o,u,c,s=arguments;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(s.length>3&&void 0!==s[3]?s[3]:{force:!1}).force,e.prev=1,"io.cozy.remote.nextcloud.files"!==n._type){e.next=10;break}if("io.cozy.remote.nextcloud.files"!==r._type){e.next=7;break}return e.next=6,t.collection("io.cozy.remote.nextcloud.files").move(n,r);case 6:case 9:case 13:return e.abrupt("return",{moved:void 0,deleted:null});case 7:return e.next=9,t.collection("io.cozy.remote.nextcloud.files").moveToCozy(n,r);case 10:if("io.cozy.remote.nextcloud.files"!==r._type){e.next=14;break}return e.next=13,t.collection("io.cozy.remote.nextcloud.files").moveFromCozy(r,n);case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(1),e.t0;case 19:return e.prev=19,e.next=22,t.collection(x.DOCTYPE_FILES).updateFileMetadata(n._id,{dir_id:r._id});case 22:return i=e.sent,e.abrupt("return",{moved:i.data,deleted:null});case 26:if(e.prev=26,e.t1=e.catch(19),!(409===e.t1.status&&a)){e.next=43;break}return e.next=31,U(t,r._id,n.name);case 31:return o=e.sent,e.next=34,t.collection(x.DOCTYPE_FILES).statByPath(o);case 34:return u=e.sent,e.next=37,t.collection(x.DOCTYPE_FILES).destroy(u.data);case 37:return e.next=39,t.collection(x.DOCTYPE_FILES).updateFileMetadata(n._id,{dir_id:r._id});case 39:return c=e.sent,e.abrupt("return",{moved:c.data,deleted:u.data.id});case 43:throw e.t1;case 44:case"end":return e.stop()}},e,null,[[1,16],[19,26]])})),function(e,t,n){return o.apply(this,arguments)});t.move=q;var G=(u=(0,v.default)(y.default.mark(function e(t,n,r,a){var i,o,u,c,s,l,d,f;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return!(i=n).endsWith("/")&&(i+="/"),o=t.collection(x.DOCTYPE_FILES),e.prev=3,e.next=6,o.statByPath(i+r.name);case 6:return c=(u=e.sent.data).id,s=u.dir_id,e.next=10,o.updateFile(r,{dirId:s,fileId:c,metadata:a});case 10:return l=e.sent,e.abrupt("return",l);case 14:if(e.prev=14,e.t0=e.catch(3),!/Not Found/.test(e.t0)){e.next=24;break}return e.next=19,o.ensureDirectoryExists(i);case 19:return d=e.sent,e.next=22,o.createFile(r,{dirId:d,metadata:a});case 22:return f=e.sent,e.abrupt("return",f);case 24:throw e.t0;case 25:case"end":return e.stop()}},e,null,[[3,14]])})),function(e,t,n,r){return u.apply(this,arguments)});t.overrideFileForPath=G;var Q=function(e,t){var n=(null==t?void 0:t.delimiter)||"_",r=new RegExp("(".concat(n,")([0-9]+)$")),a=e.match(r);if(!a)return"".concat(e).concat(n,"1");var i=parseInt(a[2]);return i++,e.replace(new RegExp("(".concat(n,")([0-9]+)$")),"".concat(n).concat(i))};t.generateNewFileNameOnConflict=Q;t.generateFileNameForRevision=function(e,t,n){var r=A(e),a=r.filename,i=r.extension;return"".concat(a,"_").concat(n(t.updated_at,"DD MMMM - HH[h]mm")).concat(i)};var H=(c=(0,v.default)(y.default.mark(function e(t,n,r){var a,i,o,u,c,s,l,d,f,p,h;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.name,i=r.dirId,o=r.conflictStrategy,u=r.conflictOptions,e.prev=1,e.next=4,U(t,i,a);case 4:return c=e.sent,e.next=7,t.collection(x.DOCTYPE_FILES).statByPath(c);case 7:if(s=e.sent.data.id,"erase"!==o){e.next=16;break}return e.next=12,t.collection(x.DOCTYPE_FILES).updateFile(n,C(C({},r),{},{fileId:s}));case 12:return l=e.sent,e.abrupt("return",l);case 16:return f=(d=A({name:a,type:"file"})).filename,p=d.extension,h=Q(f,u)+p,e.abrupt("return",H(t,n,C(C({},r),{},{name:h})));case 19:e.next=26;break;case 21:if(e.prev=21,e.t0=e.catch(1),!/Not Found/.test(e.t0.message)){e.next=25;break}return e.abrupt("return",t.collection(x.DOCTYPE_FILES).createFile(n,r));case 25:throw e.t0;case 26:case"end":return e.stop()}},e,null,[[1,21]])})),function(e,t,n){return c.apply(this,arguments)});t.uploadFileWithConflictStrategy=H;var J=(s=(0,v.default)(y.default.mark(function e(t){var n;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise(function(e,n){var r=function(){var t=(0,v.default)(y.default.mark(function t(r){return y.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r.file(function(){var t=(0,v.default)(y.default.mark(function t(n){var r;return y.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(r=new FileReader).onloadend=(0,v.default)(y.default.mark(function t(){return y.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e(r.result);case 1:case"end":return t.stop()}},t)})),r.readAsArrayBuffer(n);case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.error("error getting fileentry file!"+e),n(e)});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),a=function(e){n(e)};window.resolveLocalFileSystemURL(t,r,a)}),e.abrupt("return",n);case 2:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)});t.readMobileFile=J;var Y=(l=(0,v.default)(y.default.mark(function e(t,n,r){var a;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(n);case 2:return a=e.sent,e.abrupt("return",H(t,a,r));case 4:case"end":return e.stop()}},e)})),function(e,t,n){return l.apply(this,arguments)});t.doMobileUpload=Y;t.isPlainText=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e?/^text\//.test(e):/\.(txt|md)$/.test(t)};t.hasQualifications=function(e){return(0,_.default)(e,"metadata.qualification")};t.hasCertifications=function(e){return(0,g.default)(e,"metadata.carbonCopy",!1)||(0,g.default)(e,"metadata.electronicSafe",!1)};t.isFromKonnector=function(e){return(0,_.default)(e,"cozyMetadata.sourceAccount")};var W=(d=(0,v.default)(y.default.mark(function e(t,n){var r,a,i;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.collection(x.DOCTYPE_FILES),e.next=3,r.fetchFileContentById(n);case 3:return a=e.sent,e.next=6,a.blob();case 6:return i=e.sent,e.abrupt("return",i);case 8:case"end":return e.stop()}},e)})),function(e,t){return d.apply(this,arguments)});t.fetchBlobFileById=W;var K=(f=(0,v.default)(y.default.mark(function e(t,n,r){var a,i,o,u;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!("io.cozy.remote.nextcloud.files"===n._type&&"io.cozy.remote.nextcloud.files"===r._type)){e.next=6;break}return e.next=4,t.collection("io.cozy.remote.nextcloud.files").copy(n,r);case 4:return a=e.sent,e.abrupt("return",a);case 6:if(!("io.cozy.remote.nextcloud.files"===n._type&&"io.cozy.files"===r._type)){e.next=11;break}return e.next=9,t.collection("io.cozy.remote.nextcloud.files").moveToCozy(n,r,{copy:!0});case 9:return i=e.sent,e.abrupt("return",i);case 11:if("io.cozy.remote.nextcloud.files"!==r._type){e.next=16;break}return e.next=14,t.collection("io.cozy.remote.nextcloud.files").moveFromCozy(r,n,{copy:!0});case 14:return o=e.sent,e.abrupt("return",o);case 16:return e.next=18,t.collection(x.DOCTYPE_FILES).copy(n._id,void 0,r._id);case 18:return u=e.sent,e.abrupt("return",u);case 22:throw e.prev=22,e.t0=e.catch(0),e.t0;case 25:case"end":return e.stop()}},e,null,[[0,22]])})),function(e,t,n){return f.apply(this,arguments)});t.copy=K;var V=(p=(0,v.default)(y.default.mark(function e(t){var n,r,a,i,o,u;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.client,r=t.file,a=t.url,i=t.webviewIntent,o=n.collection(x.DOCTYPE_FILES),!((0,b.isFlagshipApp)()&&i&&!I(r))){e.next=19;break}return e.next=5,null==i?void 0:i.call("isAvailable","downloadFile");case 5:if(e.t1=u=e.sent,e.t0=null!==e.t1,!e.t0){e.next=9;break}e.t0=void 0!==u;case 9:if(!e.t0){e.next=13;break}e.t2=u,e.next=14;break;case 13:e.t2=!1;case 14:if(!e.t2){e.next=19;break}return e.next=18,i.call("downloadFile",r);case 18:return e.abrupt("return",e.sent);case 19:if(!I(r)){e.next=21;break}return e.abrupt("return",o.forceFileDownload(a,r.name));case 21:return e.abrupt("return",o.download(r));case 22:case"end":return e.stop()}},e)})),function(e){return p.apply(this,arguments)});t.downloadFile=V},16001:function(e,t,n){var r,a,i,o=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getReferencedFolder=t.createFolderWithReference=t.ensureMagicFolder=t.MAGIC_FOLDERS=void 0;var u=o(n(68434)),c=o(n(82007)),s=o(n(89734));o(n(88477));var l=n(71791),d=n(87549),f="io.cozy.apps",p="administrative",h="photos",y={ADMINISTRATIVE:"".concat(f,"/").concat(p),PHOTOS:"".concat(f,"/").concat(h),PHOTOS_BACKUP:"".concat(f,"/").concat(h,"/mobile"),PHOTOS_UPLOAD:"".concat(f,"/").concat(h,"/upload"),NOTES:"".concat(f,"/notes"),HOME:"".concat(f,"/home"),PAPERS:"".concat(f,"/").concat(p,"/papers"),COACH_CO2:"".concat(f,"/").concat(p,"/coachco2")};t.MAGIC_FOLDERS=y;var v=(r=(0,c.default)(u.default.mark(function e(t,n,r){var a,i,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={_type:f,_id:n},e.next=3,b(t,a);case 3:if(!(i=e.sent)){e.next=6;break}return e.abrupt("return",i);case 6:if((o=Object.values(y)).includes(n)){e.next=9;break}throw Error("Cannot create Magic folder with id ".concat(n,". Allowed values are ").concat(o.join(", "),"."));case 9:if(r){e.next=11;break}throw Error("Magic folder default path must be defined");case 11:return e.abrupt("return",m(t,r,a));case 12:case"end":return e.stop()}},e)})),function(e,t,n){return r.apply(this,arguments)});t.ensureMagicFolder=v;var m=(a=(0,c.default)(u.default.mark(function e(t,n,r){var a,i,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.collection(l.DOCTYPE_FILES),e.next=3,a.ensureDirectoryExists(n);case 3:return i=e.sent,e.next=6,a.addReferencesTo(r,[{_id:i}]);case 6:return e.next=8,a.get(i);case 8:return o=e.sent.data,e.abrupt("return",o);case 11:case"end":return e.stop()}},e)})),function(e,t,n){return a.apply(this,arguments)});t.createFolderWithReference=m;var b=(i=(0,c.default)(u.default.mark(function e(t,n){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query((0,d.Q)(l.DOCTYPE_FILES).partialIndex({type:"directory",trashed:!1}).referencedBy(n));case 2:return r=e.sent.included,e.abrupt("return",r.length>0?(0,s.default)(r,"created_at").pop():null);case 5:case"end":return e.stop()}},e)})),function(e,t){return i.apply(this,arguments)});t.getReferencedFolder=b},69810:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.deltaLatitude=t.deltaLongitude=t.computeSphericalCenter=t.geodesicDistance=t.computeSpeed=void 0;function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}t.computeSpeed=function(e,t){return e&&t?Math.round(e/t*100)/100:0};var r=function(e){return e*Math.PI/180},a=function(e){return 180*e/Math.PI},i=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n};t.geodesicDistance=function(e,t){if((null==e?void 0:e.lon)===void 0||(null==e?void 0:e.lat)===void 0||(null==t?void 0:t.lon)===void 0||(null==t?void 0:t.lat)===void 0)return null;var n=r(e.lon),a=r(e.lat),o=r(t.lon),u=r(t.lat),c=2*Math.asin(Math.sqrt(Math.pow(Math.sin((u-a)/2),2)+Math.cos(a)*Math.cos(u)*Math.pow(Math.sin((o-n)/2),2)));return i(6378137*c,2)};t.computeSphericalCenter=function(e){if(e.length<1)return null;if(1===e.length)return e[0];var t=0,o=0,u=0,c,s=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}}(e))){i&&(e=i);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o,u=!0,c=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return u=e.done,e},e:function(e){c=!0,o=e},f:function(){try{!u&&null!=i.return&&i.return()}finally{if(c)throw o}}}}(e);try{for(s.s();!(c=s.n()).done;){var l=c.value,d=r(l.lon),f=r(l.lat),p=Math.cos(f)*Math.cos(d),h=Math.cos(f)*Math.sin(d),y=Math.sin(f);t+=p,o+=h,u+=y}}catch(e){s.e(e)}finally{s.f()}var v=t/e.length,m=o/e.length,b=u/e.length,g=a(Math.atan2(m,v));return{lat:i(a(Math.atan2(b,Math.sqrt(v*v+m*m))),13),lon:i(g,13)}};t.deltaLongitude=function(e,t){return i(a(t/(6378137*Math.cos(r(e)))),13)};t.deltaLatitude=function(e){return i(e/(40075e3/360),13)}},66225:function(e,t,n){var r=n(14746);Object.defineProperty(t,"__esModule",{value:!0}),t.geo=t.user=t.paper=t.dacc=t.sharing=t.timeseries=t.document=t.contact=t.utils=t.permission=t.note=t.account=t.konnectorFolder=t.folder=t.file=t.applications=t.instance=t.trigger=t.accounts=t.triggers=void 0;var a=r(n(43408));t.trigger=a;var i=r(n(73320));t.instance=i;var o=r(n(13114));t.applications=o;var u=r(n(72912));t.file=u;var c=r(n(16001));t.folder=c;var s=r(n(27871));t.konnectorFolder=s;var l=r(n(47980));t.account=l;var d=r(n(34083));t.note=d;var f=r(n(10037));t.permission=f;var p=r(n(25047));t.utils=p;var h=r(n(63892));t.contact=h;var y=r(n(12189));t.document=y;var v=r(n(19851));t.timeseries=v;var m=r(n(41567));t.sharing=m;var b=r(n(88799));t.dacc=b;var g=r(n(81828));t.paper=g;var k=r(n(63138));t.user=k;var _=r(n(69810));t.geo=_;t.triggers=a;t.accounts=l},73320:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.makeDiskInfos=t.hasPasswordDefinedAttribute=t.buildPremiumLink=t.hasAnOffer=t.shouldDisplayOffers=t.getUuid=t.isFreemiumUser=t.arePremiumLinksEnabled=t.isSelfHosted=void 0;var i=a(n(68434)),o=a(n(82007)),u=a(n(27361)),c=n(87549),s=5e10,l=function(e){return!(0,u.default)(e,"context.data.manager_url")};t.isSelfHosted=l;var d=function(e){return!!(0,u.default)(e,"context.data.enable_premium_links")};t.arePremiumLinksEnabled=d;var f=function(e){return parseInt((0,u.default)(e,"diskUsage.data.quota",!1))<=s};t.isFreemiumUser=f;var p=function(e){return(0,u.default)(e,"instance.data.uuid")};t.getUuid=p;t.shouldDisplayOffers=function(e){return!l(e)&&d(e)&&p(e)&&f(e)};t.hasAnOffer=function(e){return!l(e)&&d(e)&&p(e)&&!f(e)};t.buildPremiumLink=function(e){var t=(0,u.default)(e,"context.data.manager_url",!1),n=p(e);return t&&n?"".concat(t,"/cozy/instances/").concat(n,"/premium"):null};var h=(r=(0,o.default)(i.default.mark(function e(t){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetchQueryAndGetFromState({definition:(0,c.Q)("io.cozy.settings").getById("io.cozy.settings.instance"),options:{as:"io.cozy.settings/io.cozy.settings.instance",singleDocData:!0}});case 3:return n=e.sent.data.password_defined,e.abrupt("return",!!n);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",!1);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(e){return r.apply(this,arguments)});t.hasPasswordDefinedAttribute=h;var y=function(e){return 1e-9*e},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"".concat(e%1?e.toFixed(t):e)},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return{diskQuota:y(t),diskUsage:y(e),percentUsage:e/t*100}};t.makeDiskInfos=function(e,t){var n=m(+e,t?+t:void 0),r=n.diskQuota,a=n.diskUsage,i=n.percentUsage;return{humanDiskQuota:v(r),humanDiskUsage:v(a),percentUsage:Math.round(i).toString()}}},27871:function(e,t,n){var r,a,i,o,u,c,s,l=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.findKonnectorAccountFolderByReference=t.buildFolderPermission=t.buildFolderPath=t.statDirectoryByPath=t.createDirectoryByPath=t.ensureKonnectorFolder=void 0;var d=l(n(68434)),f=l(n(90402)),p=l(n(82007)),h=n(16001);l(n(88477));var y=n(47980),v=n(37689),m=n(87549),b="io.cozy.files";var g=(r=(0,p.default)(d.default.mark(function e(t,n){var r,a,i,o,u,c,s,l,p,m,g,w,S,x,E,P;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.konnector,a=n.account,i=n.lang,o=t.collection("io.cozy.permissions"),u=t.collection(b),c=(0,v.getLocalizer)(i),e.next=6,Promise.all([(0,h.ensureMagicFolder)(t,h.MAGIC_FOLDERS.ADMINISTRATIVE,c("MagicFolders.administrative")),(0,h.ensureMagicFolder)(t,h.MAGIC_FOLDERS.PHOTOS,c("MagicFolders.photos"))]);case 6:return s=e.sent,p=(l=(0,f.default)(s,2))[0],m=l[1],g=(0,y.getAccountName)(a),e.next=13,M({client:t,slug:r.slug,sourceAccountIdentifier:g});case 13:if(!(w=e.sent)){e.next=16;break}return e.abrupt("return",w);case 16:return e.next=18,N({client:t,slug:r.slug});case 18:if(!(S=e.sent)){e.next=23;break}return e.next=22,function(e){return F.apply(this,arguments)}({client:t,mainFolder:S,konnector:r,sourceAccountIdentifier:g});case 22:return e.abrupt("return",e.sent);case 23:return x=O(r,a,{administrative:p.path,photos:m.path}),e.next=26,_(t,x);case 26:if(e.t0=e.sent,e.t0){e.next=31;break}return e.next=30,k(t,x);case 30:e.t0=e.sent;case 31:return E=e.t0,e.next=34,u.statById(E.dir_id);case 34:return P=e.sent.data,e.next=38,Promise.all([o.add(r,D(E)),R({client:t,folder:E,konnector:r}),I({client:t,folder:E,sourceAccountIdentifier:g}),R({client:t,folder:P,konnector:r})]);case 38:return e.abrupt("return",E);case 39:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.ensureKonnectorFolder=g;var k=(a=(0,p.default)(d.default.mark(function e(t,n){var r;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(b).createDirectoryByPath(n);case 2:return r=e.sent.data,e.abrupt("return",r);case 5:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)});t.createDirectoryByPath=k;var _=(i=(0,p.default)(d.default.mark(function e(t,n){var r;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.collection(b).statByPath(n);case 3:if(!(r=e.sent).data.trashed){e.next=6;break}return e.abrupt("return",null);case 6:return e.abrupt("return",r.data);case 9:if(e.prev=9,e.t0=e.catch(0),!(e.t0&&404===e.t0.status)){e.next=13;break}return e.abrupt("return",null);case 13:throw Error(e.t0.message);case 14:case"end":return e.stop()}},e,null,[[0,9]])})),function(e,t){return i.apply(this,arguments)});t.statDirectoryByPath=_;var O=function(e,t){var n,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=j(((null==e?void 0:null===(n=e.folders)||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:r.defaultDir)||"$administrative/$konnector/$account").replace(/(\/+)/g,"/"),"/");!w(i)&&(i="$administrative/"+i);var o=i.split("/",1),u=x(i,o[0]),c=E(o[0],a),s=P(u,{konnector:e.name,account:(0,y.getAccountName)(t).replace(C,"-")});return"/".concat(c,"/").concat(s)};t.buildFolderPath=O;var w=function(e){return S.some(function(t){return e.startsWith(t)})},S=["$administrative","$photos"],x=function(e,t){var n=e.substring(t.length);return""===n&&(n="$konnector/$account"),n},E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return j((t[e.slice(1)]||"Administrative").replace(/(\/+)/g,"/"),"/")},P=function(e,t){return j(e.replace(/(\/+)/g,"/"),"/").split("/").map(function(e){return(null==t?void 0:t[e.slice(1)])||e}).join("/")},C=/\//g,D=function(e){return{saveFolder:{type:b,values:[e._id],verbs:["GET","PATCH","POST"]}}};t.buildFolderPermission=D;var j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\\s";return e.replace(new RegExp("^([".concat(t,"]*)(.*?)([").concat(t,"]*)$")),"$2")},A=function(e,t){var n;return!!(null===(n=e.referenced_by)||void 0===n?void 0:n.find(function(e){return"io.cozy.konnectors"===e.type&&e.id==="io.cozy.konnectors/"+t}))},T=function(e,t){var n;return!!(null===(n=e.referenced_by)||void 0===n?void 0:n.find(function(e){return"io.cozy.accounts.sourceAccountIdentifier"===e.type&&(!t||e.id===t)}))};var R=(o=(0,p.default)(d.default.mark(function e(t){var n,r,a,i;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.client,r=t.folder,a=t.konnector,i=n.collection(b),A(r,a.slug)){e.next=5;break}return e.next=5,i.addReferencesTo(a,[r]);case 5:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)});var I=(u=(0,p.default)(d.default.mark(function e(t){var n,r,a,i;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.client,r=t.folder,a=t.sourceAccountIdentifier,i=n.collection(b),T(r,a)){e.next=5;break}return e.next=5,i.addReferencesTo({_id:a,_type:"io.cozy.accounts.sourceAccountIdentifier"},[r]);case 5:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)});var M=(c=(0,p.default)(d.default.mark(function e(t){var n,r,a,i;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.slug,a=t.sourceAccountIdentifier,e.next=3,n.query((0,m.Q)(b).partialIndex({type:"directory",trashed:!1}).referencedBy({_type:"io.cozy.konnectors",_id:"io.cozy.konnectors/".concat(r)}));case 3:return i=e.sent.included,e.abrupt("return",i.find(function(e){return T(e,a)}));case 6:case"end":return e.stop()}},e)})),function(e){return c.apply(this,arguments)});t.findKonnectorAccountFolderByReference=M;var N=(s=(0,p.default)(d.default.mark(function e(t){var n,r,a;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.slug,e.next=3,n.query((0,m.Q)(b).partialIndex({type:"directory",trashed:!1}).referencedBy({_type:"io.cozy.konnectors",_id:"io.cozy.konnectors/".concat(r)}));case 3:return a=e.sent.included,e.abrupt("return",a.find(function(e){return!T(e)}));case 6:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)});function F(){return(F=(0,p.default)(d.default.mark(function e(t){var n,r,a,i,o,u;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.mainFolder,a=t.konnector,i=t.sourceAccountIdentifier,o=r.path+"/"+i,e.next=4,_(n,o);case 4:if(e.t0=e.sent,e.t0){e.next=9;break}return e.next=8,k(n,o);case 8:e.t0=e.sent;case 9:return u=e.t0,e.next=12,R({client:n,folder:u,konnector:a});case 12:return e.next=14,I({client:n,folder:u,sourceAccountIdentifier:i});case 14:return e.abrupt("return",u);case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}},1423:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.sanitizeCategories=h,t.areTermsValid=y,t.isPartnershipValid=v,t.sanitize=function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e);return!e.categories&&e.category&&"string"==typeof e.category&&(t.categories=[e.category],delete t.category),t.categories=h(t.categories),"object"==typeof e.name&&(t.name=e.name.en),e.available_version&&(t.availableVersion=e.available_version,delete t.available_version),e.latest_version&&(t.latestVersion=e.latestVersion,delete t.latest_version),t.terms&&!y(t.terms)&&delete t.terms,t.partnership&&!v(t.partnership)&&delete t.partnership,t.fields&&(t.fields=b(e.fields)),t},t.getIdentifier=t.sanitizeIdentifier=t.legacyLoginFields=t.ROLE_IDENTIFIER=void 0;var a=r(n(64512)),i=r(n(59242)),o=r(n(50361)),u=r(n(70894));function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var l="identifier";t.ROLE_IDENTIFIER=l;var d=["login","identifier","new_identifier","email"];t.legacyLoginFields=d;var f=["secret","dob","code","answer","access_token","refresh_token","appSecret"],p=["banking","cozy","energy","health","host_provider","insurance","isp","mes_infos","online_services","others","partners","press","productivity","ptnb","public_service","shopping","social","telecom","transport"];function h(e){if(!e)return["others"];var t=e.filter(function(e){return p.includes(e)});return t.length?t:["others"]}function y(e){return!!(e&&e.id&&e.url&&e.version)}function v(e){return!!(e&&e.description)}var m=function(e){var t=(0,o.default)(e),n=!1;for(var r in t)t[r].role===l&&(n?delete t[r].role:n=!0);if(n)return t;var a,i=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(d);try{for(i.s();!(a=i.n()).done;){var u=a.value;if(t[u])return t[u].role=l,t}}catch(e){i.e(e)}finally{i.f()}for(var s in t)if("password"!==t[s].type){t[s].role=l;break}return t};t.sanitizeIdentifier=m;t.getIdentifier=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,u.default)(m(e),function(e){return e.role===l})||null};var b=(0,i.default)([function(e){var t=(0,o.default)(e);return delete t.advancedFields,t},m,function(e){var t=(0,o.default)(e);for(var n in t){var r=t[n],a=void 0===r.required?r.isRequired:r.required;t[n].required="boolean"!=typeof a||a}return t},function(e){var t=(0,o.default)(e);for(var n in t){var r=t[n];"boolean"!=typeof r.encrypted&&(r.encrypted="password"===r.type||f.includes(n))}return t}])},34083:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchURL=t.generateUrlForNote=t.generatePrivateUrl=void 0;var i=a(n(68434)),o=a(n(82007)),u=n(64157),c=a(n(81602)),s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.returnUrl,a=new URL(e);return r&&a.searchParams.set("returnUrl",r),a.hash="#/n/".concat(t.id),a.toString()};t.generatePrivateUrl=s;t.generateUrlForNote=function(e,t){return c.default.warn("generateUrlForNote is deprecated. Please use models.note.generatePrivateUrl instead"),s(e,t)};var l=(r=(0,o.default)(i.default.mark(function e(t,n){var r,a,o,c,s,l,d,f,p,h,y,v=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=v.length>2&&void 0!==v[2]?v[2]:{},e.next=3,t.getStackClient().collection("io.cozy.notes").fetchURL({_id:n.id});case 3:if(o=(a=e.sent.data).note_id,c=a.subdomain,s=a.protocol,l=a.instance,d=a.sharecode,f=a.public_name,!d){e.next=18;break}return(h=[["id",o]]).push(["sharecode",d]),f&&h.push(["username",f]),e.abrupt("return",(0,u.generateWebLink)({cozyUrl:"".concat(s,"://").concat(l),searchParams:h,pathname:null!==(p=r.pathname)&&void 0!==p?p:"/public/",slug:"notes",subDomainType:c}));case 18:return e.abrupt("return",(0,u.generateWebLink)({cozyUrl:"".concat(s,"://").concat(l),pathname:null!==(y=r.pathname)&&void 0!==y?y:"",slug:"notes",subDomainType:c,hash:"/n/".concat(o)}));case 19:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.fetchURL=l},81828:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isForeignPaper=t.makeExpirationDescription=t.makeExpiresInMessage=t.makeExpiredMessage=t.formatContactValue=t.getTranslatedNameForContact=t.formatOtherMetadataValue=t.getTranslatedNameForOtherMetadata=t.formatInformationMetadataValue=t.getTranslatedNameForInformationMetadata=t.formatDateMetadataValue=t.getTranslatedNameForDateMetadata=t.getMetadataQualificationType=t.formatMetadataQualification=t.isExpiringSoon=t.isExpired=t.computeExpirationNoticeLink=t.computeExpirationNoticeDate=t.computeExpirationDate=t.isExpiring=t.KNOWN_BILLS_ATTRIBUTES_NAMES=t.KNOWN_OTHER_METADATA_NAMES=t.KNOWN_INFORMATION_METADATA_NAMES=t.KNOWN_DATE_METADATA_NAMES=void 0;var a=r(n(98235)),i=r(n(29422)),o=r(n(27546)),u=r(n(94581)),c=r(n(99580)),s=n(37689),l=n(84854),d=n(63892),f=r(n(27361)),p=n(74632),h={national_id_card:"https://www.service-public.fr/particuliers/vosdroits/N358",residence_permit:"https://www.service-public.fr/particuliers/vosdroits/N110",passport:"https://www.service-public.fr/particuliers/vosdroits/N360",driver_license:"https://permisdeconduire.ants.gouv.fr/demarches-en-ligne/perte-vol-deterioration-fin-de-validite-ou-changement-d-etat-civil"},y=["AObtentionDate","BObtentionDate","CObtentionDate","DObtentionDate","obtentionDate","expirationDate","referencedDate","issueDate","shootingDate","date","datetime"];t.KNOWN_DATE_METADATA_NAMES=y;var v=["number","bicNumber","country","refTaxIncome","contractType","netSocialAmount","employerName","vehicle.licenseNumber","vehicle.confidentialNumber","noticePeriod"];t.KNOWN_INFORMATION_METADATA_NAMES=v;var m=["contact","page","qualification"];t.KNOWN_OTHER_METADATA_NAMES=m;var b=["amount","subtype","employer"];t.KNOWN_BILLS_ATTRIBUTES_NAMES=b;var g=function(e){var t,n,r,a,i,o=null===(t=e.metadata)||void 0===t?void 0:null===(n=t.qualification)||void 0===n?void 0:n.label,u=null===(r=e.metadata)||void 0===r?void 0:r.country,c=null===(a=e.metadata)||void 0===a?void 0:a.expirationDate,s=null===(i=e.metadata)||void 0===i?void 0:i.noticePeriod;return"national_id_card"===o&&(!u||"fr"===u)&&!!c&&!!s||!1},k=function(e){var t,n,r=null===(t=e.metadata)||void 0===t?void 0:t.expirationDate,a=null===(n=e.metadata)||void 0===n?void 0:n.noticePeriod;return!!r&&!!a||!1},_=function(e){var t,n,r,a=null===(t=e.metadata)||void 0===t?void 0:null===(n=t.qualification)||void 0===n?void 0:n.label,i=null===(r=e.metadata)||void 0===r?void 0:r.referencedDate,o=e.created_at;return"personal_sporting_licence"===a&&(!!i||!!o)||!1};t.isExpiring=function(e){return!!(g(e)||k(e)||_(e))||!1};var O=function(e){if(g(e)||k(e)){var t;return new Date(null===(t=e.metadata)||void 0===t?void 0:t.expirationDate)}if(_(e)){var n,r=null===(n=e.metadata)||void 0===n?void 0:n.referencedDate,a=e.created_at;return(0,i.default)(new Date(null!=r?r:a),{days:365})}return null};t.computeExpirationDate=O;var w=function(e){if(g(e)||k(e)){var t;return parseInt(null===(t=e.metadata)||void 0===t?void 0:t.noticePeriod,10)}return _(e)?15:null},S=function(e){var t=O(e);if(null==t)return null;var n=w(e);return null==n?null:(0,o.default)(t,{days:n})};t.computeExpirationNoticeDate=S;t.computeExpirationNoticeLink=function(e){var t,n,r=null===(t=e.metadata)||void 0===t?void 0:null===(n=t.qualification)||void 0===n?void 0:n.label;return r&&h[r]||null};t.isExpired=function(e){var t=new Date,n=O(e);return null!=n&&n<=t};t.isExpiringSoon=function(e){var t=new Date,n=O(e),r=S(e);return null!=n&&null!=r&&r<=t&&t<n};var x=function(e){var t=e.metadata,n=e.knownMetadataPath,r=e.value||(0,f.default)(t,n,null)||null;return Object.keys(t).some(function(e){return n.startsWith(e)})||"contact"===n?{name:n,value:r}:null};t.formatMetadataQualification=function(e){var t=y.map(function(t){return x({metadata:e,knownMetadataPath:t})}).filter(Boolean).filter(function(e,t,n){return n.length>1?"datetime"!==e.name:e}),n=v.map(function(t){return x({metadata:e,knownMetadataPath:t})}).filter(Boolean),r=m.map(function(t){var n,r="qualification"===t?null===(n=e[t])||void 0===n?void 0:n.label:e[t];return x({metadata:e,knownMetadataPath:t,value:r})}).filter(Boolean);return[].concat((0,a.default)(t),(0,a.default)(n),(0,a.default)(r))};t.getMetadataQualificationType=function(e){if(y.includes(e))return"date";if(v.includes(e))return"information";if(m.includes(e))return"contact"===e?"contact":"other";return b.includes(e)?"bills":null};t.getTranslatedNameForDateMetadata=function(e,t){var n=t.lang;return(0,s.getLocalizer)(n)("Scan.qualification.date.title.".concat(e))};t.formatDateMetadataValue=function(e,t){var n=t.lang,r=t.f,a=(0,s.getLocalizer)(n);return e?"en"===n?r(e,"MM/DD/YYYY"):r(e,"DD/MM/YYYY"):a("Scan.qualification.noInfo")};t.getTranslatedNameForInformationMetadata=function(e,t){var n=t.lang,r=t.qualificationLabel,a=(0,s.getLocalizer)(n);return"number"===e?a("Scan.qualification.information.title.".concat(r,".").concat(e)):a("Scan.qualification.information.title.".concat(e))};t.formatInformationMetadataValue=function(e,t){var n=t.lang,r=t.name,a=t.qualificationLabel,i=(0,s.getLocalizer)(n),o=(0,l.getLocalizer)(n).t;return"number"==typeof e||e?"noticePeriod"===r?"".concat(e," ").concat(i("Scan.qualification.information.day",{smart_count:e})):"contractType"===r?i("Scan.attributes.contractType.".concat(e),{_:e}):"refTaxIncome"===r||"netSocialAmount"===r||"amount"===r||"number"===r&&"pay_sheet"===a?"".concat(e," "):"country"===r&&(0,p.isValidCountryCodeTranslation)(n,e)?o("countries.".concat(e)):e:i("Scan.qualification.noInfo")};t.getTranslatedNameForOtherMetadata=function(e,t){var n=t.lang;return(0,s.getLocalizer)(n)("Scan.qualification.".concat(e))};t.formatOtherMetadataValue=function(e,t){var n=t.lang,r=t.name,a=(0,s.getLocalizer)(n);return"qualification"===r?a("Scan.items.".concat(e),{smart_count:1}):a("Scan.qualification.".concat(e))};t.getTranslatedNameForContact=function(e){var t=e.lang;return(0,s.getLocalizer)(t)("Scan.qualification.contact")};t.formatContactValue=function(e){return e&&e.length>0?e.map(function(e){return"".concat((0,d.getDisplayName)(e))}).join(", "):""};t.makeExpiredMessage=function(e){var t=e.lang;return(0,s.getLocalizer)(t)("Scan.expiration.expired")};t.makeExpiresInMessage=function(e,t){var n=t.lang;return(0,s.getLocalizer)(n)("Scan.expiration.expiresIn",{duration:(0,u.default)(new Date(e),{locale:"fr"===n?c.default:void 0})})};t.makeExpirationDescription=function(e,t){var n=t.lang;return(0,s.getLocalizer)(n)("Scan.expiration.description",{duration:(0,u.default)(new Date(e),{locale:"fr"===n?c.default:void 0})})};t.isForeignPaper=function(e){var t;return null!==(t=e.metadata)&&void 0!==t&&!!t.country&&"fr"!==e.metadata.country.toLowerCase()}},10037:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isReadOnly=v,t.fetchOwn=m,t.isForType=g,t.isDocumentReadOnly=function(e){return _.apply(this,arguments)},t.isShortcutCreatedOnTheRecipientCozy=void 0;var a=r(n(64512)),i=r(n(68434)),o=r(n(82007)),u=r(n(98235)),c=r(n(25325)),s=r(n(27361));r(n(88477));var l=n(87549),d=n(72912),f=n(71791),p=r(n(81602));function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.writability;return e.verbs&&e.verbs.length>0&&0===(0,c.default)(e.verbs,["ALL"].concat((0,u.default)(void 0===n?["PATCH","POST","PUT","DELETE"]:n))).length}function m(e){return b.apply(this,arguments)}function b(){return(b=(0,o.default)(i.default.mark(function e(t){var n,r,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection("io.cozy.permissions"),e.next=3,n.fetchOwnPermissions();case 3:if(r=e.sent,a=(0,s.default)(r,"data.attributes.permissions")){e.next=7;break}throw"Can't get self permissions";case 7:return e.abrupt("return",Object.values(a));case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function g(e,t){return e.type===t||e.type+".*"===t}function k(){return(k=(0,o.default)(i.default.mark(function e(t){var n,r,a,u,c,s,p,h,v,b,k;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(k=function(){return(k=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.doc,r=t.client,!(o=(a=t.perms).find(function(e){if(!e.values)return!0;var t=n[e.selector||"id"];return e.values.includes(t)}))){e.next=6;break}return e.abrupt("return",o);case 6:if(c!==f.DOCTYPE_FILES){e.next=16;break}if(u=(0,d.getParentFolderId)(n),e.t0=u,!e.t0){e.next=13;break}return e.next=12,h(u);case 12:e.t0=e.sent;case 13:if(!(s=e.t0)){e.next=16;break}return e.abrupt("return",b({doc:s,perms:a,client:r}));case 16:return e.abrupt("return",void 0);case 17:case"end":return e.stop()}},e)}))).apply(this,arguments)},b=function(e){return k.apply(this,arguments)},v=function(){return(v=(0,o.default)(i.default.mark(function e(t){var n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,l.Q)(f.DOCTYPE_FILES).getById(t),e.next=3,r.query(n);case 3:return a=e.sent,e.abrupt("return",a&&a.data);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)},h=function(e){return v.apply(this,arguments)},n=t.document,r=t.client,a=t.permissions,u=n._id||n.id,c=n._type||n.type,s=y(y({},n),{},{id:u,type:c}),!a){e.next=12;break}e.t0=a,e.next=15;break;case 12:return e.next=14,m(r);case 14:e.t0=e.sent;case 15:return p=e.t0.filter(function(e){return g(e,c)}),e.abrupt("return",b({doc:s,client:r,perms:p}));case 18:case"end":return e.stop()}},e)}))).apply(this,arguments)}function _(){return(_=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.document,r=t.client,a=t.writability,void 0!==(o=t.permissions)){e.next=10;break}return e.next=7,m(r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=o;case 11:if(!((u=e.t0).length<=1)){e.next=16;break}e.t1=u[0],e.next=19;break;case 16:return e.next=18,function(e){return k.apply(this,arguments)}({document:n,client:r,permissions:u});case 18:e.t1=e.sent;case 19:if(!(c=e.t1)){e.next=24;break}return e.abrupt("return",v(c,{writability:a}));case 24:return p.default.warn("can't find the document in current attached permissions"),e.abrupt("return",void 0);case 26:case"end":return e.stop()}},e)}))).apply(this,arguments)}t.isShortcutCreatedOnTheRecipientCozy=function(e){if(!e.included)return!1;var t=e.included.find(function(e){return"io.cozy.sharings.members"===e.type});return!!t&&!!t.attributes.instance||!1}},41567:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getSharingLink=void 0;var i=a(n(68434)),o=a(n(64512)),u=a(n(82007)),c=n(71791);a(n(88477));var s=n(64157);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var f=(r=(0,u.default)(i.default.mark(function e(t,n){var r,a,o,u,l,f,p,h,y=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=(o=y.length>2&&void 0!==y[2]?y[2]:{}).ttl,l=o.password,f=d(d({_type:c.DOCTYPE_PERMISSIONS,permissions:{files:{type:c.DOCTYPE_FILES,values:n,verbs:["GET"]}}},u&&{ttl:u}),l&&{password:l}),e.next=4,t.save(f);case 4:return p=e.sent.data,h=(0,s.generateWebLink)({cozyUrl:t.getStackClient().uri,searchParams:[["sharecode",null==p?void 0:null===(r=p.attributes)||void 0===r?void 0:null===(a=r.shortcodes)||void 0===a?void 0:a.code]],pathname:"/public",slug:"drive",subDomainType:t.capabilities.flat_subdomains?"flat":"nested"}),e.abrupt("return",h);case 8:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.getSharingLink=f},19851:function(e,t,n){var r,a,i=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchTimeSeriesByIntervalAndSource=t.saveTimeSeries=void 0;var o=i(n(68434)),u=i(n(82007)),c=n(87549),s=function(e){if(!e.startDate||!e.endDate)throw Error("You must specify a startDate and endDate for the time serie");if(!Date.parse(e.startDate)||!Date.parse(e.endDate))throw Error("Invalid date format for the time serie");if(!e.dataType)throw Error("You must specify a dataType for the time serie");if(!e.series||!Array.isArray(e.series))throw Error("You must specify a series array for the time serie")};var l=(r=(0,u.default)(o.default.mark(function e(t,n){var r,a,i,u,c,l,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.dataType,a=n.series,i=n.startDate,u=n.endDate,c=n.source,l=n.theme,s({dataType:r,series:a,startDate:i,endDate:u,source:c}),d={_type:"io.cozy.timeseries.".concat(r),startDate:i,endDate:u,source:c,theme:l,series:a},e.abrupt("return",t.save(d));case 5:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.saveTimeSeries=l;var d=(a=(0,u.default)(o.default.mark(function e(t,n){var r,a,i,u,s,l,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.startDate,a=n.endDate,i=n.dataType,u=n.source,s=n.limit,l="io.cozy.timeseries.".concat(i),d=(0,c.Q)(l).where({source:u,startDate:{$gte:r},endDate:{$lte:a}}).indexFields(["source","startDate","endDate"]).sortBy([{source:"desc"},{startDate:"desc"},{endDate:"desc"}]).limitBy(s||5),e.abrupt("return",t.query(d));case 4:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)});t.fetchTimeSeriesByIntervalAndSource=d},43408:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.triggers=t.triggerStates=void 0;var a=r(n(64512)),i=n(47980),o=r(n(81602));function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var s=["CHALLENGE_ASKED","DISK_QUOTA_EXCEEDED","TERMS_VERSION_MISMATCH","USER_ACTION_NEEDED","USER_ACTION_NEEDED.CHANGE_PASSWORD","USER_ACTION_NEEDED.ACCOUNT_REMOVED","USER_ACTION_NEEDED.WEBAUTH_REQUIRED","USER_ACTION_NEEDED.SCA_REQUIRED","LOGIN_FAILED"],l={getLastExecution:function(e){var t;return null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_execution},getLastSuccess:function(e){var t;return null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_success},getLastsuccess:function(e){var t;return o.default.warn("Deprecated, please use getLastSuccess instead of getLastsuccess"),null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_success},isErrored:function(e){var t;return(null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.status)==="errored"},getLastErrorType:function(e){var t;return null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_error}};t.triggerStates=l;var d={isKonnectorWorker:function(e){return"konnector"===e.worker},isKonnector:function(e){return"konnector"===e.worker||"client"===e.worker},getKonnector:function(e){return d.isKonnector(e)?e.message&&e.message.konnector?e.message.konnector:e.message&&e.message.Data?JSON.parse(atob(e.message.Data)).konnector:void 0:null},getAccountId:function(e){var t,n,r=null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.Data;return r?JSON.parse(atob(r)).account:null==e?void 0:null===(n=e.message)||void 0===n?void 0:n.account},isLatestErrorMuted:function(e,t){var n=l.getLastErrorType(e),r=l.getLastSuccess(e),a=r?new Date(r):new Date;return(0,i.getMutedErrors)(t).some(function(e){return e.type===n&&(!r||new Date(e.mutedAt)>a)})},hasActionableError:function(e){var t;return s.includes(null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_error)},buildTriggerAttributes:function(e){var t=e.account,n=e.cron,r=e.folder,a=e.konnector,i={account:t._id,konnector:a.slug};r&&(i.folder_to_save=r._id);var o=a.clientSide?{type:"@client"}:{type:"@cron",arguments:void 0===n?"0 0 0 * * 0":n};return c(c({},{worker:"konnector",message:i}),o)}};t.triggers=d},63138:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.hasPassword=void 0;var i=a(n(68434)),o=a(n(82007)),u=n(73320),c=n(60841),s=n(50300);var l=(r=(0,o.default)(i.default.mark(function e(t){var n,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.hasExtensionInstalledAttribute)(t);case 2:return n=e.sent,e.next=5,(0,u.hasPasswordDefinedAttribute)(t);case 5:return r=e.sent,e.abrupt("return",!((0,s.isMagicLink)(t)||(0,s.isOIDC)(t))||n||r);case 7:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)});t.hasPassword=l},25047:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getFlagshipDownloadLink=t.getCreatedByApp=t.hasBeenUpdatedByApp=void 0;var a=r(n(27361)),i=n(25976),o=r(n(71400));t.hasBeenUpdatedByApp=function(e,t){var n=(0,a.default)(e,"cozyMetadata.updatedByApps");return!!(n&&n.find(function(e){return e.slug===t}))};t.getCreatedByApp=function(e){return(0,a.default)(e,"cozyMetadata.createdByApp")};t.getFlagshipDownloadLink=function(e){if((0,i.isAndroid)()){var t=(0,o.default)("flagship.playstore-id")||"io.cozy.flagship.mobile";return"https://play.google.com/store/apps/details?id=".concat(t,"&hl=").concat(e)}if((0,i.isIOS)()){var n=(0,o.default)("flagship.appstore-id")||"id1600636174";return"https://apps.apple.com/".concat(e,"/app/").concat(n)}return(0,o.default)("flagship.download-link")||"https://cozy.io/".concat(e,"/download")}},83549:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={olderThan:function(e){return function(t){return!t||!t.lastUpdate||Date.now()-t.lastUpdate>e}},noFetch:function(){return!1}}},8665:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=function(){var e;function t(){(0,o.default)(this,t),this.pending={}}return(0,u.default)(t,[{key:"exec",value:(e=(0,i.default)(a.default.mark(function e(t,n){var r,i,o,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n(),(i=this.pending[r])?o=i:(o=t(),this.pending[r]=o),e.prev=3,e.next=6,o;case 6:return u=e.sent,e.abrupt("return",u);case 8:return e.prev=8,this.pending[r]=null,e.finish(8);case 11:case"end":return e.stop()}},e,this,[[3,,8,11]])})),function(t,n){return e.apply(this,arguments)})},{key:"get",value:function(e){var t=e(),n=this.pending[t];return n?n:null}}]),t}();t.default=c},87549:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.QueryDefinition=t.MutationTypes=t.Mutations=t.getDoctypeFromOperation=t.uploadFile=t.removeReferencedBy=t.addReferencedBy=t.removeReferencesTo=t.addReferencesTo=t.deleteDocument=t.updateDocuments=t.updateDocument=t.createDocument=t.isAGetByIdQuery=t.Q=void 0;var a=r(n(64512)),i=r(n(65105)),o=r(n(19723)),u=r(n(70894)),c=r(n(81602));function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,e),this.doctype=t.doctype,this.id=t.id,this.ids=t.ids,this.selector=t.selector,this.fields=t.fields,this.indexedFields=t.indexedFields,this.partialFilter=t.partialFilter,this.sort=t.sort,this.includes=t.includes,this.referenced=t.referenced,this.limit=t.limit,this.skip=t.skip,this.cursor=t.cursor,this.bookmark=t.bookmark}return(0,o.default)(e,[{key:"checkSortOrder",value:function(e){var t=e.sort,n=e.selector,r=e.indexedFields,a=this.sort||t,i=this.selector||n||{},o=this.indexedFields||r;if(!a)return;var u=o||Object.keys(i);if(!!u&&!(u.length<1)){if(a.length>u.length){c.default.warn("You should not sort on non-indexed fields.\n\n        Sort: ".concat(JSON.stringify(a),"\n\n        Indexed fields: ").concat(u));return}for(var s=0;s<a.length;s++)if(Object.keys(a[s])[0]!==u[s]){c.default.warn("The sort order should be the same than the indexed fields.\n\n          Sort: ".concat(JSON.stringify(a),"\n\n          Indexed fields: ").concat(u,"\n"));return}}}},{key:"checkSelector",value:function(e){(0,u.default)(e,["$exists",!1])&&c.default.warn('The "$exists: false" predicate should be defined as a partial index for better performance.\n\n        Selector: '.concat(JSON.stringify(e))),(0,u.default)(e,"$ne")&&c.default.info("The use of the $ne operator is more efficient with a partial index.\n\n        Selector: ".concat(JSON.stringify(e)));var t=(0,u.default)(e,function(e){return Array.isArray(e)});if(t&&!t.startsWith("$"))throw Error("You pass ".concat(JSON.stringify(e),", this is a valid mango operation, \n\n        but sift doesn't support it so CozyClient can not evaluate \n\n        the request in memory. You must use a MongoDB operator \n\n        like $in or $or operator instead, preferably in a partial index, \n\n        to avoid costly full-scan"))}},{key:"checkSelectFields",value:function(e){var t=e.fields,n=e.selector,r=e.partialFilter,a=this.fields||t,i=this.selector||n,o=this.partialFilter||r;if(!!a&&(!!i||!!o)){if(!Object.keys(l(l({},i),o)).every(function(e){return a.includes(e)}))throw Error("The .select should includes all the fields used in where or partialIndex.\n        Please fix this query: fields: ".concat(JSON.stringify(this.toDefinition())))}}},{key:"getById",value:function(t){if(!t)throw Error("getById called with undefined id");return new e(l(l({},this.toDefinition()),{},{id:t}))}},{key:"getByIds",value:function(t){return new e(l(l({},this.toDefinition()),{},{ids:t}))}},{key:"where",value:function(t){return this.checkSortOrder({selector:t}),this.checkSelector(t),this.checkSelectFields({selector:t}),new e(l(l({},this.toDefinition()),{},{selector:t}))}},{key:"select",value:function(t){return this.checkSelectFields({fields:t}),new e(l(l({},this.toDefinition()),{},{fields:t}))}},{key:"indexFields",value:function(t){return this.checkSortOrder({indexedFields:t}),new e(l(l({},this.toDefinition()),{},{indexedFields:t}))}},{key:"partialIndex",value:function(t){return this.checkSelectFields({partialFilter:t}),new e(l(l({},this.toDefinition()),{},{partialFilter:t}))}},{key:"sortBy",value:function(t){if(!Array.isArray(t))throw Error('Invalid sort, should be an array ([{ label: "desc"}, { name: "asc"}]), you passed '.concat(JSON.stringify(t),"."));return this.checkSortOrder({sort:t}),new e(l(l({},this.toDefinition()),{},{sort:t}))}},{key:"include",value:function(t){if(!Array.isArray(t))throw Error("include() takes an array of relationship names");return new e(l(l({},this.toDefinition()),{},{includes:t}))}},{key:"limitBy",value:function(t){return new e(l(l({},this.toDefinition()),{},{limit:t}))}},{key:"UNSAFE_noLimit",value:function(){return new e(l(l({},this.toDefinition()),{},{limit:null}))}},{key:"offset",value:function(t){return new e(l(l({},this.toDefinition()),{},{bookmark:void 0,cursor:void 0,skip:t}))}},{key:"offsetCursor",value:function(t){return new e(l(l({},this.toDefinition()),{},{bookmark:void 0,skip:void 0,cursor:t}))}},{key:"offsetBookmark",value:function(t){return new e(l(l({},this.toDefinition()),{},{skip:void 0,cursor:void 0,bookmark:t}))}},{key:"referencedBy",value:function(t){return new e(l(l({},this.toDefinition()),{},{referenced:t}))}},{key:"toDefinition",value:function(){return{doctype:this.doctype,id:this.id,ids:this.ids,selector:this.selector,fields:this.fields,indexedFields:this.indexedFields,partialFilter:this.partialFilter,sort:this.sort,includes:this.includes,referenced:this.referenced,limit:this.limit,skip:this.skip,cursor:this.cursor,bookmark:this.bookmark}}}]),e}();t.QueryDefinition=d;t.Q=function(e){return new d({doctype:e})};t.isAGetByIdQuery=function(e){if(!e)return!1;var t=Object.values(e);return 0!==t.length&&2===t.filter(function(e){return void 0!==e}).length&&void 0!==e.id};var f="CREATE_DOCUMENT",p="UPDATE_DOCUMENT",h="UPDATE_DOCUMENTS",y="DELETE_DOCUMENT",v="ADD_REFERENCES_TO",m="UPLOAD_FILE",b=function(e){return{mutationType:P.CREATE_DOCUMENT,document:e}};t.createDocument=b;var g=function(e){return{mutationType:P.UPDATE_DOCUMENT,document:e}};t.updateDocument=g;var k=function(e){return{mutationType:P.UPDATE_DOCUMENTS,documents:e}};t.updateDocuments=k;var _=function(e){return{mutationType:P.DELETE_DOCUMENT,document:e}};t.deleteDocument=_;var O=function(e,t){return{mutationType:P.ADD_REFERENCES_TO,referencedDocuments:t,document:e}};t.addReferencesTo=O;var w=function(e,t){return{mutationType:P.REMOVE_REFERENCES_TO,referencedDocuments:t,document:e}};t.removeReferencesTo=w;var S=function(e,t){return{mutationType:P.ADD_REFERENCED_BY,referencedDocuments:t,document:e}};t.addReferencedBy=S;var x=function(e,t){return{mutationType:P.REMOVE_REFERENCED_BY,referencedDocuments:t,document:e}};t.removeReferencedBy=x;var E=function(e,t){return{mutationType:P.UPLOAD_FILE,file:e,dirPath:t}};t.uploadFile=E;t.getDoctypeFromOperation=function(e){if(!e.mutationType)return e.doctype;var t=e.mutationType;switch(t){case f:case p:return e.document._type;case h:return e.documents[0]._type;case y:return e.document._type;case v:case m:throw Error("Not implemented");default:throw Error("Unknown mutationType ".concat(t))}};t.Mutations={createDocument:b,updateDocument:g,updateDocuments:k,deleteDocument:_,addReferencesTo:O,removeReferencesTo:w,addReferencedBy:S,removeReferencedBy:x,uploadFile:E};var P={CREATE_DOCUMENT:f,UPDATE_DOCUMENT:p,UPDATE_DOCUMENTS:h,DELETE_DOCUMENT:y,ADD_REFERENCES_TO:v,REMOVE_REFERENCES_TO:"REMOVE_REFERENCES_TO",ADD_REFERENCED_BY:"ADD_REFERENCED_BY",REMOVE_REFERENCED_BY:"REMOVE_REFERENCED_BY",UPLOAD_FILE:m};t.MutationTypes=P},6436:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(66604)),i=r(n(7739)),o=r(n(85564)),u=r(n(18446)),c=r(n(44908)),s=r(n(87185)),l=n(87549),d=function(e){var t=(0,i.default)(e,function(e){var t;return(t=e).id||t.ids?"idQueries":"others"}),n=t.idQueries,r=void 0===n?[]:n,a=t.others,d=r.length>0?new l.QueryDefinition({doctype:e[0].doctype,ids:(0,c.default)((0,o.default)(r.map(function(e){return e.id||e.ids})))}):[];return(0,s.default)(void 0===a?[]:a,u.default).concat(d)};t.default=function(e){var t=(0,i.default)(e,function(e){return e.doctype});return(0,o.default)(Object.values((0,a.default)(t,d)))}},74165:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.registryEndpoint=t.transformRegistryFormatToStackFormat=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(64512)),s=r(n(27361));n(35449);var l=r(n(2663)),d=n(97682);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}t.transformRegistryFormatToStackFormat=function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,c.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({id:(0,s.default)(e,"latest_version.manifest.source"),attributes:(0,s.default)(e,"latest_version.manifest")},e)};t.registryEndpoint="/registry/";var p=function(e){var t=new URLSearchParams(e).toString();return t?"?".concat(t):""},h=function(e){var t=e.type,n=t===d.APP_TYPE.KONNECTOR||"node"===t?"konnectors":"apps";return"/".concat(n)},y=function(){var e,t,n;function r(e){if((0,o.default)(this,r),!e.client)throw Error("Need to pass a client to instantiate a Registry API.");this.client=e.client}return(0,u.default)(r,[{key:"installApp",value:(e=(0,i.default)(a.default.mark(function e(t,n){var r,i,o,u,c,s,d;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.slug,i=t.terms,o={},(u=t.installed)&&(o.PermissionsAcked=u),n&&(o.Source=n),c=p(o),!i){e.next=9;break}return e.next=9,l.default.save(this.client,i);case 9:return s=t.installed?"PUT":"POST",d=h(t),e.abrupt("return",this.client.stackClient.fetchJSON(s,"".concat(d,"/").concat(r).concat(c)));case 12:case"end":return e.stop()}},e,this)})),function(t,n){return e.apply(this,arguments)})},{key:"uninstallApp",value:(t=(0,i.default)(a.default.mark(function e(t){var n,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.slug,r=h(t),e.abrupt("return",this.client.stackClient.fetchJSON("DELETE","".concat(r,"/").concat(n)));case 3:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"fetchApps",value:(n=(0,i.default)(a.default.mark(function e(t){var n,r,i,o,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.channel,r=t.type,o=new URLSearchParams({limit:void 0===(i=t.limit)?"200":i,versionsChannel:n,latestChannelVersion:n}).toString(),r&&(o+="&filter[type]=".concat(r)),e.next=6,this.client.stackClient.fetchJSON("GET","/registry?".concat(o));case 6:return u=e.sent.data,e.abrupt("return",u);case 9:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"fetchAppsInMaintenance",value:function(){return this.client.stackClient.fetchJSON("GET","/registry/maintenance")}},{key:"fetchApp",value:function(e){return this.client.stackClient.fetchJSON("GET","/registry/".concat(e))}},{key:"fetchAppVersion",value:function(e){if(!e.slug)throw Error("Need to pass a slug to use fetchAppVersion");var t=e.slug,n=e.channel,r=e.version,a=n||r&&"latest"!==r?n:"stable",i="/registry/".concat(t,"/");return a?i+="".concat(a,"/").concat(r||"latest"):i+="".concat(r),this.client.stackClient.fetchJSON("GET",i)}}]),r}();t.default=y},46011:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.extractAndMergeDocument=t.getCollectionFromSlice=t.getDocumentFromSlice=t.default=t.mergeDocumentsWithRelationships=void 0;var a=r(n(64512)),i=r(n(24350)),o=r(n(27361)),u=r(n(18446)),c=r(n(57557)),s=r(n(82492)),l=r(n(81602)),d=n(77621),f=n(87549),p=n(2868),h=n(51149);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m=function(e,t){var n=t._type;if(!n)throw Error("Document without _type");if(!(0,h.properId)(t))throw Error("Document without id");var r=(0,o.default)(e,[n,(0,h.properId)(t)]);return(0,u.default)(r,t)?e:v(v({},e),{},(0,a.default)({},n,v(v({},e[n]),{},(0,a.default)({},(0,h.properId)(t),b(r,t)))))},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=v(v({},e),t);return(e.relationships||t.relationships)&&(n.relationships=v(v({},e.relationships),t.relationships)),n};t.mergeDocumentsWithRelationships=b;t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!(0,d.isReceivingData)(t)&&!(0,p.isReceivingMutationResult)(t))return e;if(t&&t.definition&&t.definition.mutationType===f.MutationTypes.DELETE_DOCUMENT){var n=t.definition.document._id,r=t.definition.document._type;return v(v({},e),{},(0,a.default)({},r,(0,c.default)(e[r],n)))}var i=t.response,o=i.data,u=i.included;if(!o||Array.isArray(o)&&0===o.length)return e;var s=u?u.reduce(m,e):e;return Array.isArray(o)?g(o,s):m(s,o)};t.getDocumentFromSlice=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(!t)throw Error("getDocumentFromSlice: Cannot retrieve document with undefined doctype");if(!n)throw Error("getDocumentFromSlice: Cannot retrieve document with undefined id");return e[t]?e[t][n]?e[t][n]:null:null};t.getCollectionFromSlice=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!t)throw Error("getDocumentFromSlice: Cannot retrieve document with undefined doctype");return e[t]?Object.values(e[t]):null};var g=function(e,t){var n=e[0]._type;if(!n)throw l.default.info("Document without _type",e[0]),Error("Document without _type");var r=(0,i.default)(e,h.properId),a=Object.assign({},t);return a[n]=Object.assign({},t[n]),Object.values(r).map(function(e){var t=(0,h.properId)(e);a[n][t]?a[n][t]=(0,s.default)({},a[n][t],e):a[n][t]=e}),a};t.extractAndMergeDocument=g},51149:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.properId=void 0;t.properId=function(e){return e.id||e._id}},72662:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"initQuery",{enumerable:!0,get:function(){return f.initQuery}}),Object.defineProperty(t,"loadQuery",{enumerable:!0,get:function(){return f.loadQuery}}),Object.defineProperty(t,"resetQuery",{enumerable:!0,get:function(){return f.resetQuery}}),Object.defineProperty(t,"receiveQueryResult",{enumerable:!0,get:function(){return f.receiveQueryResult}}),Object.defineProperty(t,"receiveQueryError",{enumerable:!0,get:function(){return f.receiveQueryError}}),Object.defineProperty(t,"executeQueryFromState",{enumerable:!0,get:function(){return f.executeQueryFromState}}),Object.defineProperty(t,"initMutation",{enumerable:!0,get:function(){return p.initMutation}}),Object.defineProperty(t,"receiveMutationResult",{enumerable:!0,get:function(){return p.receiveMutationResult}}),Object.defineProperty(t,"receiveMutationError",{enumerable:!0,get:function(){return p.receiveMutationError}}),Object.defineProperty(t,"getStateRoot",{enumerable:!0,get:function(){return h.getStateRoot}}),Object.defineProperty(t,"getCollectionFromState",{enumerable:!0,get:function(){return h.getCollectionFromState}}),Object.defineProperty(t,"getDocumentFromState",{enumerable:!0,get:function(){return h.getDocumentFromState}}),Object.defineProperty(t,"getQueryFromStore",{enumerable:!0,get:function(){return h.getQueryFromStore}}),Object.defineProperty(t,"getQueryFromState",{enumerable:!0,get:function(){return h.getQueryFromState}}),Object.defineProperty(t,"getRawQueryFromState",{enumerable:!0,get:function(){return h.getRawQueryFromState}}),Object.defineProperty(t,"isQueryExisting",{enumerable:!0,get:function(){return h.isQueryExisting}}),Object.defineProperty(t,"dispatchCreate",{enumerable:!0,get:function(){return y.dispatchCreate}}),Object.defineProperty(t,"dispatchUpdate",{enumerable:!0,get:function(){return y.dispatchUpdate}}),Object.defineProperty(t,"dispatchDelete",{enumerable:!0,get:function(){return y.dispatchDelete}}),t.resetState=t.createStore=t.default=t.StoreProxy=void 0;var i=a(n(64512)),o=a(n(65105)),u=a(n(19723)),c=a(n(71400)),s=n(5525),l=a(n(53894)),d=a(n(46011)),f=r(n(77621)),p=n(2868),h=n(8016),y=n(8752);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var b="COZY_CLIENT.RESET_STATE";t.resetState=function(){return{type:b}};var g=function(){function e(t){(0,o.default)(this,e),this.state=t}return(0,u.default)(e,[{key:"readDocument",value:function(e,t){return this.state.documents[e][t]}},{key:"writeDocument",value:function(e){this.setState(function(t){return m(m({},t),{},{documents:m(m({},t.documents),{},(0,i.default)({},e._type,m(m({},t.documents[e._type]),{},(0,i.default)({},e._id,e))))})})}},{key:"setState",value:function(e){this.state=e(this.state)}},{key:"getState",value:function(){return this.state}}]),e}();t.StoreProxy=g;var k={documents:{},queries:{}},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;if(t.type==b)return k;if(!(0,f.isQueryAction)(t)&&!(0,p.isMutationAction)(t))return e;if(t.update){var n=new g(e);return t.update(n,t.response),{documents:n.getState().documents,queries:(0,f.default)(n.getState().queries,t,n.getState().documents)}}var r=(0,d.default)(e.documents,t),a=r!==e.documents;return{documents:r,queries:(0,f.default)(e.queries,t,r,a)}};t.default=_;var O=(0,c.default)("debug")&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||s.compose;t.createStore=function(){return(0,s.createStore)((0,s.combineReducers)({cozy:_}),O((0,s.applyMiddleware)(l.default)))}},2868:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.receiveMutationError=t.receiveMutationResult=t.initMutation=t.isReceivingMutationResult=t.isMutationAction=void 0;var a=r(n(64512));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var u="INIT_MUTATION",c="RECEIVE_MUTATION_RESULT",s="RECEIVE_MUTATION_ERROR";t.isMutationAction=function(e){return -1!==[u,c,s].indexOf(e.type)};t.isReceivingMutationResult=function(e){return e.type===c};t.initMutation=function(e,t){return{type:u,mutationId:e,definition:t}};t.receiveMutationResult=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return o(o({type:c,mutationId:e,response:t},n),{},{definition:r})};t.receiveMutationError=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{type:s,mutationId:e,error:t,definition:n}}},77621:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.QueryIDGenerator=t.getQueryFromSlice=t.resetQuery=t.receiveQueryError=t.receiveQueryResult=t.loadQuery=t.initQuery=t.default=t.updateData=t.makeSorterFromDefinition=t.executeQueryFromState=t.mergeSelectorAndPartialIndex=t.convert$gtNullSelectors=t.sortAndLimitDocsIds=t.isReceivingData=t.isQueryAction=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(90402)),u=r(n(64512)),c=r(n(98235)),s=r(n(66604)),l=r(n(7739)),d=r(n(91966)),f=r(n(25325)),p=r(n(57043)),h=r(n(68630)),y=r(n(44908)),v=r(n(75472)),m=r(n(47037)),b=r(n(27361)),g=r(n(14328)),k=r(n(71400)),_=n(46011),O=n(2868),w=n(51149),S=n(87549),x=r(n(81602)),E=n(8016);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var D="INIT_QUERY",j="LOAD_QUERY",A="RECEIVE_QUERY_RESULT",T="RECEIVE_QUERY_ERROR",R="RESET_QUERY",I=(0,k.default)("debug"),M=function(e){return -1!==[D,j,A,T,R].indexOf(e.type)};t.isQueryAction=M;t.isReceivingData=function(e){return e.type===A};var N={id:null,definition:null,fetchStatus:"pending",isFetching:null,lastFetch:null,lastUpdate:null,lastErrorUpdate:null,lastError:null,hasMore:!1,count:0,fetchedPagesCount:0,data:[],bookmark:null},F=function(e,t,n,r){var a,i=r.count,o=r.fetchedPagesCount,u=(0,c.default)(n);if(e.definition.sort&&t){var s=H(e.definition),l=t[e.definition.doctype];u=s(l?u.map(function(e){return l[e]}).filter(Boolean):[]).map(w.properId)}var d=e.definition.limit;return d&&(a=i<d?o>1?d*(o-1)+i:i:d*o,u=u.slice(0,a)),u};t.sortAndLimitDocsIds=F;var L=function(e,t,n,r){var a=r.count,i=r.fetchedPagesCount,o=(0,y.default)([].concat((0,c.default)(e.data),(0,c.default)(t.data.map(w.properId))));return F(e,n,o,{count:a,fetchedPagesCount:i})},B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;switch(t.type){case D:if(e.lastUpdate&&e.id===t.queryId&&e.definition===t.queryDefinition)return e;return C(C({},e),{},{id:t.queryId,definition:t.queryDefinition,options:t.options,fetchStatus:e.lastUpdate?e.fetchStatus:"pending"});case j:if("loading"===e.fetchStatus)return e;if("loaded"===e.fetchStatus&&t.backgroundFetching)return C(C({},e),{},{fetchStatus:"loaded",isFetching:!0});return C(C({},e),{},{fetchStatus:"loading"});case A:var r=t.response;if(!r.data)return C(C({},e),{},{fetchStatus:"loaded",isFetching:!t.backgroundFetching&&null,lastFetch:Date.now(),lastUpdate:Date.now()});var a=C({fetchStatus:"loaded",isFetching:!t.backgroundFetching&&null,lastFetch:Date.now(),lastUpdate:Date.now()},I&&{execution_stats:r.execution_stats});if(!Array.isArray(r.data))return C(C(C({},e),a),{},{hasMore:!1,count:1,data:[(0,w.properId)(r.data)]});var i=r.meta&&r.meta.count?r.meta.count:r.data.length;if(t.backgroundFetching)return C(C(C({},e),a),{},{bookmark:r.bookmark||null,hasMore:void 0!==r.next?r.next:e.hasMore,count:i,data:r.data.map(w.properId)});var o=e.fetchedPagesCount+1,u=L(e,r,n,{count:i,fetchedPagesCount:o});return C(C(C({},e),a),{},{bookmark:r.bookmark||null,hasMore:void 0!==r.next?r.next:e.hasMore,count:i,fetchedPagesCount:o,data:u});case T:return C(C({},e),{},{id:t.queryId,fetchStatus:"failed",isFetching:!t.backgroundFetching&&null,lastError:t.error,lastErrorUpdate:Date.now()});case R:return C(C({},N),{},{id:t.queryId,definition:e.definition,options:e.options});default:return e}},z=function e(t){for(var n={},r=0,a=Object.entries(t);r<a.length;r++){var i=(0,o.default)(a[r],2),u=i[0],c=i[1],s=(0,h.default)(c)?e(c):c;n["$gt"===u&&null===s?"$gtnull":u]=s}return n};t.convert$gtNullSelectors=z;var U=function(e){return C(C({},(0,b.default)(e,"selector")),(0,b.default)(e,"partialFilter"))};t.mergeSelectorAndPartialIndex=U;var q=function(e){if(e.selector||e.partialFilter){var t=U(e);return g.default.use({$gtnull:function(e,t){return!!t}}),(0,g.default)(z(t))}if(e.id){var n={_id:e.id};return(0,g.default)(n)}if(!e.ids)return null;else{var r={_id:{$in:e.ids}};return(0,g.default)(r)}};t.executeQueryFromState=function(e,t){var n=(0,E.getCollectionFromState)(e,t.doctype),r=!!t.id;if(!n)return{data:r?null:[]};var a=n.filter(G(t));return r?{data:a.length>0?a[0]:null}:{data:H(t)(a)}};var G=function(e){var t=e.doctype,n=q(e);return function(e){return e._type===t&&!e._deleted&&(!n||!!n(e))}},Q=function(e){return function(t){var n=(0,b.default)(t,e);return(0,m.default)(n)?n.toLowerCase():n}},H=function(e){var t=e.sort;if(!t)return function(e){return e};if(!Array.isArray(e.sort))return x.default.warn("Correct update of queries with a sort that is not an array is not supported. Use an array as argument of QueryDefinition::sort"),function(e){return e};var n=t.map(function(e){return Object.entries(e)[0]}),r=n.map(function(e){return e[0]}).map(Q),a=n.map(function(e){return e[1]});return function(e){return(0,v.default)(e,r,a)}};t.makeSorterFromDefinition=H;var J=function(e,t,n){var r=G(e.definition),a=(0,s.default)((0,l.default)(t,r),function(e){return e.map(w.properId)}),i=a.true,o=void 0===i?[]:i,u=a.false,c=e.data,h=e.options&&e.options.autoUpdate,y=!h||!1!==h.remove,v=!h||!1!==h.add,m=!h||!1!==h.update,b=y?(0,f.default)(c,void 0===u?[]:u):[],g=v?(0,d.default)(o,c):[],k=m?(0,f.default)(c,o):[],_=b.length||g.length||k.length,O=(0,d.default)((0,p.default)(c,g),b),S=e.fetchedPagesCount,x=F(e,n,O,{count:O.length,fetchedPagesCount:S});return C(C({},e),{},{data:x,count:x.length,fetchedPagesCount:S,lastUpdate:_?Date.now():e.lastUpdate})};t.updateData=J;var Y=function(e,t){return function(n){var r=(0,b.default)(e,"response.data")||(0,b.default)(e,"definition.document");return r?(!Array.isArray(r)&&(r=[r]),r.length&&n.definition.doctype===r[0]._type)?J(n,r,t):n:n}};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(t.type==D){var a=B(e[t.queryId],t,n);return a===e[t.queryId]?e:C(C({},e),{},(0,u.default)({},t.queryId,a))}if(M(t)){var i=Y(t,n);return(0,s.default)(e,function(e){return e.id==t.queryId?B(e,t,n):r?i(e):e})}if((0,O.isReceivingMutationResult)(t)){var o,c,l=t.updateQueries?(o=t,c=n,function(e){var t=o.updateQueries,n=o.response,r=t[e.id];if(!r)return e;var a=r(W(c,e.definition.doctype,e.data),n).map(w.properId);return C(C({},e),{},{data:a,count:a.length,lastUpdate:Date.now()})}):Y(t,n);return(0,s.default)(e,l)}return e};t.initQuery=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t.doctype)throw Error("Cannot init query with no doctype");return{type:D,queryId:e,queryDefinition:t,options:n}};t.loadQuery=function(e,t){return C({type:j,queryId:e},t)};t.receiveQueryResult=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return C({type:A,queryId:e,response:t},n)};t.receiveQueryError=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return C({type:T,queryId:e,error:t},n)};t.resetQuery=function(e){return{type:R,queryId:e}};var W=function(e,t,n){return n.map(function(n){return(0,_.getDocumentFromSlice)(e,t,n)})};t.getQueryFromSlice=function(e,t,n){if(!e||!e[t])return C(C({},N),{},{id:t,data:null});var r=e[t];return n?C(C({},r),{},{data:W(n,r.definition.doctype,r.data)}):r};var K=function(){function e(){(0,a.default)(this,e),this.idCounter=1}return(0,i.default)(e,[{key:"generateRandomId",value:function(){var e=this.idCounter;return this.idCounter++,e.toString()}},{key:"generateId",value:function(e){if(!(0,S.isAGetByIdQuery)(e))return this.generateRandomId();var t=e.id,n=e.doctype;return"".concat(n,"/").concat(t)}}]),e}();t.QueryIDGenerator=K,K.UNNAMED="unnamed"},8752:function(e,t,n){var r,a,i,o,u=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.dispatchDelete=t.dispatchUpdate=t.dispatchCreate=void 0;var c=u(n(68434)),s=u(n(82007)),l=u(n(64512)),d=n(87549),f=n(2868);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,l.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=function(e,t){return h({id:e._id,_type:t},e)};var v=(r=(0,s.default)(c.default.mark(function e(t,n){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof n.enhanceDocFn){e.next=4;break}return e.next=3,n.enhanceDocFn(t,{client:n.client});case 3:return e.abrupt("return",e.sent);case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)}),m=function(e,t,n){e.dispatch((0,f.receiveMutationResult)(e.generateRandomId(),{data:t},{},n(t)))};var b=(a=(0,s.default)(c.default.mark(function e(t,n,r){var a,i,o=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},i=y(r,n),e.next=4,v(i,{client:t,enhanceDocFn:null==a?void 0:a.enhanceDocFn});case 4:m(t,e.sent,d.Mutations.createDocument);case 6:case"end":return e.stop()}},e)})),function(e,t,n){return a.apply(this,arguments)});t.dispatchCreate=b;var g=(i=(0,s.default)(c.default.mark(function e(t,n,r){var a,i,o=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},i=y(r,n),e.next=4,v(i,{client:t,enhanceDocFn:null==a?void 0:a.enhanceDocFn});case 4:m(t,e.sent,d.Mutations.updateDocument);case 6:case"end":return e.stop()}},e)})),function(e,t,n){return i.apply(this,arguments)});t.dispatchUpdate=g;var k=(o=(0,s.default)(c.default.mark(function e(t,n,r){var a,i,o=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},i=y(h(h({},r),{},{_deleted:!0}),n),e.next=4,v(i,{client:t,enhanceDocFn:null==a?void 0:a.enhanceDocFn});case 4:m(t,e.sent,d.Mutations.deleteDocument);case 6:case"end":return e.stop()}},e)})),function(e,t,n){return o.apply(this,arguments)});t.dispatchDelete=k},8016:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isQueryExisting=t.getRawQueryFromState=t.getQueryFromState=t.getQueryFromStore=t.getDocumentFromState=t.getCollectionFromState=t.getStateRoot=void 0;var r=n(46011),a=n(77621),i=function(e){return e.cozy||{}};t.getStateRoot=i;t.getCollectionFromState=function(e,t){return(0,r.getCollectionFromSlice)(i(e).documents,t)};t.getDocumentFromState=function(e,t,n){return(0,r.getDocumentFromSlice)(i(e).documents,t,n)};t.getQueryFromStore=function(e,t){return o(e.getState(),t)};var o=function(e,t){return(0,a.getQueryFromSlice)(i(e).queries,t,i(e).documents)};t.getQueryFromState=o;t.getRawQueryFromState=function(e,t){return(0,a.getQueryFromSlice)(i(e).queries,t)};t.isQueryExisting=function(e,t){return void 0!==i(e).queries[t]}},2663:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(64512)),o=r(n(80295)),u=r(n(82007));function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var l="io.cozy.terms";function d(){return(d=(0,u.default)(a.default.mark(function e(t,n){var r,i,u,c,d,f;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.id,i=(0,o.default)(n,["id"]),e.next=3,t.query({doctype:l,selector:{termsId:r,version:i.version},limit:1});case 3:if(!((u=e.sent.data)&&u.length)){e.next=13;break}if(!((c=u[0]).termsId==r&&c.version==i.version&&c.url!=i.url)){e.next=11;break}return d=s(s({_type:l},c),{},{url:i.url}),e.next=11,t.save(d);case 11:e.next=16;break;case 13:return f=s(s({_type:l},i),{},{termsId:r,accepted:!0,acceptedAt:new Date}),e.next=16,t.save(f);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}t.default={save:function(e,t){return d.apply(this,arguments)}}},27146:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.CozyClient=void 0;var a=r(n(25665)),i=r(n(27952)),o=r(n(12323)),u=r(n(65105)),c=function(e){(0,a.default)(c,e);var t,n,r=(t=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);return e=n?Reflect.construct(r,arguments,(0,o.default)(this).constructor):r.apply(this,arguments),(0,i.default)(this,e)});function c(){return(0,u.default)(this,c),r.apply(this,arguments)}return c}(function e(t){(0,u.default)(this,e),Object.assign(this,t)});t.CozyClient=c},32420:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n(87549);t.default={}},64374:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isReactNativeOfflineError=t.hasQueriesBeenLoaded=t.isQueriesLoading=t.hasQueryBeenLoaded=t.isQueryLoading=t.cancelable=void 0;var a=r(n(81602));t.cancelable=function(e){var t,n=new Promise(function(n,r){t=r,e.then(n),e.catch(r)});return n.cancel=function(){t({canceled:!0})},n};var i=function(e){return e?"loading"===e.fetchStatus||"pending"===e.fetchStatus:(a.default.warn("isQueryLoading called on falsy value."),!1)};t.isQueryLoading=i;var o=function(e){return e.lastFetch};t.hasQueryBeenLoaded=o;t.isQueriesLoading=function(e){return Object.values(e).some(function(e){return i(e)})};t.hasQueriesBeenLoaded=function(e){return Object.values(e).some(function(e){return o(e)})};t.isReactNativeOfflineError=function(e){return"Network request failed"===e.message}},96310:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(95297)),o=a(n(65105)),u=a(n(19723)),c=a(n(8997)),s=a(n(25665)),l=a(n(27952)),d=a(n(12323)),f=a(n(64512)),p=r(n(67294)),h=a(n(45697));t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r=n.displayName||n.name||"Component",a=function(a){(0,s.default)(m,a);var h,y,v=(h=m,y=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=(0,d.default)(h);return e=y?Reflect.construct(t,arguments,(0,d.default)(this).constructor):t.apply(this,arguments),(0,l.default)(this,e)});function m(n,a){var i;if((0,o.default)(this,m),i=v.call(this,n,a),(0,f.default)((0,c.default)(i),"mutate",function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];return i.client.mutate(e.apply(null,r),t)}),i.client=n.client||a.client,!i.client)throw Error('Could not find "client" in either the context or props of '.concat(r));return i}return(0,u.default)(m,[{key:"render",value:function(){var e=(0,f.default)({},t.name||"mutate",this.mutate);return p.default.createElement(n,(0,i.default)({},e,this.props))}}]),m}(p.Component);return(0,f.default)(a,"contextTypes",{client:h.default.object}),a.displayName="WithMutation(".concat(r,")"),a}}},84170:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(95297)),o=a(n(65105)),u=a(n(19723)),c=a(n(25665)),s=a(n(27952)),l=a(n(12323)),d=a(n(64512)),f=a(n(98235)),p=a(n(82492)),h=r(n(67294)),y=a(n(45697)),v=a(n(81602));function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}t.default=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){var n=e.displayName||e.name||"Component",r=function(r){(0,c.default)(g,r);var a,y,b=(a=g,y=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=(0,l.default)(a);return e=y?Reflect.construct(t,arguments,(0,l.default)(this).constructor):t.apply(this,arguments),(0,s.default)(this,e)});function g(e,r){(0,o.default)(this,g),c=b.call(this,e,r);var a,i,u,c,s=e.client||r.client;if(v.default.warn("Deprecation: withMutations will be removed in the near future, prefer to use withClient to access the client. See https://github.com/cozy/cozy-client/pull/638 for more information."),!s)throw Error('Could not find "client" in either the context or props of '.concat(n));return c.mutations=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,d.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({createDocument:s.create.bind(s),saveDocument:s.save.bind(s),deleteDocument:s.destroy.bind(s)},(a=t,i=s,u=e,p.default.apply(void 0,(0,f.default)(a.map(function(e){return"function"==typeof e?e(i,u):e}))))),c}return(0,u.default)(g,[{key:"render",value:function(){return h.default.createElement(e,(0,i.default)({},this.mutations,this.props))}}]),g}(h.Component);return(0,d.default)(r,"contextTypes",{client:y.default.object}),r.displayName="WithMutations(".concat(n,")"),r}}},59093:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=function(){function e(t){(0,a.default)(this,e);var n=t;"string"==typeof n&&(n=JSON.parse(n)),this.tokenType=n.token_type||n.tokenType,this.accessToken=n.access_token||n.accessToken,this.refreshToken=n.refresh_token||n.refreshToken,this.scope=n.scope}return(0,i.default)(e,[{key:"toAuthHeader",value:function(){return"Bearer "+this.accessToken}},{key:"toBasicAuth",value:function(){return"user:".concat(this.accessToken,"@")}},{key:"toJSON",value:function(){return{tokenType:this.tokenType,accessToken:this.accessToken,refreshToken:this.refreshToken,scope:this.scope}}},{key:"toString",value:function(){return JSON.stringify(this.toJSON())}},{key:"getAccessToken",value:function(){return this.accessToken}}]),e}();t.default=o},83964:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.normalizeApp=t.APPS_DOCTYPE=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(25665)),s=r(n(27952)),l=r(n(12323)),d=r(n(64512)),f=r(n(27361)),p=n(74165),h=r(n(93868)),y=r(n(87386)),v=n(63818);n(86701);var m=r(n(25790));function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,d.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _="io.cozy.apps";t.APPS_DOCTYPE=_;var O=function(e,t){return k(k({},(0,v.normalizeDoctypeJsonApi)(t)(e)),{},{id:e.id})};t.normalizeApp=O;var w=function(e){(0,c.default)(w,e);var t,n,r,d,y,v,g,k=(t=w,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,l.default)(t);return e=n?Reflect.construct(r,arguments,(0,l.default)(this).constructor):r.apply(this,arguments),(0,s.default)(this,e)});function w(e){var t;return(0,o.default)(this,w),(t=k.call(this,_,e)).endpoint="/apps/",t}return(0,u.default)(w,[{key:"get",value:(r=(0,i.default)(a.default.mark(function e(t,n){var r,i,o,u,c,s,l,d,y=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.indexOf("/")>-1?r=t.split("/")[1]:(m.default.warn("Deprecated: in next versions of cozy-client, it will not be possible to query apps/konnectors only with id, please use the form ".concat(this.doctype,"/").concat(t,"\n\n- Q('io.cozy.apps').getById('banks')\n+ Q('io.cozy.apps').getById('io.cozy.apps/banks')")),r=t),!(n&&n.sources&&(!Array.isArray(n.sources)||0===n.sources.length))){e.next=3;break}throw Error('Invalid "sources" attribute passed in query, please use an array with at least one element.');case 3:i=(0,f.default)(n,"sources",["stack"]),o={stack:function(){return h.default.get(y.stackClient,"".concat(y.endpoint).concat(encodeURIComponent(r)),{normalize:function(e){return O(e,y.doctype)}})},registry:function(){return y.stackClient.fetchJSON("GET",p.registryEndpoint+r)}},u=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(i),e.prev=6,u.s();case 8:if((c=u.n()).done){e.next=27;break}return s=c.value,e.prev=10,e.next=13,o[s]();case 13:if(l=e.sent,!("registry"!==s)){e.next=16;break}return e.abrupt("return",l);case 16:return m.default.warn("The use of source registry is deprecated since it can polute the io.cozy.apps slice. For exemple, if we request data from the registry, than the app will be present in the io.cozy.apps slice and then the isInstalled() will return true.\n\n            Use Q('io.cozy.apps_registry) instead"),d=(0,p.transformRegistryFormatToStackFormat)(l),e.abrupt("return",{data:O(d,this.doctype)});case 21:if(e.prev=21,e.t0=e.catch(10),s!==i[i.length-1]){e.next=25;break}throw e.t0;case 25:e.next=8;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(6),u.e(e.t1);case 32:return e.prev=32,u.f(),e.finish(32);case 35:case"end":return e.stop()}},e,this,[[6,29,32,35],[10,21]])})),function(e,t){return r.apply(this,arguments)})},{key:"all",value:(d=(0,i.default)(a.default.mark(function e(){var t,n=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",this.endpoint);case 2:return t=e.sent,e.abrupt("return",{data:t.data.map(function(e){return O(e,n.doctype)}),meta:{count:t.meta.count},skip:0,next:!1});case 4:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)})},{key:"create",value:(y=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("create() method is not available for applications");case 1:case"end":return e.stop()}},e)})),function(){return y.apply(this,arguments)})},{key:"update",value:(v=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("update() method is not available for applications");case 1:case"end":return e.stop()}},e)})),function(){return v.apply(this,arguments)})},{key:"destroy",value:(g=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("destroy() method is not available for applications");case 1:case"end":return e.stop()}},e)})),function(){return g.apply(this,arguments)})}]),w}(y.default);w.normalizeDoctype=v.normalizeDoctypeJsonApi;t.default=w},83223:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=function(){function e(t){(0,a.default)(this,e),this.token=t||""}return(0,i.default)(e,[{key:"toAuthHeader",value:function(){return"Bearer "+this.token}},{key:"toBasicAuth",value:function(){return"user:".concat(this.token,"@")}},{key:"getAccessToken",value:function(){return this.token}}]),e}();t.default=o},75266:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.normalizeAppFromRegistry=t.APPS_REGISTRY_DOCTYPE=void 0;var i=a(n(65105)),o=a(n(19723)),u=a(n(25665)),c=a(n(27952)),s=a(n(12323)),l=a(n(68434)),d=a(n(82007)),f=a(n(64512)),p=a(n(87386)),h=n(63818);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,f.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m="io.cozy.apps_registry";t.APPS_REGISTRY_DOCTYPE=m;var b=function(e,t){var n,r="".concat("webapp"===e.type?"io.cozy.apps":"io.cozy.konnectors","/").concat(e.slug),a=v(v({},e.attributes),null===(n=e.latest_version)||void 0===n?void 0:n.manifest);return v({},(0,h.normalizeDoc)(v(v({},e),{},{attributes:a,id:r,_id:r}),t))};t.normalizeAppFromRegistry=b;var g=(r=(0,d.default)(l.default.mark(function e(t,n,r){var a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.fetchJSON("GET","/registry?versionsChannel=".concat(t,"&filter[type]=konnector&limit=500"));case 2:return a=e.sent,e.abrupt("return",{data:a.data.map(function(e){return b(e,n)})});case 4:case"end":return e.stop()}},e)})),function(e,t,n){return r.apply(this,arguments)}),k=function(e){(0,u.default)(h,e);var t,n,r,a,f,p=(t=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function h(e){var t;return(0,i.default)(this,h),(t=p.call(this,m,e)).endpoint="/registry/",t}return(0,o.default)(h,[{key:"get",value:(r=(0,d.default)(l.default.mark(function e(t){var n,r,a=this;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.startsWith("konnectors/")){e.next=3;break}return n=t.split("/")[1],e.abrupt("return",g(n,this.doctype,this.stackClient));case 3:return e.next=5,this.stackClient.fetchJSON("GET","".concat(this.endpoint).concat(t));case 5:if(r=e.sent,"maintenance"!==t){e.next=8;break}return e.abrupt("return",{data:r.map(function(e){return b(e,a.doctype)})});case 8:return e.abrupt("return",{data:b(r,this.doctype)});case 9:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"create",value:(a=(0,d.default)(l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("create() method is not available for AppsRegistryCollection");case 1:case"end":return e.stop()}},e)})),function(){return a.apply(this,arguments)})},{key:"destroy",value:(f=(0,d.default)(l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("destroy() method is not available for AppsRegistryCollection");case 1:case"end":return e.stop()}},e)})),function(){return f.apply(this,arguments)})}]),h}(p.default);t.default=k},93868:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Collection=t.isDocumentUpdateConflict=t.isTimeoutError=t.isNoUsableIndexError=t.isIndexNotUsedWarning=t.isIndexConflictError=t.isIndexNotFoundError=t.dontThrowNotFoundError=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723));n(36369);var c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e.message.match(/not_found/))return Array.isArray(t)?{data:t,meta:{count:0},skip:0,next:!1}:{data:t};throw e};t.dontThrowNotFoundError=c;t.isIndexNotFoundError=function(e){return e.message.match(/no_index/)};t.isIndexConflictError=function(e){return e.message.match(/error_saving_ddoc/)};t.isIndexNotUsedWarning=function(e){return e.match(/was not used because it does not contain a valid index for this query/)};t.isNoUsableIndexError=function(e){return e.message.match(/no_usable_index/)};t.isTimeoutError=function(e){return e.message.match(/context deadline exceeded/)};t.isDocumentUpdateConflict=function(e){return e.message.match(/Document update conflict/)};var s=function(){var e;function t(){(0,o.default)(this,t)}return(0,u.default)(t,null,[{key:"get",value:(e=(0,i.default)(a.default.mark(function e(t,n,r){var i,o,u,s,l;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=void 0===(i=r.normalize)?function(e,t){return e}:i,s=void 0===(u=r.method)?"GET":u,e.prev=1,e.next=4,t.fetchJSON(s,n);case 4:return l=e.sent,e.abrupt("return",{data:o(l.data,l)});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",c(e.t0,null));case 11:case"end":return e.stop()}},e,null,[[1,8]])})),function(t,n,r){return e.apply(this,arguments)})}]),t}();t.Collection=s;t.default=s},66829:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.CONTACTS_DOCTYPE=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(59655)),s=r(n(25665)),l=r(n(27952)),d=r(n(12323)),f=r(n(64512)),p=r(n(87386)),h=n(63818);n(32420);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,f.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m="io.cozy.contacts";t.CONTACTS_DOCTYPE=m;var b=(0,h.normalizeDoctypeJsonApi)(m),g=function(e){var t;return v(v({},b(e)),{},{_rev:null==e?void 0:null===(t=e.meta)||void 0===t?void 0:t.rev})},k=function(e){(0,s.default)(y,e);var t,n,r,f,p,h=(t=y,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,d.default)(t);return e=n?Reflect.construct(r,arguments,(0,d.default)(this).constructor):r.apply(this,arguments),(0,l.default)(this,e)});function y(){return(0,o.default)(this,y),h.apply(this,arguments)}return(0,u.default)(y,[{key:"find",value:(r=(0,i.default)(a.default.mark(function e(t,n){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(void 0!==t&&1===Object.values(t).length&&!0==t.me)){e.next=4;break}return e.abrupt("return",this.findMyself());case 4:return e.abrupt("return",(0,c.default)((0,d.default)(y.prototype),"find",this).call(this,t,n));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"findMyself",value:(f=(0,i.default)(a.default.mark(function e(){var t;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST","/contacts/myself");case 2:return t={data:[g(e.sent.data)],next:!1,meta:null,bookmark:!1},e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"destroy",value:(p=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object.keys((null==t?void 0:null===(n=t.cozyMetadata)||void 0===n?void 0:n.sync)||{}).length>0)){e.next=6;break}return e.abrupt("return",(0,c.default)((0,d.default)(y.prototype),"update",this).call(this,v(v({},t),{},{trashed:!0})));case 6:return e.abrupt("return",(0,c.default)((0,d.default)(y.prototype),"destroy",this).call(this,t));case 7:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})}]),y}(p.default);t.default=k},17400:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(68434)),o=a(n(82007)),u=a(n(64512)),c=a(n(65105)),s=a(n(19723)),l=a(n(50361)),d=r(n(83964)),f=a(n(83223));a(n(59093));var p=a(n(87386)),h=a(n(946)),y=r(n(71606)),v=r(n(53381)),m=a(n(22145)),b=a(n(85275)),g=r(n(13041)),k=r(n(81295)),_=r(n(55134)),O=r(n(69688)),w=r(n(91142)),S=r(n(66829)),x=r(n(75266)),E=a(n(5276)),P=a(n(65746)),C=n(1433),D=a(n(37203)),j=r(n(86701)),A=a(n(25790)),T=a(n(6678)),R=n(26774);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var N=function(e){var t=e;if(null===t)return null;for(;"/"===t[t.length-1];)t=t.slice(0,-1);return t},F=function(){var e,t,r,a;function u(e){(0,c.default)(this,u);var t=M({},e),n=t.token,r=t.uri;this.options=t,this.setUri(void 0===r?"":r),this.setToken(n),this.konnectors=new v.default(this),this.jobs=new y.default(this),this._promiseCache=new T.default}return(0,s.default)(u,[{key:"isRevocationError",value:function(e){return(null==e?!!void 0:!!e.message)&&(!!(j.default.CLIENT_NOT_FOUND.test(e.message)||j.default.UNREGISTERED_CLIENT.test(e.message))||void 0)}},{key:"collection",value:function(e){if(!e)throw Error("CozyStackClient.collection() called without a doctype");switch(e){case d.APPS_DOCTYPE:return new d.default(this);case v.KONNECTORS_DOCTYPE:return new v.default(this);case"io.cozy.files":return new h.default(e,this);case"io.cozy.sharings":return new m.default(e,this);case"io.cozy.permissions":return new b.default(e,this);case S.CONTACTS_DOCTYPE:return new S.default(e,this);case g.TRIGGERS_DOCTYPE:return new g.default(this);case y.JOBS_DOCTYPE:return new y.default(this);case k.SETTINGS_DOCTYPE:return new k.default(this);case _.NOTES_DOCTYPE:return new _.default(this);case O.OAUTH_CLIENTS_DOCTYPE:return new O.default(this);case w.SHORTCUTS_DOCTYPE:return new w.default(this);case x.APPS_REGISTRY_DOCTYPE:return new x.default(this);case R.NEXTCLOUD_FILES_DOCTYPE:return new R.NextcloudFilesCollection(this);default:return new p.default(e,this)}}},{key:"fetch",value:function(e){function t(t,n,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((e=(0,o.default)(i.default.mark(function e(t,n,r){var a,o,u,c,s,l,d=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(o=M({},a=d.length>3&&void 0!==d[3]?d[3]:{})).method=t,u=o.headers=M({},a.headers),"GET"!==t&&"HEAD"!==t&&void 0!==r&&u["Content-Type"]&&(o.body=r),!u.Authorization&&(u.Authorization=this.getAuthorizationHeader()),o.credentials=o.credentials||"include",c=this.fullpath(n),s=(0,C.shouldXMLHTTPRequestBeUsed)(t,n,o)?C.fetchWithXMLHttpRequest:fetch,e.prev=9,e.next=12,s(c,o);case 12:return!(l=e.sent).ok&&this.emit("error",new j.FetchError(l,"".concat(l.status," ").concat(l.statusText))),e.abrupt("return",l);case 17:throw e.prev=17,e.t0=e.catch(9),this.isRevocationError(e.t0)&&this.onRevocationChange(!0),e.t0;case 21:case"end":return e.stop()}},e,this,[[9,17]])})),function(t,n,r){return e.apply(this,arguments)}))},{key:"onTokenRefresh",value:function(e){this.options&&this.options.onTokenRefresh&&this.options.onTokenRefresh(e)}},{key:"onRevocationChange",value:function(e){this.options&&this.options.onRevocationChange&&this.options.onRevocationChange(e)}},{key:"refreshToken",value:(t=(0,o.default)(i.default.mark(function e(){var t,r,a,o,u,c,s,l;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.token){e.next=2;break}throw Error("Cannot refresh an empty token");case 2:if(t={method:"GET",credentials:"include"},n.g.document){e.next=5;break}throw Error("Not in a web context, cannot refresh token");case 5:return e.next=7,fetch("/?refreshToken",t);case 7:if((r=e.sent).ok){e.next=10;break}throw Error("couldn't fetch a new token - response "+r.statusCode);case 10:return e.next=12,r.text();case 12:if(a=e.sent,o=new DOMParser().parseFromString(a,"text/html")){e.next=17;break}throw Error("couldn't fetch a new token - doc is not html");case 17:if(u=o.querySelector('div[role="application"]')){e.next=20;break}throw Error("couldn't fetch a new token - no div[role=application]");case 20:if((s=(c=u.dataset.cozy?JSON.parse(u.dataset.cozy):M({},u.dataset)).token)&&(s=s||c.cozyToken),s){e.next=25;break}throw Error("couldn't fetch a new token -- missing data-cozy or data-cozy-token attribute");case 25:return l=new f.default(s),this.setToken(l),this.onTokenRefresh(l),e.abrupt("return",l);case 29:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"fetchJSON",value:(r=(0,o.default)(i.default.mark(function e(t,n,r){var a=this,o,u=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=u.length>3&&void 0!==u[3]?u[3]:{},e.prev=1,e.next=4,this.fetchJSONWithCurrentToken(t,n,r,o);case 4:case 20:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),!(j.default.EXPIRED_TOKEN.test(e.t0.message)||j.default.INVALID_TOKEN.test(e.t0.message)||j.default.INVALID_TOKEN_ALT.test(e.t0.message))){e.next=23;break}return e.prev=10,e.next=13,this._promiseCache.exec(function(){return a.refreshToken()},function(){return"refreshToken"});case 13:e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(10),e.t0;case 18:return e.next=20,this.fetchJSONWithCurrentToken(t,n,r,o);case 23:throw e.t0;case 24:case"end":return e.stop()}},e,this,[[1,7],[10,15]])})),function(e,t,n){return r.apply(this,arguments)})},{key:"fetchJSONWithCurrentToken",value:(a=(0,o.default)(i.default.mark(function e(t,n,r){var a,o,u,c,s,d,f,p,h=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.length>3&&void 0!==h[3]?h[3]:{},(u=(o=(0,l.default)(a)).headers=o.headers||{}).Accept="application/json",c=r,"GET"!==t&&"HEAD"!==t&&void 0!==c&&!u["Content-Type"]&&(u["Content-Type"]="application/json",c=JSON.stringify(c)),e.next=8,this.fetch(t,n,c,o);case 8:return f=(d=(s=e.sent).headers.get("content-type"))&&d.indexOf("json")>=0,e.next=13,f?s.json():s.text();case 13:if(p=e.sent,!s.ok){e.next=16;break}return e.abrupt("return",p);case 16:throw new j.FetchError(s,p);case 17:case"end":return e.stop()}},e,this)})),function(e,t,n){return a.apply(this,arguments)})},{key:"fullpath",value:function(e){return e.startsWith("http")?e:this.uri+e}},{key:"getAuthorizationHeader",value:function(){return this.token?this.token.toAuthHeader():null}},{key:"setCredentials",value:function(e){return(0,P.default)("CozyStackClient::setCredentials is deprecated, use CozyStackClient::setToken"),this.setToken(e)}},{key:"getCredentials",value:function(){return(0,P.default)("CozyStackClient::getCredentials is deprecated, use CozyStackClient::getAuthorizationHeader"),this.getAuthorizationHeader()}},{key:"setToken",value:function(e){if(e){if(e.toAuthHeader)this.token=e;else if("string"==typeof e)this.token=new f.default(e);else throw A.default.warn("Cozy-Client: Unknown token format",e),Error("Cozy-Client: Unknown token format");this.onRevocationChange(!1)}else this.token=null}},{key:"getAccessToken",value:function(){return this.token&&this.token.getAccessToken()}},{key:"setUri",value:function(e){this.uri=N(e)}},{key:"getIconURL",value:function(e){return(0,E.default)(this,e)}}]),u}();D.default.mixin(F);t.default=F},87386:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(80295)),o=a(n(98235)),u=a(n(64512)),c=a(n(68434)),s=a(n(41)),l=a(n(82007)),d=a(n(65105)),f=a(n(19723)),p=a(n(71400)),h=n(65987),y=a(n(44908)),v=a(n(57557)),m=a(n(91175)),b=a(n(82492)),g=a(n(10240)),k=a(n(80129)),_=n(91303),O=n(63818),w=r(n(93868)),S=r(n(66343));n(86701);var x=a(n(25790));function E(){var e=(0,s.default)(["/data/","/_design/","/copy?rev=",""]);return E=function(){return e},e}function P(){var e=(0,s.default)(["/data/","/_design/","?rev=",""]);return P=function(){return e},e}function C(){var e=(0,s.default)(["/data/","/_design_docs?include_docs=true"]);return C=function(){return e},e}function D(){var e=(0,s.default)(["/data/","/_index"]);return D=function(){return e},e}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function A(){var e=(0,s.default)(["/data/","/","?rev=",""]);return A=function(){return e},e}function T(){var e=(0,s.default)(["/data/","/",""]);return T=function(){return e},e}function R(){var e=(0,s.default)(["/data/","/",""]);return R=function(){return e},e}function I(){var e=(0,s.default)(["/data/","/_all_docs?include_docs=true"]);return I=function(){return e},e}function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function F(){var e=(0,s.default)(["/data/","/_find"]);return F=function(){return e},e}function L(){var e=(0,s.default)(["/data/","/",""]);return L=function(){return e},e}var B=function(e){return Object.assign({},(0,v.default)(e,"_type"),{_deleted:!0})},z=function(){var e,t,n,r,a,s,M,z,U,q,G,Q,H,J,Y,W,K,V,$,Z,X,ee;function et(e,t){(0,d.default)(this,et),this.doctype=e,this.stackClient=t,this.indexes={},this.endpoint="/data/".concat(this.doctype,"/")}return(0,f.default)(et,[{key:"all",value:(e=(0,l.default)(c.default.mark(function e(){var t=this,n,r,a,i,o,u,s,l,d,f,p,y,v,m,b,k=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(r=(n=k.length>0&&void 0!==k[0]?k[0]:{}).limit)?100:r,o=void 0===(i=n.skip)?0:i,u=n.bookmark,d=(l=!!(s=n.keys)||null===a)?"_all_docs":"_normal_docs",f=(0,h.uri)(L(),this.doctype,d),p={include_docs:!0,limit:a,skip:o,keys:s,bookmark:u},y=S.buildURL(f,p),e.prev=6,e.next=9,this.stackClient.fetchJSON("GET",y);case 9:v=e.sent,e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(6),e.abrupt("return",(0,w.dontThrowNotFoundError)(e.t0));case 15:return m=l?v.rows.filter(function(e){return e&&null!==e.doc&&!e.error&&!(0,g.default)(e.id,"_design")}).map(function(e){return(0,O.normalizeDoc)(e.doc,t.doctype)}):v.rows.map(function(e){return(0,O.normalizeDoc)(e,t.doctype)}),b=u?v.rows.length>=a:o+v.rows.length<v.total_rows,e.abrupt("return",{data:m,meta:{count:l?m.length:v.total_rows},skip:o,bookmark:v.bookmark,next:b});case 18:case"end":return e.stop()}},e,this,[[6,12]])})),function(){return e.apply(this,arguments)})},{key:"fetchDocumentsWithMango",value:(t=(0,l.default)(c.default.mark(function e(t,n){var r,a=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",this.stackClient.fetchJSON("POST",t,this.toMangoOptions(n,r)));case 2:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"migrateIndex",value:(n=(0,l.default)(c.default.mark(function e(t,n){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.copyIndex(t,n);case 3:return e.next=5,this.destroyIndex(t);case 5:e.next=16;break;case 7:if(e.prev=7,e.t0=e.catch(0),(0,w.isDocumentUpdateConflict)(e.t0)){e.next=11;break}throw e.t0;case 11:return(0,h.sleep)(1e3),e.next=14,this.copyIndex(t,n);case 14:return e.next=16,this.destroyIndex(t);case 16:case"end":return e.stop()}},e,this,[[0,7]])})),function(e,t){return n.apply(this,arguments)})},{key:"handleMissingIndex",value:(r=(0,l.default)(c.default.mark(function e(t,n){var r,a,i,o;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.indexedFields,a=n.partialFilter,!r&&(r=(0,_.getIndexFields)({sort:n.sort,selector:t})),i=(0,_.getIndexNameFromFields)(r,a),e.next=5,this.findExistingIndex(t,n);case 5:if(o=e.sent){e.next=11;break}return e.next=9,this.createIndex(r,{partialFilter:a,indexName:i});case 9:case 14:e.next=17;break;case 11:if(!(o._id!=="_design/".concat(i))){e.next=16;break}return e.next=14,this.migrateIndex(o,i);case 16:throw Error("Index unusable for query, index used: ".concat(i));case 17:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"findWithMango",value:(a=(0,l.default)(c.default.mark(function e(t,n){var r,a,i,o,u=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:{},e.prev=1,e.next=4,this.fetchDocumentsWithMango(t,n,r);case 4:if(!((o=(a=e.sent).warning||(null===(i=a.meta)||void 0===i?void 0:i.warning))&&r.partialFilter&&(0,w.isIndexNotUsedWarning)(o))){e.next=8;break}throw Error("no_index");case 8:e.next=21;break;case 10:if(e.prev=10,e.t0=e.catch(1),!((0,w.isIndexNotFoundError)(e.t0)||(0,w.isNoUsableIndexError)(e.t0)||(0,w.isTimeoutError)(e.t0))){e.next=20;break}return e.next=15,this.handleMissingIndex(n,r);case 15:return e.next=17,this.fetchDocumentsWithMango(t,n,r);case 17:a=e.sent,e.next=21;break;case 20:throw e.t0;case 21:return e.abrupt("return",a);case 22:case"end":return e.stop()}},e,this,[[1,10]])})),function(e,t){return a.apply(this,arguments)})},{key:"find",value:(s=(0,l.default)(c.default.mark(function e(t){var n=this,r,a,i,o,u,s=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0===(a=(r=s.length>1&&void 0!==s[1]?s[1]:{}).skip)?0:a,e.prev=2,u=(0,h.uri)(F(),this.doctype),e.next=6,this.findWithMango(u,t,r);case 6:o=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",(0,w.dontThrowNotFoundError)(e.t0));case 12:return e.abrupt("return",{data:o.docs.map(function(e){return(0,O.normalizeDoc)(e,n.doctype)}),next:o.next,skip:i,bookmark:o.bookmark,execution_stats:o.execution_stats});case 13:case"end":return e.stop()}},e,this,[[2,9]])})),function(e){return s.apply(this,arguments)})},{key:"findAll",value:(M=(0,l.default)(c.default.mark(function e(t){var n,r,a,i,u,s=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=s.length>1&&void 0!==s[1]?s[1]:{},r=!0,a=[],i=n.bookmark||void 0;case 4:if(!r){e.next=13;break}return e.next=7,this.find(t,N(N({},n),{},{bookmark:i}));case 7:u=e.sent,a.push.apply(a,(0,o.default)(u.data)),i=u.bookmark,r=u.next,e.next=4;break;case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)})),function(e){return M.apply(this,arguments)})},{key:"get",value:(z=(0,l.default)(c.default.mark(function e(t){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w.default.get(this.stackClient,"".concat(this.endpoint).concat(encodeURIComponent(t)),{normalize:this.constructor.normalizeDoctype(this.doctype)}));case 1:case"end":return e.stop()}},e,this)})),function(e){return z.apply(this,arguments)})},{key:"getAll",value:(U=(0,l.default)(c.default.mark(function e(t){var n,r,a=this;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stackClient.fetchJSON("POST",(0,h.uri)(I(),this.doctype),{keys:t});case 3:n=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",(0,w.dontThrowNotFoundError)(e.t0));case 9:return r=n.rows.filter(function(e){return e.doc}),e.abrupt("return",{data:r.map(function(e){return(0,O.normalizeDoc)(e.doc,a.doctype)}),meta:{count:r.length}});case 11:case"end":return e.stop()}},e,this,[[0,6]])})),function(e){return U.apply(this,arguments)})},{key:"create",value:(q=(0,l.default)(c.default.mark(function e(t){var n,r,a,o,u,s,l;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id,t._type,a=(0,i.default)(t,["_id","_type"]),u=(o=!!n)?"PUT":"POST",s=(0,h.uri)(R(),this.doctype,o?n:""),e.next=6,this.stackClient.fetchJSON(u,s,a);case 6:return l=e.sent,e.abrupt("return",{data:(0,O.normalizeDoc)(l.data,this.doctype)});case 8:case"end":return e.stop()}},e,this)})),function(e){return q.apply(this,arguments)})},{key:"update",value:(G=(0,l.default)(c.default.mark(function e(t){var n;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("PUT",(0,h.uri)(T(),this.doctype,t._id),t);case 2:return n=e.sent,e.abrupt("return",{data:(0,O.normalizeDoc)(n.data,this.doctype)});case 4:case"end":return e.stop()}},e,this)})),function(e){return G.apply(this,arguments)})},{key:"destroy",value:(Q=(0,l.default)(c.default.mark(function e(t){var n,r,a,o;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id,r=t._rev,a=(0,i.default)(t,["_id","_rev"]),e.next=3,this.stackClient.fetchJSON("DELETE",(0,h.uri)(A(),this.doctype,n,r));case 3:return o=e.sent,e.abrupt("return",{data:(0,O.normalizeDoc)(N(N({},a),{},{_id:n,_rev:o.rev,_deleted:!0}),this.doctype)});case 5:case"end":return e.stop()}},e,this)})),function(e){return Q.apply(this,arguments)})},{key:"updateAll",value:(H=(0,l.default)(c.default.mark(function e(t){var n,r,a,i,o;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.stackClient,!(!(r=t?t.map(function(e){return(0,v.default)(e,"_type")}):t)||!r.length)){e.next=4;break}return e.abrupt("return",Promise.resolve([]));case 4:return e.prev=4,e.next=7,n.fetchJSON("POST","/data/".concat(this.doctype,"/_bulk_docs"),{docs:r});case 7:return a=e.sent,e.abrupt("return",a);case 11:if(e.prev=11,e.t0=e.catch(4),!(e.t0.reason&&e.t0.reason.reason&&"Database does not exist."===e.t0.reason.reason)){e.next=24;break}return e.next=16,this.create(r[0]);case 16:return i=e.sent,e.next=19,this.updateAll(r.slice(1));case 19:return(o=e.sent).unshift({ok:!0,id:i._id,rev:i._rev}),e.abrupt("return",o);case 24:throw e.t0;case 25:case"end":return e.stop()}},e,this,[[4,11]])})),function(e){return H.apply(this,arguments)})},{key:"destroyAll",value:function(e){return this.updateAll(e.map(B))}},{key:"toMangoOptions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.sort,r=t.indexedFields,a=t.partialFilter,i=t.fields,c=t.skip,s=t.limit,l=t.bookmark;n=(0,_.transformSort)(n),!r&&e&&x.default.warn("Selector fields should be manually indexed to prevent unexpected behaviour"),r=r||(0,_.getIndexFields)({sort:n,selector:e});var d=t.indexId||"_design/".concat((0,_.getIndexNameFromFields)(r,a));if(n){var f=(0,y.default)(n.map(function(e){return(0,m.default)(Object.values(e))}));if(f.length>1)throw Error("Mango sort can only use a single order (asc or desc).");var h,v=f.length>0?(0,m.default)(f):"asc",g=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(r);try{for(g.s();!(h=g.n()).done;)!function(){var e=h.value;!n.find(function(t){return(0,m.default)(Object.keys(t))===e})&&n.push((0,u.default)({},e,v))}()}catch(e){g.e(e)}finally{g.f()}}return{selector:a?(0,b.default)(N({},e),a):e,use_index:d,fields:i?[].concat((0,o.default)(i),["_id","_rev"]):void 0,limit:s,skip:void 0===c?0:c,bookmark:t.bookmark||l,sort:n,execution_stats:!!(0,p.default)("debug")||void 0}}},{key:"checkUniquenessOf",value:(J=(0,l.default)(c.default.mark(function e(t,n){var r,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUniqueIndexId(t);case 2:return r=e.sent,e.next=5,this.find((0,u.default)({},t,n),{indexId:r,fields:["_id"]});case 5:return a=e.sent,e.abrupt("return",0===a.data.length);case 7:case"end":return e.stop()}},e,this)})),function(e,t){return J.apply(this,arguments)})},{key:"getUniqueIndexId",value:function(e){return this.getIndexId([e],{indexName:"".concat(this.doctype,"/").concat(e)})}},{key:"getIndexId",value:(Y=(0,l.default)(c.default.mark(function e(t,n){var r,a,i,o,u;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=void 0===(r=n.partialFilter)?"":r,o=void 0===(i=n.indexName)?(0,_.getIndexNameFromFields)(t):i,this.indexes[o]){e.next=20;break}return e.prev=2,e.next=5,this.createIndex(t,{partialFilter:a});case 5:u=e.sent,e.next=19;break;case 8:if(e.prev=8,e.t0=e.catch(2),(0,w.isIndexConflictError)(e.t0)){e.next=14;break}throw e.t0;case 14:return e.next=16,(0,h.sleep)(1e3);case 16:return e.next=18,this.createIndex(t,{partialFilter:a});case 18:u=e.sent;case 19:this.indexes[o]=u;case 20:return e.abrupt("return",this.indexes[o].id);case 21:case"end":return e.stop()}},e,this,[[2,8]])})),function(e,t){return Y.apply(this,arguments)})},{key:"createIndex",value:(W=(0,l.default)(c.default.mark(function e(t){var n,r,a,i,o,u,s,l,d=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=d.length>1&&void 0!==d[1]?d[1]:{}).partialFilter,a=n.indexName,i={index:{fields:t}},a&&(i.ddoc=a),r&&(i.index.partial_filter_selector=r),e.prev=4,e.next=7,this.stackClient.fetchJSON("POST",(0,h.uri)(D(),this.doctype),i);case 7:o=e.sent,e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(4),(0,w.isIndexConflictError)(e.t0)){e.next=16;break}throw e.t0;case 16:return e.abrupt("return");case 17:if(u={id:o.id,fields:t},"exists"!==o.result){e.next=20;break}return e.abrupt("return",u);case 20:return s={},t.forEach(function(e){return s[e]={$gt:null}}),l={indexId:u.id,limit:1,partialFilterFields:r?(0,_.getIndexFields)({partialFilter:r}):null},e.next=25,(0,h.attempt)(this.find(s,l));case 25:if(!e.sent){e.next=27;break}return e.abrupt("return",u);case 27:return e.next=29,(0,h.sleep)(1e3);case 29:return e.next=31,(0,h.attempt)(this.find(s,l));case 31:if(!e.sent){e.next=33;break}return e.abrupt("return",u);case 33:return e.next=35,(0,h.sleep)(500);case 35:return e.abrupt("return",u);case 36:case"end":return e.stop()}},e,this,[[4,10]])})),function(e){return W.apply(this,arguments)})},{key:"fetchAllMangoIndexes",value:(K=(0,l.default)(c.default.mark(function e(){var t,n;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,h.uri)(C(),this.doctype),e.next=3,this.stackClient.fetchJSON("GET",t);case 3:return n=e.sent,e.abrupt("return",n.rows.filter(function(e){return"query"===e.doc.language}).map(function(e){return(0,_.normalizeDesignDoc)(e)}));case 5:case"end":return e.stop()}},e,this)})),function(){return K.apply(this,arguments)})},{key:"destroyIndex",value:(V=(0,l.default)(c.default.mark(function e(t){var n,r,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id.split("/")[1],r=t._rev,a=(0,h.uri)(P(),this.doctype,n,r),e.abrupt("return",this.stackClient.fetchJSON("DELETE",a));case 4:case"end":return e.stop()}},e,this)})),function(e){return V.apply(this,arguments)})},{key:"copyIndex",value:($=(0,l.default)(c.default.mark(function e(t,n){var r,a,i,o;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t._id.split("/")[1],a=t._rev,i=(0,h.uri)(E(),this.doctype,r,a),o={headers:{Destination:"_design/".concat(n)}},e.abrupt("return",this.stackClient.fetchJSON("POST",i,null,o));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return $.apply(this,arguments)})},{key:"findExistingIndex",value:(Z=(0,l.default)(c.default.mark(function e(t,n){var r,a,i,o,u,s;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.sort,a=n.indexedFields,i=n.partialFilter,e.next=3,this.fetchAllMangoIndexes();case 3:if(!((o=e.sent).length<1)){e.next=6;break}return e.abrupt("return",null);case 6:return r=(0,_.transformSort)(r),u=a||(0,_.getIndexFields)({sort:r,selector:t}),s=o.find(function(e){return(0,_.isMatchingIndex)(e,u,i)}),e.abrupt("return",s);case 10:case"end":return e.stop()}},e,this)})),function(e,t){return Z.apply(this,arguments)})},{key:"fetchChangesRaw",value:(X=(0,l.default)(c.default.mark(function e(t){var n,r,a,i,o,u;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.doc_ids&&t.doc_ids.length>0,r="?".concat([k.default.stringify(N(N({},(0,v.default)(t,["doc_ids","includeDocs"])),{},{include_docs:t.includeDocs})),n&&void 0===t.filter?"filter=_doc_ids":void 0].filter(Boolean).join("&")),a=n?"POST":"GET",i="/data/".concat(this.doctype,"/_changes").concat(r),o=n?{doc_ids:t.doc_ids}:void 0,e.next=7,this.stackClient.fetchJSON(a,i,o);case 7:return u=e.sent,e.abrupt("return",u);case 9:case"end":return e.stop()}},e,this)})),function(e){return X.apply(this,arguments)})},{key:"fetchChanges",value:(ee=(0,l.default)(c.default.mark(function e(){var t=this,n,r,a,i,o,u,s=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>0&&void 0!==s[0]?s[0]:{},r=s.length>1&&void 0!==s[1]?s[1]:{},a={includeDocs:!0},"object"!=typeof n?(a.since=n,x.default.warn('fetchChanges use couchOptions as Object not a string, since is deprecated, please use fetchChanges({since: "'.concat(n,'"}).'))):Object.keys(n).length>0&&Object.assign(a,n),e.next=6,this.fetchChangesRaw(a);case 6:return o=(i=e.sent).last_seq,u=i.results.map(function(e){return e.doc}).filter(Boolean),!r.includeDesign&&(u=u.filter(function(e){return 0!==e._id.indexOf("_design")})),!r.includeDeleted&&(u=u.filter(function(e){return!e._deleted})),e.abrupt("return",{newLastSeq:o,documents:u.map(function(e){return(0,O.normalizeDoc)(e,t.doctype)})});case 12:case"end":return e.stop()}},e,this)})),function(){return ee.apply(this,arguments)})}],[{key:"normalizeDoctype",value:function(e){return(0,O.normalizeDoctypeRawApi)(e)}}]),et}();t.default=z},946:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isDirectory=t.isFile=void 0;var i=a(n(80295)),o=a(n(68434)),u=a(n(41)),c=a(n(82007)),s=a(n(65105)),l=a(n(19723)),d=a(n(8997)),f=a(n(25665)),p=a(n(27952)),h=a(n(12323)),y=a(n(64512)),v=a(n(12109)),m=a(n(18721)),b=a(n(27361)),g=a(n(57557)),k=a(n(78718));n(91303);var _=a(n(87386)),O=n(63818),w=n(65987);n(86701);var S=n(93868),x=n(63972),E=r(n(66343)),P=a(n(25790));function C(){var e=(0,u.default)(["/files/_changes"]);return C=function(){return e},e}function D(){var e=(0,u.default)(["/data/","/","/relationships/not_synchronizing"]);return D=function(){return e},e}function j(){var e=(0,u.default)(["/data/","/","/relationships/not_synchronizing"]);return j=function(){return e},e}function A(){var e=(0,u.default)(["/data/","/","/relationships/not_synchronizing"]);return A=function(){return e},e}function T(){var e=(0,u.default)(["/files/","/versions"]);return T=function(){return e},e}function R(){var e=(0,u.default)(["/files/upload/metadata"]);return R=function(){return e},e}function I(){var e=(0,u.default)(["/files/",""]);return I=function(){return e},e}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function N(){var e=(0,u.default)(["/files/","?Name=","&Type=directory&MetadataID=",""]);return N=function(){return e},e}function F(){var e=(0,u.default)(["/files/metadata?Path=",""]);return F=function(){return e},e}function L(){var e=(0,u.default)(["/files/",""]);return L=function(){return e},e}function B(){var e=(0,u.default)(["/files/downloads?Path=",""]);return B=function(){return e},e}function z(){var e=(0,u.default)(["/files/downloads?VersionId=","&Filename=",""]);return z=function(){return e},e}function U(){var e=(0,u.default)(["/files/downloads?Id=","&Filename=",""]);return U=function(){return e},e}function q(){var e=(0,u.default)(["/files/","?Name=","&Type=file&Executable=","&Encrypted=",""]);return q=function(){return e},e}function G(){var e=(0,u.default)(["/files/","?Name=","&Type=file&Executable=","&Encrypted=","&MetadataID=","&Size=","&SourceAccount=","&SourceAccountIdentifier=",""]);return G=function(){return e},e}function Q(){var e=(0,u.default)(["/files/",""]);return Q=function(){return e},e}function H(){var e=(0,u.default)(["/files/","/copy"]);return H=function(){return e},e}function J(){var e=(0,u.default)(["/files/trash/",""]);return J=function(){return e},e}function Y(){var e=(0,u.default)(["/files/",""]);return Y=function(){return e},e}function W(){var e=(0,u.default)(["/data/","/","/relationships/references"]);return W=function(){return e},e}function K(){var e=(0,u.default)(["/data/","/","/relationships/references"]);return K=function(){return e},e}function V(){var e=(0,u.default)(["/files/","/relationships/referenced_by"]);return V=function(){return e},e}function $(){var e=(0,u.default)(["/files/","/relationships/referenced_by"]);return $=function(){return e},e}function Z(){var e=(0,u.default)(["/data/","/","/relationships/references"]);return Z=function(){return e},e}function X(){var e=(0,u.default)(["/files/_all_docs?include_docs=true"]);return X=function(){return e},e}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach(function(t){(0,y.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var en="io.cozy.files.root-dir",er=(0,O.normalizeDoctypeJsonApi)("io.cozy.files"),ea=function(e){var t;return et(et({},er(e)),{},{_rev:null==e?void 0:null===(t=e.meta)||void 0===t?void 0:t.rev})},ei=function(e){return e?e.map(function(e){return{_type:e.type,_id:e.id}}):[]},eo=function(e){return e&&e.trim()},eu=function(e){var t=eo(e);if("string"!=typeof t||""===t)throw Error("Missing name argument");if("."===e||".."===e)throw Error("Invalid filename: ".concat(e));var n=(0,x.getIllegalCharacters)(t);if(n.length)throw Error("Invalid filename containing illegal character(s): ".concat(n));return t};t.isFile=function(e){var t=e._type,n=e.type;return"io.cozy.files"===t||"directory"===n||"file"===n};t.isDirectory=function(e){return"directory"===e.type};var ec=function(e,t){return new Promise(function(n){e.forEach(function(e){return e.then(function(e){t(e)&&n(!0)})}),Promise.all(e).then(function(){return n(!1)})})},es=function(e){var t=e.lastIndexOf("/");return e.substring(0,t)},el=function(e){(0,f.default)(eB,e);var t,n,r,a,u,_,O,x,ee,er,el,ed,ef,ep,eh,ey,ev,em,eb,eg,ek,e_,eO,ew,eS,ex,eE,eP,eC,eD,ej,eA,eT,eR,eI,eM,eN,eF,eL=(t=eB,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,h.default)(t);return e=n?Reflect.construct(r,arguments,(0,h.default)(this).constructor):r.apply(this,arguments),(0,p.default)(this,e)});function eB(e,t){var n;return(0,s.default)(this,eB),n=eL.call(this,e,t),(0,y.default)((0,d.default)(n),"extractResponseLinkRelated",function(e){var t=e.links&&e.links.related;if(!t)throw Error("No related link in server response");return n.stackClient.fullpath(t)}),(0,y.default)((0,d.default)(n),"forceFileDownload",function(e,t){(0,w.forceDownload)(e,t)}),n.specialDirectories={},n}return(0,l.default)(eB,[{key:"get",value:function(e){return this.statById(e)}},{key:"getAll",value:(r=(0,c.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stackClient.fetchJSON("POST",(0,w.uri)(X()),{keys:t});case 3:n=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",(0,S.dontThrowNotFoundError)(e.t0));case 9:return e.abrupt("return",{data:n.data.map(function(e){return ea(e)}),meta:{count:n.data.length},execution_stats:n.execution_stats});case 10:case"end":return e.stop()}},e,this,[[0,6]])})),function(e){return r.apply(this,arguments)})},{key:"fetchFindFiles",value:(a=(0,c.default)(o.default.mark(function e(t,n){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.stackClient.fetchJSON("POST","/files/_find",this.toMangoOptions(t,n)));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"find",value:(u=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u,c,s,l=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(r=(n=l.length>1&&void 0!==l[1]?l[1]:{}).skip)?0:r,e.prev=2,u="/files/_find",e.next=6,this.findWithMango(u,t,n);case 6:i=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",(0,S.dontThrowNotFoundError)(e.t0));case 12:return c=(0,b.default)(i,"links.next",""),s=new URL("".concat(this.stackClient.uri).concat(c)).searchParams.get("page[cursor]"),e.abrupt("return",{data:i.data.map(function(e){return ea(e)}),meta:i.meta,next:i.meta.count>a+i.data.length,skip:a,bookmark:s||void 0,execution_stats:i.meta.execution_stats});case 16:case"end":return e.stop()}},e,this,[[2,9]])})),function(e){return u.apply(this,arguments)})},{key:"findReferencedBy",value:(_=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u,c,s,l,d=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(r=(n=d.length>1&&void 0!==d[1]?d[1]:{}).skip)?0:r,i=n.limit,u={include:"files","page[limit]":i,"page[cursor]":n.cursor,sort:"datetime"},c=(0,w.uri)(Z(),t._type,t._id),s=E.buildURL(c,u),e.next=6,this.stackClient.fetchJSON("GET",s);case 6:return l=e.sent,e.abrupt("return",{data:ei(l.data),included:l.included?l.included.map(function(e){return ea(e)}):[],next:(0,m.default)(l,"links.next"),meta:l.meta,skip:a});case 8:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"addReferencedBy",value:(O=(0,c.default)(o.default.mark(function e(t,n){var r,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.map(function(e){return{id:e._id,type:e._type}}),e.next=3,this.stackClient.fetchJSON("POST",(0,w.uri)($(),t._id),{data:r});case 3:return a=e.sent,e.abrupt("return",{data:ei(a.data),meta:a.meta});case 5:case"end":return e.stop()}},e,this)})),function(e,t){return O.apply(this,arguments)})},{key:"removeReferencedBy",value:(x=(0,c.default)(o.default.mark(function e(t,n){var r,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.map(function(e){return{id:e._id||e.id,type:e._type||e.type}}),e.next=3,this.stackClient.fetchJSON("DELETE",(0,w.uri)(V(),t._id||t.id),{data:r});case 3:return a=e.sent,e.abrupt("return",{data:ei(a.data),meta:a.meta});case 5:case"end":return e.stop()}},e,this)})),function(e,t){return x.apply(this,arguments)})},{key:"addReferencesTo",value:(ee=(0,c.default)(o.default.mark(function e(t,n){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.map(function(e){return{id:e._id,type:"io.cozy.files"}}),e.abrupt("return",this.stackClient.fetchJSON("POST",(0,w.uri)(K(),t._type,t._id),{data:r}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return ee.apply(this,arguments)})},{key:"removeReferencesTo",value:(er=(0,c.default)(o.default.mark(function e(t,n){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.map(function(e){return{id:e._id,type:"io.cozy.files"}}),e.abrupt("return",this.stackClient.fetchJSON("DELETE",(0,w.uri)(W(),t._type,t._id),{data:r}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return er.apply(this,arguments)})},{key:"destroy",value:(el=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u,c,s=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0===(n=(s.length>1&&void 0!==s[1]?s[1]:{}).ifMatch)?"":n,a=t._id,i=t.relationships,e.next=4,this.stackClient.fetchJSON("DELETE",(0,w.uri)(Y(),a),void 0,{headers:{"If-Match":r}});case 4:if(u=e.sent,!Array.isArray(c=(0,b.default)(i,"referenced_by.data",t.referenced_by))){e.next=9;break}return e.next=9,this.removeReferencedBy(t,c);case 9:return e.abrupt("return",{data:ea(u.data)});case 10:case"end":return e.stop()}},e,this)})),function(e){return el.apply(this,arguments)})},{key:"emptyTrash",value:function(){return this.stackClient.fetchJSON("DELETE","/files/trash")}},{key:"restore",value:function(e){return this.stackClient.fetchJSON("POST",(0,w.uri)(J(),e))}},{key:"copy",value:(ed=(0,c.default)(o.default.mark(function e(t,n,r){var a,i,u,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={name:void 0===n?void 0:eu(n),DirID:r},i=(0,w.uri)(H(),t),u=E.buildURL(i,a),e.next=5,this.stackClient.fetchJSON("POST",u);case 5:return c=e.sent,e.abrupt("return",{data:ea(c.data)});case 7:case"end":return e.stop()}},e,this)})),function(e,t,n){return ed.apply(this,arguments)})},{key:"deleteFilePermanently",value:(ef=(0,c.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("PATCH",(0,w.uri)(Q(),t),{data:{type:"io.cozy.files",id:t,attributes:{permanent_delete:!0}}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return ef.apply(this,arguments)})},{key:"upload",value:(ep=(0,c.default)(o.default.mark(function e(t,n){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureDirectoryExists(n);case 2:return r=e.sent,e.abrupt("return",this.createFile(t,{dirId:r}));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return ep.apply(this,arguments)})},{key:"create",value:(eh=(0,c.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("directory"!==t.type){e.next=4;break}return e.abrupt("return",this.createDirectory(t));case 4:return n=t.data,r=(0,i.default)(t,["data"]),e.abrupt("return",this.createFile(n,r));case 6:case"end":return e.stop()}},e,this)})),function(e){return eh.apply(this,arguments)})},{key:"update",value:(ey=(0,c.default)(o.default.mark(function e(t){var n,r,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.data,r=(0,i.default)(t,["data"]),a=t.id||t._id,!n){e.next=7;break}if("directory"!==t.type){e.next=5;break}throw Error("You cannot pass a data object for a directory");case 5:return r.fileId=a,e.abrupt("return",this.updateFile(n,r));case 7:return e.abrupt("return",this.updateAttributes(a,t));case 8:case"end":return e.stop()}},e,this)})),function(e){return ey.apply(this,arguments)})},{key:"createFile",value:(ev=(0,c.default)(o.default.mark(function e(t){var n,r,a,u,c,s,l,d,f,p,h,y,v,m,b,g,k,_,O=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=O.length>1&&void 0!==O[1]?O[1]:{}).name,u=void 0===(a=n.dirId)?"":a,s=void 0!==(c=n.executable)&&c,d=void 0!==(l=n.encrypted)&&l,f=n.metadata,h=void 0===(p=n.sourceAccount)?"":p,v=void 0===(y=n.sourceAccountIdentifier)?"":y,m=(0,i.default)(n,["name","dirId","executable","encrypted","metadata","sourceAccount","sourceAccountIdentifier"]),!(b=r)&&"string"==typeof t.name&&(b=t.name),b=eu(b),g="",!f){e.next=11;break}return e.next=9,this.createFileMetadata(f);case 9:g=e.sent.data.id;case 11:return k="",m.contentLength&&(k=String(m.contentLength)),_=(0,w.uri)(G(),u,b,s,d,g,k,h,v),e.abrupt("return",this.doUpload(t,_,m));case 15:case"end":return e.stop()}},e,this)})),function(e){return ev.apply(this,arguments)})},{key:"updateFile",value:(em=(0,c.default)(o.default.mark(function e(t){var n,r,a,u,c,s,l,d,f,p,h,y,v,m,b,g=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=void 0!==(r=(n=g.length>1&&void 0!==g[1]?g[1]:{}).executable)&&r,c=void 0!==(u=n.encrypted)&&u,s=n.fileId,d=void 0===(l=n.name)?"":l,f=n.metadata,p=(0,i.default)(n,["executable","encrypted","fileId","name","metadata"]),!(!s||"string"!=typeof s)){e.next=4;break}throw Error("missing fileId argument");case 4:if(!(!(h=d||t.name)||"string"!=typeof h)){e.next=7;break}throw Error("missing name in data argument");case 7:if(y=eu(h),m=(0,w.uri)(q(),s,y,a,c),!f){e.next=15;break}return e.next=12,this.createFileMetadata(f);case 12:v=e.sent.data.id,m+="&MetadataID=".concat(v);case 15:return b="",p.contentLength&&(b=String(p.contentLength),m+="&Size=".concat(b)),e.abrupt("return",this.doUpload(t,m,p,"PUT"));case 18:case"end":return e.stop()}},e,this)})),function(e){return em.apply(this,arguments)})},{key:"getDownloadLinkById",value:function(e,t){return this.stackClient.fetchJSON("POST",(0,w.uri)(U(),e,encodeURIComponent(t))).then(this.extractResponseLinkRelated)}},{key:"getDownloadLinkByRevision",value:function(e,t){return this.stackClient.fetchJSON("POST",(0,w.uri)(z(),e,encodeURIComponent(t))).then(this.extractResponseLinkRelated)}},{key:"getDownloadLinkByPath",value:function(e){return this.stackClient.fetchJSON("POST",(0,w.uri)(B(),e)).then(this.extractResponseLinkRelated)}},{key:"download",value:(eb=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:null,i=(r=u.length>2&&void 0!==u[2]?u[2]:void 0)||t.name,n){e.next=9;break}return e.next=6,this.getDownloadLinkById(t._id,i);case 6:a=e.sent,e.next=12;break;case 9:return e.next=11,this.getDownloadLinkByRevision(n,i);case 11:a=e.sent;case 12:this.forceFileDownload("".concat(a,"?Dl=1"),i);case 13:case"end":return e.stop()}},e,this)})),function(e){return eb.apply(this,arguments)})},{key:"fetchFileContent",value:(eg=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.default.warn("FileCollection.fetchFileContent() is deprecated. Use FileCollection.fetchFileContentById() instead"),e.abrupt("return",this.fetchFileContentById(t));case 2:case"end":return e.stop()}},e,this)})),function(e){return eg.apply(this,arguments)})},{key:"fetchFileContentById",value:(ek=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.stackClient.fetch("GET","/files/download/".concat(t)));case 1:case"end":return e.stop()}},e,this)})),function(e){return ek.apply(this,arguments)})},{key:"getBeautifulSize",value:function(e,t){return(0,w.formatBytes)(parseInt(e.size),t)}},{key:"downloadArchive",value:(e_=(0,c.default)(o.default.mark(function e(t,n){var r,a,i,u,c=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(c.length>2&&void 0!==c[2]?c[2]:{}).pages,a=n?(0,w.slugify)(n):"files",e.next=4,this.createArchiveLinkByIds({ids:t,name:a,pages:r});case 4:i=e.sent,u=this.stackClient.fullpath(i),this.forceFileDownload(u,a+".zip");case 7:case"end":return e.stop()}},e,this)})),function(e,t){return e_.apply(this,arguments)})},{key:"getArchiveLinkByIds",value:(eO=(0,c.default)(o.default.mark(function e(t){var n,r,a=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:"files",P.default.warn("CozyClient FileCollection getArchiveLinkByIds method is deprecated. Use createArchiveLinkByIds instead"),e.next=4,this.stackClient.fetchJSON("POST","/files/archive",{data:{type:"io.cozy.archives",attributes:{name:n,ids:t}}});case 4:return r=e.sent,e.abrupt("return",r.links.related);case 6:case"end":return e.stop()}},e,this)})),function(e){return eO.apply(this,arguments)})},{key:"createArchiveLinkByIds",value:(ew=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.ids,a=void 0===(r=t.name)?"files":r,i=t.pages,e.next=3,this.stackClient.fetchJSON("POST","/files/archive",{data:{type:"io.cozy.archives",attributes:et({name:a,ids:n},i&&{pages:i})}});case 3:return u=e.sent,e.abrupt("return",u.links.related);case 5:case"end":return e.stop()}},e,this)})),function(e){return ew.apply(this,arguments)})},{key:"isChildOf",value:(eS=(0,c.default)(o.default.mark(function e(t,n){var r,a,i,u,c,s,l,d,f,p=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(r="object"==typeof t?t:{_id:t})._id,i=r.dirID,u=r.path,c=("object"==typeof n?n:{_id:n})._id,!(a===c||i===c)){e.next=4;break}return e.abrupt("return",!0);case 4:if(u){e.next=10;break}return e.next=7,this.statById(a);case 7:u=(s=e.sent).data.path,i=s.data.dirID;case 10:for(l=u,d=[u];""!=l;)""!=(f=es(l))&&d.push(f),l=f;return d.reverse(),e.abrupt("return",ec(d.map(function(e){return p.statByPath(e)}),function(e){return e.data._id==c}));case 15:case"end":return e.stop()}},e,this)})),function(e,t){return eS.apply(this,arguments)})},{key:"statById",value:(ex=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u,c=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},r=(0,k.default)(n,["page[limit]","page[skip]","page[cursor]"]),a=(0,w.uri)(L(),t),i=E.buildURL(a,r),e.next=6,this.stackClient.fetchJSON("GET",i);case 6:return u=e.sent,e.abrupt("return",{data:ea(u.data),included:u.included&&u.included.map(function(e){return ea(e)}),links:u.links});case 8:case"end":return e.stop()}},e,this)})),function(e){return ex.apply(this,arguments)})},{key:"statByPath",value:(eE=(0,c.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",(0,w.uri)(F(),t));case 2:return n=e.sent,e.abrupt("return",{data:ea(n.data),included:n.included&&n.included.map(function(e){return ea(e)})});case 4:case"end":return e.stop()}},e,this)})),function(e){return eE.apply(this,arguments)})},{key:"createDirectory",value:(eP=(0,c.default)(o.default.mark(function e(){var t,n,r,a,i,u,c,s,l,d=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=d.length>0&&void 0!==d[0]?d[0]:{}).name,r=t.dirId,a=t.lastModifiedDate,i=t.metadata,u="",!i){e.next=8;break}return e.next=6,this.createFileMetadata(i);case 6:u=e.sent.data.id;case 8:return c=eu(n),s=a&&("string"==typeof a?new Date(a):a),e.next=12,this.stackClient.fetchJSON("POST",(0,w.uri)(N(),r,c,u),void 0,{headers:{Date:s?s.toGMTString():""}});case 12:return l=e.sent,e.abrupt("return",{data:ea(l.data)});case 14:case"end":return e.stop()}},e,this)})),function(){return eP.apply(this,arguments)})},{key:"ensureDirectoryExists",value:(eC=(0,c.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.specialDirectories[t]){e.next=5;break}return e.next=3,this.createDirectoryByPath(t);case 3:n=e.sent,this.specialDirectories[t]=n.data._id;case 5:return e.abrupt("return",this.specialDirectories[t]);case 6:case"end":return e.stop()}},e,this)})),function(e){return eC.apply(this,arguments)})},{key:"getDirectoryOrCreate",value:(eD=(0,c.default)(o.default.mark(function e(t,n){var r,a,i,u;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n&&!n.attributes)){e.next=2;break}throw Error("Malformed parent directory");case 2:return r=eo(t),a="".concat(n._id===en?"":n.attributes.path,"/").concat(r),e.prev=4,e.next=7,this.statByPath(a||"/");case 7:return i=e.sent,e.abrupt("return",i);case 11:if(e.prev=11,e.t0=e.catch(4),!((u=JSON.parse(e.t0.message).errors)&&u.length&&"404"===u[0].status)){e.next=17;break}return e.abrupt("return",this.createDirectory({name:r,dirId:n&&n._id}));case 17:throw u;case 18:case"end":return e.stop()}},e,this,[[4,11]])})),function(e,t){return eD.apply(this,arguments)})},{key:"createDirectoryByPath",value:(ej=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.split("/").filter(function(e){return""!==e}),e.next=3,this.statById(en);case 3:if(r=e.sent,n.length){e.next=6;break}return e.abrupt("return",r);case 6:a=r,i=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(n),e.prev=8,i.s();case 10:if((u=i.n()).done){e.next=17;break}return c=u.value,e.next=14,this.getDirectoryOrCreate(c,a.data);case 14:a=e.sent;case 15:e.next=10;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),i.e(e.t0);case 22:return e.prev=22,i.f(),e.finish(22);case 25:return e.abrupt("return",a);case 26:case"end":return e.stop()}},e,this,[[8,19,22,25]])})),function(e){return ej.apply(this,arguments)})},{key:"updateAttributes",value:(eA=(0,c.default)(o.default.mark(function e(t,n){var r,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=et({},n),n.name&&(r.name=eu(n.name)),e.next=4,this.stackClient.fetchJSON("PATCH",(0,w.uri)(I(),t),{data:{type:"io.cozy.files",id:t,attributes:r}});case 4:return a=e.sent,e.abrupt("return",{data:ea(a.data)});case 6:case"end":return e.stop()}},e,this)})),function(e,t){return eA.apply(this,arguments)})},{key:"updateFileMetadata",value:(eT=(0,c.default)(o.default.mark(function e(t,n){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.default.warn("CozyClient FileCollection updateFileMetadata method is deprecated. Use updateAttributes instead"),e.abrupt("return",this.updateAttributes(t,n));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return eT.apply(this,arguments)})},{key:"createFileMetadata",value:(eR=(0,c.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST",(0,w.uri)(R()),{data:{type:"io.cozy.files.metadata",attributes:t}});case 2:return n=e.sent,e.abrupt("return",{data:n.data});case 4:case"end":return e.stop()}},e,this)})),function(e){return eR.apply(this,arguments)})},{key:"updateMetadataAttribute",value:(eI=(0,c.default)(o.default.mark(function e(t,n){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST",(0,w.uri)(T(),t),{data:{type:"io.cozy.files.metadata",attributes:n}});case 2:return r=e.sent,e.abrupt("return",{data:r.data});case 4:case"end":return e.stop()}},e,this)})),function(e,t){return eI.apply(this,arguments)})},{key:"getFileTypeFromName",value:function(e){return v.default.getType(e)||"application/octet-stream"}},{key:"doUpload",value:(eM=(0,c.default)(o.default.mark(function e(t,n,r){var a,i,u,c,s,l,d,f,p,h,y,v,m,b,g,k,_,O,w,S=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=S.length>3&&void 0!==S[3]?S[3]:"POST",i=n,u=t){e.next=5;break}throw Error("missing data argument");case 5:if(u.buffer&&u.buffer instanceof ArrayBuffer&&(u=u.buffer),c="undefined"!=typeof ArrayBuffer&&u instanceof ArrayBuffer,s="undefined"!=typeof File&&u instanceof File,l="undefined"!=typeof Blob&&u instanceof Blob,d=!0===u.readable&&"function"==typeof u.pipe,f="string"==typeof u,!(!c&&!s&&!l&&!d&&!f)){e.next=13;break}throw Error("invalid data type");case 13:return h=(p=r||{}).contentType,y=p.contentLength,v=p.checksum,m=p.lastModifiedDate,b=p.ifMatch,!h&&("string"==typeof u?h="text/plain":u.type?h=u.type:(k=new URLSearchParams((g=i.split("?")).length>1?g[1]:"").get("Name"),h=this.getFileTypeFromName(k.toLowerCase()))),(m=m||u.lastModified)&&(m=new Date(m)),_={"Content-Type":h},y&&(_["Content-Length"]=String(y)),v&&(_["Content-MD5"]=v),m&&(O=m.toISOString(),i="".concat(i,"&UpdatedAt=").concat(O,"&CreatedAt=").concat(O)),b&&(_["If-Match"]=b),e.next=24,this.stackClient.fetchJSON(a,i,u,{headers:_,onUploadProgress:r.onUploadProgress});case 24:return w=e.sent,e.abrupt("return",{data:ea(w.data)});case 26:case"end":return e.stop()}},e,this)})),function(e,t,n){return eM.apply(this,arguments)})},{key:"findNotSynchronizedDirectories",value:(eN=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u,c,s,l,d,f,p=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(r=(n=p.length>1&&void 0!==p[1]?p[1]:{}).skip)?0:r,i=n.limit,u=n.cursor,s={include:void 0!==(c=n.includeFiles)&&c?"files":void 0,"page[limit]":i,"page[cursor]":u,sort:"id"},l=(0,w.uri)(A(),t._type,t._id),d=E.buildURL(l,s),e.next=6,this.stackClient.fetchJSON("GET",d);case 6:return f=e.sent,e.abrupt("return",{data:f.data.map(function(e){return ea(e)}),included:f.included?f.included.map(function(e){return ea(e)}):[],next:(0,m.default)(f,"links.next"),meta:f.meta,skip:a});case 8:case"end":return e.stop()}},e,this)})),function(e){return eN.apply(this,arguments)})},{key:"addNotSynchronizedDirectories",value:function(e,t){var n=t.map(function(e){return{id:e._id,type:e._type}});return this.stackClient.fetchJSON("POST",(0,w.uri)(j(),e._type,e._id),{data:n})}},{key:"removeNotSynchronizedDirectories",value:function(e,t){var n=t.map(function(e){return{id:e._id,type:e._type}});return this.stackClient.fetchJSON("DELETE",(0,w.uri)(D(),e._type,e._id),{data:n})}},{key:"fetchChanges",value:(eF=(0,c.default)(o.default.mark(function e(){var t,n,r,a,i,u,c,s,l,d,f=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]?f[0]:{},n=f.length>1&&void 0!==f[1]?f[1]:{},r={},"object"!=typeof t?(r.since=t,P.default.warn('fetchChanges use couchOptions as Object not a string, since is deprecated, please use fetchChanges({since: "'.concat(t,'"}).'))):Object.keys(t).length>0&&Object.assign(r,t),Object.keys(n).length>0&&(Object.assign(r,n),(n.skipTrashed||n.includeFilePath)&&(r.includeDocs=!0)),a=et(et({},(0,g.default)(r,["fields","includeDocs","includeFilePath","skipDeleted","skipTrashed"])),{},{fields:r.fields?r.fields.join(","):null,include_docs:r.includeDocs,include_file_path:r.includeFilePath,skip_deleted:r.skipDeleted,skip_trashed:r.skipTrashed}),i=(0,w.uri)(C()),u=E.buildURL(i,a),e.next=10,this.stackClient.fetchJSON("GET",u);case 10:return s=(c=e.sent).last_seq,l=c.pending,d=c.results,e.abrupt("return",{newLastSeq:s,pending:l,results:d});case 15:case"end":return e.stop()}},e,this)})),function(){return eF.apply(this,arguments)})}]),eB}(_.default);t.default=el},71606:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.hasJobFinished=t.normalizeJob=t.JOBS_DOCTYPE=void 0;var a=r(n(68434)),i=r(n(41)),o=r(n(82007)),u=r(n(65105)),c=r(n(19723)),s=r(n(25665)),l=r(n(27952)),d=r(n(12323)),f=r(n(93868)),p=r(n(87386)),h=n(65987),y=n(63818);function v(){var e=(0,i.default)(["/jobs/",""]);return v=function(){return e},e}var m="io.cozy.jobs";t.JOBS_DOCTYPE=m;var b=function(e){return new Promise(function(t){return setTimeout(t,e)})},g=(0,y.normalizeDoctypeJsonApi)(m);t.normalizeJob=g;var k=function(e){return"done"===e.state||"errored"===e.state};t.hasJobFinished=k;var _=function(e){(0,s.default)(_,e);var t,n,r,i,p,y=(t=_,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,d.default)(t);return e=n?Reflect.construct(r,arguments,(0,d.default)(this).constructor):r.apply(this,arguments),(0,l.default)(this,e)});function _(e){return(0,u.default)(this,_),y.call(this,m,e)}return(0,c.default)(_,[{key:"queued",value:function(e){return this.stackClient.fetchJSON("GET","/jobs/queue/".concat(e))}},{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.stackClient.fetchJSON("POST","/jobs/queue/".concat(e),{data:{type:m,attributes:{arguments:t,options:n,manual:r}}})}},{key:"get",value:(r=(0,o.default)(a.default.mark(function e(t){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.default.get(this.stackClient,(0,h.uri)(v(),t),{normalize:g}));case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"update",value:(i=(0,o.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("client"!==t.worker)){e.next=2;break}throw Error("JobCollection.update only works for client workers. ".concat(t.worker," given"));case 2:return e.next=4,this.stackClient.fetchJSON("PATCH","/jobs/".concat(t._id),{data:{type:m,id:t._id,attributes:{state:t.attributes.state,error:t.attributes.error}}});case 4:return n=e.sent,e.abrupt("return",g(n.data));case 6:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"waitFor",value:(p=(0,o.default)(a.default.mark(function e(t){var n,r,i,o,u,c,s,l,d,f,p,h,y=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0===(r=(n=y.length>1&&void 0!==y[1]?y[1]:{}).onUpdate)?null:r,u=void 0===(o=n.until)?k:o,s=void 0===(c=n.delay)?5e3:c,d=void 0===(l=n.timeout)?3e5:l,f=Date.now(),e.next=4,this.get(t);case 4:p=e.sent.data.attributes;case 5:if(!(!p||!u(p))){e.next=17;break}return e.next=8,b(s);case 8:return e.next=10,this.get(t);case 10:if(p=e.sent.data.attributes,i&&i(p),h=Date.now(),!(f-h>d)){e.next=15;break}throw Error("Timeout for JobCollection::waitFor");case 15:e.next=5;break;case 17:return e.abrupt("return",p);case 18:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})}]),_}(p.default);t.default=_},53381:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.KONNECTORS_DOCTYPE=void 0;var i=a(n(68434)),o=a(n(82007)),u=a(n(65105)),c=a(n(19723)),s=a(n(25665)),l=a(n(27952)),d=a(n(12323)),f=a(n(78718)),p=a(n(83964)),h=r(n(13041)),y=n(63818),v="io.cozy.konnectors";t.KONNECTORS_DOCTYPE=v;var m=function(e){(0,s.default)(k,e);var t,n,r,a,p,m,b,g=(t=k,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,d.default)(t);return e=n?Reflect.construct(r,arguments,(0,d.default)(this).constructor):r.apply(this,arguments),(0,l.default)(this,e)});function k(e){var t;return(0,u.default)(this,k),(t=g.call(this,e)).doctype=v,t.endpoint="/konnectors/",t}return(0,c.default)(k,[{key:"create",value:(r=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("create() method is not available for konnectors");case 1:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"destroy",value:(a=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("destroy() method is not available for konnectors");case 1:case"end":return e.stop()}},e)})),function(){return a.apply(this,arguments)})},{key:"findTriggersBySlug",value:(p=(0,o.default)(i.default.mark(function e(t){var n,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new h.default(this.stackClient),e.next=3,n.all({limit:null});case 3:return r=e.sent.data,e.abrupt("return",r.map(function(e){return e.attributes}).filter(function(e){return(0,h.isForKonnector)(e,t)}));case 6:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"launch",value:(m=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u,c=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},r=new h.default(this.stackClient),e.next=4,this.findTriggersBySlug(t);case 4:if(a=e.sent,1!==(o=n.accountId?a.filter(function(e){return(0,h.isForAccount)(e,n.accountId)}):a).length){e.next=10;break}return e.abrupt("return",r.launch(a[0]));case 10:if(u=JSON.stringify((0,f.default)({slug:t,accountId:n.accountId})),0!==o.length){e.next=15;break}throw Error("No trigger found for ".concat(u));case 15:if(!(o.length>1)){e.next=17;break}throw Error("More than 1 trigger found for ".concat(u));case 17:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"update",value:(b=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:{},t){e.next=3;break}throw Error("Cannot call update with no slug");case 3:return r=n.source||null,a=n.sync?{headers:{Accept:"text/event-stream"}}:{},e.next=8,this.stackClient.fetchJSON("PUT","/konnectors/".concat(t)+(r?"?Source=".concat(r):""),a);case 8:return o=e.sent,e.abrupt("return",(0,y.normalizeDoc)(o));case 10:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})}]),k}(p.default);t.default=m},26774:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.NEXTCLOUD_FILES_DOCTYPE=t.NextcloudFilesCollection=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(25665)),s=r(n(27952)),l=r(n(12323)),d=r(n(64512)),f=r(n(87386)),p=n(65987),h=n(86701),y=n(63818);function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,d.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var g="io.cozy.remote.nextcloud.files";t.NEXTCLOUD_FILES_DOCTYPE=g;var k=(0,y.normalizeDoctypeJsonApi)(g),_=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.fromTrash,a=void 0!==r&&r;return function(n){var r=k(n);return b(b({},r),{},{parentPath:t,path:a?r.path:(0,p.joinPath)(t,r.name),cozyMetadata:b(b({},r.cozyMetadata),{},{sourceAccount:e})})}},O=function(e){(0,c.default)(P,e);var t,n,r,d,f,y,m,b,k,O,w,S,x,E=(t=P,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,l.default)(t);return e=n?Reflect.construct(r,arguments,(0,l.default)(this).constructor):r.apply(this,arguments),(0,s.default)(this,e)});function P(e){return(0,o.default)(this,P),E.call(this,g,e)}return(0,u.default)(P,[{key:"find",value:(r=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t["cozyMetadata.sourceAccount"]&&t.parentPath)){e.next=5;break}return e.next=3,this.stackClient.fetchJSON("GET","/remote/nextcloud/".concat(t["cozyMetadata.sourceAccount"]).concat((0,p.encodePath)(t.parentPath)));case 3:return n=e.sent,e.abrupt("return",{data:n.data.map(_(t["cozyMetadata.sourceAccount"],t.parentPath,{fromTrash:t.trashed}))});case 5:throw Error("Not implemented");case 6:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"destroy",value:(d=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("DELETE","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount).concat((0,p.encodePath)(t.path)));case 2:if(204!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",n);case 5:throw new h.FetchError(n,n.json());case 6:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"destroyAll",value:(f=(0,i.default)(a.default.mark(function e(t){var n,r,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,this.destroy(i);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}},e,this,[[1,11,14,17]])})),function(e){return f.apply(this,arguments)})},{key:"download",value:(y=(0,i.default)(a.default.mark(function e(t){var n,r,i,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("GET","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount).concat((0,p.encodePath)(t.path),"?Dl=1"));case 2:return n=e.sent,e.next=5,n.blob();case 5:r=e.sent,i=URL.createObjectURL(r),o=t.path.split("/").pop(),(0,p.forceDownload)(i,o);case 9:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"move",value:(m=(0,i.default)(a.default.mark(function e(t,n){var r,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,p.joinPath)(n.path,t.name),e.next=3,this.stackClient.fetch("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/move").concat((0,p.encodePath)(t.path),"?To=").concat((0,p.encodePath)(r)));case 3:if(204!==(i=e.sent).status){e.next=6;break}return e.abrupt("return",i);case 6:throw new h.FetchError(i,i.json());case 7:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"moveToCozy",value:(b=(0,i.default)(a.default.mark(function e(t,n){var r,i,o,u=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0!==(r=(u.length>2&&void 0!==u[2]?u[2]:{}).copy)&&r,e.next=3,this.stackClient.fetch("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/downstream").concat((0,p.encodePath)(t.path),"?To=").concat(n._id).concat(i?"&Copy=true":""));case 3:if(201!==(o=e.sent).status){e.next=6;break}return e.abrupt("return",o);case 6:throw new h.FetchError(o,o.json());case 7:case"end":return e.stop()}},e,this)})),function(e,t){return b.apply(this,arguments)})},{key:"moveFromCozy",value:(k=(0,i.default)(a.default.mark(function e(t,n){var r,i,o,u,c=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0!==(r=(c.length>2&&void 0!==c[2]?c[2]:{}).copy)&&r,o=(0,p.joinPath)(t.path,n.name),e.next=4,this.stackClient.fetch("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/upstream").concat((0,p.encodePath)(o),"?From=").concat(n._id).concat(i?"&Copy=true":""));case 4:if(204!==(u=e.sent).status){e.next=7;break}return e.abrupt("return",u);case 7:throw new h.FetchError(u,u.json());case 8:case"end":return e.stop()}},e,this)})),function(e,t){return k.apply(this,arguments)})},{key:"restore",value:(O=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/restore").concat((0,p.encodePath)(t.path)));case 2:if(204!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",n);case 5:throw new h.FetchError(n,n.json());case 6:case"end":return e.stop()}},e,this)})),function(e){return O.apply(this,arguments)})},{key:"emptyTrash",value:(w=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("DELETE","/remote/nextcloud/".concat(t,"/trash"));case 2:if(204!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",n);case 5:throw new h.FetchError(n,n.json());case 6:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"deletePermanently",value:(S=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("DELETE","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount).concat((0,p.encodePath)(t.path)));case 2:if(204!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",n);case 5:throw new h.FetchError(n,n.json());case 6:case"end":return e.stop()}},e,this)})),function(e){return S.apply(this,arguments)})},{key:"copy",value:(x=(0,i.default)(a.default.mark(function e(t,n){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/copy/").concat(t.path).concat(n?"?Path=".concat(n.path,"/").concat(t.name):""));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return x.apply(this,arguments)})}]),P}(f.default);t.NextcloudFilesCollection=O},55134:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.NOTES_URL_DOCTYPE=t.NOTES_DOCTYPE=void 0;var a=r(n(41)),i=r(n(64512)),o=r(n(68434)),u=r(n(82007)),c=r(n(65105)),s=r(n(19723)),l=r(n(25665)),d=r(n(27952)),f=r(n(12323)),p=r(n(87386)),h=n(63818),y=n(65987),v=n(6206);function m(){var e=(0,a.default)(["/notes/","/open"]);return m=function(){return e},e}function b(){var e=(0,a.default)(["/files/",""]);return b=function(){return e},e}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _="io.cozy.notes";t.NOTES_DOCTYPE=_;var O="io.cozy.notes.url";t.NOTES_URL_DOCTYPE=O;var w=(0,h.normalizeDoctypeJsonApi)(_),S=(0,h.normalizeDoctypeJsonApi)(O),x=function(e){(0,l.default)(O,e);var t,n,r,a,i,p,h,g=(t=O,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,f.default)(t);return e=n?Reflect.construct(r,arguments,(0,f.default)(this).constructor):r.apply(this,arguments),(0,d.default)(this,e)});function O(e){return(0,c.default)(this,O),g.call(this,_,e)}return(0,s.default)(O,[{key:"get",value:(r=(0,u.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET","/notes/".concat(t));case 2:return n=e.sent,e.abrupt("return",{data:w(n.data)});case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"all",value:(a=(0,u.default)(o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET","/notes");case 2:return t=e.sent,e.abrupt("return",k(k({},t),{},{data:t.data.map(w)}));case 4:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"destroy",value:(i=(0,u.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id,e.next=3,this.stackClient.fetchJSON("DELETE",(0,y.uri)(b(),n));case 3:return r=e.sent,e.abrupt("return",{data:k(k({},w(r.data)),{},{_deleted:!0})});case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"create",value:(p=(0,u.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dir_id,e.next=3,this.stackClient.fetchJSON("POST","/notes",{data:{type:"io.cozy.notes.documents",attributes:{title:"",schema:(0,v.getDefaultSchema)(),dir_id:n}}});case 3:return r=e.sent,e.abrupt("return",k(k({},r),{},{data:w(r.data)}));case 5:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"fetchURL",value:(h=(0,u.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id,e.next=3,this.stackClient.fetchJSON("GET",(0,y.uri)(m(),n));case 3:return r=e.sent,e.abrupt("return",{data:S(r.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"getDefaultSchema",value:function(){return(0,v.getDefaultSchema)()}}]),O}(p.default);x.normalizeDoctype=h.normalizeDoctypeJsonApi;t.default=x},6206:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultSchema=t.marks=t.nodes=void 0;var n=[["doc",{content:"(block)+",marks:"link"}],["paragraph",{content:"inline*",group:"block",marks:"strong code em link strike subsup textColor typeAheadQuery underline",parseDOM:[{tag:"p"}]}],["text",{group:"inline"}],["bulletList",{group:"block",content:"listItem+",parseDOM:[{tag:"ul"}]}],["orderedList",{group:"block",content:"listItem+",parseDOM:[{tag:"ol"}]}],["listItem",{content:"(paragraph ) (paragraph | bulletList | orderedList )*",defining:!0,parseDOM:[{tag:"li"}]}],["heading",{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}]}],["blockquote",{content:"paragraph+",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"blockquote"}]}],["rule",{group:"block",parseDOM:[{tag:"hr"}]}],["panel",{group:"block",content:"(paragraph | heading | bulletList | orderedList)+",attrs:{panelType:{default:"info"}},parseDOM:[{tag:"div[data-panel-type]"}]}],["confluenceUnsupportedBlock",{group:"block",attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedBlock"]'}]}],["confluenceUnsupportedInline",{group:"inline",inline:!0,atom:!0,attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedInline"]'}]}],["unsupportedBlock",{inline:!1,group:"block",atom:!0,selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedBlock"]'}]}],["unsupportedInline",{inline:!0,group:"inline",selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedInline"]'}]}],["hardBreak",{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}]}],["table",{content:"tableRow+",attrs:{isNumberColumnEnabled:{default:!1},layout:{default:"default"},__autoSize:{default:!1}},tableRole:"table",isolating:!0,selectable:!1,group:"block",parseDOM:[{tag:"table"}]}],["tableHeader",{content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading )+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"header_cell",isolating:!0,marks:"",parseDOM:[{tag:"th"}]}],["tableRow",{content:"(tableCell | tableHeader)+",tableRole:"row",parseDOM:[{tag:"tr"}]}],["tableCell",{content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | unsupportedBlock)+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"cell",marks:"",isolating:!0,parseDOM:[{tag:".ak-renderer-table-number-column",ignore:!0},{tag:"td"}]}]];t.nodes=n;var r=[["link",{excludes:"color",group:"link",attrs:{href:{},__confluenceMetadata:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]"}]}],["em",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}]}],["strong",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strong"},{tag:"b"},{style:"font-weight"}]}],["textColor",{attrs:{color:{}},inclusive:!0,group:"color",parseDOM:[{style:"color"}]}],["strike",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strike"},{tag:"s"},{tag:"del"},{style:"text-decoration"}]}],["subsup",{inclusive:!0,group:"fontStyle",attrs:{type:{default:"sub"}},parseDOM:[{tag:"sub",attrs:{type:"sub"}},{tag:"sup",attrs:{type:"sup"}}]}],["underline",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"u"},{style:"text-decoration"}]}],["code",{excludes:"fontStyle link searchQuery color",inclusive:!0,parseDOM:[{tag:"span.code",preserveWhitespace:!0},{tag:"code",preserveWhitespace:!0},{tag:"tt",preserveWhitespace:!0},{tag:"span",preserveWhitespace:!0}]}],["typeAheadQuery",{excludes:"searchQuery",inclusive:!0,group:"searchQuery",parseDOM:[{tag:"span[data-type-ahead-query]"}],attrs:{trigger:{default:""}}}]];t.marks=r;t.getDefaultSchema=function(){return{nodes:n,marks:r}}},78238:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(15500)),i=r(n(68434)),o=r(n(82007)),u=r(n(64512)),c=r(n(80295)),s=r(n(65105)),l=r(n(19723)),d=r(n(25665)),f=r(n(27952)),p=r(n(12323)),h=r(n(17400)),y=r(n(59093)),v=r(n(65746)),m=r(n(86701)),b=r(n(25790));function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=(0,p.default)(e);return n=t?Reflect.construct(r,arguments,(0,p.default)(this).constructor):r.apply(this,arguments),(0,f.default)(this,n)}}var O={clientID:"",clientName:"",clientKind:"",clientSecret:"",clientURI:"",registrationAccessToken:"",redirectURI:"",softwareID:"",softwareVersion:"",logoURI:"",policyURI:"",notificationPlatform:"",notificationDeviceToken:""},w=function(e){(0,d.default)(P,e);var t,n,r,a,u,f,p,h,g,w,x,E=_(P);function P(e){var t,n=e.oauth,r=e.scope,a=e.onTokenRefresh,i=(0,c.default)(e,["oauth","scope","onTokenRefresh"]);return(0,s.default)(this,P),(t=E.call(this,i)).setOAuthOptions(k(k({},O),n)),n.token&&t.setToken(n.token),t.scope=void 0===r?[]:r,t.onTokenRefresh=a,t}return(0,l.default)(P,[{key:"isRegistered",value:function(){return""!==this.oauthOptions.clientID}},{key:"snakeCaseOAuthData",value:function(e){var t={softwareID:"software_id",softwareVersion:"software_version",clientID:"client_id",clientName:"client_name",clientKind:"client_kind",clientURI:"client_uri",logoURI:"logo_uri",policyURI:"policy_uri",notificationPlatform:"notification_platform",notificationDeviceToken:"notification_device_token",redirectURI:"redirect_uris"},n={};return Object.keys(e).forEach(function(r){var a=t[r]||r,i=e[r];n[a]=i}),n.redirect_uris&&n.redirect_uris instanceof Array==!1&&(n.redirect_uris=[n.redirect_uris]),n}},{key:"camelCaseOAuthData",value:function(e){var t={client_id:"clientID",client_name:"clientName",client_secret:"clientSecret",registration_access_token:"registrationAccessToken",software_id:"softwareID",redirect_uris:"redirectURI"},n={};return Object.keys(e).forEach(function(r){var a=t[r]||r,i=e[r];n[a]=i}),n}},{key:"doRegistration",value:function(){return this.fetchJSON("POST","/auth/register",this.snakeCaseOAuthData({redirectURI:this.oauthOptions.redirectURI,clientName:this.oauthOptions.clientName,softwareID:this.oauthOptions.softwareID,clientKind:this.oauthOptions.clientKind,clientURI:this.oauthOptions.clientURI,logoURI:this.oauthOptions.logoURI,policyURI:this.oauthOptions.policyURI,softwareVersion:this.oauthOptions.softwareVersion,notificationPlatform:this.oauthOptions.notificationPlatform,notificationDeviceToken:this.oauthOptions.notificationDeviceToken}))}},{key:"register",value:(t=(0,o.default)(i.default.mark(function e(){var t,n,r,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRegistered()){e.next=2;break}throw Error("Client already registered");case 2:if(t=["redirectURI"],n=Object.keys(this.oauthOptions),!((r=t.filter(function(e){return n[e]})).length>0)){e.next=7;break}throw Error("Can't register client : missing ".concat(r," fields"));case 7:return e.next=9,this.doRegistration();case 9:return a=e.sent,this.setOAuthOptions(k(k({},this.oauthOptions),{},{client_id:a.client_id,client_name:a.client_name,client_secret:a.client_secret,registration_access_token:a.registration_access_token,software_id:a.software_id})),e.abrupt("return",this.oauthOptions);case 12:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"unregister",value:(n=(0,o.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRegistered()){e.next=2;break}throw new S;case 2:return t=this.oauthOptions.clientID,this.oauthOptions.clientID="",e.abrupt("return",this.fetchJSON("DELETE","/auth/register/".concat(t),null,{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}}));case 5:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"fetchInformation",value:(r=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRegistered()){e.next=2;break}throw new S;case 2:return e.abrupt("return",this.fetchJSON("GET","/auth/register/".concat(this.oauthOptions.clientID),null,{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}}));case 3:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"updateInformation",value:(a=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]&&u[1],this.isRegistered()){e.next=3;break}throw new S;case 3:return r={clientID:this.oauthOptions.clientID,clientName:this.oauthOptions.clientName,redirectURI:this.oauthOptions.redirectURI,softwareID:this.oauthOptions.softwareID},a=this.snakeCaseOAuthData(k(k({},r),t)),n&&(a.client_secret=this.oauthOptions.clientSecret),e.next=8,this.fetchJSON("PUT","/auth/register/".concat(this.oauthOptions.clientID),a,{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}});case 8:return o=e.sent,this.setOAuthOptions(k(k({},a),o)),e.abrupt("return",this.oauthOptions);case 11:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"generateStateCode",value:function(){var e;if("undefined"!=typeof window&&void 0!==window.crypto&&"function"==typeof window.crypto.getRandomValues)e=new Uint8Array(16),window.crypto.getRandomValues(e);else{e=Array(16);for(var t=0;t<e.length;t++)e[t]=Math.floor(255*Math.random())}return btoa(String.fromCharCode.apply(null,e)).replace(/=+$/,"").replace(/\//g,"_").replace(/\+/g,"-")}},{key:"getAuthCodeURL",value:function(e){var t=e.stateCode,n=e.scopes,r=void 0===n?this.scope:n,a=e.sessionCode,i=void 0===a?void 0:a,o=e.codeChallenge,u=void 0===o?void 0:o;if(!this.isRegistered())throw new S;var c={client_id:this.oauthOptions.clientID,redirect_uri:this.oauthOptions.redirectURI,state:t,response_type:"code",scope:r.join(" ")};return this.oauthOptions.registerToken&&(c=k(k({},c),{},{registerToken:this.oauthOptions.registerToken})),i&&(c=k(k({},c),{},{session_code:i})),u&&(c=k(k({},c),{},{code_challenge:u,code_challenge_method:"S256"})),"".concat(this.uri,"/auth/authorize?").concat(this.dataToQueryString(c))}},{key:"dataToQueryString",value:function(e){return Object.keys(e).map(function(t){return"".concat(t,"=").concat(encodeURIComponent(e[t]))}).join("&")}},{key:"getAccessCodeFromURL",value:function(e,t){if(!t)throw Error("Missing state code");var n=new URL(e).searchParams,r=n.get("state"),a=n.get("access_code");if(t!==r)throw Error("Given state does not match url query state");return a}},{key:"fetchAccessToken",value:(u=(0,o.default)(i.default.mark(function e(t,n,r,a){var o,u,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!this.isRegistered()&&!n)){e.next=2;break}throw new S;case 2:return u={grant_type:"authorization_code",code:t,client_id:(o=n||this.oauthOptions).clientID,client_secret:o.clientSecret},a&&(u=k(k({},u),{},{code_verifier:a})),e.next=7,this.fetchJSON("POST",(r||"")+"/auth/access_token",this.dataToQueryString(u),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 7:return c=e.sent,e.abrupt("return",new y.default(c));case 9:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return u.apply(this,arguments)})},{key:"fetchKonnectorToken",value:(f=(0,o.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchJSON("POST","/auth/tokens/konnectors/".concat(t));case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),Error('oAuthClient.fetchKonnectorToken(): Could not create a token for the konnector with slug "'.concat(t,'". \n\n').concat(e.t0));case 9:case"end":return e.stop()}},e,this,[[0,6]])})),function(e){return f.apply(this,arguments)})},{key:"fetchSessionCode",value:(p=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchJSON("POST","/auth/session_code"));case 1:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"fetchSessionCodeWithPassword",value:(h=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.passwordHash,a=void 0===(r=t.twoFactorToken)?void 0:r,u=void 0===(o=t.twoFactorPasscode)?void 0:o,e.abrupt("return",this.fetchJSON("POST","/auth/session_code",{passphrase:n,two_factor_token:a,two_factor_passcode:u}));case 2:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"loginFlagship",value:(g=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u,c,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0===(n=t.emailVerifiedCode)?void 0:n,a=t.passwordHash,u=void 0===(o=t.twoFactorToken)?void 0:o,s=void 0===(c=t.twoFactorPasscode)?void 0:c,e.abrupt("return",this.fetchJSON("POST","/auth/login/flagship",{client_id:this.oauthOptions.clientID,client_secret:this.oauthOptions.clientSecret,email_verified_code:r,passphrase:a,two_factor_token:u,two_factor_passcode:s}));case 2:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"refreshToken",value:(w=(0,o.default)(i.default.mark(function e(){var t,n,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRegistered()){e.next=2;break}throw new S;case 2:if(this.token){e.next=4;break}throw Error("No token to refresh");case 4:return t={grant_type:"refresh_token",refresh_token:this.token.refreshToken,client_id:this.oauthOptions.clientID,client_secret:this.oauthOptions.clientSecret},e.prev=5,e.next=8,this.fetchJSONWithCurrentToken("POST","/auth/access_token",this.dataToQueryString(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 8:return n=e.sent,r=new y.default(k({refresh_token:this.token.refreshToken},n)),this.setToken(r),this.onTokenRefresh&&"function"==typeof this.onTokenRefresh&&this.onTokenRefresh(r),e.abrupt("return",r);case 15:if(e.prev=15,e.t0=e.catch(5),!this.isRevocationError(e.t0)){e.next=21;break}throw this.onRevocationChange(!0),b.default.warn("Client has been revoked. Please authenticate again."),e.t0;case 21:if(!(m.default.EXPIRED_TOKEN.test(e.t0.message)||m.default.INVALID_TOKEN.test(e.t0.message)||m.default.INVALID_TOKEN_ALT.test(e.t0.message))){e.next=28;break}return e.next=24,this.checkForRevocation();case 24:if(!e.sent){e.next=28;break}throw b.default.warn("Client has been revoked. Please authenticate again."),e.t0;case 28:throw e.t0;case 29:case"end":return e.stop()}},e,this,[[5,15]])})),function(){return w.apply(this,arguments)})},{key:"exchangeOAuthSecret",value:function(e,t){return this.fetchJSON("POST",e+"/auth/secret_exchange",{secret:t})}},{key:"setToken",value:function(e){e?this.token=e instanceof y.default?e:new y.default(e):this.token=null}},{key:"setCredentials",value:function(e){return(0,v.default)("setCredentials is deprecated, please replace by setToken"),this.setToken(e)}},{key:"setOAuthOptions",value:function(e){this.oauthOptions=this.camelCaseOAuthData(e)}},{key:"resetClientId",value:function(){this.oauthOptions.clientID=""}},{key:"resetClient",value:function(){this.resetClientId(),this.setUri(null),this.setToken(null)}},{key:"registrationAccessTokenToAuthHeader",value:function(){if(!this.oauthOptions.registrationAccessToken)throw Error("No registration access token");return"Bearer "+this.oauthOptions.registrationAccessToken}},{key:"setPassphraseFlagship",value:function(e){var t=e.registerToken,n=e.passwordHash,r=e.hint,a=e.key,i=e.publicKey,o=e.privateKey,u=e.iterations;return this.fetchJSON("POST","/settings/passphrase/flagship",{register_token:t,passphrase:n,hint:r,key:a,public_key:i,private_key:o,iterations:u,client_id:this.oauthOptions.clientID,client_secret:this.oauthOptions.clientSecret},{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}})}},{key:"checkForRevocation",value:(x=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchInformation();case 3:case 11:return e.abrupt("return",!1);case 6:if(e.prev=6,e.t0=e.catch(0),!this.isRevocationError(e.t0)){e.next=11;break}return this.onRevocationChange(!0),e.abrupt("return",!0);case 12:case"end":return e.stop()}},e,this,[[0,6]])})),function(){return x.apply(this,arguments)})}]),P}(h.default),S=function(e){(0,d.default)(n,e);var t=_(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Client not registered or missing OAuth information";return(0,s.default)(this,n),(e=t.call(this,r)).message=r,e.name="NotRegisteredException",e}return n}((0,a.default)(Error));t.default=w},69688:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.OAUTH_CLIENTS_DOCTYPE=void 0;var i=a(n(68434)),o=a(n(64512)),u=a(n(41)),c=a(n(82007)),s=a(n(65105)),l=a(n(19723)),d=a(n(25665)),f=a(n(27952)),p=a(n(12323)),h=a(n(27361)),y=a(n(87386)),v=n(63818),m=n(65987),b=r(n(66343)),g=n(93868),k=n(86701);function _(){var e=(0,u.default)(["/settings/clients/",""]);return _=function(){return e},e}function O(){var e=(0,u.default)(["/settings/clients/",""]);return O=function(){return e},e}function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function x(){var e=(0,u.default)(["/settings/clients"]);return x=function(){return e},e}var E="io.cozy.oauth.clients";t.OAUTH_CLIENTS_DOCTYPE=E;var P=(0,v.normalizeDoctypeJsonApi)(E),C=function(e){(0,d.default)(y,e);var t,n,r,a,o,u=(t=y,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,p.default)(t);return e=n?Reflect.construct(r,arguments,(0,p.default)(this).constructor):r.apply(this,arguments),(0,f.default)(this,e)});function y(e){return(0,s.default)(this,y),u.call(this,E,e)}return(0,l.default)(y,[{key:"all",value:(r=(0,c.default)(i.default.mark(function e(){var t,n,r,a,o,u,c,s,l,d,f,p,y,v,k=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0===(n=(t=k.length>0&&void 0!==k[0]?k[0]:{}).limit)?100:n,a=t.bookmark,o=t.keys,u={"page[limit]":r,"page[cursor]":a},c=(0,m.uri)(x()),s=b.buildURL(c,u),e.prev=5,e.next=8,this.stackClient.fetchJSON("GET",s);case 8:l=e.sent,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(5),e.abrupt("return",(0,g.dontThrowNotFoundError)(e.t0));case 14:if(d=(0,h.default)(l,"links.next",""),p=void 0!==(f=new URL("".concat(this.stackClient.uri).concat(d)).searchParams.get("page[cursor]")||void 0),!o){e.next=24;break}return y=l.data.filter(function(e){return o.includes(e.id)}).map(function(e){return P(e)}),v=S(S({},l.meta),{},{count:y.length}),e.abrupt("return",{data:y,meta:v,next:o.length>y.length&&p,bookmark:f});case 24:return e.abrupt("return",{data:l.data.map(function(e){return P(e)}),meta:l.meta,next:p,bookmark:f});case 25:case"end":return e.stop()}},e,this,[[5,11]])})),function(){return r.apply(this,arguments)})},{key:"get",value:(a=(0,c.default)(i.default.mark(function e(t){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.all({keys:[t]});case 2:n=e.sent;case 3:if(!n.next){e.next=9;break}return e.next=6,this.all({keys:[t],bookmark:n.bookmark});case 6:n=e.sent,e.next=3;break;case 9:if(!n.data.length){e.next=13;break}return e.abrupt("return",{data:P(n.data[0])});case 13:throw n.url=(0,m.uri)(O(),t),n.status="404",new k.FetchError(n,"Not Found");case 16:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"destroy",value:(o=(0,c.default)(i.default.mark(function e(t){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id,e.next=3,this.stackClient.fetchJSON("DELETE",(0,m.uri)(_(),n));case 3:return e.abrupt("return",{data:S(S({},P(t)),{},{_deleted:!0})});case 4:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})}]),y}(y.default);C.normalizeDoctype=v.normalizeDoctypeJsonApi;t.default=C},85275:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.getPermissionsFor=void 0;var a=r(n(98235)),i=r(n(64512)),o=r(n(80295)),u=r(n(68434)),c=r(n(41)),s=r(n(82007)),l=r(n(65105)),d=r(n(19723)),f=r(n(25665)),p=r(n(27952)),h=r(n(12323)),y=r(n(87386)),v=n(63818),m=n(946),b=n(65987),g=r(n(25790));function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function w(){var e=(0,c.default)(["/permissions/doctype/","/shared-by-link"]);return w=function(){return e},e}function S(){var e=(0,c.default)(["/permissions/",""]);return S=function(){return e},e}function x(){var e=(0,c.default)(["/permissions/",""]);return x=function(){return e},e}var E=function(e){return(0,v.normalizeDoc)(e,"io.cozy.permissions")},P=function(e){(0,f.default)(I,e);var t,n,r,i,c,y,v,m,_,P,j,A,T,R=(t=I,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,h.default)(t);return e=n?Reflect.construct(r,arguments,(0,h.default)(this).constructor):r.apply(this,arguments),(0,p.default)(this,e)});function I(){return(0,l.default)(this,I),R.apply(this,arguments)}return(0,d.default)(I,[{key:"get",value:(r=(0,s.default)(u.default.mark(function e(t){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",(0,b.uri)(x(),t));case 2:return n=e.sent,e.abrupt("return",{data:E(n.data)});case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"create",value:(i=(0,s.default)(u.default.mark(function e(t){var n,r,a,i,c,s,l,d,f;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t._id,t._type,i=void 0===(a=t.codes)?"code":a,c=t.ttl,s=t.tiny,l=(0,o.default)(t,["_id","_type","codes","ttl","tiny"]),(d=new URLSearchParams).append("codes",i),c&&d.append("ttl",c),s&&d.append("tiny",!0),e.next=7,this.stackClient.fetchJSON("POST","/permissions?".concat(d),{data:{type:"io.cozy.permissions",attributes:l}});case 7:return f=e.sent,e.abrupt("return",{data:E(f.data)});case 9:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"add",value:(c=(0,s.default)(u.default.mark(function e(t,n){var r,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t._type,e.next="io.cozy.apps"===e.t0?3:"io.cozy.konnectors"===e.t0?5:"io.cozy.permissions"===e.t0?7:9;break;case 3:return r="/permissions/apps/".concat(t.slug),e.abrupt("break",10);case 5:return r="/permissions/konnectors/".concat(t.slug),e.abrupt("break",10);case 7:return r="/permissions/".concat(t._id),e.abrupt("break",10);case 9:throw Error("Permissions can only be added on existing permissions, apps and konnectors.");case 10:return e.next=12,this.stackClient.fetchJSON("PATCH",r,{data:{type:"io.cozy.permissions",attributes:{permissions:n}}});case 12:return a=e.sent,e.abrupt("return",{data:E(a.data)});case 14:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"destroy",value:function(e){return this.stackClient.fetchJSON("DELETE",(0,b.uri)(S(),e.id))}},{key:"findLinksByDoctype",value:(y=(0,s.default)(u.default.mark(function e(t){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",(0,b.uri)(w(),t));case 2:return n=e.sent,e.abrupt("return",O(O({},n),{},{data:n.data.map(E)}));case 4:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"findApps",value:(v=(0,s.default)(u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g.default.warn("PermissionCollection.findApps will be removed in next version of cozy-client. \n\n      You can use AppCollection.all() instead \n\n      or even better client.query(Q('io.cozy.apps'), {as: 'io.cozy.apps'})"),e.next=3,this.stackClient.fetchJSON("GET","/apps/");case 3:return t=e.sent,e.abrupt("return",O(O({},t),{},{data:t.data.map(function(e){return O({_id:e.id},e)})}));case 5:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"createSharingLink",value:(m=(0,s.default)(u.default.mark(function e(t){var n,r,a=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(a.length>1&&void 0!==a[1]?a[1]:{}).verbs,e.next=4,this.stackClient.fetchJSON("POST","/permissions?codes=email",{data:{type:"io.cozy.permissions",attributes:{permissions:C(t,!0,n?{verbs:n}:{})}}});case 4:return r=e.sent,e.abrupt("return",{data:E(r.data)});case 6:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"fetchPermissionsByLink",value:(_=(0,s.default)(u.default.mark(function e(t){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.links&&t.links.next)){e.next=5;break}return e.next=3,this.stackClient.fetchJSON("GET",t.links.next);case 3:return n=e.sent,e.abrupt("return",O(O({},n),{},{data:n.data.map(E)}));case 5:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"fetchAllLinks",value:(P=(0,s.default)(u.default.mark(function e(t){var n,r,i;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findLinksByDoctype(t._type);case 2:r=n=e.sent;case 4:if(!(r.links&&r.links.next)){e.next=11;break}return e.next=7,this.fetchPermissionsByLink(r);case 7:r=e.sent,(i=n.data).push.apply(i,(0,a.default)(r.data)),e.next=4;break;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this)})),function(e){return P.apply(this,arguments)})},{key:"revokeSharingLink",value:(j=(0,s.default)(u.default.mark(function e(t){var n,r,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchAllLinks(t);case 2:n=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(e.sent.data.filter(function(e){return D(e,t)})),e.prev=5,n.s();case 7:if((r=n.n()).done){e.next=13;break}return a=r.value,e.next=11,this.destroy(a);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}},e,this,[[5,15,18,21]])})),function(e){return j.apply(this,arguments)})},{key:"getOwnPermissions",value:(A=(0,s.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g.default.warn("getOwnPermissions is deprecated, please use fetchOwnPermissions instead"),e.abrupt("return",this.fetchOwnPermissions());case 2:case"end":return e.stop()}},e,this)})),function(){return A.apply(this,arguments)})},{key:"fetchOwnPermissions",value:(T=(0,s.default)(u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET","/permissions/self");case 2:return t=e.sent,e.abrupt("return",{data:E(t.data),included:t.included?t.included.map(E):[]});case 4:case"end":return e.stop()}},e,this)})),function(){return T.apply(this,arguments)})}]),I}(y.default),C=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e._id,a=e._type,i=n.verbs?n.verbs:t?["GET"]:["ALL"];return(0,m.isFile)(e)?{files:{type:"io.cozy.files",verbs:i,values:[r]}}:{collection:{type:a,verbs:i,values:[r]},files:{type:"io.cozy.files",verbs:i,values:["".concat(a,"/").concat(r)],selector:"referenced_by"}}};t.getPermissionsFor=C;var D=function(e,t){var n=t._id;return(0,m.isFile)(t)?-1!==e.attributes.permissions.files.values.indexOf(n):-1!==e.attributes.permissions.collection.values.indexOf(n)};t.default=P},81295:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.normalizeSettings=t.SETTINGS_DOCTYPE=void 0;var a=r(n(41)),i=r(n(68434)),o=r(n(64512)),u=r(n(82007)),c=r(n(65105)),s=r(n(19723)),l=r(n(25665)),d=r(n(27952)),f=r(n(12323)),p=r(n(87386)),h=r(n(25790)),y=n(65987),v=n(63818);function m(){var e=(0,a.default)(["/data/","/",""]);return m=function(){return e},e}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var g="io.cozy.settings";t.SETTINGS_DOCTYPE=g;var k=(0,v.normalizeDoctypeJsonApi)(g);t.normalizeSettings=k;var _=function(e){(0,l.default)(v,e);var t,n,r,a,p=(t=v,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,f.default)(t);return e=n?Reflect.construct(r,arguments,(0,f.default)(this).constructor):r.apply(this,arguments),(0,d.default)(this,e)});function v(e){return(0,c.default)(this,v),p.call(this,g,e)}return(0,s.default)(v,[{key:"get",value:(r=(0,u.default)(i.default.mark(function e(t){var n,r,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("io.cozy.settings.bitwarden"!==t){e.next=5;break}return e.next=3,this.stackClient.fetchJSON("GET","/data/io.cozy.settings/io.cozy.settings.bitwarden");case 3:return n=e.sent,e.abrupt("return",{data:k(n)});case 5:return t.startsWith("io.cozy.settings.")?r=t.substring(17):(h.default.warn("Deprecated: in next versions of cozy-client, it will not be possible to query settings with an incomplete id\n\n- Q('io.cozy.settings').getById('instance')\n+ Q('io.cozy.settings').getById('io.cozy.settings.instance')"),r=t),e.next=8,this.stackClient.fetchJSON("GET","/settings/".concat(r));case 8:return a=e.sent,e.abrupt("return",{data:k(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({id:"/settings/".concat(r)},a.data))});case 10:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"update",value:(a=(0,u.default)(i.default.mark(function e(t){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("io.cozy.settings.instance"!==t._id){e.next=6;break}return e.next=3,this.stackClient.fetchJSON("PUT","/settings/instance",{data:t});case 3:n=e.sent,e.next=9;break;case 6:return e.next=8,this.stackClient.fetchJSON("PUT",(0,y.uri)(m(),this.doctype,t._id),t);case 8:n=e.sent;case 9:return e.abrupt("return",{data:k(n.data)});case 10:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})}]),v}(p.default);_.normalizeDoctype=v.normalizeDoctypeJsonApi;t.default=_},22145:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.getSharingRules=t.BITWARDEN_CIPHERS_DOCTYPE=t.BITWARDEN_ORGANIZATIONS_DOCTYPE=t.SHARING_DOCTYPE=void 0;var a=r(n(68434)),i=r(n(64512)),o=r(n(41)),u=r(n(82007)),c=r(n(65105)),s=r(n(19723)),l=r(n(25665)),d=r(n(27952)),f=r(n(12323)),p=r(n(87386)),h=n(63818),y=n(946),v=n(65987),m=r(n(25790));function b(){var e=(0,o.default)(["/sharings/","/recipients"]);return b=function(){return e},e}function g(){var e=(0,o.default)(["/sharings/","/recipients/self"]);return g=function(){return e},e}function k(){var e=(0,o.default)(["/sharings/","/groups/",""]);return k=function(){return e},e}function _(){var e=(0,o.default)(["/sharings/","/recipients/",""]);return _=function(){return e},e}function O(){var e=(0,o.default)(["/sharings/","/recipients"]);return O=function(){return e},e}function w(){var e=(0,o.default)(["/sharings/",""]);return w=function(){return e},e}function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function E(){var e=(0,o.default)(["/sharings/doctype/",""]);return E=function(){return e},e}var P="io.cozy.sharings";t.SHARING_DOCTYPE=P;var C="com.bitwarden.organizations";t.BITWARDEN_ORGANIZATIONS_DOCTYPE=C;var D="com.bitwarden.ciphers";t.BITWARDEN_CIPHERS_DOCTYPE=D;var j=(0,h.normalizeDoctypeJsonApi)(P),A=function(e){(0,l.default)(S,e);var t,n,r,i,o,p,h,y=(t=S,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,f.default)(t);return e=n?Reflect.construct(r,arguments,(0,f.default)(this).constructor):r.apply(this,arguments),(0,d.default)(this,e)});function S(){return(0,c.default)(this,S),y.apply(this,arguments)}return(0,s.default)(S,[{key:"findByDoctype",value:(r=(0,u.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",(0,v.uri)(E(),t));case 2:return n=e.sent,e.abrupt("return",x(x({},n),{},{data:n.data.map(j)}));case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"get",value:(i=(0,u.default)(a.default.mark(function e(t){var n,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,v.uri)(w(),t),e.next=3,this.stackClient.fetchJSON("GET",n);case 3:return r=e.sent,e.abrupt("return",{data:j(r.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"create",value:(o=(0,u.default)(a.default.mark(function e(t){var n,r,i,o,u,c,s,l,d,f,p,h,y;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.document,r=t.description,i=t.previewPath,o=t.rules,c=void 0===(u=t.recipients)?[]:u,l=void 0===(s=t.readOnlyRecipients)?[]:s,d=t.openSharing,f=t.appSlug,p={description:r,preview_path:i,open_sharing:d,rules:o||R(n)},h={},f&&(h={app_slug:f}),e.next=6,this.stackClient.fetchJSON("POST","/sharings/",{data:{type:"io.cozy.sharings",attributes:x(x({},p),h),relationships:x(x({},c.length>0&&{recipients:{data:c.map(z)}}),l.length>0&&{read_only_recipients:{data:l.map(z)}})}});case 6:return y=e.sent,e.abrupt("return",{data:j(y.data)});case 8:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"share",value:(p=(0,u.default)(a.default.mark(function e(t,n,r,i){var o,u,c=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=c.length>4&&void 0!==c[4]?c[4]:null,m.default.warn("SharingCollection.share is deprecated, use SharingCollection.create instead"),u="two-way"===r?{recipients:n}:{readOnlyRecipients:n},e.abrupt("return",this.create(x(x({document:t},u),{},{description:i,previewPath:o,openSharing:"two-way"===r,rules:R(t,r)})));case 4:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return p.apply(this,arguments)})},{key:"getDiscoveryLink",value:function(e,t){return this.stackClient.fullpath("/sharings/".concat(e,"/discovery?sharecode=").concat(t))}},{key:"addRecipients",value:(h=(0,u.default)(a.default.mark(function e(t){var n,r,i,o,u,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.document,i=void 0===(r=t.recipients)?[]:r,u=void 0===(o=t.readOnlyRecipients)?[]:o,e.next=3,this.stackClient.fetchJSON("POST",(0,v.uri)(O(),n._id),{data:{type:"io.cozy.sharings",id:n._id,relationships:x(x({},i.length>0&&{recipients:{data:i.map(z)}}),u.length>0&&{read_only_recipients:{data:u.map(z)}})}});case 3:return c=e.sent,e.abrupt("return",{data:j(c.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"revokeRecipient",value:function(e,t){return this.stackClient.fetchJSON("DELETE",(0,v.uri)(_(),e._id,t))}},{key:"revokeGroup",value:function(e,t){return this.stackClient.fetchJSON("DELETE",(0,v.uri)(k(),e._id,t))}},{key:"revokeSelf",value:function(e){return this.stackClient.fetchJSON("DELETE",(0,v.uri)(g(),e._id))}},{key:"revokeAllRecipients",value:function(e){return this.stackClient.fetchJSON("DELETE",(0,v.uri)(b(),e._id))}}]),S}(p.default);A.normalizeDoctype=h.normalizeDoctypeJsonApi;var T=function(e,t){return(0,y.isFile)(e)?F(e,t):e._type===C?B(e):I(e,t)},R=function(e,t){return t&&m.default.warn("sharingType is deprecated and will be removed. We now set this default rules: ".concat(T(e),"} \n      \n      If this default rules do not fill your need, please set custom rules \n      by using the 'rules' object of the SharingCollection.create() method")),T(e,t)};t.getSharingRules=R;var I=function(e,t){var n=e._id,r=e._type;return[x({title:"collection",doctype:r,values:[n]},N(t)),x({title:"items",doctype:"io.cozy.files",values:["".concat(r,"/").concat(n)],selector:"referenced_by"},M(t))]},M=function(e){return"two-way"===e?{add:"sync",update:"sync",remove:"sync"}:{add:"push",update:"none",remove:"push"}},N=function(e){return e?"two-way"===e?{update:"sync",remove:"revoke"}:{update:"push",remove:"revoke"}:{update:"sync",remove:"revoke"}},F=function(e,t){var n=e._id;return[x({title:e.name,doctype:"io.cozy.files",values:[n]},L(e,t))]},L=function(e,t){if((0,y.isDirectory)(e))return t?"two-way"===t?{add:"sync",update:"sync",remove:"sync"}:{add:"push",update:"push",remove:"push"}:{add:"sync",update:"sync",remove:"sync"};return t?"two-way"===t?{update:"sync",remove:"revoke"}:{update:"push",remove:"revoke"}:{update:"sync",remove:"revoke"}},B=function(e){var t=e._id;return[{title:e.name,doctype:C,values:[t],add:"sync",update:"sync",remove:"revoke"},{title:"Ciphers",doctype:D,values:[t],add:"sync",update:"sync",remove:"sync",selector:"organization_id"}]},z=function(e){return{id:e._id,type:e._type}};t.default=A},91142:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SHORTCUTS_DOCTYPE=void 0;var a=r(n(68434)),i=r(n(41)),o=r(n(82007)),u=r(n(65105)),c=r(n(19723)),s=r(n(25665)),l=r(n(27952)),d=r(n(12323)),f=r(n(64512)),p=r(n(87386)),h=n(63818),y=n(65987),v=n(63972);function m(){var e=(0,i.default)(["/shortcuts/",""]);return m=function(){return e},e}function b(){var e=(0,i.default)(["/shortcuts"]);return b=function(){return e},e}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,f.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _="io.cozy.files.shortcuts";t.SHORTCUTS_DOCTYPE=_;var O=(0,h.normalizeDoctypeJsonApi)(_),w=function(e){return k(k({},O(e)),{},{_id:e._id})},S=function(e){(0,s.default)(p,e);var t,n,r,i,f=(t=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,d.default)(t);return e=n?Reflect.construct(r,arguments,(0,d.default)(this).constructor):r.apply(this,arguments),(0,l.default)(this,e)});function p(e){return(0,u.default)(this,p),f.call(this,_,e)}return(0,c.default)(p,[{key:"create",value:(r=(0,o.default)(a.default.mark(function e(t){var n,r,i,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.type&&(t.type=_),!(!t.name||!t.name.trim()||!t.url||!t.dir_id)){e.next=3;break}throw Error("you need at least a name, an url and a dir_id attributes to create a shortcut");case 3:if(!("."===(n=t.name.trim())||".."===n)){e.next=6;break}throw Error("Invalid filename: ".concat(n));case 6:if(!(r=(0,v.getIllegalCharacters)(n)).length){e.next=9;break}throw Error("Invalid filename containing illegal character(s): ".concat(r));case 9:return i=(0,y.uri)(b()),e.next=12,this.stackClient.fetchJSON("POST",i,{data:{attributes:t,type:"io.cozy.files.shortcuts"}});case 12:return o=e.sent,e.abrupt("return",{data:w(o.data)});case 14:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"get",value:(i=(0,o.default)(a.default.mark(function e(t){var n,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,y.uri)(m(),t),e.next=3,this.stackClient.fetchJSON("GET",n);case 3:return r=e.sent,e.abrupt("return",{data:w(r.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})}]),p}(p.default);S.normalizeDoctype=h.normalizeDoctypeJsonApi;t.default=S},13041:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isForAccount=t.isForKonnector=t.normalizeTrigger=t.TRIGGERS_DOCTYPE=t.JOBS_DOCTYPE=void 0;var i=a(n(80295)),o=a(n(64512)),u=a(n(41)),c=a(n(68434)),s=a(n(82007)),l=a(n(65105)),d=a(n(19723)),f=a(n(59655)),p=a(n(25665)),h=a(n(27952)),y=a(n(12323)),v=r(n(93868)),m=n(63818),b=n(71606),g=n(65987),k=a(n(87386));function _(){var e=(0,u.default)(["/jobs/triggers/","/launch"]);return _=function(){return e},e}function O(){var e=(0,u.default)(["/jobs/triggers/",""]);return O=function(){return e},e}function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function x(){var e=(0,u.default)(["/jobs/triggers/",""]);return x=function(){return e},e}function E(){var e=(0,u.default)(["/jobs/triggers"]);return E=function(){return e},e}n(86701);t.JOBS_DOCTYPE="io.cozy.jobs";var P="io.cozy.triggers";t.TRIGGERS_DOCTYPE=P;var C=(0,m.normalizeDoctypeJsonApi)(P);t.normalizeTrigger=C;t.isForKonnector=function(e,t){return"konnector"===e.worker&&e.message.konnector==t};t.isForAccount=function(e,t){return e.message.account==t};var D=function(e,t){var n=new URLSearchParams;return e&&(Array.isArray(e.$in)?n.set("Worker",e.$in.join(",")):n.set("Worker",e)),t&&(Array.isArray(t.$in)?n.set("Type",t.$in.join(",")):n.set("Type",t)),n.toString()},j=function(e){(0,p.default)(A,e);var t,n,r,a,o,u,m,k,w,j=(t=A,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,y.default)(t);return e=n?Reflect.construct(r,arguments,(0,y.default)(this).constructor):r.apply(this,arguments),(0,h.default)(this,e)});function A(e){return(0,l.default)(this,A),j.call(this,P,e)}return(0,d.default)(A,[{key:"all",value:(r=(0,s.default)(c.default.mark(function e(){var t,n,r=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>0&&void 0!==r[0]&&r[0],e.prev=1,e.next=4,this.stackClient.fetchJSON("GET","/jobs/triggers");case 4:return n=e.sent,e.abrupt("return",{data:n.data.map(function(e){return C(e)}),meta:{count:n.data.length},next:!1,skip:0});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",(0,v.dontThrowNotFoundError)(e.t0));case 11:case"end":return e.stop()}},e,this,[[1,8]])})),function(){return r.apply(this,arguments)})},{key:"create",value:(a=(0,s.default)(c.default.mark(function e(t){var n,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,g.uri)(E()),e.next=3,this.stackClient.fetchJSON("POST",n,{data:{attributes:t}});case 3:return r=e.sent,e.abrupt("return",{data:C(r.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"destroy",value:(o=(0,s.default)(c.default.mark(function e(t){var n;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t._id){e.next=3;break}throw Error("TriggerCollection.destroy needs a document with an _id");case 3:return e.next=5,this.stackClient.fetchJSON("DELETE",(0,g.uri)(x(),n));case 5:return e.abrupt("return",{data:C(S(S({},t),{},{_deleted:!0}))});case 6:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"find",value:(u=(0,s.default)(c.default.mark(function e(){var t,n,r,a,o,u,s=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:{},r=t.worker,a=t.type,0!==Object.keys((0,i.default)(t,["worker","type"])).length){e.next=18;break}return o="/jobs/triggers?".concat(D(r,a)),e.prev=6,e.next=9,this.stackClient.fetchJSON("GET",o);case 9:return u=e.sent,e.abrupt("return",{data:u.data.map(function(e){return C(e)}),meta:{count:u.data.length},next:!1,skip:0});case 13:return e.prev=13,e.t0=e.catch(6),e.abrupt("return",(0,v.dontThrowNotFoundError)(e.t0));case 16:e.next=19;break;case 18:return e.abrupt("return",(0,f.default)((0,y.default)(A.prototype),"find",this).call(this,t,n));case 19:case"end":return e.stop()}},e,this,[[6,13]])})),function(){return u.apply(this,arguments)})},{key:"get",value:(m=(0,s.default)(c.default.mark(function e(t){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",v.default.get(this.stackClient,(0,g.uri)(O(),t),{normalize:C}));case 1:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"launch",value:(k=(0,s.default)(c.default.mark(function e(t){var n,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,g.uri)(_(),t._id),e.next=3,this.stackClient.fetchJSON("POST",n);case 3:return r=e.sent,e.abrupt("return",{data:(0,b.normalizeJob)(r.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"update",value:(w=(0,s.default)(c.default.mark(function e(t){var n,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=c.default.keys(t);case 1:if((e.t1=e.t0()).done){e.next=7;break}if(["_id","_rev","_type","arguments","message","cozyMetadata"].includes(e.t1.value)){e.next=5;break}throw Error("TriggerCollection.update only works for 'arguments', and 'message' attributes.");case 5:e.next=1;break;case 7:return n=S(S({},t.arguments?{arguments:t.arguments}:{}),t.message?{message:t.message}:{}),e.next=10,this.stackClient.fetchJSON("PATCH","/jobs/triggers/".concat(t._id),{data:{attributes:n}});case 10:return r=e.sent,e.abrupt("return",{data:C(r.data)});case 12:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})}]),A}(k.default);j.normalizeDoctype=m.normalizeDoctypeJsonApi;t.default=j},86701:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.FetchError=t.default=void 0;var a=r(n(65105)),i=r(n(8997)),o=r(n(25665)),u=r(n(27952)),c=r(n(12323)),s=r(n(15500)),l=/the client must be registered/;t.default={EXPIRED_TOKEN:/Expired token/,CLIENT_NOT_FOUND:/Client not found/,INVALID_TOKEN:/Invalid JWT token/,INVALID_TOKEN_ALT:/Invalid token/,UNREGISTERED_CLIENT:l};var d=/invalid_token/,f=/access_token_expired/,p=function(e){var t,n=null===(t=e.headers)||void 0===t?void 0:t.get("www-authenticate");if(n){if(f.test(n))return"Expired token";if(d.test(n))return"Invalid token"}},h=function(e){(0,o.default)(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,c.default)(t);return e=n?Reflect.construct(r,arguments,(0,c.default)(this).constructor):r.apply(this,arguments),(0,u.default)(this,e)});function s(e,t){if((0,a.default)(this,s),c=r.call(this),null===(u=Error.captureStackTrace)||void 0===u||u.call(Error,(0,i.default)(c),c.constructor),c.name="FetchError",c.response=e,c.url=e.url,c.status=e.status,c.reason=t,null===t)throw Error("FetchError received a ".concat(e.status," error without a Response Body when calling ").concat(e.url));var n,o,u,c,d=p(e);return Object.defineProperty((0,i.default)(c),"message",{value:(n=t,o=d,("string"==typeof n.error&&l.test(n.error)?n.error:void 0)||n.message||o||("string"==typeof n?n:JSON.stringify(n)))}),c}return s}((0,s.default)(Error));t.FetchError=h},5276:function(e,t,n){var r,a,i=n(14746),o=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getIconURL=t.default=t._getIconURL=void 0;var u=o(n(68434)),c=o(n(82007));n(36369);var s=i(n(89292));function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var d=function(e,t,n,r){if(!n)throw Error("Cannot fetch icon: missing domain");var a=f(e,t,n,r);if(!a)throw Error("Cannot get icon source for app ".concat(e.name));return a},f=function(e,t,n,r){var a=e&&e.links&&e.links.icon||p(e,t);return a?"".concat(r,"//").concat(n).concat(a):null},p=function(e,t){return t?"/registry/".concat(t,"/icon"):e&&e.latest_version&&e.latest_version.version&&"/registry/".concat(e.slug,"/").concat(e.latest_version.version,"/icon")},h={gif:"image/gif",ico:"image/vnd.microsoft.icon",jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml"},y=function(e){if(!e.icon)throw Error("".concat(e.name,": Cannot detect icon mime type since app has no icon"));var t=e.icon.split(".").pop();if(!t)throw Error("".concat(e.name,": Unable to detect icon mime type from extension (").concat(e.icon,")"));return t};var v=(r=(0,c.default)(u.default.mark(function e(t,n){var r,a,i,o,c;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(t),e.prev=1,a.s();case 3:if((i=a.n()).done){e.next=18;break}return o=i.value,e.prev=5,e.next=8,o();case 8:return c=e.sent,n&&n(c),e.abrupt("return",c);case 13:e.prev=13,e.t0=e.catch(5),r=e.t0;case 16:e.next=3;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(1),a.e(e.t1);case 23:return e.prev=23,a.f(),e.finish(23);case 26:throw r;case 27:case"end":return e.stop()}},e,null,[[1,20,23,26],[5,13]])})),function(e,t){return r.apply(this,arguments)});var m=(a=(0,c.default)(u.default.mark(function e(t,n){var r,a,i,o,c,s,l,f,p,m,b,g,k,_;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.type,a=n.slug,i=n.appData,c=void 0===(o=n.priority)?"stack":o,!t.oauthOptions){e.next=29;break}return s=[function(){return t.fetch("GET","/".concat(r,"s/").concat(a,"/icon"))},function(){return t.fetch("GET","/registry/".concat(a,"/icon"))}],"registry"===c&&s.reverse(),e.next=6,v(s,function(e){if(!e.ok)throw Error("Error while fetching icon ".concat(e.statusText))});case 6:return l=e.sent,e.next=9,l.blob();case 9:if((f=e.sent).type){e.next=26;break}if(m=[function(){var e,n,i;return e=t,n=r,i=a,e.fetchJSON("GET","/".concat(n,"s/").concat(i)).then(function(e){return e.data.attributes})},function(){var e,n,r;return e=t,n=0,r=a,e.fetchJSON("GET","/registry/".concat(r)).then(function(e){return e.latest_version.manifest})}],"registry"===c&&m.reverse(),e.t1=i,e.t1){e.next=18;break}return e.next=17,v(m);case 17:e.t1=e.sent;case 18:if(e.t0=e.t1,e.t0){e.next=21;break}e.t0={};case 21:if(h[b=y(p=e.t0)]){e.next=25;break}throw Error('Unknown image extension "'.concat(b,'" for app ').concat(p.name));case 25:f=new Blob([f],{type:h[b]});case 26:return e.abrupt("return",URL.createObjectURL(f));case 29:return e.prev=29,k=(g=new URL(t.uri)).host,_=g.protocol,e.abrupt("return",d(i,a,k,_));case 34:throw e.prev=34,e.t2=e.catch(29),Error("Cannot fetch icon: invalid stackClient.uri: ".concat(e.t2.message));case 37:case"end":return e.stop()}},e,null,[[29,34]])})),function(e,t){return a.apply(this,arguments)});t._getIconURL=m;var b=function(){return m.apply(this,arguments).catch(function(){return new s.ErrorReturned})};t.getIconURL=b;var g=(0,s.default)(b,{maxDuration:3e5,key:function(e,t){var n=t.type,r=t.slug,a=t.priority;return e.uri+NaN+n+":"+r+":"+a}});t.default=g},63972:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getIllegalCharacters=void 0;t.getIllegalCharacters=function(e){var t=e.match(/\/|\x00|\n|\r/g);return t?t.join(" "):""}},2779:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"OAuthClient",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"errors",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"FetchError",{enumerable:!0,get:function(){return u.FetchError}}),Object.defineProperty(t,"normalizeDoc",{enumerable:!0,get:function(){return c.normalizeDoc}});var i=a(n(17400)),o=a(n(78238)),u=r(n(86701)),c=n(63818)},65746:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(25790));t.default=function(){a.default.warn.apply(a.default,arguments)}},25790:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(60732)),i=(0,a.default)("cozy-stack-client");a.default.suggest.deny("cozy-stack-client","info");t.default=i},91303:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.makeOperatorsExplicit=t.isMatchingIndex=t.getIndexFields=t.transformSort=t.getIndexNameFromFields=t.makeKeyFromPartialFilter=t.normalizeDesignDoc=void 0;var a=r(n(98235)),i=r(n(90402)),o=r(n(64512)),u=r(n(91175)),c=r(n(27361)),s=r(n(18446)),l=r(n(13218));function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}t.normalizeDesignDoc=function(e){var t=e._id||e.id;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({id:t,_id:t},e.doc)};var f=function e(t){return"object"!=typeof t||null===t?String(t):Object.entries(t).map(function(t){var n=(0,i.default)(t,2),r=n[0],a=n[1];if(Array.isArray(a)&&a.every(function(e){return"string"==typeof e}))return"".concat(r,"_(").concat(a.join("_"),")");if(Array.isArray(a))return"(".concat(a.map(function(t){return"".concat(e(t))}).join(")_".concat(r,"_(")),")");if("object"==typeof a)return"".concat(r,"_").concat(e(a));else return"".concat(r,"_").concat(a)}).join(")_and_(")};t.makeKeyFromPartialFilter=f;t.getIndexNameFromFields=function(e,t){var n="by_".concat(e.join("_and_"));return t?"".concat(n,"_filter_(").concat(f(t),")"):n};t.transformSort=function(e){if(!e||Array.isArray(e))return e;throw Error('Passing an object to the "sort" is not supported')};t.getIndexFields=function(e){var t=e.selector,n=e.partialFilter,r=e.sort;return Array.from(new Set([].concat((0,a.default)((void 0===r?[]:r).map(function(e){return(0,u.default)(Object.keys(e))})),(0,a.default)(t?Object.keys(t):[]),(0,a.default)(n?Object.keys(n):[]))))};t.isMatchingIndex=function(e,t,n){var r=Object.keys((0,c.default)(e,"views"))[0],a=Object.keys((0,c.default)(e,"views.".concat(r,".map.fields")));if((0,s.default)(a,t)){var i=(0,c.default)(e,"views.".concat(r,".map.partial_filter_selector"));if(!n&&!i)return!0;var o=p(null!=n?n:{});if((0,s.default)(o,i))return!0}return!1};var p=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Object.entries(t).reduce(function(t,r){var a,u=(0,i.default)(r,2),c=u[0],s=u[1];if("$nor"===c)t.$and=s.map(function(e){return Object.entries(e).reduce(function(e,t){var n=(0,i.default)(t,2),r=n[0],a=n[1];return"string"==typeof a?e[r]={$ne:a}:e[r]=p(a,!0),e},{})}).sort(h);else null!==(a=s.$or)&&void 0!==a&&a.every(function(e){return"string"==typeof e})?t.$or=s.$or.map(function(t){return e((0,o.default)({},c,t),n)}).sort(h):Array.isArray(s)&&s.every(l.default)?t[c]=s.map(function(t){return e(t,n)}).sort(h):(0,l.default)(s)&&!Array.isArray(s)?t[c]=e(s,n):n&&"$eq"===c?t.$ne=s:c.startsWith("$")?t[c]=s:t[c]={$eq:s};return t},{}),a=Object.keys(r).sort();return 1===a.length?r:{$and:a.map(function(e){return(0,o.default)({},e,r[e])})}};t.makeOperatorsExplicit=p;var h=function(e,t){var n=Object.keys(e)[0],r=Object.keys(t)[0];return n.localeCompare(r)}},89292:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorReturned=t.default=void 0;var a=r(n(65105)),i=r(n(25665)),o=r(n(27952)),u=r(n(12323)),c=r(n(15500)),s=function(e){(0,i.default)(c,e);var t,n,r=(t=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,u.default)(t);return e=n?Reflect.construct(r,arguments,(0,u.default)(this).constructor):r.apply(this,arguments),(0,o.default)(this,e)});function c(){return(0,a.default)(this,c),r.apply(this,arguments)}return c}((0,c.default)(String));t.ErrorReturned=s;var l=function(e,t){for(var n=Date.now(),r=0,a=Object.keys(e);r<a.length;r++){var i=a[r];n-e[i].date>t&&delete e[i]}};t.default=function(e,t){var n={};return function(){var r,a=t.key.apply(null,arguments);l(n,t.maxDuration);var i=n[a];if(i)return i.result;var o=e.apply(this,arguments);if(n[a]={result:o,date:Date.now()},"object"==typeof(r=o)&&"function"==typeof r.then)o.then(function(e){e instanceof s&&delete n[a]}).catch(function(e){delete n[a]});return o}}},63818:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeDoc=u,t.normalizeDoctypeJsonApi=function(e){return function(t,n){var r=u(t,e);return o(o({},r),r.attributes||{})}},t.normalizeDoctypeRawApi=function(e){return function(t,n){var r=u(n,e);return o(o({},r),r.attributes||{})}};var a=r(n(64512));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=e._id||e.id;return o({id:n,_id:n,_type:t},e)}},6678:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=function(){var e;function t(){(0,o.default)(this,t),this.pending={}}return(0,u.default)(t,[{key:"exec",value:(e=(0,i.default)(a.default.mark(function e(t,n){var r,i,o,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n(),(i=this.pending[r])?o=i:(o=t(),this.pending[r]=o),e.prev=3,e.next=6,o;case 6:return u=e.sent,e.abrupt("return",u);case 8:return e.prev=8,this.pending[r]=null,e.finish(8);case 11:case"end":return e.stop()}},e,this,[[3,,8,11]])})),function(t,n){return e.apply(this,arguments)})},{key:"get",value:function(e){var t=e(),n=this.pending[t];return n?n:null}}]),t}();t.default=c},66343:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.buildURL=t.encode=void 0;var a=r(n(90402)),i=r(n(35937)),o=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.isArray(t)?"["+t.map(function(t){return e(t,!0)}).join(",")+"]":n?encodeURIComponent('"'.concat(t,'"')):encodeURIComponent(t)},u=function(e){return Object.entries(e).map(function(e){var t=(0,a.default)(e,2),n=t[0],r=o(t[1]);return"".concat(n,"=").concat(r)}).join("&")};t.encode=u;t.buildURL=function(e,t){var n=u((0,i.default)(t));return n?"".concat(e,"?").concat(n):e}},36369:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={}},65987:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.joinPath=function(e,t){return"".concat(e).concat(e.endsWith("/")?"":"/").concat(t)},t.encodePath=t.forceDownload=t.formatBytes=t.slugify=t.sleep=t.attempt=t.uri=void 0;t.uri=function(e){for(var t=[e[0]],n=0;n<(arguments.length<=1?0:arguments.length-1);n++)t.push(encodeURIComponent(n+1<1||arguments.length<=n+1?void 0:arguments[n+1])+e[n+1]);return t.join("")};t.attempt=function(e){return e.then(function(){return!0}).catch(function(){return!1})};t.sleep=function(e,t){return new Promise(function(n){setTimeout(n,e,t)})};t.slugify=function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")};t.formatBytes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(t<0?0:t))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]};t.forceDownload=function(e,t){var n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)};t.encodePath=function(e){return e.split("/").map(function(e){return encodeURIComponent(e).replace(/\(/g,"%28").replace(/\)/g,"%29")}).join("/")}},1433:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.shouldXMLHTTPRequestBeUsed=t.fetchWithXMLHttpRequest=void 0;var i=a(n(68434)),o=a(n(90402)),u=a(n(82007)),c=a(n(88306));var s=(r=(0,u.default)(i.default.mark(function e(t,n){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(e,r){var a=new XMLHttpRequest;n.onUploadProgress&&a.upload&&a.upload.addEventListener("progress",n.onUploadProgress,!1),a.onload=function(){4==this.readyState?e(this):r(this)},a.onerror=function(e){r(e)},a.open(n.method,t,!0),a.withCredentials=!0;for(var i=0,u=Object.entries(n.headers);i<u.length;i++){var c=(0,o.default)(u[i],2),s=c[0],l=c[1];a.setRequestHeader(s,l)}a.send(n.body)});case 2:return r=e.sent,e.abrupt("return",{headers:new Headers(r.getAllResponseHeaders().split("\r\n").map(function(e){return e.split(":",2)}).filter(function(e){return 2==e.length})),ok:r.status>=200&&r.status<300,text:function(){var e=(0,u.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.responseText);case 1:case"end":return e.stop()}},e)}));return function t(){return e.apply(this,arguments)}}(),json:function(){var e=(0,u.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",JSON.parse(r.responseText));case 1:case"end":return e.stop()}},e)}));return function t(){return e.apply(this,arguments)}}(),status:r.status,statusText:r.statusText});case 4:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.fetchWithXMLHttpRequest=s;var l=(0,c.default)(function(){var e=new XMLHttpRequest;return"onload"in e&&"onprogress"in e});t.shouldXMLHTTPRequestBeUsed=function(e,t,n){return!!n.onUploadProgress&&l()}},17561:function(e,t,n){n.r(t),n.d(t,{default:function(){return nP}});var r,a,i,o,u,c,s,l=n(70624),d=n.n(l),f=n(21530),p=n(8322),h=n.n(p),y=n(33684),v=n(77105),m=n.n(v),b=n(35717),g=n.n(b),k=n(17187),_=n.n(k),O=n(34155);function w(e){return"$"+e}function S(e){return e.substring(1)}function x(){this._store={}}function E(e){if(this._store=new x,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}x.prototype.get=function(e){var t="$"+e;return this._store[t]},x.prototype.set=function(e,t){var n="$"+e;return this._store[n]=t,!0},x.prototype.has=function(e){return"$"+e in this._store},x.prototype.keys=function(){return Object.keys(this._store).map(e=>S(e))},x.prototype.delete=function(e){var t="$"+e,n=t in this._store;return delete this._store[t],n},x.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var a=t[n],i=this._store[a];e(i,a=S(a))}},Object.defineProperty(x.prototype,"size",{get:function(){return Object.keys(this._store).length}}),E.prototype.add=function(e){return this._store.set(e,!0)},E.prototype.has=function(e){return this._store.has(e)},E.prototype.forEach=function(e){this._store.forEach(function(t,n){e(n)})},Object.defineProperty(E.prototype,"size",{get:function(){return this._store.size}});(function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map})()?(i=Set,o=Map):(i=E,o=x);var P=Function.prototype.toString,C=P.call(Object);function D(e){if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(r=0,n=[],a=e.length;r<a;r++)n[r]=D(e[r]);return n}if(e instanceof Date&&isFinite(e))return e.toISOString();if(t=e,"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer||"undefined"!=typeof Blob&&t instanceof Blob)return function(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}(e);var t=e.size,n=e.type;return"function"==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&P.call(n)==C}(e))return e;for(r in n={},e)if(Object.prototype.hasOwnProperty.call(e,r)){var t,n,r,a,i=D(e[r]);void 0!==i&&(n[r]=i)}return n}function j(e){var t=!1;return m()(function(n){if(t)throw Error("once called more than once");t=!0,e.apply(this,n)})}function A(e){return m()(function(t){t=D(t);var n=this,r="function"==typeof t[t.length-1]&&t.pop(),a=new Promise(function(r,a){var i;try{var o=j(function(e,t){e?a(e):r(t)});t.push(o),(i=e.apply(n,t))&&"function"==typeof i.then&&r(i)}catch(e){a(e)}});return r&&a.then(function(e){r(null,e)},r),a})}function T(e,t){return A(m()(function(n){if(this._closed)return Promise.reject(Error("database is closed"));if(this._destroyed)return Promise.reject(Error("database is destroyed"));var r=this;return(!function(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],a=0;a<n.length-1;a++)r.push(n[a]);e.constructor.emit("debug",r);var i=n[n.length-1];n[n.length-1]=function(n,r){var a=["api",e.name,t];a=a.concat(n?["error",n]:["success",r]),e.constructor.emit("debug",a),i(n,r)}}}(r,e,n),this.taskqueue.isReady)?t.apply(this,n):new Promise(function(t,a){r.taskqueue.addTask(function(i){i?a(i):t(r[e].apply(r,n))})})}))}function R(e,t){for(var n={},r=0,a=t.length;r<a;r++){var i=t[r];i in e&&(n[i]=e[i])}return n}function I(e){return e}function M(e){return[{ok:e}]}function N(e,t,n){var r=t.docs,a=new o;r.forEach(function(e){a.has(e.id)?a.get(e.id).push(e):a.set(e.id,[e])});var i=a.size,u=0,c=Array(i),s=[];a.forEach(function(e,t){s.push(t)});var l=0;function d(){if(!(l>=s.length)){var r=Math.min(l+6,s.length),o=s.slice(l,r);(function(r,o){r.forEach(function(r,s){var l=o+s,f=a.get(r),p=R(f[0],["atts_since","attachments"]);p.open_revs=f.map(function(e){return e.rev}),p.open_revs=p.open_revs.filter(I);var h=I;0===p.open_revs.length&&(delete p.open_revs,h=M),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in t&&(p[e]=t[e])}),e.get(r,p,function(e,t){var a,o,s,f;a=e?[{error:e}]:h(t),o=l,s=r,f=a,c[o]={id:s,docs:f},function(){if(++u===i){var e;e=[],c.forEach(function(t){t.docs.forEach(function(n){e.push({id:t.id,docs:[n]})})}),n(null,{results:e})}}(),d()})})})(o,l),l+=o.length}}d()}try{localStorage.setItem("_pouch_check_localstorage",1),u=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){u=!1}function F(){return u}g()(L,_());function L(){var e;_().call(this),this._listeners={},e=this,u&&addEventListener("storage",function(t){e.emit(t.key)})}function B(e){if("undefined"!=typeof console&&"function"==typeof console[e]){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}L.prototype.addListener=function(e,t,n,r){if(!this._listeners[t]){var a=this,i=!1;this._listeners[t]=o,this.on(e,o)}function o(){if(!!a._listeners[t]){if(i){i="waiting";return}i=!0;var e=R(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);n.changes(e).on("change",function(e){e.seq>r.since&&!r.cancelled&&(r.since=e.seq,r.onChange(e))}).on("complete",function(){"waiting"===i&&d()(o),i=!1}).on("error",function(){i=!1})}}},L.prototype.removeListener=function(e,t){if(t in this._listeners)_().prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t]},L.prototype.notifyLocalWindows=function(e){u&&(localStorage[e]="a"===localStorage[e]?"b":"a")},L.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};function z(e){var t,n,r=0;return!e&&(r=2e3),t=e,n=r,t=parseInt(t,10)||0,(n=parseInt(n,10))!=n||n<=t?n=(t||1)<<1:n+=1,n>6e5&&(t=3e5,n=6e5),~~((n-t)*Math.random()+t)}function U(e,t){B("info","The above "+e+" is totally normal. "+t)}var q=c="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t};function G(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}g()(G,Error),G.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})},new G(401,"unauthorized","Name or password is incorrect.");var Q=new G(400,"bad_request","Missing JSON list of 'docs'"),H=new G(404,"not_found","missing"),J=new G(409,"conflict","Document update conflict"),Y=new G(400,"bad_request","_id field must contain a string"),W=new G(412,"missing_id","_id is required for puts"),K=new G(400,"bad_request","Only reserved document ids may start with underscore.");new G(412,"precondition_failed","Database not open");var V=new G(500,"unknown_error","Database encountered an unknown error"),$=new G(500,"badarg","Some query argument is invalid");new G(400,"invalid_request","Request was invalid");var Z=new G(400,"query_parse_error","Some query parameter is invalid"),X=new G(500,"doc_validation","Bad special document member"),ee=new G(400,"bad_request","Something wrong with the request"),et=new G(400,"bad_request","Document must be a JSON object");new G(404,"not_found","Database not found");var en=new G(500,"indexed_db_went_bad","unknown");new G(500,"web_sql_went_bad","unknown"),new G(500,"levelDB_went_went_bad","unknown"),new G(403,"forbidden","Forbidden by design doc validate_doc_update function");var er=new G(400,"bad_request","Invalid rev format");new G(412,"file_exists","The database could not be created, the file already exists.");var ea=new G(412,"missing_stub","A pre-existing attachment stub wasn't found");function ei(e,t){function n(t){for(var n=Object.getOwnPropertyNames(e),r=0,a=n.length;r<a;r++)"function"!=typeof e[n[r]]&&(this[n[r]]=e[n[r]]);void 0===this.stack&&(this.stack=Error().stack),void 0!==t&&(this.reason=t)}return n.prototype=G.prototype,new n(t)}function eo(e){if("object"!=typeof e){var t=e;(e=V).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),!("name"in e)&&(e.name=e.error||"unknown"),!("status"in e)&&(e.status=500),!("message"in e)&&(e.message=e.message||e.reason),!("stack"in e)&&(e.stack=Error().stack),e}new G(413,"invalid_url","Provided URL is invalid");function eu(e){var t={},n=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(r){!r.doc&&(r.doc={});var a=n&&function(e,t,n){try{return!e(t,n)}catch(e){return ei(ee,"Filter function threw: "+e.toString())}}(e.filter,r.doc,t);if("object"==typeof a)return a;if(a)return!1;if(e.include_docs){if(!e.attachments)for(var i in r.doc._attachments)Object.prototype.hasOwnProperty.call(r.doc._attachments,i)&&(r.doc._attachments[i].stub=!0)}else delete r.doc;return!0}}function ec(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t}function es(e){var t;if(e?"string"!=typeof e?t=ei(Y):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=ei(K)):t=ei(W),t)throw t}function el(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(B("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())}function ed(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function ef(e){var t=ed(e);return t?t.join("/"):null}var ep=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],eh="queryKey",ey=/(?:^|&)([^&=]*)=?([^&]*)/g,ev=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function em(e){for(var t=ev.exec(e),n={},r=14;r--;){var a=ep[r],i=t[r]||"",o=-1!==["user","password"].indexOf(a);n[a]=o?decodeURIComponent(i):i}return n[eh]={},n.query.replace(ey,function(e,t,r){t&&(n[eh][t]=r)}),n}function eb(e,t){var n=[],r=[];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n.push(a),r.push(t[a]));return n.push(e),Function.apply(null,n).apply(null,r)}function eg(e,t,n){return e.get(t).catch(function(e){if(404!==e.status)throw e;return{}}).then(function(r){var a=r._rev,i=n(r);return i?(i._id=t,i._rev=a,function(e,t,n){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(r){if(409!==r.status)throw r;return eg(e,t._id,n)})}(e,i,n)):{updated:!1,rev:a}})}var ek=function(e){return atob(e)},e_=function(e){return btoa(e)};function eO(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if("TypeError"!==a.name)throw a;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}function ew(e,t){return eO([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),a=0;a<t;a++)r[a]=e.charCodeAt(a);return n}(e)],{type:t})}function eS(e,t){return ew(ek(e),t)}function ex(e,t){var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(e){var n=e.target.result||"";if(r)return t(n);t(function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,a=0;a<r;a++)t+=String.fromCharCode(n[a]);return t}(n))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function eE(e,t){ex(e,function(e){t(e)})}function eP(e,t){eE(e,function(e){t(e_(e))})}var eC=self.setImmediate||self.setTimeout;function eD(e,t,n,r,a){var i,o,u,c,s,l;if(n>0||r<t.size){;i=t,o=n,u=r,t=i.webkitSlice?i.webkitSlice(o,u):i.slice(o,u)}c=t,s=function(t){e.append(t),a()},(l=new FileReader).onloadend=function(e){s(e.target.result||new ArrayBuffer(0))},l.readAsArrayBuffer(c)}function ej(e,t,n,r,a){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),a()}function eA(e,t){var n="string"==typeof e,r=n?e.length:e.size,a=Math.min(32768,r),i=Math.ceil(r/a),o=0,u=n?new(h()):new(h()).ArrayBuffer,c=n?ej:eD;function s(){eC(d)}function l(){t(e_(u.end(!0))),u.destroy()}function d(){var t=o*a,n=t+a;++o<i?c(u,e,t,n,s):c(u,e,t,n,l)}d()}function eT(e){return h().hash(e)}function eR(e,t){if(!t)return(0,f.Z)().replace(/-/g,"").toLowerCase();var n,r=q({},e);return delete r._rev_tree,n=JSON.stringify(r),h().hash(n)}var eI=f.Z;function eM(e){for(var t,n,r,a,i=e.rev_tree.slice();a=i.pop();){var o=a.ids,u=o[2],c=a.pos;if(u.length){for(var s=0,l=u.length;s<l;s++)i.push({pos:c+1,ids:u[s]});continue}var d=!!o[1].deleted,f=o[0];(!t||(r!==d?r:n!==c?n<c:t<f))&&(t=f,n=c,r=d)}return n+"-"+t}function eN(e,t){for(var n,r=e.slice();n=r.pop();){for(var a=n.pos,i=n.ids,o=i[2],u=t(0===o.length,a,i[0],n.ctx,i[1]),c=0,s=o.length;c<s;c++)r.push({pos:a+1,ids:o[c],ctx:u})}}function eF(e,t){return e.pos-t.pos}function eL(e){var t=[];eN(e,function(e,n,r,a,i){e&&t.push({rev:n+"-"+r,pos:n,opts:i})}),t.sort(eF).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function eB(e){for(var t=eM(e),n=eL(e.rev_tree),r=[],a=0,i=n.length;a<i;a++){var o=n[a];o.rev!==t&&!o.opts.deleted&&r.push(o.rev)}return r}function ez(e){for(var t,n=[],r=e.slice();t=r.pop();){var a=t.pos,i=t.ids,o=i[0],u=i[1],c=i[2],s=0===c.length,l=t.history?t.history.slice():[];l.push({id:o,opts:u}),s&&n.push({pos:a+1-l.length,ids:l});for(var d=0,f=c.length;d<f;d++)r.push({pos:a+1,ids:c[d],history:l})}return n.reverse()}function eU(e,t){return e.pos-t.pos}function eq(e,t){for(var n,r,a=t,i=e.length;a<i;a++){var o=e[a],u=[o.id,o.opts,[]];r?(r[2].push(u),r=u):n=r=u}return n}function eG(e,t){return e[0]<t[0]?-1:1}function eQ(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var a=n.pop(),i=a.tree1,o=a.tree2;(i[1].status||o[1].status)&&(i[1].status="available"===i[1].status||"available"===o[1].status?"available":"missing");for(var u=0;u<o[2].length;u++){if(!i[2][0]){r="new_leaf",i[2][0]=o[2][u];continue}for(var c=!1,s=0;s<i[2].length;s++)i[2][s][0]===o[2][u][0]&&(n.push({tree1:i[2][s],tree2:o[2][u]}),c=!0);!c&&(r="new_branch",!function(e,t,n){var r=function(e,t,n){for(var r,a=0,i=e.length;a<i;)0>n(e[r=a+i>>>1],t)?a=r+1:i=r;return a}(e,t,n);e.splice(r,0,t)}(i[2],o[2][u],eG))}}return{conflicts:r,tree:e}}function eH(e,t,n){var r,a=[],i=!1,o=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var u=0,c=e.length;u<c;u++){var s=e[u];if(s.pos===t.pos&&s.ids[0]===t.ids[0])r=eQ(s.ids,t.ids),a.push({pos:s.pos,ids:r.tree}),i=i||r.conflicts,o=!0;else if(!0!==n){var l=s.pos<t.pos?s:t,d=s.pos<t.pos?t:s,f=d.pos-l.pos,p=[],h=[];for(h.push({ids:l.ids,diff:f,parent:null,parentIdx:null});h.length>0;){var y=h.pop();if(0===y.diff){y.ids[0]===d.ids[0]&&p.push(y);continue}for(var v=y.ids[2],m=0,b=v.length;m<b;m++)h.push({ids:v[m],diff:y.diff-1,parent:y.ids,parentIdx:m})}var g=p[0];g?(r=eQ(g.ids,d.ids),g.parent[2][g.parentIdx]=r.tree,a.push({pos:l.pos,ids:l.ids}),i=i||r.conflicts,o=!0):a.push(s)}else a.push(s)}return!o&&a.push(t),a.sort(eU),{tree:a,conflicts:i||"internal_node"}}function eJ(e,t,n){var r=eH(e,t),a=function(e,t){for(var n=ez(e),r=0,a=n.length;r<a;r++){var i,o,u,c=n[r],s=c.ids;if(s.length>t){!i&&(i={});var l=s.length-t;u={pos:c.pos+l,ids:eq(s,l)};for(var d=0;d<l;d++)i[c.pos+d+"-"+s[d].id]=!0}else u={pos:c.pos,ids:eq(s,0)};o=o?eH(o,u,!0).tree:[u]}return i&&eN(o,function(e,t,n){delete i[t+"-"+n]}),{tree:o,revs:i?Object.keys(i):[]}}(r.tree,n);return{tree:a.tree,stemmedRevs:a.revs,conflicts:r.conflicts}}function eY(e){return e.ids}function eW(e,t){!t&&(t=eM(e));for(var n,r=t.substring(t.indexOf("-")+1),a=e.rev_tree.map(eY);n=a.pop();){if(n[0]===r)return!!n[1].deleted;a=a.concat(n[2])}}function eK(e){return/^_local/.test(e)}g()(eV,_());function eV(e,t,n){_().call(this);var r=this;this.db=e;var a=(t=t?D(t):{}).complete=j(function(t,n){if(t){var a,o;if(o="error",("listenerCount"in(a=r)?a.listenerCount(o):_().listenerCount(a,o))>0)r.emit("error",t)}else r.emit("complete",n);r.removeAllListeners(),e.removeListener("destroyed",i)});function i(){r.cancel()}n&&(r.on("complete",function(e){n(null,e)}),r.on("error",n)),e.once("destroyed",i),t.onChange=function(e,t,n){if(!r.isCancelled)!function(e,t,n,r){try{e.emit("change",t,n,r)}catch(e){B("error",'Error in .on("change", function):',e)}}(r,e,t,n)};var o=new Promise(function(e,n){t.complete=function(t,r){t?n(t):e(r)}});r.once("cancel",function(){e.removeListener("destroyed",i),t.complete(null,{status:"cancelled"})}),this.then=o.then.bind(o),this.catch=o.catch.bind(o),this.then(function(e){a(null,e)},a),e.taskqueue.isReady?r.validateChanges(t):e.taskqueue.addTask(function(e){e?t.complete(e):r.isCancelled?r.emit("cancel"):r.validateChanges(t)})}function e$(e,t,n){var r=[{rev:e._rev}];"all_docs"===n.style&&(r=eL(t.rev_tree).map(function(e){return{rev:e.rev}}));var a={id:t.id,changes:r,doc:e};return eW(t,e._rev)&&(a.deleted=!0),n.conflicts&&(a.doc._conflicts=eB(t),!a.doc._conflicts.length&&delete a.doc._conflicts),a}function eZ(e,t){return e<t?-1:e>t?1:0}function eX(e,t){return function(n,r){n||r[0]&&r[0].error?((n=n||r[0]).docId=t,e(n)):e(null,r.length?r[0]:r)}}eV.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},eV.prototype.validateChanges=function(e){var t=e.complete,n=this;e5._changesFilterPlugin?e5._changesFilterPlugin.validate(e,function(r){if(r)return t(r);n.doChanges(e)}):n.doChanges(e)},eV.prototype.doChanges=function(e){var t=this,n=e.complete;if("live"in(e=D(e))&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=e$,"latest"===e.since&&(e.since="now"),!e.since&&(e.since=0),"now"===e.since){this.db.info().then(function(r){if(t.isCancelled){n(null,{status:"cancelled"});return}e.since=r.update_seq,t.doChanges(e)},n);return}if(e5._changesFilterPlugin){if(e5._changesFilterPlugin.normalize(e),e5._changesFilterPlugin.shouldFilter(this,e))return e5._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach(function(t){t in e&&B("warn",'The "'+t+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});!("descending"in e)&&(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=n;var r=this.db._changes(e);if(r&&"function"==typeof r.cancel){var a=t.cancel;t.cancel=m()(function(e){r.cancel(),a.apply(this,e)})}};function e0(e,t){var n,r,a,i,o=(n=e._id,n<(r=t._id)?-1:n>r?1:0);if(0!==o)return o;var u=e._revisions?e._revisions.start:0,c=t._revisions?t._revisions.start:0;return(a=u)<(i=c)?-1:a>i?1:0}function e1(){for(var e in _().call(this),e1.prototype)"function"==typeof this[e]&&(this[e]=this[e].bind(this))}function e2(){this.isReady=!1,this.failed=!1,this.queue=[]}g()(e1,_()),e1.prototype.post=T("post",function(e,t,n){if("function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e))return n(ei(et));this.bulkDocs({docs:[e]},t,eX(n,e._id))}),e1.prototype.put=T("put",function(e,t,n){if("function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e))return n(ei(et));if(es(e._id),eK(e._id)&&"function"==typeof this._putLocal)return e._deleted?this._removeLocal(e,n):this._putLocal(e,n);var r=this;t.force&&e._rev?(function(){var n=e._rev.split("-"),r=n[1],a=parseInt(n[0],10)+1,i=eR();e._revisions={start:a,ids:[i,r]},e._rev=a+"-"+i,t.new_edits=!1}(),a(function(t){var r=t?null:{ok:!0,id:e._id,rev:e._rev};n(t,r)})):a(n);function a(n){"function"==typeof r._put&&!1!==t.new_edits?r._put(e,t,n):r.bulkDocs({docs:[e]},t,eX(n,e._id))}}),e1.prototype.putAttachment=T("putAttachment",function(e,t,n,r,a){var i=this;function o(e){var n="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[t]={content_type:a,data:r,revpos:++n},i.put(e)}return"function"==typeof a&&(a=r,r=n,n=null),void 0===a&&(a=r,r=n,n=null),!a&&B("warn","Attachment",t,"on document",e,"is missing content_type"),i.get(e).then(function(e){if(e._rev!==n)throw ei(J);return o(e)},function(t){if(t.reason===H.message)return o({_id:e});throw t})}),e1.prototype.removeAttachment=T("removeAttachment",function(e,t,n,r){var a=this;a.get(e,function(e,i){if(e){r(e);return}if(i._rev!==n){r(ei(J));return}if(!i._attachments)return r();delete i._attachments[t],0===Object.keys(i._attachments).length&&delete i._attachments,a.put(i,r)})}),e1.prototype.remove=T("remove",function(e,t,n,r){"string"==typeof t?(a={_id:e,_rev:t},"function"==typeof n&&(r=n,n={})):(a=e,"function"==typeof t?(r=t,n={}):(r=n,n=t)),(n=n||{}).was_delete=!0;var a,i={_id:a._id,_rev:a._rev||n.rev};if(i._deleted=!0,eK(i._id)&&"function"==typeof this._removeLocal)return this._removeLocal(a,r);this.bulkDocs({docs:[i]},n,eX(r,i._id))}),e1.prototype.revsDiff=T("revsDiff",function(e,t,n){"function"==typeof t&&(n=t,t={});var r=Object.keys(e);if(!r.length)return n(null,{});var a=0,i=new o;function u(e,t){!i.has(e)&&i.set(e,{missing:[]}),i.get(e).missing.push(t)}r.map(function(t){this._getRevisionTree(t,function(o,c){if(o&&404===o.status&&"missing"===o.message)i.set(t,{missing:e[t]});else{if(o)return n(o);var s,l,d;s=t,l=c,d=e[s].slice(0),eN(l,function(e,t,n,r,a){var i=t+"-"+n,o=d.indexOf(i);if(-1!==o)d.splice(o,1),"available"!==a.status&&u(s,i)}),d.forEach(function(e){u(s,e)})}if(++a===r.length){var f={};return i.forEach(function(e,t){f[t]=e}),n(null,f)}})},this)}),e1.prototype.bulkGet=T("bulkGet",function(e,t){N(this,e,t)}),e1.prototype.compactDocument=T("compactDocument",function(e,t,n){var r=this;this._getRevisionTree(e,function(a,i){if(a)return n(a);var o,u,c=(o={},u=[],eN(i,function(e,t,n,r){var a=t+"-"+n;return e&&(o[a]=0),void 0!==r&&u.push({from:r,to:a}),a}),u.reverse(),u.forEach(function(e){void 0===o[e.from]?o[e.from]=1+o[e.to]:o[e.from]=Math.min(o[e.from],1+o[e.to])}),o),s=[],l=[];Object.keys(c).forEach(function(e){c[e]>t&&s.push(e)}),eN(i,function(e,t,n,r,a){var i=t+"-"+n;"available"===a.status&&-1!==s.indexOf(i)&&l.push(i)}),r._doCompaction(e,l,n)})}),e1.prototype.compact=T("compact",function(e,t){"function"==typeof e&&(t=e,e={});e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:t}),1===this._compactionQueue.length&&!function e(t){var n=t._compactionQueue[0],r=n.opts,a=n.callback;t.get("_local/compaction").catch(function(){return!1}).then(function(n){n&&n.last_seq&&(r.last_seq=n.last_seq),t._compact(r,function(n,r){n?a(n):a(null,r),d()(function(){t._compactionQueue.shift(),t._compactionQueue.length&&e(t)})})})}(this)}),e1.prototype._compact=function(e,t){var n=this,r={return_docs:!1,last_seq:e.last_seq||0},a=[];n.changes(r).on("change",function(e){a.push(n.compactDocument(e.id,0))}).on("complete",function(e){var r=e.last_seq;Promise.all(a).then(function(){return eg(n,"_local/compaction",function(e){return(!e.last_seq||!!(e.last_seq<r))&&(e.last_seq=r,e)})}).then(function(){t(null,{ok:!0})}).catch(t)}).on("error",t)},e1.prototype.get=T("get",function(e,t,n){if("function"==typeof t&&(n=t,t={}),"string"!=typeof e)return n(ei(Y));if(eK(e)&&"function"==typeof this._getLocal)return this._getLocal(e,n);var r=[],a=this;function i(){var i=[],o=r.length;if(!o)return n(null,i);r.forEach(function(r){a.get(e,{rev:r,revs:t.revs,latest:t.latest,attachments:t.attachments,binary:t.binary},function(e,t){if(e)i.push({missing:r});else{for(var a,u=0,c=i.length;u<c;u++)if(i[u].ok&&i[u].ok._rev===t._rev){a=!0;break}!a&&i.push({ok:t})}!--o&&n(null,i)})})}if(t.open_revs){if("all"===t.open_revs)this._getRevisionTree(e,function(e,t){if(e)return n(e);r=eL(t).map(function(e){return e.rev}),i()});else{if(!Array.isArray(t.open_revs))return n(ei(V,"function_clause"));r=t.open_revs;for(var o=0;o<r.length;o++){var u=r[o];if(!("string"==typeof u&&/^\d+-/.test(u)))return n(ei(er))}i()}return}return this._get(e,t,function(r,i){if(r)return r.docId=e,n(r);var o=i.doc,u=i.metadata,c=i.ctx;if(t.conflicts){var s=eB(u);s.length&&(o._conflicts=s)}if(eW(u,o._rev)&&(o._deleted=!0),t.revs||t.revs_info){for(var l=o._rev.split("-"),d=parseInt(l[0],10),f=l[1],p=ez(u.rev_tree),h=null,y=0;y<p.length;y++){var v=p[y],m=v.ids.map(function(e){return e.id}).indexOf(f);(m===d-1||!h&&-1!==m)&&(h=v)}if(!h)return(r=Error("invalid rev tree")).docId=e,n(r);var b=h.ids.map(function(e){return e.id}).indexOf(o._rev.split("-")[1])+1,g=h.ids.length-b;if(h.ids.splice(b,g),h.ids.reverse(),t.revs&&(o._revisions={start:h.pos+h.ids.length-1,ids:h.ids.map(function(e){return e.id})}),t.revs_info){var k=h.pos+h.ids.length;o._revs_info=h.ids.map(function(e){return{rev:--k+"-"+e.id,status:e.opts.status}})}}if(t.attachments&&o._attachments){var _=o._attachments,O=Object.keys(_).length;if(0===O)return n(null,o);Object.keys(_).forEach(function(e){this._getAttachment(o._id,e,_[e],{rev:o._rev,binary:t.binary,ctx:c},function(t,r){var a=o._attachments[e];a.data=r,delete a.stub,delete a.length,!--O&&n(null,o)})},a)}else{if(o._attachments)for(var w in o._attachments)Object.prototype.hasOwnProperty.call(o._attachments,w)&&(o._attachments[w].stub=!0);n(null,o)}})}),e1.prototype.getAttachment=T("getAttachment",function(e,t,n,r){var a=this;n instanceof Function&&(r=n,n={}),this._get(e,n,function(i,o){return i?r(i):o.doc._attachments&&o.doc._attachments[t]?void(n.ctx=o.ctx,n.binary=!0,a._getAttachment(e,t,o.doc._attachments[t],n,r)):r(ei(H))})}),e1.prototype.allDocs=T("allDocs",function(e,t){if("function"==typeof e&&(t=e,e={}),e.skip=void 0!==e.skip?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(TypeError("options.keys must be an array"));var n,r,a=["startkey","endkey","key"].filter(function(t){return t in e})[0];if(a){t(ei(Z,"Query parameter `"+a+"` is not compatible with multi-get"));return}if(!el(this)){;if(r="limit"in(n=e)?n.keys.slice(n.skip,n.limit+n.skip):n.skip>0?n.keys.slice(n.skip):n.keys,n.keys=r,n.skip=0,delete n.limit,n.descending&&(r.reverse(),n.descending=!1),0===e.keys.length)return this._allDocs({limit:0},t)}}return this._allDocs(e,t)}),e1.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),(e=e||{}).return_docs="return_docs"in e?e.return_docs:!e.live,new eV(this,e,t)},e1.prototype.close=T("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}),e1.prototype.info=T("info",function(e){var t=this;this._info(function(n,r){if(n)return e(n);r.db_name=r.db_name||t.name,r.auto_compaction=!!(t.auto_compaction&&!el(t)),r.adapter=t.adapter,e(null,r)})}),e1.prototype.id=T("id",function(e){return this._id(e)}),e1.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},e1.prototype.bulkDocs=T("bulkDocs",function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return n(ei(Q));for(var r,a=0;a<e.docs.length;++a)if("object"!=typeof e.docs[a]||Array.isArray(e.docs[a]))return n(ei(et));if(e.docs.forEach(function(e){e._attachments&&Object.keys(e._attachments).forEach(function(t){var n;r=r||"_"===(n=t).charAt(0)&&n+" is not a valid attachment name, attachment names cannot start with '_'",!e._attachments[t].content_type&&B("warn","Attachment",t,"on document",e._id,"is missing content_type")})}),r)return n(ei(ee,r));!("new_edits"in t)&&("new_edits"in e?t.new_edits=e.new_edits:t.new_edits=!0);var i=this;!t.new_edits&&!el(i)&&e.docs.sort(e0),!function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments){for(var r=Object.keys(n._attachments),a=0;a<r.length;a++){var i=r[a];n._attachments[i]=R(n._attachments[i],["data","digest","content_type","length","revpos","stub"])}}}}(e.docs);var o=e.docs.map(function(e){return e._id});return this._bulkDocs(e,t,function(e,r){if(e)return n(e);if(!t.new_edits&&(r=r.filter(function(e){return e.error})),!el(i))for(var a=0,u=r.length;a<u;a++)r[a].id=r[a].id||o[a];n(null,r)})}),e1.prototype.registerDependentDatabase=T("registerDependentDatabase",function(e,t){var n=D(this.__opts);this.__opts.view_adapter&&(n.adapter=this.__opts.view_adapter);var r=new this.constructor(e,n);eg(this,"_local/_pouch_dependentDbs",function(t){return t.dependentDbs=t.dependentDbs||{},!t.dependentDbs[e]&&(t.dependentDbs[e]=!0,t)}).then(function(){t(null,{db:r})}).catch(t)}),e1.prototype.destroy=T("destroy",function(e,t){"function"==typeof e&&(t=e,e={});var n=this,r=!("use_prefix"in n)||n.use_prefix;function a(){n._destroy(e,function(e,r){if(e)return t(e);n._destroyed=!0,n.emit("destroyed"),t(null,r||{ok:!0})})}if(el(n))return a();n.get("_local/_pouch_dependentDbs",function(e,i){if(e)return 404!==e.status?t(e):a();var o=i.dependentDbs,u=n.constructor;Promise.all(Object.keys(o).map(function(e){var t=r?e.replace(RegExp("^"+u.prefix),""):e;return new u(t,n.__opts).destroy()})).then(a,t)})}),e2.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},e2.prototype.fail=function(e){this.failed=e,this.execute()},e2.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},e2.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()};function e5(e,t){if(!(this instanceof e5))return new e5(e,t);var n=this;if(t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),void 0===t.deterministic_revs&&(t.deterministic_revs=!0),this.__opts=t=D(t),n.auto_compaction=t.auto_compaction,n.prefix=e5.prefix,"string"!=typeof e)throw Error("Missing/invalid DB name");var r=function(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=e5.adapters,a=e5.preferredAdapters,i=e5.prefix,o=t.adapter;if(!o)for(var c=0;c<a.length;++c){if("idb"===(o=a[c])&&"websql"in r&&u&&localStorage["_pouch__websqldb_"+i+e]){B("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var s=r[o];return{name:s&&"use_prefix"in s&&!s.use_prefix?e:i+e,adapter:o}}((t.prefix||"")+e,t);if(t.name=r.name,t.adapter=t.adapter||r.adapter,n.name=e,n._adapter=t.adapter,e5.emit("debug",["adapter","Picked adapter: ",t.adapter]),!e5.adapters[t.adapter]||!e5.adapters[t.adapter].valid())throw Error("Invalid Adapter: "+t.adapter);if(t.view_adapter&&(!e5.adapters[t.view_adapter]||!e5.adapters[t.view_adapter].valid()))throw Error("Invalid View Adapter: "+t.view_adapter);e1.call(n),n.taskqueue=new e2,n.adapter=t.adapter,e5.adapters[t.adapter].call(n,t,function(e){if(e)return n.taskqueue.fail(e);!function(e){function t(t){e.removeListener("closed",n),!t&&e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)}(n),n.emit("created",n),e5.emit("created",n.name),n.taskqueue.ready(n)})}g()(e5,e1);var e3="undefined"!=typeof AbortController?AbortController:function(){return{abort:function(){}}},e4=fetch,e6=Headers;e5.adapters={},e5.preferredAdapters=[],e5.prefix="_pouch_";var e7=new(_());r=e5,Object.keys(_().prototype).forEach(function(e){"function"==typeof _().prototype[e]&&(r[e]=e7[e].bind(e7))}),a=r._destructionListeners=new o,r.on("ref",function(e){!a.has(e.name)&&a.set(e.name,[]),a.get(e.name).push(e)}),r.on("unref",function(e){if(!a.has(e.name))return;var t=a.get(e.name),n=t.indexOf(e);if(!(n<0))t.splice(n,1),t.length>1?a.set(e.name,t):a.delete(e.name)}),r.on("destroyed",function(e){if(!!a.has(e)){var t=a.get(e);a.delete(e),t.forEach(function(e){e.emit("destroyed",!0)})}}),e5.adapter=function(e,t,n){t.valid()&&(e5.adapters[e]=t,n&&e5.preferredAdapters.push(e))},e5.plugin=function(e){if("function"==typeof e)e(e5);else if("object"!=typeof e||0===Object.keys(e).length)throw Error('Invalid plugin: got "'+e+'", expected an object or a function');else Object.keys(e).forEach(function(t){e5.prototype[t]=e[t]});return this.__defaults&&(e5.__defaults=q({},this.__defaults)),e5},e5.defaults=function(e){function t(e,n){if(!(this instanceof t))return new t(e,n);n=n||{},e&&"object"==typeof e&&(e=(n=e).name,delete n.name),n=q({},t.__defaults,n),e5.call(this,e,n)}return g()(t,e5),t.preferredAdapters=e5.preferredAdapters.slice(),Object.keys(e5).forEach(function(e){!(e in t)&&(t[e]=e5[e])}),t.__defaults=q({},this.__defaults,e),t},e5.fetch=function(e,t){return e4(e,t)};function e8(e,t){for(var n=e,r=0,a=t.length;r<a&&(n=n[t[r]]);r++);return n}function e9(e){for(var t=[],n="",r=0,a=e.length;r<a;r++){var i=e[r];r>0&&"\\"===e[r-1]&&("$"===i||"."===i)?n=n.substring(0,n.length-1)+i:"."===i?(t.push(n),n=""):n+=i}return t.push(n),t}var te=["$or","$nor","$not"];function tt(e){return te.indexOf(e)>-1}function tn(e){return Object.keys(e)[0]}function tr(e){var t={},n={$or:!0,$nor:!0};return e.forEach(function(e){Object.keys(e).forEach(function(r){var a=e[r];if("object"!=typeof a&&(a={$eq:a}),tt(r)){if(a instanceof Array){if(n[r]){n[r]=!1,t[r]=a;return}var i=[];t[r].forEach(function(e){Object.keys(a).forEach(function(t){var n=a[t],r=Math.max(Object.keys(e).length,Object.keys(n).length),o=tr([e,n]);if(!(Object.keys(o).length<=r))i.push(o)})}),t[r]=i}else t[r]=tr([a])}else{var o=t[r]=t[r]||{};Object.keys(a).forEach(function(e){var t=a[e];if("$gt"===e||"$gte"===e)return function(e,t,n){if(void 0===n.$eq)void 0!==n.$gte?"$gte"===e?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):void 0!==n.$gt?"$gte"===e?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t}(e,t,o);if("$lt"===e||"$lte"===e)return function(e,t,n){if(void 0===n.$eq)void 0!==n.$lte?"$lte"===e?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):void 0!==n.$lt?"$lte"===e?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t}(e,t,o);if("$ne"===e)return function(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}(t,o);else if("$eq"===e)return function(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}(t,o);else if("$regex"===e)return function(e,t){"$regex"in t?t.$regex.push(e):t.$regex=[e]}(t,o);o[e]=t})}})}),t}function ta(e,t){if(e===t)return 0;e=ti(e),t=ti(t);var n=tu(e),r=tu(t);if(n-r!=0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return function(e,t){return e===t?0:e>t?1:-1}(e,t)}return Array.isArray(e)?function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var a=ta(e[r],t[r]);if(0!==a)return a}return e.length===t.length?0:e.length>t.length?1:-1}(e,t):function(e,t){for(var n=Object.keys(e),r=Object.keys(t),a=Math.min(n.length,r.length),i=0;i<a;i++){var o=ta(n[i],r[i]);if(0!==o||0!==(o=ta(e[n[i]],t[r[i]])))return o}return n.length===r.length?0:n.length>r.length?1:-1}(e,t)}function ti(e){switch(typeof e){case"undefined":return null;case"number":if(e===1/0||e===-1/0||isNaN(e))return null;break;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=Array(n);for(var r=0;r<n;r++)e[r]=ti(t[r])}else if(e instanceof Date)return e.toJSON();else if(null!==e){for(var a in e={},t)if(Object.prototype.hasOwnProperty.call(t,a)){var i=t[a];void 0!==i&&(e[a]=ti(i))}}}return e}function to(e){return tu(e=ti(e))+""+function(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return function(e){if(0===e)return"1";var t,n,r,a=e.toExponential().split(/e\+?/),i=parseInt(a[1],10),o=e<0,u=o?"0":"2";u+=""+(t=((o?-i:i)- -324).toString(),n="0",r=3,function(e,t,n){for(var r="",a=n-e.length;r.length<a;)r+=t;return r}(t,"0",3)+t);var c=Math.abs(parseFloat(a[0]));o&&(c=10-c);var s=c.toFixed(20);return u+=""+(s=s.replace(/\.?0+$/,""))}(e);case"string":return e.replace(/\u0002/g,"\x02\x02").replace(/\u0001/g,"\x01\x02").replace(/\u0000/g,"\x01\x01");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,a=n.length,i="";if(t)for(;++r<a;)i+=to(n[r]);else for(;++r<a;){var o=n[r];i+=to(o)+to(e[o])}return i}return""}(e)+"\0"}function tu(e){var t=["boolean","number","string","object"].indexOf(typeof e);if(~t)return null===e?1:Array.isArray(e)?5:t<3?t+2:t+3;if(Array.isArray(e))return 5}function tc(e,t,n){return n.every(function(n){var r=t[n],a=e9(n),i=e8(e,a);return tt(n)?function(e,t,n){return"$or"===e?t.some(function(e){return tc(n,e,Object.keys(e))}):"$not"===e?!tc(n,t,Object.keys(t)):!t.find(function(e){return tc(n,e,Object.keys(e))})}(n,r,e):ts(r,e,a,i)})}function ts(e,t,n,r){return!e||("object"==typeof e?Object.keys(e).every(function(a){var i=e[a];if(0===a.indexOf("$"))return tl(a,t,i,n,r);var o=e9(a);if(void 0===r&&"object"!=typeof i&&o.length>0)return!1;var u=e8(r,o);return"object"==typeof i?ts(i,t,n,u):tl("$eq",t,i,o,u)}):e===r)}function tl(e,t,n,r,a){if(!th[e])throw Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return th[e](t,n,r,a)}function td(e){return null!=e}function tf(e){return void 0!==e}function tp(e,t){return t.some(function(t){return e instanceof Array?e.some(function(e){return 0===ta(t,e)}):0===ta(t,e)})}var th={$elemMatch:function(e,t,n,r){return!!Array.isArray(r)&&0!==r.length&&("object"==typeof r[0]&&null!==r[0]?r.some(function(e){return tc(e,t,Object.keys(t))}):r.some(function(r){return ts(t,e,n,r)}))},$allMatch:function(e,t,n,r){return!!Array.isArray(r)&&0!==r.length&&("object"==typeof r[0]&&null!==r[0]?r.every(function(e){return tc(e,t,Object.keys(t))}):r.every(function(r){return ts(t,e,n,r)}))},$eq:function(e,t,n,r){return tf(r)&&0===ta(r,t)},$gte:function(e,t,n,r){return tf(r)&&ta(r,t)>=0},$gt:function(e,t,n,r){return tf(r)&&ta(r,t)>0},$lte:function(e,t,n,r){return tf(r)&&0>=ta(r,t)},$lt:function(e,t,n,r){return tf(r)&&0>ta(r,t)},$exists:function(e,t,n,r){return t?tf(r):!tf(r)},$mod:function(e,t,n,r){var a,i;return td(r)&&(a=r,i=t,"number"==typeof a&&parseInt(a,10)===a&&a%i[0]===i[1])},$ne:function(e,t,n,r){return t.every(function(e){return 0!==ta(r,e)})},$in:function(e,t,n,r){return td(r)&&tp(r,t)},$nin:function(e,t,n,r){return td(r)&&!tp(r,t)},$size:function(e,t,n,r){var a,i;return td(r)&&Array.isArray(r)&&(a=r,i=t,a.length===i)},$all:function(e,t,n,r){var a;return Array.isArray(r)&&(a=r,t.every(function(e){return a.some(function(t){return 0===ta(e,t)})}))},$regex:function(e,t,n,r){return td(r)&&"string"==typeof r&&t.every(function(e){var t;return t=r,new RegExp(e).test(t)})},$type:function(e,t,n,r){return function(e,t){switch(t){case"null":return null===e;case"boolean":return"boolean"==typeof e;case"number":return"number"==typeof e;case"string":return"string"==typeof e;case"array":return e instanceof Array;case"object":return"[object Object]"===({}).toString.call(e)}}(r,t)}};function ty(e,t){if(e.selector&&e.filter&&"_selector"!==e.filter)return t(Error('selector invalid for filter "'+("string"==typeof e.filter?e.filter:"function")+'"'));t()}function tv(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=ef(e.view):e.filter=ef(e.filter))}function tm(e,t){return t.filter&&"string"==typeof t.filter&&!t.doc_ids&&!el(e.db)}function tb(e,t){var n=t.complete;if("_view"===t.filter){if(!t.view||"string"!=typeof t.view)return n(ei(ee,"`view` filter parameter not found or invalid."));var r=ed(t.view);e.db.get("_design/"+r[0],function(a,i){if(e.isCancelled)return n(null,{status:"cancelled"});if(a)return n(eo(a));var o=i&&i.views&&i.views[r[1]]&&i.views[r[1]].map;if(!o)return n(ei(H,i.views?"missing json key: "+r[1]:"missing json key: views"));t.filter=eb(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+o+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{}),e.doChanges(t)})}else if(t.selector)t.filter=function(e){return function(e,t){if("object"!=typeof t)throw Error("Selector error: expected a JSON object");t=function(e){var t=D(e),n=!1;(function e(t,n){for(var r in t){"$and"===r&&(n=!0);var a=t[r];"object"==typeof a&&(n=e(a,n))}return n})(t,!1)&&("$and"in(t=function e(t){for(var n in t){if(Array.isArray(t))for(var r in t)t[r].$and&&(t[r]=tr(t[r].$and));var a=t[n];"object"==typeof a&&e(a)}return t}(t))&&(t=tr(t.$and)),n=!0),["$or","$nor"].forEach(function(e){e in t&&t[e].forEach(function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var r=t[n],a=e[r];("object"!=typeof a||null===a)&&(e[r]={$eq:a})}})}),"$not"in t&&(t.$not=tr([t.$not]));for(var r=Object.keys(t),a=0;a<r.length;a++){var i=r[a],o=t[i];"object"!=typeof o||null===o?o={$eq:o}:!n&&("$ne"in o&&(o.$ne=[o.$ne]),"$regex"in o&&(o.$regex=[o.$regex])),t[i]=o}return t}(t);var n=function(e,t,n){if(e=e.filter(function(e){return tc(e.doc,t.selector,n)}),t.sort){var r,a=function(e){function t(t){return e.map(function(e){return e8(t,e9(tn(e)))})}return function(e,n){var r,a,i=ta(t(e.doc),t(n.doc));if(0!==i)return i;return r=e.doc._id,r<(a=n.doc._id)?-1:r>a?1:0}}(t.sort);if(e=e.sort(a),"string"!=typeof t.sort[0]&&"desc"===(r=t.sort[0])[tn(r)])e=e.reverse()}if("limit"in t||"skip"in t){var i=t.skip||0,o=("limit"in t?t.limit:e.length)+i;e=e.slice(i,o)}return e}([{doc:e}],{selector:t},Object.keys(t));return n&&1===n.length}(e,t.selector)},e.doChanges(t);else{var a=ed(t.filter);e.db.get("_design/"+a[0],function(r,i){if(e.isCancelled)return n(null,{status:"cancelled"});if(r)return n(eo(r));var o=i&&i.filters&&i.filters[a[1]];if(!o)return n(ei(H,i&&i.filters?"missing json key: "+a[1]:"missing json key: filters"));t.filter=eb('"use strict";\nreturn '+o+";",{}),e.doChanges(t)})}}function tg(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}e5.plugin(function(e){e._changesFilterPlugin={validate:ty,normalize:tv,shouldFilter:tm,filter:tb}}),e5.version="7.3.1";var tk=tg(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),t_=tg(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function tO(e){if(!/^\d+-/.test(e))return ei(er);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function tw(e,t,n){!n&&(n={deterministic_revs:!0});var r,a,i,o={status:"available"};if(e._deleted&&(o.deleted=!0),t){if(!e._id&&(e._id=eI()),a=eR(e,n.deterministic_revs),e._rev){if((i=tO(e._rev)).error)return i;e._rev_tree=[{pos:i.prefix,ids:[i.id,{status:"missing"},[[a,o,[]]]]}],r=i.prefix+1}else e._rev_tree=[{pos:1,ids:[a,o,[]]}],r=1}else if(e._revisions&&(e._rev_tree=function(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,a=[r[0],t,[]],i=1,o=r.length;i<o;i++)a=[r[i],{status:"missing"},[a]];return[{pos:n,ids:a}]}(e._revisions,o),r=e._revisions.start,a=e._revisions.ids[0]),!e._rev_tree){if((i=tO(e._rev)).error)return i;r=i.prefix,a=i.id,e._rev_tree=[{pos:r,ids:[a,o,[]]}]}es(e._id),e._rev=r+"-"+a;var u={metadata:{},data:{}};for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)){var s="_"===c[0];if(s&&!tk[c]){var l=ei(X,c);throw l.message=X.message+": "+c,l}s&&!t_[c]?u.metadata[c.slice(1)]=e[c]:u.data[c]=e[c]}return u}var tS="document-store",tx="by-sequence",tE="attach-store",tP="attach-seq-store",tC="meta-store",tD="local-store",tj="detect-blob-support";function tA(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(ei(en,n,t.type))}}function tT(e,t,n){return{data:function(e){try{return JSON.stringify(e)}catch(t){return y.stringify(e)}}(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function tR(e){if(!e)return null;var t=function(e){try{return JSON.parse(e)}catch(t){return y.parse(e)}}(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function tI(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function tM(e,t,n,r){if(n){if(e){if("string"!=typeof e)r(e);else{var a,i;r((a=e,i=t,ew(ek(a),i)))}}else r(eO([""],{type:t}))}else e?"string"!=typeof e?ex(e,function(e){r(e_(e))}):r(e):r("")}function tN(e,t,n,r){var a=Object.keys(e._attachments||{});if(!a.length)return r&&r();var i=0;function o(){++i===a.length&&r&&r()}a.forEach(function(r){if(t.attachments&&t.include_docs){var a,i,u,c;a=e,i=r,c=(u=a._attachments[i]).digest,n.objectStore(tE).get(c).onsuccess=function(e){u.body=e.target.result.body,o()}}else e._attachments[r].stub=!0,o()})}function tF(e,t){return Promise.all(e.map(function(e){if(e.doc&&e.doc._attachments)return Promise.all(Object.keys(e.doc._attachments).map(function(n){var r=e.doc._attachments[n];if("body"in r){var a=r.body,i=r.content_type;return new Promise(function(o){tM(a,i,t,function(t){e.doc._attachments[n]=q(R(r,["digest","content_type"]),{data:t}),o()})})}}))}))}function tL(e,t,n){var r=[],a=n.objectStore(tx),i=n.objectStore(tE),o=n.objectStore(tP),u=e.length;function c(){!--u&&s()}function s(){if(!!r.length)r.forEach(function(e){o.index("digestSeq").count(IDBKeyRange.bound(e+"::",e+"::",!1,!1)).onsuccess=function(t){!t.target.result&&i.delete(e)}})}e.forEach(function(e){var n=a.index("_doc_id_rev");n.getKey(t+"::"+e).onsuccess=function(e){var t=e.target.result;if("number"!=typeof t)return void(!--u&&s());a.delete(t),o.index("seq").openCursor(IDBKeyRange.only(t)).onsuccess=function(e){var t=e.target.result;if(t){var n=t.value.digestSeq.split("::")[0];r.push(n),o.delete(t.primaryKey),t.continue()}else--u||s()}}})}function tB(e,t,n){try{return{txn:e.transaction(t,n)}}catch(e){return{error:e}}}var tz=new L;function tU(e,t,n,r,a){-1===r&&(r=1e3);var i,o,u,c="function"==typeof e.getAll&&"function"==typeof e.getAllKeys&&r>1&&!n;function s(e){o=e.target.result,i&&a(i,o,u)}function l(e){i=e.target.result,o&&a(i,o,u)}function d(e){var t=e.target.result;if(!t)return a();a([t.key],[t.value],t)}c?(u={continue:function(){if(!i.length)return a();var n,u=i[i.length-1];if(t&&t.upper)try{n=IDBKeyRange.bound(u,t.upper,!0,t.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return a()}else n=IDBKeyRange.lowerBound(u,!0);t=n,i=null,o=null,e.getAll(t,r).onsuccess=s,e.getAllKeys(t,r).onsuccess=l}},e.getAll(t,r).onsuccess=s,e.getAllKeys(t,r).onsuccess=l):n?e.openCursor(t,"prev").onsuccess=d:e.openCursor(t).onsuccess=d}var tq=!1,tG=[];function tQ(){if(!tq&&!!tG.length)tq=!0,tG.shift()()}var tH=new o,tJ=new o;function tY(e,t){var n,r,a,c=this;n=function(t){(function(e,t,n){var r=t.name,a=null,c=null;function l(e){return function(t,n){t&&t instanceof Error&&!t.reason&&c&&(t.reason=c),e(t,n)}}e._meta=null;function f(e,t){var n=e.objectStore(tS);n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.openCursor().onsuccess=function(e){var r=e.target.result;if(r){var a=r.value,i=eW(a);a.deletedOrLocal=i?"1":"0",n.put(a),r.continue()}else t()}}function p(e,t){var n=e.objectStore(tD),r=e.objectStore(tS),a=e.objectStore(tx);r.openCursor().onsuccess=function(e){var i=e.target.result;if(i){var o=i.value,u=o.id,c=eK(u),s=eM(o);if(c){var l=u+"::"+s,d=a.index("_doc_id_rev"),f=IDBKeyRange.bound(u+"::",u+"::~",!1,!1),p=d.openCursor(f);p.onsuccess=function(e){if(p=e.target.result){var t=p.value;t._doc_id_rev===l&&n.put(t),a.delete(p.primaryKey),p.continue()}else r.delete(i.primaryKey),i.continue()}}else i.continue()}else t&&t()}}function h(e,t){var n=e.objectStore(tx),r=e.objectStore(tE),a=e.objectStore(tP);r.count().onsuccess=function(e){if(!e.target.result)return t();n.openCursor().onsuccess=function(e){var n=e.target.result;if(!n)return t();for(var r=n.value,i=n.primaryKey,o=Object.keys(r._attachments||{}),u={},c=0;c<o.length;c++)u[r._attachments[o[c]].digest]=!0;var s=Object.keys(u);for(c=0;c<s.length;c++){var l=s[c];a.put({seq:i,digestSeq:l+"::"+i})}n.continue()}}}function y(e){var t=e.objectStore(tx),n=e.objectStore(tS);n.openCursor().onsuccess=function(e){var r,a,i,o,u,c=e.target.result;if(!!c){var s=(r=c.value).data?tR(r):(r.deleted="1"===r.deletedOrLocal,r);s.winningRev=s.winningRev||eM(s);if(s.seq)return l();a=s.id+"::",i=s.id+"::",o=t.index("_doc_id_rev").openCursor(IDBKeyRange.bound(a,i)),u=0,o.onsuccess=function(e){var t=e.target.result;if(!t)return s.seq=u,l();var n=t.primaryKey;n>u&&(u=n),t.continue()}}function l(){var e=tT(s,s.winningRev,s.deleted);n.put(e).onsuccess=function(){c.continue()}}}}e._remote=!1,e.type=function(){return"idb"},e._id=A(function(t){t(null,e._meta.instanceId)}),e._bulkDocs=function(n,r,i){!function(e,t,n,r,a,i){for(var u,c,s,l,d,f,p,h,y=t.docs,v=0,m=y.length;v<m;v++){var b=y[v];if(!(b._id&&eK(b._id)))(b=y[v]=tw(b,n.new_edits,e)).error&&!p&&(p=b)}if(p)return i(p);var g=!1,k=0,_=Array(y.length),O=new o,w=!1;!function(e,t,n){if(!e.length)return n();var r,a=0;function i(){a++,e.length===a&&(r?n(r):n())}e.forEach(function(e){var n=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],a=0;if(!n.length)return i();function o(e){r=e,++a===n.length&&i()}for(var u in e.data._attachments)Object.prototype.hasOwnProperty.call(e.data._attachments,u)&&!function(e,t,n){if(e.stub)return n();if("string"==typeof e.data)!function(e,t,n){var r=function(e){try{return ek(e)}catch(e){return{error:ei($,"Attachment is not a valid base64 string")}}}(e.data);if(r.error)return n(r.error);e.length=r.length,"blob"===t?e.data=ew(r,e.content_type):"base64"===t?e.data=e_(r):e.data=r,eA(r,function(t){e.digest="md5-"+t,n()})}(e,t,n);else{var r,a,i;r=e,a=t,i=n,eA(r.data,function(e){r.digest="md5-"+e,r.length=r.data.size||r.data.length||0,"binary"===a?eE(r.data,function(e){r.data=e,i()}):"base64"===a?eP(r.data,function(e){r.data=e,i()}):i()})}}(e.data._attachments[u],t,o)})}(y,r._meta.blobSupport?"blob":"base64",function(t){if(t)return i(t);(function(){var t=tB(a,[tS,tx,tE,tD,tP,tC],"readwrite");if(t.error)return i(t.error);(u=t.txn).onabort=tA(i),u.ontimeout=tA(i),u.oncomplete=E,c=u.objectStore(tS),s=u.objectStore(tx),l=u.objectStore(tE),d=u.objectStore(tP),(f=u.objectStore(tC)).get(tC).onsuccess=function(e){h=e.target.result,x()},function(e){var t,n=[];if(y.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var r=e.data._attachments[t];r.stub&&n.push(r.digest)})}),!n.length)return e();var r=0;n.forEach(function(a){var i,o;i=a,o=function(a){a&&!t&&(t=a),++r===n.length&&e(t)},l.get(i).onsuccess=function(e){if(e.target.result)o();else{var t=ei(ea,"unknown stub attachment with digest "+i);t.status=412,o(t)}}})}(function(t){if(t)return w=!0,i(t);(function(){if(!!y.length){var t=0;for(var a=0,i=y.length;a<i;a++){var s=y[a];if(s._id&&eK(s._id)){l();continue}c.get(s.metadata.id).onsuccess=d}}function l(){++t===y.length&&!function(e,t,n,r,a,i,u,c,s){e=e||1e3;var l=c.new_edits,d=new o,f=0,p=t.length;function h(){++f===p&&s&&s()}t.forEach(function(e,t){if(e._id&&eK(e._id)){n[e._deleted?"_removeLocal":"_putLocal"](e,{ctx:a},function(e,n){i[t]=e||n,h()});return}var r=e.metadata.id;d.has(r)?(p--,d.get(r).push([e,t])):d.set(r,[[e,t]])}),d.forEach(function(t,n){var a=0;function o(){++a<t.length?s():h()}function s(){var s=t[a],d=s[0],f=s[1];if(r.has(n))!function(e,t,n,r,a,i,o,u){if(function(e,t){for(var n,r=e.slice(),a=t.split("-"),i=parseInt(a[0],10),o=a[1];n=r.pop();){if(n.pos===i&&n.ids[0]===o)return!0;for(var u=n.ids[2],c=0,s=u.length;c<s;c++)r.push({pos:n.pos+1,ids:u[c]})}return!1}(t.rev_tree,n.metadata.rev)&&!u)return r[a]=n,i();var c,s=t.winningRev||eM(t),l="deleted"in t?t.deleted:eW(t,s),d="deleted"in n.metadata?n.metadata.deleted:eW(n.metadata),f=/^1-/.test(n.metadata.rev);if(l&&!d&&u&&f){var p=n.data;p._rev=s,p._id=n.metadata.id,n=tw(p,u)}var h=eJ(t.rev_tree,n.metadata.rev_tree[0],e);if(u&&(l&&d&&"new_leaf"!==h.conflicts||!l&&"new_leaf"!==h.conflicts||l&&!d&&"new_branch"===h.conflicts)){var y=ei(J);return r[a]=y,i()}var v=n.metadata.rev;n.metadata.rev_tree=h.tree,n.stemmedRevs=h.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var m=eM(n.metadata),b=eW(n.metadata,m),g=l===b?0:l<b?-1:1;c=v===m?b:eW(n.metadata,v),o(n,m,b,c,!0,g,a,i)}(e,r.get(n),d,i,f,o,u,l);else{var p=eJ([],d.metadata.rev_tree[0],e);d.metadata.rev_tree=p.tree,d.stemmedRevs=p.stemmedRevs||[],!function(e,t,n){var r=eM(e.metadata),a=eW(e.metadata,r);if("was_delete"in c&&a)return i[t]=ei(H,"deleted"),n();if(l&&"missing"===e.metadata.rev_tree[0].ids[1].status){var o=ei(J);return i[t]=o,n()}var s=a?0:1;u(e,r,a,a,!1,s,t,n)}(d,f,o)}}s()})}(e.revs_limit,y,r,O,u,_,P,n,S)}function d(e){var t=tR(e.target.result);t&&O.set(t.id,t),l()}})()})})()});function S(){g=!0,x()}function x(){if(!!h&&!!g)h.docCount+=k,f.put(h)}function E(){if(!w)tz.notify(r._meta.name),i(null,_)}function P(e,t,n,r,a,i,o,u){e.metadata.winningRev=t,e.metadata.deleted=n;var c=e.data;if(c._id=e.metadata.id,c._rev=e.metadata.rev,r&&(c._deleted=!0),c._attachments&&Object.keys(c._attachments).length)return function(e,t,n,r,a,i){var o=e.data,u=0,c=Object.keys(o._attachments);function s(){u===c.length&&C(e,t,n,r,a,i)}function d(){u++,s()}c.forEach(function(n){var r=e.data._attachments[n];if(r.stub)u++,s();else{var a=r.data;delete r.data,r.revpos=parseInt(t,10),function(e,t,n){l.count(e).onsuccess=function(r){if(r.target.result)return n();l.put({digest:e,body:t}).onsuccess=n}}(r.digest,a,d)}})}(e,t,n,a,o,u);k+=i,x(),C(e,t,n,a,o,u)}function C(e,t,n,a,i,o){var l=e.data,f=e.metadata;function p(i){var o,s,l=e.stemmedRevs||[];if(a&&r.auto_compaction){;l=l.concat((o=e.metadata,s=[],eN(o.rev_tree,function(e,t,n,r,a){"available"===a.status&&!e&&(s.push(t+"-"+n),a.status="missing")}),s))}l&&l.length&&tL(l,e.metadata.id,u),f.seq=i.target.result;var d=tT(f,t,n);c.put(d).onsuccess=h}l._doc_id_rev=f.id+"::"+f.rev,delete l._id,delete l._rev;function h(){_[i]={ok:!0,id:f.id,rev:f.rev},O.set(e.metadata.id,e.metadata),function(e,t,n){var r=0,a=Object.keys(e.data._attachments||{});if(!a.length)return n();function i(){++r===a.length&&n()}for(var o=0;o<a.length;o++)!function(n){var r=e.data._attachments[n].digest,a=d.put({seq:t,digestSeq:r+"::"+t});a.onsuccess=i,a.onerror=function(e){e.preventDefault(),e.stopPropagation(),i()}}(a[o])}(e,f.seq,o)}var y=s.put(l);y.onsuccess=p,y.onerror=function(e){e.preventDefault(),e.stopPropagation(),s.index("_doc_id_rev").getKey(l._doc_id_rev).onsuccess=function(e){s.put(l,e.target.result).onsuccess=p}}}}(t,n,r,e,a,l(i))},e._get=function(e,t,n){var r,i,o,u=t.ctx;if(!u){var c=tB(a,[tS,tx,tE],"readonly");if(c.error)return n(c.error);u=c.txn}function s(){n(o,{doc:r,metadata:i,ctx:u})}u.objectStore(tS).get(e).onsuccess=function(e){if(!(i=tR(e.target.result)))return o=ei(H,"missing"),s();if(t.rev)n=t.latest?function(e,t){for(var n,r=t.rev_tree.slice();n=r.pop();){var a=n.pos,i=n.ids,o=i[0],u=i[1],c=i[2],s=0===c.length,l=n.history?n.history.slice():[];if(l.push({id:o,pos:a,opts:u}),s)for(var d=0,f=l.length;d<f;d++){var p=l[d];if(p.pos+"-"+p.id===e)return a+"-"+o}for(var h=0,y=c.length;h<y;h++)r.push({pos:a+1,ids:c[h],history:l})}throw Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}(t.rev,i):t.rev;else{var n;if(n=i.winningRev,eW(i))return o=ei(H,"deleted"),s()}var a=u.objectStore(tx),c=i.id+"::"+n;a.index("_doc_id_rev").get(c).onsuccess=function(e){if((r=e.target.result)&&(r=tI(r)),!r)return o=ei(H,"missing"),s();s()}}},e._getAttachment=function(e,t,n,r,i){if(r.ctx)o=r.ctx;else{var o,u=tB(a,[tS,tx,tE],"readonly");if(u.error)return i(u.error);o=u.txn}var c=n.digest,s=n.content_type;o.objectStore(tE).get(c).onsuccess=function(e){tM(e.target.result.body,s,r.binary,function(e){i(null,e)})}},e._info=function(t){var n,r,i=tB(a,[tC,tx],"readonly");if(i.error)return t(i.error);var o=i.txn;o.objectStore(tC).get(tC).onsuccess=function(e){r=e.target.result.docCount},o.objectStore(tx).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;n=t?t.key:0},o.oncomplete=function(){t(null,{doc_count:r,update_seq:n,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(e,t){!function(e,t,n){var r,a,i,o,u="startkey"in e&&e.startkey,c="endkey"in e&&e.endkey,s="key"in e&&e.key,l="keys"in e&&e.keys,d=e.skip||0,f="number"==typeof e.limit?e.limit:-1,p=!1!==e.inclusive_end;if(!l&&(a=(r=function(e,t,n,r,a){try{if(e&&t){if(a)return IDBKeyRange.bound(t,e,!n,!1);return IDBKeyRange.bound(e,t,!1,!n)}if(e){if(a)return IDBKeyRange.upperBound(e);return IDBKeyRange.lowerBound(e)}else if(t){if(a)return IDBKeyRange.lowerBound(t,!n);return IDBKeyRange.upperBound(t,!n)}else if(r)return IDBKeyRange.only(r)}catch(e){return{error:e}}return null}(u,c,p,s,e.descending))&&r.error)&&!("DataError"===a.name&&0===a.code))return n(ei(en,a.name,a.message));var h=[tS,tx,tC];e.attachments&&h.push(tE);var y=tB(t,h,"readonly");if(y.error)return n(y.error);var v=y.txn;v.oncomplete=function(){e.attachments?tF(_,e.binary).then(S):S()},v.onabort=tA(n);var m=v.objectStore(tS),b=v.objectStore(tx),g=v.objectStore(tC),k=b.index("_doc_id_rev"),_=[];g.get(tC).onsuccess=function(e){i=e.target.result.docCount},e.update_seq&&function(e,t){e.openCursor(null,"prev").onsuccess=function(e){var n=e.target.result,r=void 0;return n&&n.key&&(r=n.key),t({target:{result:[r]}})}}(b,function(e){e.target.result&&e.target.result.length>0&&(o=e.target.result[0])});function O(t){for(var n=0,r=t.length;n<r&&_.length!==f;n++){;var a=t[n];if(a.error&&l){_.push(a);continue}var i=tR(a);!function(t,n){var r,a,i,o,u={id:n.id,key:n.id,value:{rev:t}};if(n.deleted)l&&(_.push(u),u.value.deleted=!0,u.doc=null);else if(d--<=0&&(_.push(u),e.include_docs)){;r=n,a=u,i=t,o=r.id+"::"+i,k.get(o).onsuccess=function(t){if(a.doc=tI(t.target.result)||{},e.conflicts){var n=eB(r);n.length&&(a.doc._conflicts=n)}tN(a.doc,e,v)}}}(i.winningRev,i)}}function w(e,t,n){if(!!n)O(t),_.length<f&&n.continue()}function S(){var t={total_rows:i,offset:e.skip,rows:_};e.update_seq&&void 0!==o&&(t.update_seq=o),n(null,t)}a||0===f?void 0:l?function(e,t,n){var r=Array(e.length),a=0;e.forEach(function(i,o){t.get(i).onsuccess=function(t){t.target.result?r[o]=t.target.result:r[o]={key:i,error:"not_found"},++a===e.length&&n(e,r,{})}})}(e.keys,m,w):-1===f?function(e,t,n){if("function"==typeof e.getAll){e.getAll(t).onsuccess=n;return}var r=[];e.openCursor(t).onsuccess=function(e){var t=e.target.result;t?(r.push(t.value),t.continue()):n({target:{result:r}})}}(m,r,function(t){var n=t.target.result;e.descending&&(n=n.reverse()),O(n)}):void tU(m,r,e.descending,f+d,w)}(e,a,l(t))},e._changes=function(t){return function(e,t,n,r){if((e=D(e)).continuous){var a,u,c,s,l=n+":"+eI();return tz.addListener(n,l,t,e),tz.notify(n),{cancel:function(){tz.removeListener(n,l)}}}var d=e.doc_ids&&new i(e.doc_ids);e.since=e.since||0;var f=e.since,p="limit"in e?e.limit:-1;0===p&&(p=1);var h=[],y=0,v=eu(e),m=new o;function b(e,t,n,r){if(n.seq!==t)return r();if(n.winningRev===e._rev)return r(n,e);var a=e._id+"::"+n.winningRev;s.get(a).onsuccess=function(e){r(n,tI(e.target.result))}}function g(){e.complete(null,{results:h,last_seq:f})}var k=[tS,tx];e.attachments&&k.push(tE);var _=tB(r,k,"readonly");if(_.error)return e.complete(_.error);(a=_.txn).onabort=tA(e.complete),a.oncomplete=function(){!e.continuous&&e.attachments?tF(h).then(g):g()},u=a.objectStore(tx),c=a.objectStore(tS),s=u.index("_doc_id_rev"),tU(u,e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null,e.descending,p,function(t,n,r){if(!!r&&!!t.length){var i=Array(t.length),o=Array(t.length),u=0;n.forEach(function(n,s){(function(e,t,n){if(d&&!d.has(e._id))return n();var r=m.get(e._id);if(r)return b(e,t,r,n);c.get(e._id).onsuccess=function(a){r=tR(a.target.result),m.set(e._id,r),b(e,t,r,n)}})(tI(n),t[s],function(n,c){o[s]=n,i[s]=c,++u===t.length&&!function(){for(var t=[],n=0,u=i.length;n<u&&y!==p;n++){;var c=i[n];if(!!c){var s=o[n];t.push(function(t,n){var r=e.processChange(n,t,e);f=r.seq=t.seq;var i=v(r);return"object"==typeof i?Promise.reject(i):i?(y++,e.return_docs&&h.push(r),e.attachments&&e.include_docs)?new Promise(function(t){tN(n,e,a,function(){tF([r],e.binary).then(function(){t(r)})})}):Promise.resolve(r):Promise.resolve()}(s,c))}}Promise.all(t).then(function(t){for(var n=0,r=t.length;n<r;n++)t[n]&&e.onChange(t[n])}).catch(e.complete),y!==p&&r.continue()}()})})}})}(t,e,r,a)},e._close=function(e){a.close(),tH.delete(r),e()},e._getRevisionTree=function(e,t){var n=tB(a,[tS],"readonly");if(n.error)return t(n.error);n.txn.objectStore(tS).get(e).onsuccess=function(e){var n=tR(e.target.result);n?t(null,n.rev_tree):t(ei(H))}},e._doCompaction=function(e,t,n){var r=tB(a,[tS,tx,tE,tP],"readwrite");if(r.error)return n(r.error);var i=r.txn;i.objectStore(tS).get(e).onsuccess=function(n){var r=tR(n.target.result);eN(r.rev_tree,function(e,n,r,a,i){-1!==t.indexOf(n+"-"+r)&&(i.status="missing")}),tL(t,e,i);var a=r.winningRev,o=r.deleted;i.objectStore(tS).put(tT(r,a,o))},i.onabort=tA(n),i.oncomplete=function(){n()}},e._getLocal=function(e,t){var n=tB(a,[tD],"readonly");if(n.error)return t(n.error);var r=n.txn.objectStore(tD).get(e);r.onerror=tA(t),r.onsuccess=function(e){var n=e.target.result;n?(delete n._doc_id_rev,t(null,n)):t(ei(H))}},e._putLocal=function(e,t,n){"function"==typeof t&&(n=t,t={}),delete e._revisions;var r,i,o=e._rev,u=e._id;o?e._rev="0-"+(parseInt(o.split("-")[1],10)+1):e._rev="0-1";var c=t.ctx;if(!c){var s=tB(a,[tD],"readwrite");if(s.error)return n(s.error);(c=s.txn).onerror=tA(n),c.oncomplete=function(){r&&n(null,r)}}var l=c.objectStore(tD);o?(i=l.get(u)).onsuccess=function(a){var i=a.target.result;i&&i._rev===o?l.put(e).onsuccess=function(){r={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,r)}:n(ei(J))}:((i=l.add(e)).onerror=function(e){n(ei(J)),e.preventDefault(),e.stopPropagation()},i.onsuccess=function(){r={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,r)})},e._removeLocal=function(e,t,n){"function"==typeof t&&(n=t,t={});var r,i=t.ctx;if(!i){var o=tB(a,[tD],"readwrite");if(o.error)return n(o.error);(i=o.txn).oncomplete=function(){r&&n(null,r)}}var u=e._id,c=i.objectStore(tD),s=c.get(u);s.onerror=tA(n),s.onsuccess=function(a){var i=a.target.result;i&&i._rev===e._rev?(c.delete(u),r={ok:!0,id:u,rev:"0-0"},t.ctx&&n(null,r)):n(ei(H))}},e._destroy=function(e,t){tz.removeAllListeners(r);var n=tJ.get(r);n&&n.result&&(n.result.close(),tH.delete(r));var a=indexedDB.deleteDatabase(r);a.onsuccess=function(){tJ.delete(r),u&&r in localStorage&&delete localStorage[r],t(null,{ok:!0})},a.onerror=tA(t)};var v=tH.get(r);if(v)return a=v.idb,e._meta=v.global,d()(function(){n(null,e)});var m=indexedDB.open(r,5);tJ.set(r,m),m.onupgradeneeded=function(e){var t,n,r,a,i=e.target.result;if(e.oldVersion<1){;return n=(t=i).createObjectStore(tS,{keyPath:"id"}),t.createObjectStore(tx,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),t.createObjectStore(tE,{keyPath:"digest"}),t.createObjectStore(tC,{keyPath:"id",autoIncrement:!1}),t.createObjectStore(tj),n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),t.createObjectStore(tD,{keyPath:"_id"}),void((r=t.createObjectStore(tP,{autoIncrement:!0})).createIndex("seq","seq"),r.createIndex("digestSeq","digestSeq",{unique:!0}))}var o=e.currentTarget.transaction;if(e.oldVersion<3&&!function(e){e.createObjectStore(tD,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(i),e.oldVersion<4){;(a=i.createObjectStore(tP,{autoIncrement:!0})).createIndex("seq","seq"),a.createIndex("digestSeq","digestSeq",{unique:!0})}var u=[f,p,h,y],c=e.oldVersion;!function e(){var t=u[c-1];c++,t&&t(o,e)}()},m.onsuccess=function(t){(a=t.target.result).onversionchange=function(){a.close(),tH.delete(r)},a.onabort=function(e){B("error","Database has a global failure",e.target.error),c=e.target.error,a.close(),tH.delete(r)};var i,o,u,l,d,f,p,h=a.transaction([tC,tj,tS],"readwrite"),y=!1;function v(){if(void 0!==f&&!!y)e._meta={name:r,instanceId:p,blobSupport:f},tH.set(r,{idb:a,global:e._meta}),n(null,e)}function m(){if(void 0!==d&&void 0!==l){var e=r+"_id";e in l?p=l[e]:l[e]=p=eI(),l.docCount=d,h.objectStore(tC).put(l)}}if(h.objectStore(tC).get(tC).onsuccess=function(e){l=e.target.result||{id:tC},m()},i=h,o=function(e){d=e,m()},i.objectStore(tS).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){o(e.target.result)},!s){;u=h,s=new Promise(function(e){var t=eO([""]),n=u.objectStore(tj).put(t,"key");n.onsuccess=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/);e(navigator.userAgent.match(/Edge\//)||!t||parseInt(t[1],10)>=43)},n.onerror=u.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)}}).catch(function(){return!1})}s.then(function(e){f=e,v()}),h.oncomplete=function(){y=!0,v()},h.onabort=tA(n)},m.onerror=function(e){var t=e.target.error&&e.target.error.message;t?-1!==t.indexOf("stored database is a higher version")&&(t=Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):t="Failed to open indexedDB, are you in private browsing mode?",B("error",t),n(ei(en,t))}})(c,e,t)},r=t,a=c.constructor,tG.push(function(){n(function(e,t){!function(e,t,n,r){try{e(t,n)}catch(e){r.emit("error",e)}}(r,e,t,a),tq=!1,d()(function(){tQ(a)})})}),tQ()}tY.valid=function(){try{return"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}};var tW={};function tK(e){var t=e.doc||e.ok,n=t&&t._attachments;if(!!n)Object.keys(n).forEach(function(e){var t,r,a=n[e];a.data=(t=a.data,r=a.content_type,ew(ek(t),r))})}function tV(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function t$(e){return e._attachments&&Object.keys(e._attachments)?Promise.all(Object.keys(e._attachments).map(function(t){var n=e._attachments[t];if(n.data&&"string"!=typeof n.data)return new Promise(function(e){eP(n.data,e)}).then(function(e){n.data=e})})):Promise.resolve()}function tZ(e,t){return tX(e,e.db+"/"+t)}function tX(e,t){var n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function t0(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function t1(e,t){var n,r=this,a=function(e,t){if(function(e){if(!e.prefix)return!1;var t=em(e.prefix).protocol;return"http"===t||"https"===t}(t)){var n=t.name.substr(t.prefix.length);e=t.prefix.replace(/\/?$/,"/")+encodeURIComponent(n)}var r=em(e);(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var a=r.path.replace(/(^\/|\/$)/g,"").split("/");return r.db=a.pop(),-1===r.db.indexOf("%")&&(r.db=encodeURIComponent(r.db)),r.path=a.join("/"),r}(e.name,e),i=tZ(a,"");e=D(e);var o=function(t,n){if((n=n||{}).headers=n.headers||new e6,n.credentials="include",e.auth||a.auth){var r,i,o,u,c,s,l=e.auth||a.auth,d=e_(unescape(encodeURIComponent(l.username+":"+l.password)));n.headers.set("Authorization","Basic "+d)}var f=e.headers||{};if(Object.keys(f).forEach(function(e){n.headers.append(e,f[e])}),r=n,o=-1!==(i="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"").indexOf("msie"),u=-1!==i.indexOf("trident"),c=-1!==i.indexOf("edge"),s=!("method"in r)||"GET"===r.method,(o||u||c)&&s)t+=(-1===t.indexOf("?")?"?":"&")+"_nonce="+Date.now();return(e.fetch||e4)(t,n)};function u(e,t){return T(e,m()(function(e){s().then(function(){return t.apply(this,e)}).catch(function(t){e.pop()(t)})})).bind(r)}function c(e,t,n){var r={};return(t=t||{}).headers=t.headers||new e6,!t.headers.get("Content-Type")&&t.headers.set("Content-Type","application/json"),!t.headers.get("Accept")&&t.headers.set("Accept","application/json"),o(e,t).then(function(e){return r.ok=e.ok,r.status=e.status,e.json()}).then(function(e){if(r.data=e,!r.ok){r.data.status=r.status;var t=eo(r.data);if(n)return n(t);throw t}if(Array.isArray(r.data)&&(r.data=r.data.map(function(e){return e.error||e.missing?eo(e):e})),!n)return r;n(null,r.data)})}function s(){return e.skip_setup?Promise.resolve():n?n:((n=c(i).catch(function(e){return e&&e.status&&404===e.status?(U(404,"PouchDB is just detecting if the remote exists."),c(i,{method:"PUT"})):Promise.reject(e)}).catch(function(e){return!!e&&!!e.status&&412===e.status||Promise.reject(e)})).catch(function(){n=null}),n)}function l(e){return e.split("/").map(encodeURIComponent).join("/")}d()(function(){t(null,r)}),r._remote=!0,r.type=function(){return"http"},r.id=u("id",function(e){o(tX(a,"")).then(function(e){return e.json()}).catch(function(){return{}}).then(function(t){e(null,t&&t.uuid?t.uuid+a.db:tZ(a,""))})}),r.compact=u("compact",function(e,t){"function"==typeof e&&(t=e,e={}),e=D(e),c(tZ(a,"_compact"),{method:"POST"}).then(function(){!function n(){r.info(function(r,a){a&&!a.compact_running?t(null,{ok:!0}):setTimeout(n,e.interval||200)})}()})}),r.bulkGet=T("bulkGet",function(e,t){var n=this;function r(t){var n={};e.revs&&(n.revs=!0),e.attachments&&(n.attachments=!0),e.latest&&(n.latest=!0),c(tZ(a,"_bulk_get"+t0(n)),{method:"POST",body:JSON.stringify({docs:e.docs})}).then(function(n){e.attachments&&e.binary&&n.data.results.forEach(function(e){e.docs.forEach(tK)}),t(null,n.data)}).catch(t)}function i(){for(var r=Math.ceil(e.docs.length/50),a=0,i=Array(r),o=0;o<r;o++){var u=R(e,["revs","attachments","binary","latest"]);u.docs=e.docs.slice(50*o,Math.min(e.docs.length,(o+1)*50)),N(n,u,function(e){return function(n,o){i[e]=o.results,++a===r&&t(null,{results:ec(i)})}}(o))}}var o=tX(a,""),u=tW[o];"boolean"!=typeof u?r(function(e,n){e?(tW[o]=!1,U(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),i()):(tW[o]=!0,t(null,n))}):u?r(t):i()}),r._info=function(e){s().then(function(){return o(tZ(a,""))}).then(function(e){return e.json()}).then(function(t){t.host=tZ(a,""),e(null,t)}).catch(e)},r.fetch=function(e,t){return s().then(function(){return o("/"===e.substring(0,1)?tX(a,e.substring(1)):tZ(a,e),t)})},r.get=u("get",function(e,t,n){"function"==typeof t&&(n=t,t={}),t=D(t);var r={};function i(e){var n,r=e._attachments,i=r&&Object.keys(r);if(!!r&&!!i.length)return n=i.map(function(n){return function(){var i,u;return u=r[i=n],o(tZ(a,tV(e._id)+"/"+l(i)+"?rev="+e._rev)).then(function(e){return"buffer"in e?e.buffer():e.blob()}).then(function(e){if(t.binary){var n=Object.getOwnPropertyDescriptor(e.__proto__,"type");return(!n||n.set)&&(e.type=u.content_type),e}return new Promise(function(t){eP(e,t)})}).then(function(e){delete u.stub,delete u.length,u.data=e})}}),new Promise(function(e,t){var r,a=0,i=0,o=0,u=n.length;function c(){++o===u?r?t(r):e():d()}function s(){a--,c()}function l(e){a--,r=r||e,c()}function d(){for(;a<5&&i<u;)a++,n[i++]().then(s,l)}d()})}t.revs&&(r.revs=!0),t.revs_info&&(r.revs_info=!0),t.latest&&(r.latest=!0),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),r.open_revs=t.open_revs),t.rev&&(r.rev=t.rev),t.conflicts&&(r.conflicts=t.conflicts),t.update_seq&&(r.update_seq=t.update_seq),e=tV(e);c(tZ(a,e+t0(r))).then(function(e){return Promise.resolve().then(function(){if(t.attachments){var n;return Array.isArray(n=e.data)?Promise.all(n.map(function(e){if(e.ok)return i(e.ok)})):i(n)}}).then(function(){n(null,e.data)})}).catch(function(t){t.docId=e,n(t)})}),r.remove=u("remove",function(e,t,n,r){"string"==typeof t?(i={_id:e,_rev:t},"function"==typeof n&&(r=n,n={})):(i=e,"function"==typeof t?(r=t,n={}):(r=n,n=t));var i,o=i._rev||n.rev;c(tZ(a,tV(i._id))+"?rev="+o,{method:"DELETE"},r).catch(r)}),r.getAttachment=u("getAttachment",function(e,t,n,r){"function"==typeof n&&(r=n,n={});var i,u=n.rev?"?rev="+n.rev:"";o(tZ(a,tV(e))+"/"+l(t)+u,{method:"GET"}).then(function(e){if(i=e.headers.get("content-type"),e.ok)return void 0===O||O.browser||"function"!=typeof e.buffer?e.blob():e.buffer();throw e}).then(function(e){if(void 0!==O&&!O.browser){var t=Object.getOwnPropertyDescriptor(e.__proto__,"type");(!t||t.set)&&(e.type=i)}r(null,e)}).catch(function(e){r(e)})}),r.removeAttachment=u("removeAttachment",function(e,t,n,r){c(tZ(a,tV(e)+"/"+l(t))+"?rev="+n,{method:"DELETE"},r).catch(r)}),r.putAttachment=u("putAttachment",function(e,t,n,r,i,o){"function"==typeof i&&(o=i,i=r,r=n,n=null);var u,s=tZ(a,tV(e)+"/"+l(t));if(n&&(s+="?rev="+n),"string"==typeof r){try{u=ek(r)}catch(e){return o(ei($,"Attachment is not a valid base64 string"))}r=u?ew(u,i):""}c(s,{headers:new e6({"Content-Type":i}),method:"PUT",body:r},o).catch(o)}),r._bulkDocs=function(e,t,n){e.new_edits=t.new_edits,s().then(function(){return Promise.all(e.docs.map(t$))}).then(function(){return c(tZ(a,"_bulk_docs"),{method:"POST",body:JSON.stringify(e)},n)}).catch(n)},r._put=function(e,t,n){s().then(function(){return t$(e)}).then(function(){return c(tZ(a,tV(e._id)),{method:"PUT",body:JSON.stringify(e)})}).then(function(e){n(null,e.data)}).catch(function(t){t.docId=e&&e._id,n(t)})},r.allDocs=u("allDocs",function(e,t){"function"==typeof e&&(t=e,e={}),e=D(e);var n,r={},i="GET";e.conflicts&&(r.conflicts=!0),e.update_seq&&(r.update_seq=!0),e.descending&&(r.descending=!0),e.include_docs&&(r.include_docs=!0),e.attachments&&(r.attachments=!0),e.key&&(r.key=JSON.stringify(e.key)),e.start_key&&(e.startkey=e.start_key),e.startkey&&(r.startkey=JSON.stringify(e.startkey)),e.end_key&&(e.endkey=e.end_key),e.endkey&&(r.endkey=JSON.stringify(e.endkey)),void 0!==e.inclusive_end&&(r.inclusive_end=!!e.inclusive_end),void 0!==e.limit&&(r.limit=e.limit),void 0!==e.skip&&(r.skip=e.skip);var o=t0(r);void 0!==e.keys&&(i="POST",n={keys:e.keys}),c(tZ(a,"_all_docs"+o),{method:i,body:JSON.stringify(n)}).then(function(n){e.include_docs&&e.attachments&&e.binary&&n.data.rows.forEach(tK),t(null,n.data)}).catch(t)}),r._changes=function(e){var t,n,r="batch_size"in e?e.batch_size:25;(e=D(e)).continuous&&!("heartbeat"in e)&&(e.heartbeat=1e4);var i="timeout"in e?e.timeout:3e4;"timeout"in e&&e.timeout&&i-e.timeout<5e3&&(i=e.timeout+5e3),"heartbeat"in e&&e.heartbeat&&i-e.heartbeat<5e3&&(i=e.heartbeat+5e3);var o={};"timeout"in e&&e.timeout&&(o.timeout=e.timeout);var u=void 0!==e.limit&&e.limit,l=u;if(e.style&&(o.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(o.include_docs=!0),e.attachments&&(o.attachments=!0),e.continuous&&(o.feed="longpoll"),e.seq_interval&&(o.seq_interval=e.seq_interval),e.conflicts&&(o.conflicts=!0),e.descending&&(o.descending=!0),e.update_seq&&(o.update_seq=!0),"heartbeat"in e&&e.heartbeat&&(o.heartbeat=e.heartbeat),e.filter&&"string"==typeof e.filter&&(o.filter=e.filter),e.view&&"string"==typeof e.view&&(o.filter="_view",o.view=e.view),e.query_params&&"object"==typeof e.query_params)for(var f in e.query_params)Object.prototype.hasOwnProperty.call(e.query_params,f)&&(o[f]=e.query_params[f]);var p="GET";e.doc_ids?(o.filter="_doc_ids",p="POST",t={doc_ids:e.doc_ids}):e.selector&&(o.filter="_selector",p="POST",t={selector:e.selector});var h=new e3,y=function(i,d){if(e.aborted)return;o.since=i,"object"==typeof o.since&&(o.since=JSON.stringify(o.since)),e.descending?u&&(o.limit=l):o.limit=!u||l>r?r:l;var f=tZ(a,"_changes"+t0(o)),y={signal:h.signal,method:p,body:JSON.stringify(t)};if(n=i,!e.aborted)s().then(function(){return c(f,y,d)}).catch(d)},v={results:[]},m=function(t,a){if(!e.aborted){var i=0;if(a&&a.results){i=a.results.length,v.last_seq=a.last_seq;var o=null,c=null;"number"==typeof a.pending&&(o=a.pending),("string"==typeof v.last_seq||"number"==typeof v.last_seq)&&(c=v.last_seq);e.query_params,a.results=a.results.filter(function(t){l--;var n=eu(e)(t);return n&&(e.include_docs&&e.attachments&&e.binary&&tK(t),e.return_docs&&v.results.push(t),e.onChange(t,o,c)),n})}else if(t){e.aborted=!0,e.complete(t);return}a&&a.last_seq&&(n=a.last_seq);var s=u&&l<=0||a&&i<r||e.descending;(!e.continuous||u&&l<=0)&&s?e.complete(null,v):d()(function(){y(n,m)})}};return y(e.since||0,m),{cancel:function(){e.aborted=!0,h.abort()}}},r.revsDiff=u("revsDiff",function(e,t,n){"function"==typeof t&&(n=t,t={}),c(tZ(a,"_revs_diff"),{method:"POST",body:JSON.stringify(e)},n).catch(n)}),r._close=function(e){e()},r._destroy=function(e,t){c(tZ(a,""),{method:"DELETE"}).then(function(e){t(null,e)}).catch(function(e){404===e.status?t(null,{ok:!0}):t(e)})}}t1.valid=function(){return!0};function t2(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,t2)}catch(e){}}function t5(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,t5)}catch(e){}}function t3(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,t3)}catch(e){}}function t4(e,t){return t&&e.then(function(e){d()(function(){t(null,e)})},function(e){d()(function(){t(e)})}),e}g()(t2,Error),g()(t5,Error),g()(t3,Error);function t6(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}}function t7(e){var t=new i(e),n=Array(t.size),r=-1;return t.forEach(function(e){n[++r]=e}),n}function t8(e){var t=Array(e.size),n=-1;return e.forEach(function(e,r){t[++n]=r}),t}function t9(e){return new t3("builtin "+e+" function requires map values to be numbers or number arrays")}function ne(e){for(var t=0,n=0,r=e.length;n<r;n++){var a=e[n];if("number"!=typeof a){if(Array.isArray(a)){t="number"==typeof t?[t]:t;for(var i=0,o=a.length;i<o;i++){var u=a[i];if("number"!=typeof u)throw t9("_sum");void 0===t[i]?t.push(u):t[i]+=u}}else throw t9("_sum")}else"number"==typeof t?t+=a:t[0]+=a}return t}var nt=B.bind(null,"log"),nn=Array.isArray,nr=JSON.parse;function na(e,t){return eb("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:ne,log:nt,isArray:nn,toJSON:nr})}function ni(){this.promise=new Promise(function(e){e()})}function no(e){if(!e)return"undefined";switch(typeof e){case"function":case"string":return e.toString();default:return JSON.stringify(e)}}ni.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},ni.prototype.finish=function(){return this.promise};function nu(e,t,n,r,a,i){var o,u,c,s=(o=n,u=r,no(o)+no(u)+"undefined");if(!a&&(c=e._cachedViews=e._cachedViews||{})[s])return c[s];var l=e.info().then(function(o){var u,l=o.db_name+"-mrview-"+(a?"temp":(u=s,h().hash(u)));return eg(e,"_local/"+i,function(e){e.views=e.views||{};var n=t;-1===n.indexOf("/")&&(n=t+"/"+t);var r=e.views[n]=e.views[n]||{};if(!r[l])return r[l]=!0,e}).then(function(){return e.registerDependentDatabase(l).then(function(t){var a=t.db;a.auto_compaction=!0;var i={name:l,db:a,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};return i.db.get("_local/lastSeq").catch(function(e){if(404!==e.status)throw e}).then(function(e){return i.seq=e?e.seq:0,c&&i.db.once("destroyed",function(){delete c[s]}),i})})})});return c&&(c[s]=l),l}var nc={},ns=new ni;function nl(e){return -1===e.indexOf("/")?[e,e]:e.split("/")}function nd(e,t,n){try{e.emit("error",t)}catch(e){B("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),B("error",t,n)}}var nf={_sum:function(e,t){return ne(t)},_count:function(e,t){return t.length},_stats:function(e,t){return{sum:ne(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,n=0,r=e.length;n<r;n++){var a=e[n];t+=a*a}return t}(t)}}},np=function(e,t,n,r){var a;function u(e,t){var n=ta(e.key,t.key);return 0!==n?n:ta(e.value,t.value)}function c(e,t,n){return(n=n||0,"number"==typeof t)?e.slice(n,t+n):n>0?e.slice(n):e}function s(e){var t=e.value;return t&&"object"==typeof t&&t._id||e.id}function l(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&!function(e){e.rows.forEach(function(e){var t=e.doc&&e.doc._attachments;if(!!t)Object.keys(t).forEach(function(e){var n,r,a=t[e];t[e].data=(n=a.data,r=a.content_type,ew(ek(n),r))})})}(t),t}}function f(e,t,n,r){var a=t[e];void 0!==a&&(r&&(a=encodeURIComponent(JSON.stringify(a))),n.push(e+"="+a))}function p(e){if(void 0!==e){var t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function h(e,t){var n=e.descending?"endkey":"startkey",r=e.descending?"startkey":"endkey";if(void 0!==e[n]&&void 0!==e[r]&&ta(e[n],e[r])>0)throw new t2("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&!1!==e.reduce){if(e.include_docs)throw new t2("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new t2("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(t){var n=function(e){if(e){if("number"!=typeof e)return new t2('Invalid value for integer: "'+e+'"');if(e<0)return new t2('Invalid value for positive integer: "'+e+'"')}}(e[t]);if(n)throw n})}function y(e){return function(t){if(404===t.status)return e;throw t}}function v(e){var t="string"==typeof e?e:e.name,n=nc[t];return!n&&(n=nc[t]=new ni),n}function b(e,n){return t6(v(e),function(){return function(e,n){var r,a,c=t(e.mapFun,function(e,t){var n={id:a._id,key:ti(e)};null!=t&&(n.value=ti(t)),r.push(n)}),s=e.seq||0;let l=0,d={view:e.name,indexed_docs:l};e.sourceDB.emit("indexing",d);var f=new ni;function p(){return e.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:s,limit:n.changes_batch_size}).then(h)}function h(t){var d,h,v=t.results;if(!v.length)return;var m=function(t){for(var n=new o,i=0,l=t.length;i<l;i++){var d=t[i];if("_"!==d.doc._id[0]){r=[],!(a=d.doc)._deleted&&!function(e,t,n){try{t(n)}catch(r){nd(e,r,{fun:t,doc:n})}}(e.sourceDB,c,a),r.sort(u);var f=function(e){for(var t,n=new o,r=0,a=e.length;r<a;r++){var i=e[r],u=[i.key,i.id];r>0&&0===ta(i.key,t)&&u.push(r),n.set(to(u),i),t=i.key}return n}(r);n.set(d.doc._id,[f,d.changes])}s=d.seq}return n}(v);f.add((d=m,h=s,function(){var t,n,r,a;return t=e,n=d,r=h,a="_local/lastSeq",t.db.get(a).catch(y({_id:a,seq:0})).then(function(e){return Promise.all(t8(n).map(function(e){var r,a,o,u,c,s,l,d;return r=e,a=t,o=n,c={_id:u="_local/doc_"+r,keys:[]},l=(s=o.get(r))[0],(1===(d=s[1]).length&&/^1-/.test(d[0].rev)?Promise.resolve(c):a.db.get(u).catch(y(c))).then(function(e){var t;return((t=e).keys.length?a.db.allDocs({keys:t.keys,include_docs:!0}):Promise.resolve({rows:[]})).then(function(t){return function(e,t){for(var n=[],r=new i,a=0,o=t.rows.length;a<o;a++){var u=t.rows[a].doc;if(!!u){if(n.push(u),r.add(u._id),u._deleted=!l.has(u._id),!u._deleted){var c=l.get(u._id);"value"in c&&(u.value=c.value)}}}var s=t8(l);return s.forEach(function(e){if(!r.has(e)){var t={_id:e},a=l.get(e);"value"in a&&(t.value=a.value),n.push(t)}}),e.keys=t7(s.concat(e.keys)),n.push(e),n}(e,t)})})})).then(function(n){var a=ec(n);return e.seq=r,a.push(e),t.db.bulkDocs({docs:a})})})})),l+=v.length;let b={view:e.name,last_seq:t.last_seq,results_count:v.length,indexed_docs:l};if(e.sourceDB.emit("indexing",b),!(v.length<n.changes_batch_size))return p()}return p().then(function(){return f.finish()}).then(function(){e.seq=s})}(e,n)})()}function g(e,t){return t6(v(e),function(){return function(e,t){var r=e.reduceFun&&!1!==t.reduce,a=t.skip||0;function i(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return l=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),n=["id","key","value"];if(!(t<n||t>n))return e.doc.value}var r=function(e){for(var t=[],n=[],r=0;;){var a=e[r++];if("\0"===a){if(1===t.length)return t.pop();!function(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var a=r.element,i=r.index;Array.isArray(a)?a.push(n):i===e.length-2?a[e.pop()]=n:e.push(n)}}(t,n);continue}switch(a){case"1":t.push(null);break;case"2":t.push("1"===e[r]),r++;break;case"3":var i=function(e,t){var n,r=t;if("1"===e[t])n=0,t++;else{var a="0"===e[t];t++;var i="",o=parseInt(e.substring(t,t+3),10)+-324;for(a&&(o=-o),t+=3;;){var u=e[t];if("\0"===u)break;i+=u;t++}n=1===(i=i.split(".")).length?parseInt(i,10):parseFloat(i[0]+"."+i[1]),a&&(n-=10),0!==o&&(n=parseFloat(n+"e"+o))}return{num:n,length:t-r}}(e,r);t.push(i.num),r+=i.length;break;case"4":for(var o="";;){var u=e[r];if("\0"===u)break;o+=u,r++}o=o.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"\x01").replace(/\u0002\u0002/g,"\x02"),t.push(o);break;case"5":var c={element:[],index:t.length};t.push(c.element),n.push(c);break;case"6":var s={element:{},index:t.length};t.push(s.element),n.push(s);break;default:throw Error("bad collationIndex or unexpectedly reached end of input: "+a)}}}(e.doc._id);return{key:r[0],id:r[1],value:"value"in e.doc?e.doc.value:null}})})}function u(i){if(u=r?function(e,t,r){0===r.group_level&&delete r.group_level;var a=r.group||r.group_level,i=n(e.reduceFun),o=[],u=isNaN(r.group_level)?Number.POSITIVE_INFINITY:r.group_level;t.forEach(function(e){var t=o[o.length-1],n=a?e.key:null;if(a&&Array.isArray(n)&&(n=n.slice(0,u)),t&&0===ta(t.groupKey,n)){t.keys.push([e.key,e.id]),t.values.push(e.value);return}o.push({keys:[[e.key,e.id]],values:[e.value],groupKey:n})}),t=[];for(var s=0,l=o.length;s<l;s++){var d=o[s],f=function(e,t,n,r,a){try{return{output:t(n,r,a)}}catch(i){return nd(e,i,{fun:t,keys:n,values:r,rereduce:a}),{error:i}}}(e.sourceDB,i,d.keys,d.values,!1);if(f.error&&f.error instanceof t3)throw f.error;t.push({value:f.error?null:f.output,key:d.groupKey})}return{rows:c(t,r.limit,r.skip)}}(e,i,t):void 0===t.keys?{total_rows:l,offset:a,rows:i}:{total_rows:l,offset:a,rows:c(i,t.limit,t.skip)},t.update_seq&&(u.update_seq=e.seq),!t.include_docs)return u;var u,d=t7(i.map(s));return e.sourceDB.allDocs({keys:d,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then(function(e){var t=new o;return e.rows.forEach(function(e){t.set(e.id,e.doc)}),i.forEach(function(e){var n=s(e),r=t.get(n);r&&(e.doc=r)}),u})}if(void 0!==t.keys&&!t.keys.length&&(t.limit=0,delete t.keys),void 0!==t.keys)return Promise.all(t.keys.map(function(e){var n={startkey:to([e]),endkey:to([e,{}])};return t.update_seq&&(n.update_seq=!0),i(n)})).then(ec).then(u);var l,d,f,p={descending:t.descending};if(t.update_seq&&(p.update_seq=!0),"start_key"in t&&(d=t.start_key),"startkey"in t&&(d=t.startkey),"end_key"in t&&(f=t.end_key),"endkey"in t&&(f=t.endkey),void 0!==d&&(p.startkey=t.descending?to([d,{}]):to([d])),void 0!==f){var h=!1!==t.inclusive_end;t.descending&&(h=!h),p.endkey=to(h?[f,{}]:[f])}if(void 0!==t.key){var y=to([t.key]),v=to([t.key,{}]);p.descending?(p.endkey=y,p.startkey=v):(p.startkey=y,p.endkey=v)}return!r&&("number"==typeof t.limit&&(p.limit=t.limit),p.skip=a),i(p).then(u)}(e,t)})()}return{query:function(t,n,a){var i,o=this;"function"==typeof n&&(a=n,n={}),n=n?((i=n).group_level=p(i.group_level),i.limit=p(i.limit),i.skip=p(i.skip),i):{},"function"==typeof t&&(t={map:t});var u=Promise.resolve().then(function(){return function(t,n,a){if("function"==typeof t._query){var i,o,u;return i=t,o=n,u=a,new Promise(function(e,t){i._query(o,u,function(n,r){if(n)return t(n);e(r)})})}if(el(t))return function(e,t,n){var r,a,i,o=[],u="GET";if(f("reduce",n,o),f("include_docs",n,o),f("attachments",n,o),f("limit",n,o),f("descending",n,o),f("group",n,o),f("group_level",n,o),f("skip",n,o),f("stale",n,o),f("conflicts",n,o),f("startkey",n,o,!0),f("start_key",n,o,!0),f("endkey",n,o,!0),f("end_key",n,o,!0),f("inclusive_end",n,o),f("key",n,o,!0),f("update_seq",n,o),o=""===(o=o.join("&"))?"":"?"+o,void 0!==n.keys){var c="keys="+encodeURIComponent(JSON.stringify(n.keys));c.length+o.length+1<=2e3?o+=("?"===o[0]?"&":"?")+c:(u="POST","string"==typeof t?r={keys:n.keys}:t.keys=n.keys)}if("string"==typeof t){var s=nl(t);return e.fetch("_design/"+s[0]+"/_view/"+s[1]+o,{headers:new e6({"Content-Type":"application/json"}),method:u,body:JSON.stringify(r)}).then(function(e){return a=e.ok,i=e.status,e.json()}).then(function(e){if(!a)throw e.status=i,eo(e);return e.rows.forEach(function(e){if(e.value&&e.value.error&&"builtin_reduce_error"===e.value.error)throw Error(e.reason)}),e}).then(l(n))}return r=r||{},Object.keys(t).forEach(function(e){Array.isArray(t[e])?r[e]=t[e]:r[e]=t[e].toString()}),e.fetch("_temp_view"+o,{headers:new e6({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(r)}).then(function(e){return a=e.ok,i=e.status,e.json()}).then(function(e){if(!a)throw e.status=i,eo(e);return e}).then(l(n))}(t,n,a);var c={changes_batch_size:t.__opts.view_update_changes_batch_size||50};if("string"!=typeof n)return h(a,n),ns.add(function(){return nu(t,"temp_view/temp_view",n.map,n.reduce,!0,e).then(function(e){var t,n;return t=b(e,c).then(function(){return g(e,a)}),n=function(){return e.db.destroy()},t.then(function(e){return n().then(function(){return e})},function(e){return n().then(function(){throw e})})})}),ns.finish();var s=nl(n),p=s[0],y=s[1];return t.get("_design/"+p).then(function(i){var o=i.views&&i.views[y];if(!o)throw new t5("ddoc "+i._id+" has no view named "+y);return r(i,y),h(a,o),nu(t,n,o.map,o.reduce,!1,e).then(function(e){return"ok"===a.stale||"update_after"===a.stale?("update_after"===a.stale&&d()(function(){b(e,c)}),g(e,a)):b(e,c).then(function(){return g(e,a)})})})}(o,t,n)});return t4(u,a),u},viewCleanup:(a=function(){var t,n,r;if("function"==typeof this._viewCleanup){;return t=this,new Promise(function(e,n){t._viewCleanup(function(t,r){if(t)return n(t);e(r)})})}if(el(this)){;return n=this,n.fetch("_view_cleanup",{headers:new e6({"Content-Type":"application/json"}),method:"POST"}).then(function(e){return e.json()})}return r=this,r.get("_local/"+e).then(function(e){var t=new o;Object.keys(e.views).forEach(function(e){var n=nl(e),r="_design/"+n[0],a=n[1],o=t.get(r);!o&&(o=new i,t.set(r,o)),o.add(a)});var n={keys:t8(t),include_docs:!0};return r.allDocs(n).then(function(n){var a={};return n.rows.forEach(function(n){var r=n.key.substring(8);t.get(n.key).forEach(function(t){var i=r+"/"+t;!e.views[i]&&(i=t);var o=Object.keys(e.views[i]),u=n.doc&&n.doc.views&&n.doc.views[t];o.forEach(function(e){a[e]=a[e]||u})})}),Promise.all(Object.keys(a).filter(function(e){return!a[e]}).map(function(e){return t6(v(e),function(){return new r.constructor(e,r.__opts).destroy()})()})).then(function(){return{ok:!0}})})},y({ok:!0}))},m()(function(e){var t=e.pop(),n=a.apply(this,e);return"function"==typeof t&&t4(n,t),n}))}}("mrviews",function(e,t){return"function"==typeof e&&2===e.length?function(n){return e(n,t)}:na(e.toString(),t)},function(e){var t=e.toString(),n=function(e){if(/^_sum/.test(e))return nf._sum;if(/^_count/.test(e))return nf._count;if(/^_stats/.test(e))return nf._stats;else if(/^_/.test(e))throw Error(e+" is not a supported reduce function.")}(t);return n?n:na(t)},function(e,t){var n=e.views&&e.views[t];if("string"!=typeof n.map)throw new t5("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)});function nh(e){return/^1-/.test(e)}function ny(e,t){return Promise.all(Object.keys(t._attachments).map(function(n){return e.getAttachment(t._id,n,{rev:t._rev})}))}var nv="pouchdb";function nm(e,t,n,r,a){return e.get(t).catch(function(n){if(404===n.status)return("http"===e.adapter||"https"===e.adapter)&&U(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:t,history:[],replicator:nv,version:1};throw n}).then(function(i){if(!a.cancelled&&i.last_seq!==n)return i.history=(i.history||[]).filter(function(e){return e.session_id!==r}),i.history.unshift({last_seq:n,session_id:r}),i.history=i.history.slice(0,5),i.version=1,i.replicator=nv,i.session_id=r,i.last_seq=n,e.put(i).catch(function(i){if(409===i.status)return nm(e,t,n,r,a);throw i})})}function nb(e,t,n,r,a){this.src=e,this.target=t,this.id=n,this.returnValue=r,this.opts=a||{}}nb.prototype.writeCheckpoint=function(e,t){var n=this;return this.updateTarget(e,t).then(function(){return n.updateSource(e,t)})},nb.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?nm(this.target,this.id,e,t,this.returnValue):Promise.resolve(!0)},nb.prototype.updateSource=function(e,t){if(!this.opts.writeSourceCheckpoint)return Promise.resolve(!0);var n=this;return nm(this.src,this.id,e,t,this.returnValue).catch(function(e){if(n_(e))return n.opts.writeSourceCheckpoint=!1,!0;throw e})};var ng={undefined:function(e,t){return 0===ta(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return function(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:function e(t,n){var r=t[0],a=t.slice(1),i=n[0],o=n.slice(1);return r&&0!==n.length?nk(r.session_id,n)?{last_seq:r.last_seq,history:t}:nk(i.session_id,a)?{last_seq:i.last_seq,history:o}:e(a,o):{last_seq:0,history:[]}}(e.history,t.history)}(t,e).last_seq}};nb.prototype.getCheckpoint=function(){var e=this;return e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then(function(e){return e.last_seq||0}).catch(function(e){if(404!==e.status)throw e;return 0}):e.target.get(e.id).then(function(t){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?t.last_seq||0:e.src.get(e.id).then(function(e){var n;return t.version!==e.version?0:(n=t.version?t.version.toString():"undefined")in ng?ng[n](t,e):0},function(n){if(404===n.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:0}).then(function(){return 0},function(n){return n_(n)?(e.opts.writeSourceCheckpoint=!1,t.last_seq):0});throw n})}).catch(function(e){if(404!==e.status)throw e;return 0})};function nk(e,t){var n=t[0],r=t.slice(1);return!!e&&0!==t.length&&(e===n.session_id||nk(e,r))}function n_(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}function nO(){_().call(this),this.cancelled=!1,this.state="pending";var e=this,t=new Promise(function(t,n){e.once("complete",t),e.once("error",n)});e.then=function(e,n){return t.then(e,n)},e.catch=function(e){return t.catch(e)},e.catch(function(){})}function nw(e,t){var n=t.PouchConstructor;return"string"==typeof e?new n(e,t):e}function nS(e,t,n,r){if("function"==typeof n&&(r=n,n={}),void 0===n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw ei(ee,"`doc_ids` filter parameter is not a list.");n.complete=r,(n=D(n)).continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var a=new nO(n);return!function e(t,n,r,a,i){var o,u,c=[],s={seq:0,changes:[],docs:[]},l=!1,f=!1,p=!1,h=0,y=r.continuous||r.live||!1,v=r.batch_size||100,m=r.batches_limit||10,b=r.style||"all_docs",g=!1,k=r.doc_ids,_=r.selector,O=[],w=eI();i=i||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var S={};function x(){return u?Promise.resolve():(function(e,t,n){var r,a=n.doc_ids?n.doc_ids.sort(ta):"",i=n.filter?n.filter.toString():"",o="",u="",c="";if(n.selector&&(c=JSON.stringify(n.selector)),n.filter&&n.query_params){;o=JSON.stringify(Object.keys(r=n.query_params).sort(ta).reduce(function(e,t){return e[t]=r[t],e},{}))}return n.filter&&"_view"===n.filter&&(u=n.view.toString()),Promise.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+i+u+o+a+c;return new Promise(function(e){eA(t,e)})}).then(function(e){return"_local/"+(e=e.replace(/\//g,".").replace(/\+/g,"_"))})})(t,n,r).then(function(e){var i={};u=new nb(t,n,e,a,i=!1===r.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===r.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===r.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0})})}function E(){if(O=[],0!==o.docs.length){var e=o.docs,t={timeout:r.timeout};return n.bulkDocs({docs:e,new_edits:!1},t).then(function(t){if(a.cancelled)throw T(),Error("cancelled");var n=Object.create(null);t.forEach(function(e){e.error&&(n[e.id]=e)});var r=Object.keys(n).length;i.doc_write_failures+=r,i.docs_written+=e.length-r,e.forEach(function(e){var t=n[e._id];if(t){i.errors.push(t);var r=(t.name||"").toLowerCase();if("unauthorized"===r||"forbidden"===r)a.emit("denied",D(t));else throw t}else O.push(e)})},function(t){throw i.doc_write_failures+=e.length,t})}}function P(){if(o.error)throw Error("There was a problem getting docs.");i.last_seq=h=o.seq;var e=D(i);return O.length&&(e.docs=O,"number"==typeof o.pending&&(e.pending=o.pending,delete o.pending),a.emit("change",e)),l=!0,u.writeCheckpoint(o.seq,w).then(function(){if(a.emit("checkpoint",{checkpoint:o.seq}),l=!1,a.cancelled)throw T(),Error("cancelled");o=void 0,N()}).catch(function(e){throw L(e),e})}a.ready(t,n);function C(){var e,r,u,c,s,l;return(e=t,r=n,u=o.diffs,c=a,u=D(u),s=[],l=!0,Promise.resolve().then(function(){var t,n=Object.keys(u).filter(function(e){var t,n=u[e].missing;return 1===n.length&&(t=n[0],/^1-/.test(t))});if(n.length>0){;return t=n,e.allDocs({keys:t,include_docs:!0,conflicts:!0}).then(function(e){if(c.cancelled)throw Error("cancelled");e.rows.forEach(function(e){var t,n,r;if(!e.deleted&&!!e.doc&&(t=e.value.rev,!!/^1-/.test(t))&&(!(n=e.doc)._attachments||!(Object.keys(n._attachments).length>0))&&(!(r=e.doc)._conflicts||!(r._conflicts.length>0)))e.doc._conflicts&&delete e.doc._conflicts,s.push(e.doc),delete u[e.id]})})}}).then(function(){var t,n,a=(n=[],Object.keys(t=u).forEach(function(e){t[e].missing.forEach(function(t){n.push({id:e,rev:t})})}),{docs:n,revs:!0,latest:!0});if(!!a.docs.length)return e.bulkGet(a).then(function(t){if(c.cancelled)throw Error("cancelled");return Promise.all(t.results.map(function(t){return Promise.all(t.docs.map(function(t){var n,a,i,o,u,c=t.ok;if(t.error&&(l=!1),!c||!c._attachments)return c;return(n=r,a=e,i=c,o=el(a)&&!el(n),u=Object.keys(i._attachments),o?n.get(i._id).then(function(e){return Promise.all(u.map(function(t){var r,o,u;return(r=e,o=i,u=t,r._attachments&&r._attachments[u]&&r._attachments[u].digest===o._attachments[u].digest)?n.getAttachment(e._id,t):a.getAttachment(i._id,t)}))}).catch(function(e){if(404!==e.status)throw e;return ny(a,i)}):ny(a,i)).then(function(e){var t=Object.keys(c._attachments);return e.forEach(function(e,n){var r=c._attachments[t[n]];delete r.stub,delete r.length,r.data=e}),c})}))})).then(function(e){s=s.concat(ec(e).filter(Boolean))})})}).then(function(){return{ok:l,docs:s}})).then(function(e){o.error=!e.ok,e.docs.forEach(function(e){delete o.diffs[e._id],i.docs_read++,o.docs.push(e)})})}function j(e){if(0===s.changes.length){0===c.length&&!o&&((y&&S.live||f)&&(a.state="pending",a.emit("paused")),f&&T());return}(e||f||s.changes.length>=v)&&(c.push(s),s={seq:0,changes:[],docs:[]},("pending"===a.state||"stopped"===a.state)&&(a.state="active",a.emit("active")),!function e(){var t;if(!a.cancelled&&!o){if(0===c.length){j(!0);return}o=c.shift(),a.emit("checkpoint",{start_next_batch:o.seq}),(t={},o.changes.forEach(function(e){if(a.emit("checkpoint",{revs_diff:e}),"_user/"!==e.id)t[e.id]=e.changes.map(function(e){return e.rev})}),n.revsDiff(t).then(function(e){if(a.cancelled)throw T(),Error("cancelled");o.diffs=e})).then(C).then(E).then(P).then(e).catch(function(e){A("batch processing terminated with error",e)})}}())}function A(e,t){if(!p)!t.message&&(t.message=e),i.ok=!1,i.status="aborting",c=[],s={seq:0,changes:[],docs:[]},T(t)}function T(o){if(!p&&(!a.cancelled||(i.status="cancelled",!l)))if(i.status=i.status||"complete",i.end_time=new Date().toISOString(),i.last_seq=h,p=!0,o){(o=ei(o)).result=i;var u=(o.name||"").toLowerCase();"unauthorized"===u||"forbidden"===u?(a.emit("error",o),a.removeAllListeners()):!function(e,t,n,r){if(!1===e.retry){t.emit("error",n),t.removeAllListeners();return}if("function"!=typeof e.back_off_function&&(e.back_off_function=z),t.emit("requestError",n),"active"===t.state||"pending"===t.state){t.emit("paused",n),t.state="stopped";var a=function(){e.current_back_off=0};t.once("paused",function(){t.removeListener("active",a)}),t.once("active",a)}e.current_back_off=e.current_back_off||0,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}(r,a,o,function(){e(t,n,r,a)})}else a.emit("complete",i),a.removeAllListeners()}function R(e,t,n){if(a.cancelled)return T();if("number"==typeof t&&(s.pending=t),!!eu(r)(e))s.seq=e.seq||n,s.changes.push(e),a.emit("checkpoint",{pending_batch:s.seq}),d()(function(){j(0===c.length&&S.live)})}function I(e){if(g=!1,a.cancelled)return T();if(e.results.length>0)S.since=e.results[e.results.length-1].seq,N(),j(!0);else{var t=function(){y?(S.live=!0,N()):f=!0,j(!0)};o||0!==e.results.length?t():(l=!0,u.writeCheckpoint(e.last_seq,w).then(function(){l=!1,i.last_seq=h=e.last_seq,t()}).catch(L))}}function M(e){if(g=!1,a.cancelled)return T();A("changes rejected",e)}function N(){if(!!(!g&&!f&&c.length<m)){g=!0,a._changes&&(a.removeListener("cancel",a._abortChanges),a._changes.cancel()),a.once("cancel",n);var e=t.changes(S).on("change",R);e.then(i,i),e.then(I).catch(M),r.retry&&(a._changes=e,a._abortChanges=n)}function n(){e.cancel()}function i(){a.removeListener("cancel",n)}}function F(){x().then(function(){if(a.cancelled){T();return}return u.getCheckpoint().then(function(e){S={since:h=e,limit:v,batch_size:v,style:b,doc_ids:k,selector:_,return_docs:!0},r.filter&&("string"!=typeof r.filter?S.include_docs=!0:S.filter=r.filter),"heartbeat"in r&&(S.heartbeat=r.heartbeat),"timeout"in r&&(S.timeout=r.timeout),r.query_params&&(S.query_params=r.query_params),r.view&&(S.view=r.view),N()})}).catch(function(e){A("getCheckpoint rejected with ",e)})}function L(e){l=!1,A("writeCheckpoint completed with error",e)}if(a.cancelled){T();return}!a._addedListeners&&(a.once("cancel",T),"function"==typeof r.complete&&(a.once("error",r.complete),a.once("complete",function(e){r.complete(null,e)})),a._addedListeners=!0),void 0===r.since?F():x().then(function(){return l=!0,u.writeCheckpoint(r.since,w)}).then(function(){if(l=!1,a.cancelled){T();return}h=r.since,F()}).catch(L)}(nw(e,n),nw(t,n),n,a),a}function nx(e,t,n,r){return"function"==typeof n&&(r=n,n={}),void 0===n&&(n={}),(n=D(n)).PouchConstructor=n.PouchConstructor||this,e=nw(e,n),new nE(e,t=nw(t,n),n,r)}function nE(e,t,n,r){var a=this;this.canceled=!1;var i=n.push?q({},n,n.push):n,o=n.pull?q({},n,n.pull):n;function u(e){a.emit("change",{direction:"pull",change:e})}function c(e){a.emit("change",{direction:"push",change:e})}function s(e){a.emit("denied",{direction:"push",doc:e})}function l(e){a.emit("denied",{direction:"pull",doc:e})}function d(){a.pushPaused=!0,a.pullPaused&&a.emit("paused")}function f(){a.pullPaused=!0,a.pushPaused&&a.emit("paused")}function p(){a.pushPaused=!1,a.pullPaused&&a.emit("active",{direction:"push"})}function h(){a.pullPaused=!1,a.pushPaused&&a.emit("active",{direction:"pull"})}this.push=nS(e,t,i),this.pull=nS(t,e,o),this.pushPaused=!0,this.pullPaused=!0;var y={};function v(e){return function(t,n){var r="change"===t&&(n===u||n===c),i="denied"===t&&(n===l||n===s),o="paused"===t&&(n===f||n===d),v="active"===t&&(n===h||n===p);(r||i||o||v)&&(!(t in y)&&(y[t]={}),y[t][e]=!0,2===Object.keys(y[t]).length&&a.removeAllListeners(t))}}function m(e,t,n){-1==e.listeners(t).indexOf(n)&&e.on(t,n)}n.live&&(this.push.on("complete",a.pull.cancel.bind(a.pull)),this.pull.on("complete",a.push.cancel.bind(a.push))),this.on("newListener",function(e){"change"===e?(m(a.pull,"change",u),m(a.push,"change",c)):"denied"===e?(m(a.pull,"denied",l),m(a.push,"denied",s)):"active"===e?(m(a.pull,"active",h),m(a.push,"active",p)):"paused"===e&&(m(a.pull,"paused",f),m(a.push,"paused",d))}),this.on("removeListener",function(e){"change"===e?(a.pull.removeListener("change",u),a.push.removeListener("change",c)):"denied"===e?(a.pull.removeListener("denied",l),a.push.removeListener("denied",s)):"active"===e?(a.pull.removeListener("active",h),a.push.removeListener("active",p)):"paused"===e&&(a.pull.removeListener("paused",f),a.push.removeListener("paused",d))}),this.pull.on("removeListener",v("pull")),this.push.on("removeListener",v("push"));var b=Promise.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return a.emit("complete",t),r&&r(null,t),a.removeAllListeners(),t},function(e){if(a.cancel(),r?r(e):a.emit("error",e),a.removeAllListeners(),r)throw e});this.then=function(e,t){return b.then(e,t)},this.catch=function(e){return b.catch(e)}}g()(nO,_()),nO.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},nO.prototype.ready=function(e,t){var n=this;if(!n._readyCalled)n._readyCalled=!0,e.once("destroyed",r),t.once("destroyed",r),n.once("complete",a),n.once("error",a);function r(){n.cancel()}function a(){e.removeListener("destroyed",r),t.removeListener("destroyed",r)}},g()(nE,_()),nE.prototype.cancel=function(){!this.canceled&&(this.canceled=!0,this.push.cancel(),this.pull.cancel())};e5.plugin(function(e){e.adapter("idb",tY,!0)}).plugin(function(e){e.adapter("http",t1,!1),e.adapter("https",t1,!1)}).plugin({query:function(e,t,n){return np.query.call(this,e,t,n)},viewCleanup:function(e){return np.viewCleanup.call(this,e)}}).plugin(function(e){e.replicate=nS,e.sync=nx,Object.defineProperty(e.prototype,"replicate",{get:function(){var e=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(t,n,r){return e.constructor.replicate(t,e,n,r)},to:function(t,n,r){return e.constructor.replicate(e,t,n,r)}}),this.replicateMethods}}),e.prototype.sync=function(e,t,n){return this.constructor.sync(this,e,t,n)}});let nP=168==n.j?e5:null},11461:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(64512)),o=r(n(82007)),u=r(n(65105)),c=r(n(19723)),s=r(n(37203)),l=n(25976),d=r(n(88838)),f=r(n(77123)),p=n(86540),h=r(n(74268)),y=n(83462);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function b(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=n.return&&n.return()}finally{if(u)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var k=function(){var e,t,n,r,i;function s(e){var t=this;(0,u.default)(this,s),this.client=(0,y.getCozyClientFromOptions)(e),this.createWebSocket=e.createWebSocket||y.createWebSocket,this.logger=e.logger||h.default,this.subscriptions=new f.default({logger:e.logger}),this.retryManager=new d.default({raiseErrorAfterAttempts:p.raiseErrorAfterAttempts,timeBeforeSuccessful:p.timeBeforeSuccessful,baseWaitAfterFirstFailure:p.baseWaitAfterFirstFailure,maxWaitBetweenRetries:p.maxWaitBetweenRetries,logger:e.logger}),this.retryManager.on("error",function(e){return t.emit("error",e)}),this.bindEventHandlers(),(0,l.isCordova)()&&!(0,l.hasNetworkInformationPlugin)()&&this.logger.warn("This seems a Cordova app and cordova-plugin-network-information doesn't seem to be installed. Please install it from https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-network-information/ to support online and offline events.")}return(0,c.default)(s,[{key:"start",value:function(){!this.isStarted&&(this.logger.info("started"),this.isStarted=!0,this.retryManager.reset(),this.subscribeGlobalEvents(),this.subscribeClientEvents(),this.subscribeCordovaEvents(),this.emit("start"),(0,y.isOnline)()&&this.connect())}},{key:"createSocket",value:function(){this.websocket&&(this.logger.error("Unexpected replacement of an existing socket, this should not happen. A `revokeWebSocket()` should have been called first inside CozyRealtime"),this.revokeWebSocket()),this.logger.info("creating a new websocket");var e=(0,y.getUrl)(this.client);try{return this.websocket=this.createWebSocket(e,y.protocol),this.websocket.authenticated=!1,this.websocket.onmessage=this.onWebSocketMessage,this.websocket.onerror=this.onWebSocketError,this.websocket.onopen=this.onWebSocketOpen,this.websocket.onclose=this.onWebSocketClose,this.websocket}catch(e){this.onWebSocketError(e)}}},{key:"connect",value:(e=(0,o.default)(a.default.mark(function e(){var t,n,r=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0!==(t=(r.length>0&&void 0!==r[0]?r[0]:{}).immediate)&&t,this.logger.info("connecting"),!this.waitingForConnect){e.next=7;break}this.logger.debug("Pending reconnection, skipping reconnect"),n&&this.retryManager.stopCurrentAttemptWaitingTime(),e.next=17;break;case 7:if(this.logger.debug("No pending reconnection, will reconnect"),e.prev=8,this.waitingForConnect=!0,n){e.next=13;break}return e.next=13,this.retryManager.waitBeforeNextAttempt();case 13:this.createSocket();case 14:return e.prev=14,this.waitingForConnect=!1,e.finish(14);case 17:case"end":return e.stop()}},e,this,[[8,,14,17]])})),function(){return e.apply(this,arguments)})},{key:"reconnect",value:(t=(0,o.default)(a.default.mark(function e(){var t,n,r=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=void 0!==(t=(r.length>0&&void 0!==r[0]?r[0]:{}).immediate)&&t,this.hasWebSocket()&&this.revokeWebSocket(),this.connect({immediate:n});case 3:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"revokeWebSocket",value:function(){var e=this;if(this.emit("disconnected"),this.hasWebSocket()){this.logger.info("trashing the previous websocket"),this.websocket.onmessage=null,this.websocket.onerror=function(t){e.logger.error("Error while trying to close the websocket: ".concat(t.message))},this.websocket.onopen=null,this.websocket.onclose=null;try{this.websocket.close()}catch(e){}finally{this.websocket=null}}else this.logger.error("Trying to revoke a websocket that is not attached. This should not happen")}},{key:"stop",value:function(){this.isStarted&&(this.logger.info("stopped"),this.unsubscribeCordovaEvents(),this.unsubscribeGlobalEvents(),this.unsubscribeClientEvents(),this.hasWebSocket()&&this.revokeWebSocket(),this.isStarted=!1,!this.subscriptions.isEmpty()&&this.unsubscribeAll(),this.emit("close"))}},{key:"authenticate",value:function(){if(this.isWebSocketOpen()){var e=(0,y.getToken)(this.client);this.logger.debug("authenticate with",e),this.sendWebSocketMessage("AUTH",e),this.websocket.authenticated=!0}else this.logger.error("Trying to authenticate to a non-opened websocket. This should not happen.",this.websocket,this.websocket&&this.websocket.readyState)}},{key:"sendWebSocketMessage",value:function(e,t){var n=JSON.stringify({method:e,payload:t});this.websocket.send(n)}},{key:"sendNotification",value:(n=(0,o.default)(a.default.mark(function e(t,n,r){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.getStackClient().fetchJSON("POST","/realtime/".concat(t,"/").concat(n),{data:r}));case 1:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"send",value:function(){return!this.sendDeprecationNoticeSent&&(this.sendDeprecationNoticeSent=!0,this.logger.warn("Deprecation notice: CozyRealtime.send() is deprecated, please use CozyRealtime.sendNotification() from now on")),this.sendNotification.apply(this,arguments)}},{key:"waitForSocketReady",value:(r=(0,o.default)(a.default.mark(function e(){var t=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWebSocketAuthenticated()){e.next=2;break}return e.abrupt("return",!0);case 2:return e.abrupt("return",new Promise(function(e,n){t.once("ready",e),t.once("close",n)}));case 3:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"hasWebSocket",value:function(){return!!this.websocket}},{key:"isWebSocketOpen",value:function(){return!!(this.hasWebSocket()&&this.websocket.readyState===WebSocket.OPEN)}},{key:"isWebSocketAuthenticated",value:function(){return!!(this.isWebSocketOpen()&&this.websocket.authenticated)}},{key:"subscribe",value:function(e,t,n,r){this.start();var a=this.normalizeSubscription(e,t,n,r),i=this.subscriptions.hasSameTypeAndId(a);this.subscriptions.add(a),!i&&this.isWebSocketAuthenticated()&&this.sendSubscription(a.type,a.id)}},{key:"unsubscribe",value:function(e,t,n,r){var a=this.normalizeSubscription(e,t,n,r);this.subscriptions.remove(a),!this.subscriptions.hasSameTypeAndId(a)&&this.isWebSocketAuthenticated()&&this.sendUnsubscription(a.type,a.id),this.subscriptions.isEmpty()&&this.stop()}},{key:"unsubscribeAll",value:function(){var e,t=b(this.subscriptions.getAll());try{for(t.s();!(e=t.n()).done;){var n=e.value,r=n.event,a=n.type,i=n.id,o=n.handler;this.unsubscribe(r,a,i,o)}}catch(e){t.e(e)}finally{t.f()}}},{key:"sendSubscriptions",value:function(){var e,t=b(this.subscriptions.getAllTypeAndIdPairs());try{for(t.s();!(e=t.n()).done;){var n=e.value,r=n.type,a=n.id;this.sendSubscription(r,a)}}catch(e){t.e(e)}finally{t.f()}}},{key:"sendSubscription",value:function(e,t){if(this.isWebSocketOpen()){var n=t?{type:e,id:t}:{type:e};this.logger.debug("send subscription to",n.type,n.id),this.sendWebSocketMessage("SUBSCRIBE",n)}else this.logger.error("Trying to subscribe on a non-ready socket. This should not happen. Type and id:",e,t)}},{key:"sendUnsubscription",value:function(e,t){if(this.isWebSocketOpen()){var n=t?{type:e,id:t}:{type:e};this.logger.debug("send unsubscription to",n.type,n.id),this.sendWebSocketMessage("UNSUBSCRIBE",n)}else this.logger.error("Trying to subscribe on a non-ready socket. This should not happen. Type and id:",e,t)}},{key:"normalizeSubscription",value:function(e,t,n,r){return{event:e?e.toUpperCase():e,type:t,id:r?n:null,handler:r||n}}},{key:"bindEventHandlers",value:(i=(0,o.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.onWebSocketMessage=this.onWebSocketMessage.bind(this),this.onWebSocketError=this.onWebSocketError.bind(this),this.onWebSocketOpen=this.onWebSocketOpen.bind(this),this.onWebSocketClose=this.onWebSocketClose.bind(this),this.onClientLogin=this.onClientLogin.bind(this),this.onClientTokenRefreshed=this.onClientTokenRefreshed.bind(this),this.onClientLogout=this.onClientLogout.bind(this),this.onOnline=this.onOnline.bind(this),this.onOffline=this.onOffline.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this),this.onDeviceReady=this.onDeviceReady.bind(this),this.onResume=this.onResume.bind(this);case 12:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"onWebSocketMessage",value:function(e){var t=JSON.parse(e.data),n=t.event,r=t.payload;this.logger.info("receive message from server",{event:n,payload:r});var a,i=b(this.subscriptions.getAllHandlersForEvent(n,r.type,r.id));try{for(i.s();!(a=i.n()).done;){var o=a.value;try{o(m(m({},r.doc),{},{_type:r.type}))}catch(e){this.logger.error("handler did throw for ".concat(n,", ").concat(r.type,", ").concat(r.id))}}}catch(e){i.e(e)}finally{i.f()}"error"===n&&this.logger.warn("Stack returned an error",r)}},{key:"onWebSocketError",value:function(e){this.logger.info("An error was raised on the websocket",e),this.retryManager.onFailure(e),this.reconnect()}},{key:"onWebSocketOpen",value:function(){this.retryManager.onSuccess(),this.authenticate(),this.sendSubscriptions(),this.emit("ready")}},{key:"onWebSocketClose",value:function(e){this.logger.info("The current websocket was closed by a third party",e),this.retryManager.onFailure(e),this.reconnect()}},{key:"subscribeClientEvents",value:function(){this.client.on("login",this.onClientLogin),this.client.on("tokenRefreshed",this.onClientTokenRefreshed),this.client.on("logout",this.onClientLogout)}},{key:"unsubscribeClientEvents",value:function(){this.client.removeListener("login",this.onClientLogin),this.client.removeListener("tokenRefreshed",this.onClientTokenRefreshed),this.client.removeListener("logout",this.onClientLogout)}},{key:"onClientLogin",value:function(){this.logger.info("Received login from cozy-client"),this.isWebSocketOpen()&&(this.authenticate(),this.sendSubscriptions())}},{key:"onClientTokenRefreshed",value:function(){this.hasWebSocket()&&this.revokeWebSocket()}},{key:"onClientLogout",value:function(){this.hasWebSocket()&&this.revokeWebSocket()}},{key:"subscribeCordovaEvents",value:function(){(0,l.isCordova)()&&(document.addEventListener("deviceready",this.onDeviceReady),document.addEventListener("resume",this.onResume))}},{key:"unsubscribeCordovaEvents",value:function(){(0,l.isCordova)()&&(document.removeEventListener("deviceready",this.onDeviceReady),document.removeEventListener("resume",this.onResume))}},{key:"onDeviceReady",value:function(){this.unsubscribeGlobalEvents(),this.subscribeGlobalEvents()}},{key:"onResume",value:function(){this.reconnect({immediate:!0})}},{key:"subscribeGlobalEvents",value:function(){y.hasBrowserContext&&window.addEventListener&&(window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline),window.addEventListener("visibilitychange",this.onVisibilityChange))}},{key:"unsubscribeGlobalEvents",value:function(){y.hasBrowserContext&&window.removeEventListener&&(window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline),window.removeEventListener("visibilitychange",this.onVisibilityChange))}},{key:"onOnline",value:function(){this.logger.info("reconnect because receiving an online event"),this.reconnect({immediate:!0})}},{key:"onOffline",value:function(){this.hasWebSocket()&&this.revokeWebSocket()}},{key:"onVisibilityChange",value:function(){document.visibilityState&&"visible"===document.visibilityState&&this.retryManager.stopCurrentAttemptWaitingTime()}}]),s}();s.default.mixin(k);t.default=k},81935:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(11461)),u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,a.default)(this,e),this.client=t,this.createWebSocket=n.createWebSocket,this.logger=n.logger,this.realtime=null,this.handleLogin=this.handleLogin.bind(this),this.handleLogout=this.handleLogout.bind(this),this.client.on("login",this.handleLogin),this.client.on("logout",this.handleLogout),t.isLogged&&this.handleLogin()}return(0,i.default)(e,[{key:"handleLogin",value:function(){this.realtime=new o.default({client:this.client,createWebSocket:this.createWebSocket,logger:this.logger}),this.client.emit("plugin:realtime:login")}},{key:"handleLogout",value:function(){this.unsubscribeAll(),this.realtime=null,this.client.emit("plugin:realtime:logout")}},{key:"checkRealtimeInstance",value:function(){if(!this.realtime)throw Error("Unable to use realtime while cozy-client is not logged in")}},{key:"subscribe",value:function(){var e;this.checkRealtimeInstance(),(e=this.realtime).subscribe.apply(e,arguments)}},{key:"unsubscribe",value:function(){var e;this.checkRealtimeInstance(),(e=this.realtime).unsubscribe.apply(e,arguments)}},{key:"unsubscribeAll",value:function(){this.checkRealtimeInstance(),this.realtime.unsubscribeAll()}},{key:"sendNotification",value:function(){var e;this.checkRealtimeInstance(),(e=this.realtime).sendNotification.apply(e,arguments)}}]),e}();u.pluginName="realtime";t.default=u},88838:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(37203)),s=n(86540),l=r(n(74268)),d=function(){var e;function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.maxWaitBetweenRetries,r=void 0===n?s.maxWaitBetweenRetries:n,a=e.baseWaitAfterFirstFailure,i=void 0===a?s.baseWaitAfterFirstFailure:a,u=e.timeBeforeSuccessful,c=void 0===u?s.timeBeforeSuccessful:u,d=e.raiseErrorAfterAttempts,f=void 0===d?s.raiseErrorAfterAttempts:d,p=e.logger,h=void 0===p?l.default:p;(0,o.default)(this,t),this.logger=h,this.reset(),this.onSuccess=this.onSuccess.bind(this),this.onFailure=this.onFailure.bind(this),this.onSuccessAcknowledged=this.onSuccessAcknowledged.bind(this),this.raiseErrorAfterAttempts=f,this.timeBeforeSuccessful=c,this.baseWaitAfterFirstFailure=i,this.maxWaitBetweenRetries=r}return(0,u.default)(t,[{key:"onSuccess",value:function(){this.timeBeforeSuccessful>0?this.startSuccessTimer(this.onSuccessAcknowledged,this.timeBeforeSuccessful):this.onSuccessAcknowledged()}},{key:"onSuccessAcknowledged",value:function(){this.emit("success"),this.reset()}},{key:"clearSuccessTimer",value:function(){this.successTimer&&(n.g.clearTimeout(this.successTimer),this.successTimer=null)}},{key:"startSuccessTimer",value:function(e,t){var r=this;!this.successTimer&&(this.successTimer=n.g.setTimeout(function(){r.successTimer=null,e()},t))}},{key:"onFailure",value:function(e){this.logger.debug("failure, increase the failure counter of the retry manager"),this.clearSuccessTimer(),this.increaseFailureCounter(),this.emit("failure",e),this.shouldEmitError()&&this.emit("error",e)}},{key:"shouldEmitError",value:function(){return this.retries>0&&this.retries%this.raiseErrorAfterAttempts==0}},{key:"reset",value:function(){this.logger.debug("reset the retry manager"),this.clearSuccessTimer(),this.retries=0,this.wait=0}},{key:"increaseFailureCounter",value:function(){0===this.retries?this.wait=0:0===this.wait?this.wait=this.baseWaitAfterFirstFailure:this.wait=Math.min(2*this.wait,this.maxWaitBetweenRetries),this.retries=this.retries+1}},{key:"waitBeforeNextAttempt",value:(e=(0,i.default)(a.default.mark(function e(){var t,r,i=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.debug("waitBeforeNextAttempt",this.wait),!this.wait){e.next=5;break}return!this.waiting&&((r=new Promise(function(e){t=function(){i.waiting===r&&(i.waiting=null),e()},n.g.setTimeout(t,i.wait)})).stop=t,this.waiting=r),e.next=5,this.waiting;case 5:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"stopCurrentAttemptWaitingTime",value:function(){this.waiting&&this.waiting.stop()}}]),t}();c.default.mixin(d);t.default=d},77123:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=r(n(18446)),u=r(n(78718)),c=r(n(82257)),s=r(n(82729)),l=r(n(87185)),d=n(86540),f=r(n(74268)),p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.default)(this,e),this.subscriptions=[],this.logger=t.logger||f.default}return(0,i.default)(e,[{key:"add",value:function(e){var t=this.normalize(e);if(!this.subscriptions.find(function(e){return(0,o.default)(e,t)})||(d.onDoubleSubscriptions&&(0,d.onDoubleSubscriptions)(t,{logger:this.logger}),!!d.allowDoubleSubscriptions))this.subscriptions.push(t)}},{key:"remove",value:function(e){var t=this.normalize(e);if(d.requireDoubleUnsubscriptions){var n=this.subscriptions.findIndex(function(e){return(0,o.default)(e,t)});if(n>=0){(0,c.default)(this.subscriptions,n);return}}else{var r=(0,s.default)(this.subscriptions,function(e){return(0,o.default)(e,t)});if(r&&r.length>0)return}this.logger.warn("Trying to unsubscribe to an unknown subscription",t)}},{key:"getAll",value:function(){return this.subscriptions.slice()}},{key:"getAllTypeAndIdPairs",value:function(){return(0,l.default)(this.subscriptions.map(function(e){return(0,u.default)(e,["type","id"])}),o.default)}},{key:"hasSameTypeAndId",value:function(e){var t=e.type,n=e.id,r=t||null,a=n||null;return!!this.subscriptions.find(function(e){return e.type===r&&e.id===a})}},{key:"getAllHandlersForEvent",value:function(e,t,n){var r=this;return this.subscriptions.filter(function(a){return r.isMatchingEvent(a,e,t,n)}).map(function(e){return e.handler})}},{key:"isMatchingEvent",value:function(e,t,n,r){return(!e.event||e.event===t)&&(!e.id||e.id===(r||null))&&(!e.type||e.type===(n||null))&&!0}},{key:"isEmpty",value:function(){return 0===this.subscriptions.length}},{key:"normalize",value:function(e){function t(e){throw this.logger.error(e),Error(e)}return e.event&&!d.eventNames.includes(e.event)&&t("Trying to subscribe to a unknown event name ".concat(e.event)),"function"!=typeof e.handler&&t("Trying to subscribe with a non-function handler ".concat(e.event)),"error"!==e.event&&"string"!=typeof e.type&&t("Trying to subscribe with to non-string type ".concat(e.type)),e.id&&"string"!=typeof e.id&&t("Trying to subscribe with to non-string id ".concat(e.id)),{event:e.event||null,type:e.type||null,id:e.id||null,handler:e.handler||null}}}]),e}();t.default=p},86540:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.timeBeforeSuccessful=t.requireDoubleUnsubscriptions=t.raiseErrorAfterAttempts=t.onDoubleSubscriptions=t.maxWaitBetweenRetries=t.eventNames=t.baseWaitAfterFirstFailure=t.allowDoubleSubscriptions=void 0;var a=r(n(74268));t.maxWaitBetweenRetries=3e5;t.baseWaitAfterFirstFailure=128;t.timeBeforeSuccessful=1200;t.raiseErrorAfterAttempts=8;t.allowDoubleSubscriptions=!0;t.requireDoubleUnsubscriptions=!0;t.onDoubleSubscriptions=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.logger,r=void 0===n?a.default:n;r.warn("Double subscription for ",e),r.info("The handler may be called twice for the same event!"),r.info("Remember to call one `unsubscribe` for each `subscribe`")};t.eventNames=["CREATED","UPDATED","DELETED","NOTIFIED","error"]},72916:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RealtimePlugin",{enumerable:!0,get:function(){return o.default}}),t.default=void 0,Object.defineProperty(t,"useRealtime",{enumerable:!0,get:function(){return i.default}});var a=r(n(11461)),i=r(n(72841)),o=r(n(81935)),u=a.default;t.default=u},74268:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(60732)),i="undefined"!=typeof window&&window.minilog||a.default,o=i("cozy-realtime");o.minilog=a.default,i.enable(),i.suggest.deny("cozy-realtime","warn"),i.suggest.allow("cozy-realtime","warn");t.default=o},72841:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(90402)),u=n(67294);t.default=function(e,t,n){(0,u.useEffect)(function(){if(!e.plugins||!e.plugins.realtime){console.error("[useRealtime] The provided CozyClient instance does not have a RealtimePlugin registered, useRealtime will not work");return}return Object.entries(t).forEach(function(t){var n,r=(0,o.default)(t,2),u=r[0];Object.entries(r[1]).forEach((n=(0,i.default)(a.default.mark(function t(n){var r,i,c;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=(r=(0,o.default)(n,2))[0],c=r[1],t.prev=1,t.next=4,e.plugins.realtime.subscribe(i,u,c);case 4:t.next=10;break;case 6:t.prev=6,t.t0=t.catch(1),console.error(t.t0),console.error("[useRealtime] Impossible to subscribe to ".concat(i," event on ").concat(u,". Does your app have the required permissions on this doctype?"));case 10:case"end":return t.stop()}},t,null,[[1,6]])})),function(e){return n.apply(this,arguments)}))}),function(){Object.entries(t).forEach(function(t){var n,r=(0,o.default)(t,2),u=r[0];Object.entries(r[1]).forEach((n=(0,i.default)(a.default.mark(function t(n){var r,i,c;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=(r=(0,o.default)(n,2))[0],c=r[1],t.prev=1,t.next=4,e.plugins.realtime.unsubscribe(i,u,c);case 4:t.next=10;break;case 6:t.prev=6,t.t0=t.catch(1),console.error(t.t0),console.error("[useRealtime] Impossible to unsubscribe from ".concat(i," event on ").concat(u,". Does your app have the required permissions on this doctype?"));case 10:case"end":return t.stop()}},t,null,[[1,6]])})),function(e){return n.apply(this,arguments)}))})}},n)}},83462:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.createWebSocket=function(e,t){return new WebSocket(e,t)},t.getCozyClientFromOptions=function(e){var t=e.cozyClient,n=e.client,r=e.logger,a=void 0===r?i.default:r;return t?a.warn("Passing a `cozyClient` parameter is deprecated, please use `client` instead"):!n&&a.warn("Realtime must be initialized with a client. Ex: `new Realtime({ client })`"),n||t},t.getToken=function(e){return e.getStackClient().getAccessToken()},t.getUrl=function(e){var t=e.getStackClient().uri,n=t.toString().match("^(https:/{2})")?"wss:":"ws:",r=new URL(t).host;return"".concat(n,"//").concat(r,"/realtime/")},t.hasBrowserContext=void 0,t.isOnline=function(){return!(0,a.default)(n.g,"navigator.onLine")||n.g.navigator.onLine},t.protocol=void 0;var a=r(n(18721)),i=r(n(74268)),o="undefined"!=typeof window;t.hasBrowserContext=o;t.protocol="io.cozy.websocket"},88928:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=function(){function e(t){(0,a.default)(this,e);var n=t;"string"==typeof n&&(n=JSON.parse(n)),this.tokenType=n.token_type||n.tokenType,this.accessToken=n.access_token||n.accessToken,this.refreshToken=n.refresh_token||n.refreshToken,this.scope=n.scope}return(0,i.default)(e,[{key:"toAuthHeader",value:function(){return"Bearer "+this.accessToken}},{key:"toBasicAuth",value:function(){return"user:".concat(this.accessToken,"@")}},{key:"toJSON",value:function(){return{tokenType:this.tokenType,accessToken:this.accessToken,refreshToken:this.refreshToken,scope:this.scope}}},{key:"toString",value:function(){return JSON.stringify(this.toJSON())}},{key:"getAccessToken",value:function(){return this.accessToken}}]),e}();t.default=o},14324:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.normalizeApp=t.APPS_DOCTYPE=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(25665)),s=r(n(27952)),l=r(n(12323)),d=r(n(64512)),f=r(n(27361)),p=n(10513),h=r(n(78140)),y=r(n(67267)),v=n(26070);n(45051);var m=r(n(79271));function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,d.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _="io.cozy.apps";t.APPS_DOCTYPE=_;var O=function(e,t){return k(k({},(0,v.normalizeDoctypeJsonApi)(t)(e)),{},{id:e.id})};t.normalizeApp=O;var w=function(e){(0,c.default)(w,e);var t,n,r,d,y,v,g,k=(t=w,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,l.default)(t);return e=n?Reflect.construct(r,arguments,(0,l.default)(this).constructor):r.apply(this,arguments),(0,s.default)(this,e)});function w(e){var t;return(0,o.default)(this,w),(t=k.call(this,_,e)).endpoint="/apps/",t}return(0,u.default)(w,[{key:"get",value:(r=(0,i.default)(a.default.mark(function e(t,n){var r,i,o,u,c,s,l,d,y=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.indexOf("/")>-1?r=t.split("/")[1]:(m.default.warn("Deprecated: in next versions of cozy-client, it will not be possible to query apps/konnectors only with id, please use the form ".concat(this.doctype,"/").concat(t,"\n\n- Q('io.cozy.apps').getById('banks')\n+ Q('io.cozy.apps').getById('io.cozy.apps/banks')")),r=t),!(n&&n.sources&&(!Array.isArray(n.sources)||0===n.sources.length))){e.next=3;break}throw Error('Invalid "sources" attribute passed in query, please use an array with at least one element.');case 3:i=(0,f.default)(n,"sources",["stack"]),o={stack:function(){return h.default.get(y.stackClient,"".concat(y.endpoint).concat(encodeURIComponent(r)),{normalize:function(e){return O(e,y.doctype)}})},registry:function(){return y.stackClient.fetchJSON("GET",p.registryEndpoint+r)}},u=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(i),e.prev=6,u.s();case 8:if((c=u.n()).done){e.next=27;break}return s=c.value,e.prev=10,e.next=13,o[s]();case 13:if(l=e.sent,!("registry"!==s)){e.next=16;break}return e.abrupt("return",l);case 16:return m.default.warn("The use of source registry is deprecated since it can polute the io.cozy.apps slice. For exemple, if we request data from the registry, than the app will be present in the io.cozy.apps slice and then the isInstalled() will return true.\n\n            Use Q('io.cozy.apps_registry) instead"),d=(0,p.transformRegistryFormatToStackFormat)(l),e.abrupt("return",{data:O(d,this.doctype)});case 21:if(e.prev=21,e.t0=e.catch(10),s!==i[i.length-1]){e.next=25;break}throw e.t0;case 25:e.next=8;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(6),u.e(e.t1);case 32:return e.prev=32,u.f(),e.finish(32);case 35:case"end":return e.stop()}},e,this,[[6,29,32,35],[10,21]])})),function(e,t){return r.apply(this,arguments)})},{key:"all",value:(d=(0,i.default)(a.default.mark(function e(){var t,n=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",this.endpoint);case 2:return t=e.sent,e.abrupt("return",{data:t.data.map(function(e){return O(e,n.doctype)}),meta:{count:t.meta.count},skip:0,next:!1});case 4:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)})},{key:"create",value:(y=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("create() method is not available for applications");case 1:case"end":return e.stop()}},e)})),function(){return y.apply(this,arguments)})},{key:"update",value:(v=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("update() method is not available for applications");case 1:case"end":return e.stop()}},e)})),function(){return v.apply(this,arguments)})},{key:"destroy",value:(g=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("destroy() method is not available for applications");case 1:case"end":return e.stop()}},e)})),function(){return g.apply(this,arguments)})}]),w}(y.default);w.normalizeDoctype=v.normalizeDoctypeJsonApi;t.default=w},20576:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(65105)),i=r(n(19723)),o=function(){function e(t){(0,a.default)(this,e),this.token=t||""}return(0,i.default)(e,[{key:"toAuthHeader",value:function(){return"Bearer "+this.token}},{key:"toBasicAuth",value:function(){return"user:".concat(this.token,"@")}},{key:"getAccessToken",value:function(){return this.token}}]),e}();t.default=o},69736:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.normalizeAppFromRegistry=t.APPS_REGISTRY_DOCTYPE=void 0;var i=a(n(65105)),o=a(n(19723)),u=a(n(25665)),c=a(n(27952)),s=a(n(12323)),l=a(n(68434)),d=a(n(82007)),f=a(n(64512)),p=a(n(67267)),h=n(26070);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,f.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m="io.cozy.apps_registry";t.APPS_REGISTRY_DOCTYPE=m;var b=function(e,t){var n,r="".concat("webapp"===e.type?"io.cozy.apps":"io.cozy.konnectors","/").concat(e.slug),a=v(v({},e.attributes),null===(n=e.latest_version)||void 0===n?void 0:n.manifest);return v({},(0,h.normalizeDoc)(v(v({},e),{},{attributes:a,id:r,_id:r}),t))};t.normalizeAppFromRegistry=b;var g=(r=(0,d.default)(l.default.mark(function e(t,n,r){var a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.fetchJSON("GET","/registry?versionsChannel=".concat(t,"&filter[type]=konnector&limit=500"));case 2:return a=e.sent,e.abrupt("return",{data:a.data.map(function(e){return b(e,n)})});case 4:case"end":return e.stop()}},e)})),function(e,t,n){return r.apply(this,arguments)}),k=function(e){(0,u.default)(h,e);var t,n,r,a,f,p=(t=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);return e=n?Reflect.construct(r,arguments,(0,s.default)(this).constructor):r.apply(this,arguments),(0,c.default)(this,e)});function h(e){var t;return(0,i.default)(this,h),(t=p.call(this,m,e)).endpoint="/registry/",t}return(0,o.default)(h,[{key:"get",value:(r=(0,d.default)(l.default.mark(function e(t){var n,r,a=this;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.startsWith("konnectors/")){e.next=3;break}return n=t.split("/")[1],e.abrupt("return",g(n,this.doctype,this.stackClient));case 3:return e.next=5,this.stackClient.fetchJSON("GET","".concat(this.endpoint).concat(t));case 5:if(r=e.sent,"maintenance"!==t){e.next=8;break}return e.abrupt("return",{data:r.map(function(e){return b(e,a.doctype)})});case 8:return e.abrupt("return",{data:b(r,this.doctype)});case 9:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"create",value:(a=(0,d.default)(l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("create() method is not available for AppsRegistryCollection");case 1:case"end":return e.stop()}},e)})),function(){return a.apply(this,arguments)})},{key:"destroy",value:(f=(0,d.default)(l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("destroy() method is not available for AppsRegistryCollection");case 1:case"end":return e.stop()}},e)})),function(){return f.apply(this,arguments)})}]),h}(p.default);t.default=k},78140:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Collection=t.isDocumentUpdateConflict=t.isTimeoutError=t.isNoUsableIndexError=t.isIndexNotUsedWarning=t.isIndexConflictError=t.isIndexNotFoundError=t.dontThrowNotFoundError=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723));n(79312);var c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e.message.match(/not_found/))return Array.isArray(t)?{data:t,meta:{count:0},skip:0,next:!1}:{data:t};throw e};t.dontThrowNotFoundError=c;t.isIndexNotFoundError=function(e){return e.message.match(/no_index/)};t.isIndexConflictError=function(e){return e.message.match(/error_saving_ddoc/)};t.isIndexNotUsedWarning=function(e){return e.match(/was not used because it does not contain a valid index for this query/)};t.isNoUsableIndexError=function(e){return e.message.match(/no_usable_index/)};t.isTimeoutError=function(e){return e.message.match(/context deadline exceeded/)};t.isDocumentUpdateConflict=function(e){return e.message.match(/Document update conflict/)};var s=function(){var e;function t(){(0,o.default)(this,t)}return(0,u.default)(t,null,[{key:"get",value:(e=(0,i.default)(a.default.mark(function e(t,n,r){var i,o,u,s,l;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=void 0===(i=r.normalize)?function(e,t){return e}:i,s=void 0===(u=r.method)?"GET":u,e.prev=1,e.next=4,t.fetchJSON(s,n);case 4:return l=e.sent,e.abrupt("return",{data:o(l.data,l)});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",c(e.t0,null));case 11:case"end":return e.stop()}},e,null,[[1,8]])})),function(t,n,r){return e.apply(this,arguments)})}]),t}();t.Collection=s;t.default=s},25454:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.CONTACTS_DOCTYPE=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(59655)),s=r(n(25665)),l=r(n(27952)),d=r(n(12323)),f=r(n(64512)),p=r(n(67267)),h=n(26070);n(41315);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,f.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m="io.cozy.contacts";t.CONTACTS_DOCTYPE=m;var b=(0,h.normalizeDoctypeJsonApi)(m),g=function(e){var t;return v(v({},b(e)),{},{_rev:null==e?void 0:null===(t=e.meta)||void 0===t?void 0:t.rev})},k=function(e){(0,s.default)(y,e);var t,n,r,f,p,h=(t=y,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,d.default)(t);return e=n?Reflect.construct(r,arguments,(0,d.default)(this).constructor):r.apply(this,arguments),(0,l.default)(this,e)});function y(){return(0,o.default)(this,y),h.apply(this,arguments)}return(0,u.default)(y,[{key:"find",value:(r=(0,i.default)(a.default.mark(function e(t,n){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(void 0!==t&&1===Object.values(t).length&&!0==t.me)){e.next=4;break}return e.abrupt("return",this.findMyself());case 4:return e.abrupt("return",(0,c.default)((0,d.default)(y.prototype),"find",this).call(this,t,n));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"findMyself",value:(f=(0,i.default)(a.default.mark(function e(){var t;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST","/contacts/myself");case 2:return t={data:[g(e.sent.data)],next:!1,meta:null,bookmark:!1},e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"destroy",value:(p=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object.keys((null==t?void 0:null===(n=t.cozyMetadata)||void 0===n?void 0:n.sync)||{}).length>0)){e.next=6;break}return e.abrupt("return",(0,c.default)((0,d.default)(y.prototype),"update",this).call(this,v(v({},t),{},{trashed:!0})));case 6:return e.abrupt("return",(0,c.default)((0,d.default)(y.prototype),"destroy",this).call(this,t));case 7:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})}]),y}(p.default);t.default=k},29328:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(68434)),o=a(n(82007)),u=a(n(64512)),c=a(n(65105)),s=a(n(19723)),l=a(n(50361)),d=r(n(14324)),f=a(n(20576));a(n(88928));var p=a(n(67267)),h=a(n(49129)),y=r(n(54056)),v=r(n(76812)),m=a(n(67207)),b=a(n(96302)),g=r(n(54026)),k=r(n(96727)),_=r(n(45082)),O=r(n(54348)),w=r(n(86247)),S=r(n(25454)),x=r(n(69736)),E=a(n(79954)),P=a(n(66605)),C=n(38558),D=a(n(37203)),j=r(n(45051)),A=a(n(79271)),T=a(n(20368)),R=n(68512);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var N=function(e){var t=e;if(null===t)return null;for(;"/"===t[t.length-1];)t=t.slice(0,-1);return t},F=function(){var e,t,r,a;function u(e){(0,c.default)(this,u);var t=M({},e),n=t.token,r=t.uri;this.options=t,this.setUri(void 0===r?"":r),this.setToken(n),this.konnectors=new v.default(this),this.jobs=new y.default(this),this._promiseCache=new T.default}return(0,s.default)(u,[{key:"isRevocationError",value:function(e){return(null==e?!!void 0:!!e.message)&&(!!(j.default.CLIENT_NOT_FOUND.test(e.message)||j.default.UNREGISTERED_CLIENT.test(e.message))||void 0)}},{key:"collection",value:function(e){if(!e)throw Error("CozyStackClient.collection() called without a doctype");switch(e){case d.APPS_DOCTYPE:return new d.default(this);case v.KONNECTORS_DOCTYPE:return new v.default(this);case"io.cozy.files":return new h.default(e,this);case"io.cozy.sharings":return new m.default(e,this);case"io.cozy.permissions":return new b.default(e,this);case S.CONTACTS_DOCTYPE:return new S.default(e,this);case g.TRIGGERS_DOCTYPE:return new g.default(this);case y.JOBS_DOCTYPE:return new y.default(this);case k.SETTINGS_DOCTYPE:return new k.default(this);case _.NOTES_DOCTYPE:return new _.default(this);case O.OAUTH_CLIENTS_DOCTYPE:return new O.default(this);case w.SHORTCUTS_DOCTYPE:return new w.default(this);case x.APPS_REGISTRY_DOCTYPE:return new x.default(this);case R.NEXTCLOUD_FILES_DOCTYPE:return new R.NextcloudFilesCollection(this);default:return new p.default(e,this)}}},{key:"fetch",value:function(e){function t(t,n,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((e=(0,o.default)(i.default.mark(function e(t,n,r){var a,o,u,c,s,l,d=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(o=M({},a=d.length>3&&void 0!==d[3]?d[3]:{})).method=t,u=o.headers=M({},a.headers),"GET"!==t&&"HEAD"!==t&&void 0!==r&&u["Content-Type"]&&(o.body=r),!u.Authorization&&(u.Authorization=this.getAuthorizationHeader()),o.credentials=o.credentials||"include",c=this.fullpath(n),s=(0,C.shouldXMLHTTPRequestBeUsed)(t,n,o)?C.fetchWithXMLHttpRequest:fetch,e.prev=9,e.next=12,s(c,o);case 12:return!(l=e.sent).ok&&this.emit("error",new j.FetchError(l,"".concat(l.status," ").concat(l.statusText))),e.abrupt("return",l);case 17:throw e.prev=17,e.t0=e.catch(9),this.isRevocationError(e.t0)&&this.onRevocationChange(!0),e.t0;case 21:case"end":return e.stop()}},e,this,[[9,17]])})),function(t,n,r){return e.apply(this,arguments)}))},{key:"onTokenRefresh",value:function(e){this.options&&this.options.onTokenRefresh&&this.options.onTokenRefresh(e)}},{key:"onRevocationChange",value:function(e){this.options&&this.options.onRevocationChange&&this.options.onRevocationChange(e)}},{key:"refreshToken",value:(t=(0,o.default)(i.default.mark(function e(){var t,r,a,o,u,c,s,l;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.token){e.next=2;break}throw Error("Cannot refresh an empty token");case 2:if(t={method:"GET",credentials:"include"},n.g.document){e.next=5;break}throw Error("Not in a web context, cannot refresh token");case 5:return e.next=7,fetch("/?refreshToken",t);case 7:if((r=e.sent).ok){e.next=10;break}throw Error("couldn't fetch a new token - response "+r.statusCode);case 10:return e.next=12,r.text();case 12:if(a=e.sent,o=new DOMParser().parseFromString(a,"text/html")){e.next=17;break}throw Error("couldn't fetch a new token - doc is not html");case 17:if(u=o.querySelector('div[role="application"]')){e.next=20;break}throw Error("couldn't fetch a new token - no div[role=application]");case 20:if((s=(c=u.dataset.cozy?JSON.parse(u.dataset.cozy):M({},u.dataset)).token)&&(s=s||c.cozyToken),s){e.next=25;break}throw Error("couldn't fetch a new token -- missing data-cozy or data-cozy-token attribute");case 25:return l=new f.default(s),this.setToken(l),this.onTokenRefresh(l),e.abrupt("return",l);case 29:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"fetchJSON",value:(r=(0,o.default)(i.default.mark(function e(t,n,r){var a=this,o,u=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=u.length>3&&void 0!==u[3]?u[3]:{},e.prev=1,e.next=4,this.fetchJSONWithCurrentToken(t,n,r,o);case 4:case 20:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),!(j.default.EXPIRED_TOKEN.test(e.t0.message)||j.default.INVALID_TOKEN.test(e.t0.message)||j.default.INVALID_TOKEN_ALT.test(e.t0.message))){e.next=23;break}return e.prev=10,e.next=13,this._promiseCache.exec(function(){return a.refreshToken()},function(){return"refreshToken"});case 13:e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(10),e.t0;case 18:return e.next=20,this.fetchJSONWithCurrentToken(t,n,r,o);case 23:throw e.t0;case 24:case"end":return e.stop()}},e,this,[[1,7],[10,15]])})),function(e,t,n){return r.apply(this,arguments)})},{key:"fetchJSONWithCurrentToken",value:(a=(0,o.default)(i.default.mark(function e(t,n,r){var a,o,u,c,s,d,f,p,h=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.length>3&&void 0!==h[3]?h[3]:{},(u=(o=(0,l.default)(a)).headers=o.headers||{}).Accept="application/json",c=r,"GET"!==t&&"HEAD"!==t&&void 0!==c&&!u["Content-Type"]&&(u["Content-Type"]="application/json",c=JSON.stringify(c)),e.next=8,this.fetch(t,n,c,o);case 8:return f=(d=(s=e.sent).headers.get("content-type"))&&d.indexOf("json")>=0,e.next=13,f?s.json():s.text();case 13:if(p=e.sent,!s.ok){e.next=16;break}return e.abrupt("return",p);case 16:throw new j.FetchError(s,p);case 17:case"end":return e.stop()}},e,this)})),function(e,t,n){return a.apply(this,arguments)})},{key:"fullpath",value:function(e){return e.startsWith("http")?e:this.uri+e}},{key:"getAuthorizationHeader",value:function(){return this.token?this.token.toAuthHeader():null}},{key:"setCredentials",value:function(e){return(0,P.default)("CozyStackClient::setCredentials is deprecated, use CozyStackClient::setToken"),this.setToken(e)}},{key:"getCredentials",value:function(){return(0,P.default)("CozyStackClient::getCredentials is deprecated, use CozyStackClient::getAuthorizationHeader"),this.getAuthorizationHeader()}},{key:"setToken",value:function(e){if(e){if(e.toAuthHeader)this.token=e;else if("string"==typeof e)this.token=new f.default(e);else throw A.default.warn("Cozy-Client: Unknown token format",e),Error("Cozy-Client: Unknown token format");this.onRevocationChange(!1)}else this.token=null}},{key:"getAccessToken",value:function(){return this.token&&this.token.getAccessToken()}},{key:"setUri",value:function(e){this.uri=N(e)}},{key:"getIconURL",value:function(e){return(0,E.default)(this,e)}}]),u}();D.default.mixin(F);t.default=F},67267:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(80295)),o=a(n(98235)),u=a(n(64512)),c=a(n(68434)),s=a(n(41)),l=a(n(82007)),d=a(n(65105)),f=a(n(19723)),p=a(n(71400)),h=n(66804),y=a(n(44908)),v=a(n(57557)),m=a(n(91175)),b=a(n(82492)),g=a(n(10240)),k=a(n(80129)),_=n(35946),O=n(26070),w=r(n(78140)),S=r(n(93726));n(45051);var x=a(n(79271));function E(){var e=(0,s.default)(["/data/","/_design/","/copy?rev=",""]);return E=function(){return e},e}function P(){var e=(0,s.default)(["/data/","/_design/","?rev=",""]);return P=function(){return e},e}function C(){var e=(0,s.default)(["/data/","/_design_docs?include_docs=true"]);return C=function(){return e},e}function D(){var e=(0,s.default)(["/data/","/_index"]);return D=function(){return e},e}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function A(){var e=(0,s.default)(["/data/","/","?rev=",""]);return A=function(){return e},e}function T(){var e=(0,s.default)(["/data/","/",""]);return T=function(){return e},e}function R(){var e=(0,s.default)(["/data/","/",""]);return R=function(){return e},e}function I(){var e=(0,s.default)(["/data/","/_all_docs?include_docs=true"]);return I=function(){return e},e}function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function F(){var e=(0,s.default)(["/data/","/_find"]);return F=function(){return e},e}function L(){var e=(0,s.default)(["/data/","/",""]);return L=function(){return e},e}var B=function(e){return Object.assign({},(0,v.default)(e,"_type"),{_deleted:!0})},z=function(){var e,t,n,r,a,s,M,z,U,q,G,Q,H,J,Y,W,K,V,$,Z,X,ee;function et(e,t){(0,d.default)(this,et),this.doctype=e,this.stackClient=t,this.indexes={},this.endpoint="/data/".concat(this.doctype,"/")}return(0,f.default)(et,[{key:"all",value:(e=(0,l.default)(c.default.mark(function e(){var t=this,n,r,a,i,o,u,s,l,d,f,p,y,v,m,b,k=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(r=(n=k.length>0&&void 0!==k[0]?k[0]:{}).limit)?100:r,o=void 0===(i=n.skip)?0:i,u=n.bookmark,d=(l=!!(s=n.keys)||null===a)?"_all_docs":"_normal_docs",f=(0,h.uri)(L(),this.doctype,d),p={include_docs:!0,limit:a,skip:o,keys:s,bookmark:u},y=S.buildURL(f,p),e.prev=6,e.next=9,this.stackClient.fetchJSON("GET",y);case 9:v=e.sent,e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(6),e.abrupt("return",(0,w.dontThrowNotFoundError)(e.t0));case 15:return m=l?v.rows.filter(function(e){return e&&null!==e.doc&&!e.error&&!(0,g.default)(e.id,"_design")}).map(function(e){return(0,O.normalizeDoc)(e.doc,t.doctype)}):v.rows.map(function(e){return(0,O.normalizeDoc)(e,t.doctype)}),b=u?v.rows.length>=a:o+v.rows.length<v.total_rows,e.abrupt("return",{data:m,meta:{count:l?m.length:v.total_rows},skip:o,bookmark:v.bookmark,next:b});case 18:case"end":return e.stop()}},e,this,[[6,12]])})),function(){return e.apply(this,arguments)})},{key:"fetchDocumentsWithMango",value:(t=(0,l.default)(c.default.mark(function e(t,n){var r,a=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",this.stackClient.fetchJSON("POST",t,this.toMangoOptions(n,r)));case 2:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"migrateIndex",value:(n=(0,l.default)(c.default.mark(function e(t,n){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.copyIndex(t,n);case 3:return e.next=5,this.destroyIndex(t);case 5:e.next=16;break;case 7:if(e.prev=7,e.t0=e.catch(0),(0,w.isDocumentUpdateConflict)(e.t0)){e.next=11;break}throw e.t0;case 11:return(0,h.sleep)(1e3),e.next=14,this.copyIndex(t,n);case 14:return e.next=16,this.destroyIndex(t);case 16:case"end":return e.stop()}},e,this,[[0,7]])})),function(e,t){return n.apply(this,arguments)})},{key:"handleMissingIndex",value:(r=(0,l.default)(c.default.mark(function e(t,n){var r,a,i,o;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.indexedFields,a=n.partialFilter,!r&&(r=(0,_.getIndexFields)({sort:n.sort,selector:t})),i=(0,_.getIndexNameFromFields)(r,a),e.next=5,this.findExistingIndex(t,n);case 5:if(o=e.sent){e.next=11;break}return e.next=9,this.createIndex(r,{partialFilter:a,indexName:i});case 9:case 14:e.next=17;break;case 11:if(!(o._id!=="_design/".concat(i))){e.next=16;break}return e.next=14,this.migrateIndex(o,i);case 16:throw Error("Index unusable for query, index used: ".concat(i));case 17:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"findWithMango",value:(a=(0,l.default)(c.default.mark(function e(t,n){var r,a,i,o,u=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:{},e.prev=1,e.next=4,this.fetchDocumentsWithMango(t,n,r);case 4:if(!((o=(a=e.sent).warning||(null===(i=a.meta)||void 0===i?void 0:i.warning))&&r.partialFilter&&(0,w.isIndexNotUsedWarning)(o))){e.next=8;break}throw Error("no_index");case 8:e.next=21;break;case 10:if(e.prev=10,e.t0=e.catch(1),!((0,w.isIndexNotFoundError)(e.t0)||(0,w.isNoUsableIndexError)(e.t0)||(0,w.isTimeoutError)(e.t0))){e.next=20;break}return e.next=15,this.handleMissingIndex(n,r);case 15:return e.next=17,this.fetchDocumentsWithMango(t,n,r);case 17:a=e.sent,e.next=21;break;case 20:throw e.t0;case 21:return e.abrupt("return",a);case 22:case"end":return e.stop()}},e,this,[[1,10]])})),function(e,t){return a.apply(this,arguments)})},{key:"find",value:(s=(0,l.default)(c.default.mark(function e(t){var n=this,r,a,i,o,u,s=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0===(a=(r=s.length>1&&void 0!==s[1]?s[1]:{}).skip)?0:a,e.prev=2,u=(0,h.uri)(F(),this.doctype),e.next=6,this.findWithMango(u,t,r);case 6:o=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",(0,w.dontThrowNotFoundError)(e.t0));case 12:return e.abrupt("return",{data:o.docs.map(function(e){return(0,O.normalizeDoc)(e,n.doctype)}),next:o.next,skip:i,bookmark:o.bookmark,execution_stats:o.execution_stats});case 13:case"end":return e.stop()}},e,this,[[2,9]])})),function(e){return s.apply(this,arguments)})},{key:"findAll",value:(M=(0,l.default)(c.default.mark(function e(t){var n,r,a,i,u,s=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=s.length>1&&void 0!==s[1]?s[1]:{},r=!0,a=[],i=n.bookmark||void 0;case 4:if(!r){e.next=13;break}return e.next=7,this.find(t,N(N({},n),{},{bookmark:i}));case 7:u=e.sent,a.push.apply(a,(0,o.default)(u.data)),i=u.bookmark,r=u.next,e.next=4;break;case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)})),function(e){return M.apply(this,arguments)})},{key:"get",value:(z=(0,l.default)(c.default.mark(function e(t){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w.default.get(this.stackClient,"".concat(this.endpoint).concat(encodeURIComponent(t)),{normalize:this.constructor.normalizeDoctype(this.doctype)}));case 1:case"end":return e.stop()}},e,this)})),function(e){return z.apply(this,arguments)})},{key:"getAll",value:(U=(0,l.default)(c.default.mark(function e(t){var n,r,a=this;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stackClient.fetchJSON("POST",(0,h.uri)(I(),this.doctype),{keys:t});case 3:n=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",(0,w.dontThrowNotFoundError)(e.t0));case 9:return r=n.rows.filter(function(e){return e.doc}),e.abrupt("return",{data:r.map(function(e){return(0,O.normalizeDoc)(e.doc,a.doctype)}),meta:{count:r.length}});case 11:case"end":return e.stop()}},e,this,[[0,6]])})),function(e){return U.apply(this,arguments)})},{key:"create",value:(q=(0,l.default)(c.default.mark(function e(t){var n,r,a,o,u,s,l;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id,t._type,a=(0,i.default)(t,["_id","_type"]),u=(o=!!n)?"PUT":"POST",s=(0,h.uri)(R(),this.doctype,o?n:""),e.next=6,this.stackClient.fetchJSON(u,s,a);case 6:return l=e.sent,e.abrupt("return",{data:(0,O.normalizeDoc)(l.data,this.doctype)});case 8:case"end":return e.stop()}},e,this)})),function(e){return q.apply(this,arguments)})},{key:"update",value:(G=(0,l.default)(c.default.mark(function e(t){var n;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("PUT",(0,h.uri)(T(),this.doctype,t._id),t);case 2:return n=e.sent,e.abrupt("return",{data:(0,O.normalizeDoc)(n.data,this.doctype)});case 4:case"end":return e.stop()}},e,this)})),function(e){return G.apply(this,arguments)})},{key:"destroy",value:(Q=(0,l.default)(c.default.mark(function e(t){var n,r,a,o;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id,r=t._rev,a=(0,i.default)(t,["_id","_rev"]),e.next=3,this.stackClient.fetchJSON("DELETE",(0,h.uri)(A(),this.doctype,n,r));case 3:return o=e.sent,e.abrupt("return",{data:(0,O.normalizeDoc)(N(N({},a),{},{_id:n,_rev:o.rev,_deleted:!0}),this.doctype)});case 5:case"end":return e.stop()}},e,this)})),function(e){return Q.apply(this,arguments)})},{key:"updateAll",value:(H=(0,l.default)(c.default.mark(function e(t){var n,r,a,i,o;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.stackClient,!(!(r=t?t.map(function(e){return(0,v.default)(e,"_type")}):t)||!r.length)){e.next=4;break}return e.abrupt("return",Promise.resolve([]));case 4:return e.prev=4,e.next=7,n.fetchJSON("POST","/data/".concat(this.doctype,"/_bulk_docs"),{docs:r});case 7:return a=e.sent,e.abrupt("return",a);case 11:if(e.prev=11,e.t0=e.catch(4),!(e.t0.reason&&e.t0.reason.reason&&"Database does not exist."===e.t0.reason.reason)){e.next=24;break}return e.next=16,this.create(r[0]);case 16:return i=e.sent,e.next=19,this.updateAll(r.slice(1));case 19:return(o=e.sent).unshift({ok:!0,id:i._id,rev:i._rev}),e.abrupt("return",o);case 24:throw e.t0;case 25:case"end":return e.stop()}},e,this,[[4,11]])})),function(e){return H.apply(this,arguments)})},{key:"destroyAll",value:function(e){return this.updateAll(e.map(B))}},{key:"toMangoOptions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.sort,r=t.indexedFields,a=t.partialFilter,i=t.fields,c=t.skip,s=t.limit,l=t.bookmark;n=(0,_.transformSort)(n),!r&&e&&x.default.warn("Selector fields should be manually indexed to prevent unexpected behaviour"),r=r||(0,_.getIndexFields)({sort:n,selector:e});var d=t.indexId||"_design/".concat((0,_.getIndexNameFromFields)(r,a));if(n){var f=(0,y.default)(n.map(function(e){return(0,m.default)(Object.values(e))}));if(f.length>1)throw Error("Mango sort can only use a single order (asc or desc).");var h,v=f.length>0?(0,m.default)(f):"asc",g=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(r);try{for(g.s();!(h=g.n()).done;)!function(){var e=h.value;!n.find(function(t){return(0,m.default)(Object.keys(t))===e})&&n.push((0,u.default)({},e,v))}()}catch(e){g.e(e)}finally{g.f()}}return{selector:a?(0,b.default)(N({},e),a):e,use_index:d,fields:i?[].concat((0,o.default)(i),["_id","_rev"]):void 0,limit:s,skip:void 0===c?0:c,bookmark:t.bookmark||l,sort:n,execution_stats:!!(0,p.default)("debug")||void 0}}},{key:"checkUniquenessOf",value:(J=(0,l.default)(c.default.mark(function e(t,n){var r,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUniqueIndexId(t);case 2:return r=e.sent,e.next=5,this.find((0,u.default)({},t,n),{indexId:r,fields:["_id"]});case 5:return a=e.sent,e.abrupt("return",0===a.data.length);case 7:case"end":return e.stop()}},e,this)})),function(e,t){return J.apply(this,arguments)})},{key:"getUniqueIndexId",value:function(e){return this.getIndexId([e],{indexName:"".concat(this.doctype,"/").concat(e)})}},{key:"getIndexId",value:(Y=(0,l.default)(c.default.mark(function e(t,n){var r,a,i,o,u;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=void 0===(r=n.partialFilter)?"":r,o=void 0===(i=n.indexName)?(0,_.getIndexNameFromFields)(t):i,this.indexes[o]){e.next=20;break}return e.prev=2,e.next=5,this.createIndex(t,{partialFilter:a});case 5:u=e.sent,e.next=19;break;case 8:if(e.prev=8,e.t0=e.catch(2),(0,w.isIndexConflictError)(e.t0)){e.next=14;break}throw e.t0;case 14:return e.next=16,(0,h.sleep)(1e3);case 16:return e.next=18,this.createIndex(t,{partialFilter:a});case 18:u=e.sent;case 19:this.indexes[o]=u;case 20:return e.abrupt("return",this.indexes[o].id);case 21:case"end":return e.stop()}},e,this,[[2,8]])})),function(e,t){return Y.apply(this,arguments)})},{key:"createIndex",value:(W=(0,l.default)(c.default.mark(function e(t){var n,r,a,i,o,u,s,l,d=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=d.length>1&&void 0!==d[1]?d[1]:{}).partialFilter,a=n.indexName,i={index:{fields:t}},a&&(i.ddoc=a),r&&(i.index.partial_filter_selector=r),e.prev=4,e.next=7,this.stackClient.fetchJSON("POST",(0,h.uri)(D(),this.doctype),i);case 7:o=e.sent,e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(4),(0,w.isIndexConflictError)(e.t0)){e.next=16;break}throw e.t0;case 16:return e.abrupt("return");case 17:if(u={id:o.id,fields:t},"exists"!==o.result){e.next=20;break}return e.abrupt("return",u);case 20:return s={},t.forEach(function(e){return s[e]={$gt:null}}),l={indexId:u.id,limit:1,partialFilterFields:r?(0,_.getIndexFields)({partialFilter:r}):null},e.next=25,(0,h.attempt)(this.find(s,l));case 25:if(!e.sent){e.next=27;break}return e.abrupt("return",u);case 27:return e.next=29,(0,h.sleep)(1e3);case 29:return e.next=31,(0,h.attempt)(this.find(s,l));case 31:if(!e.sent){e.next=33;break}return e.abrupt("return",u);case 33:return e.next=35,(0,h.sleep)(500);case 35:return e.abrupt("return",u);case 36:case"end":return e.stop()}},e,this,[[4,10]])})),function(e){return W.apply(this,arguments)})},{key:"fetchAllMangoIndexes",value:(K=(0,l.default)(c.default.mark(function e(){var t,n;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,h.uri)(C(),this.doctype),e.next=3,this.stackClient.fetchJSON("GET",t);case 3:return n=e.sent,e.abrupt("return",n.rows.filter(function(e){return"query"===e.doc.language}).map(function(e){return(0,_.normalizeDesignDoc)(e)}));case 5:case"end":return e.stop()}},e,this)})),function(){return K.apply(this,arguments)})},{key:"destroyIndex",value:(V=(0,l.default)(c.default.mark(function e(t){var n,r,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id.split("/")[1],r=t._rev,a=(0,h.uri)(P(),this.doctype,n,r),e.abrupt("return",this.stackClient.fetchJSON("DELETE",a));case 4:case"end":return e.stop()}},e,this)})),function(e){return V.apply(this,arguments)})},{key:"copyIndex",value:($=(0,l.default)(c.default.mark(function e(t,n){var r,a,i,o;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t._id.split("/")[1],a=t._rev,i=(0,h.uri)(E(),this.doctype,r,a),o={headers:{Destination:"_design/".concat(n)}},e.abrupt("return",this.stackClient.fetchJSON("POST",i,null,o));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return $.apply(this,arguments)})},{key:"findExistingIndex",value:(Z=(0,l.default)(c.default.mark(function e(t,n){var r,a,i,o,u,s;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.sort,a=n.indexedFields,i=n.partialFilter,e.next=3,this.fetchAllMangoIndexes();case 3:if(!((o=e.sent).length<1)){e.next=6;break}return e.abrupt("return",null);case 6:return r=(0,_.transformSort)(r),u=a||(0,_.getIndexFields)({sort:r,selector:t}),s=o.find(function(e){return(0,_.isMatchingIndex)(e,u,i)}),e.abrupt("return",s);case 10:case"end":return e.stop()}},e,this)})),function(e,t){return Z.apply(this,arguments)})},{key:"fetchChangesRaw",value:(X=(0,l.default)(c.default.mark(function e(t){var n,r,a,i,o,u;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.doc_ids&&t.doc_ids.length>0,r="?".concat([k.default.stringify(N(N({},(0,v.default)(t,["doc_ids","includeDocs"])),{},{include_docs:t.includeDocs})),n&&void 0===t.filter?"filter=_doc_ids":void 0].filter(Boolean).join("&")),a=n?"POST":"GET",i="/data/".concat(this.doctype,"/_changes").concat(r),o=n?{doc_ids:t.doc_ids}:void 0,e.next=7,this.stackClient.fetchJSON(a,i,o);case 7:return u=e.sent,e.abrupt("return",u);case 9:case"end":return e.stop()}},e,this)})),function(e){return X.apply(this,arguments)})},{key:"fetchChanges",value:(ee=(0,l.default)(c.default.mark(function e(){var t=this,n,r,a,i,o,u,s=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>0&&void 0!==s[0]?s[0]:{},r=s.length>1&&void 0!==s[1]?s[1]:{},a={includeDocs:!0},"object"!=typeof n?(a.since=n,x.default.warn('fetchChanges use couchOptions as Object not a string, since is deprecated, please use fetchChanges({since: "'.concat(n,'"}).'))):Object.keys(n).length>0&&Object.assign(a,n),e.next=6,this.fetchChangesRaw(a);case 6:return o=(i=e.sent).last_seq,u=i.results.map(function(e){return e.doc}).filter(Boolean),!r.includeDesign&&(u=u.filter(function(e){return 0!==e._id.indexOf("_design")})),!r.includeDeleted&&(u=u.filter(function(e){return!e._deleted})),e.abrupt("return",{newLastSeq:o,documents:u.map(function(e){return(0,O.normalizeDoc)(e,t.doctype)})});case 12:case"end":return e.stop()}},e,this)})),function(){return ee.apply(this,arguments)})}],[{key:"normalizeDoctype",value:function(e){return(0,O.normalizeDoctypeRawApi)(e)}}]),et}();t.default=z},49129:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isDirectory=t.isFile=void 0;var i=a(n(80295)),o=a(n(68434)),u=a(n(41)),c=a(n(82007)),s=a(n(65105)),l=a(n(19723)),d=a(n(8997)),f=a(n(25665)),p=a(n(27952)),h=a(n(12323)),y=a(n(64512)),v=a(n(12109)),m=a(n(18721)),b=a(n(27361)),g=a(n(57557)),k=a(n(78718));n(35946);var _=a(n(67267)),O=n(26070),w=n(66804);n(45051);var S=n(78140),x=n(77069),E=r(n(93726)),P=a(n(79271));function C(){var e=(0,u.default)(["/files/_changes"]);return C=function(){return e},e}function D(){var e=(0,u.default)(["/data/","/","/relationships/not_synchronizing"]);return D=function(){return e},e}function j(){var e=(0,u.default)(["/data/","/","/relationships/not_synchronizing"]);return j=function(){return e},e}function A(){var e=(0,u.default)(["/data/","/","/relationships/not_synchronizing"]);return A=function(){return e},e}function T(){var e=(0,u.default)(["/files/","/versions"]);return T=function(){return e},e}function R(){var e=(0,u.default)(["/files/upload/metadata"]);return R=function(){return e},e}function I(){var e=(0,u.default)(["/files/",""]);return I=function(){return e},e}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function N(){var e=(0,u.default)(["/files/","?Name=","&Type=directory&MetadataID=",""]);return N=function(){return e},e}function F(){var e=(0,u.default)(["/files/metadata?Path=",""]);return F=function(){return e},e}function L(){var e=(0,u.default)(["/files/",""]);return L=function(){return e},e}function B(){var e=(0,u.default)(["/files/downloads?Path=",""]);return B=function(){return e},e}function z(){var e=(0,u.default)(["/files/downloads?VersionId=","&Filename=",""]);return z=function(){return e},e}function U(){var e=(0,u.default)(["/files/downloads?Id=","&Filename=",""]);return U=function(){return e},e}function q(){var e=(0,u.default)(["/files/","?Name=","&Type=file&Executable=","&Encrypted=",""]);return q=function(){return e},e}function G(){var e=(0,u.default)(["/files/","?Name=","&Type=file&Executable=","&Encrypted=","&MetadataID=","&Size=","&SourceAccount=","&SourceAccountIdentifier=",""]);return G=function(){return e},e}function Q(){var e=(0,u.default)(["/files/",""]);return Q=function(){return e},e}function H(){var e=(0,u.default)(["/files/","/copy"]);return H=function(){return e},e}function J(){var e=(0,u.default)(["/files/trash/",""]);return J=function(){return e},e}function Y(){var e=(0,u.default)(["/files/",""]);return Y=function(){return e},e}function W(){var e=(0,u.default)(["/data/","/","/relationships/references"]);return W=function(){return e},e}function K(){var e=(0,u.default)(["/data/","/","/relationships/references"]);return K=function(){return e},e}function V(){var e=(0,u.default)(["/files/","/relationships/referenced_by"]);return V=function(){return e},e}function $(){var e=(0,u.default)(["/files/","/relationships/referenced_by"]);return $=function(){return e},e}function Z(){var e=(0,u.default)(["/data/","/","/relationships/references"]);return Z=function(){return e},e}function X(){var e=(0,u.default)(["/files/_all_docs?include_docs=true"]);return X=function(){return e},e}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach(function(t){(0,y.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var en="io.cozy.files.root-dir",er=(0,O.normalizeDoctypeJsonApi)("io.cozy.files"),ea=function(e){var t;return et(et({},er(e)),{},{_rev:null==e?void 0:null===(t=e.meta)||void 0===t?void 0:t.rev})},ei=function(e){return e?e.map(function(e){return{_type:e.type,_id:e.id}}):[]},eo=function(e){return e&&e.trim()},eu=function(e){var t=eo(e);if("string"!=typeof t||""===t)throw Error("Missing name argument");if("."===e||".."===e)throw Error("Invalid filename: ".concat(e));var n=(0,x.getIllegalCharacters)(t);if(n.length)throw Error("Invalid filename containing illegal character(s): ".concat(n));return t};t.isFile=function(e){var t=e._type,n=e.type;return"io.cozy.files"===t||"directory"===n||"file"===n};t.isDirectory=function(e){return"directory"===e.type};var ec=function(e,t){return new Promise(function(n){e.forEach(function(e){return e.then(function(e){t(e)&&n(!0)})}),Promise.all(e).then(function(){return n(!1)})})},es=function(e){var t=e.lastIndexOf("/");return e.substring(0,t)},el=function(e){(0,f.default)(eB,e);var t,n,r,a,u,_,O,x,ee,er,el,ed,ef,ep,eh,ey,ev,em,eb,eg,ek,e_,eO,ew,eS,ex,eE,eP,eC,eD,ej,eA,eT,eR,eI,eM,eN,eF,eL=(t=eB,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,h.default)(t);return e=n?Reflect.construct(r,arguments,(0,h.default)(this).constructor):r.apply(this,arguments),(0,p.default)(this,e)});function eB(e,t){var n;return(0,s.default)(this,eB),n=eL.call(this,e,t),(0,y.default)((0,d.default)(n),"extractResponseLinkRelated",function(e){var t=e.links&&e.links.related;if(!t)throw Error("No related link in server response");return n.stackClient.fullpath(t)}),(0,y.default)((0,d.default)(n),"forceFileDownload",function(e,t){(0,w.forceDownload)(e,t)}),n.specialDirectories={},n}return(0,l.default)(eB,[{key:"get",value:function(e){return this.statById(e)}},{key:"getAll",value:(r=(0,c.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stackClient.fetchJSON("POST",(0,w.uri)(X()),{keys:t});case 3:n=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",(0,S.dontThrowNotFoundError)(e.t0));case 9:return e.abrupt("return",{data:n.data.map(function(e){return ea(e)}),meta:{count:n.data.length},execution_stats:n.execution_stats});case 10:case"end":return e.stop()}},e,this,[[0,6]])})),function(e){return r.apply(this,arguments)})},{key:"fetchFindFiles",value:(a=(0,c.default)(o.default.mark(function e(t,n){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.stackClient.fetchJSON("POST","/files/_find",this.toMangoOptions(t,n)));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"find",value:(u=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u,c,s,l=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(r=(n=l.length>1&&void 0!==l[1]?l[1]:{}).skip)?0:r,e.prev=2,u="/files/_find",e.next=6,this.findWithMango(u,t,n);case 6:i=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",(0,S.dontThrowNotFoundError)(e.t0));case 12:return c=(0,b.default)(i,"links.next",""),s=new URL("".concat(this.stackClient.uri).concat(c)).searchParams.get("page[cursor]"),e.abrupt("return",{data:i.data.map(function(e){return ea(e)}),meta:i.meta,next:i.meta.count>a+i.data.length,skip:a,bookmark:s||void 0,execution_stats:i.meta.execution_stats});case 16:case"end":return e.stop()}},e,this,[[2,9]])})),function(e){return u.apply(this,arguments)})},{key:"findReferencedBy",value:(_=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u,c,s,l,d=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(r=(n=d.length>1&&void 0!==d[1]?d[1]:{}).skip)?0:r,i=n.limit,u={include:"files","page[limit]":i,"page[cursor]":n.cursor,sort:"datetime"},c=(0,w.uri)(Z(),t._type,t._id),s=E.buildURL(c,u),e.next=6,this.stackClient.fetchJSON("GET",s);case 6:return l=e.sent,e.abrupt("return",{data:ei(l.data),included:l.included?l.included.map(function(e){return ea(e)}):[],next:(0,m.default)(l,"links.next"),meta:l.meta,skip:a});case 8:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"addReferencedBy",value:(O=(0,c.default)(o.default.mark(function e(t,n){var r,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.map(function(e){return{id:e._id,type:e._type}}),e.next=3,this.stackClient.fetchJSON("POST",(0,w.uri)($(),t._id),{data:r});case 3:return a=e.sent,e.abrupt("return",{data:ei(a.data),meta:a.meta});case 5:case"end":return e.stop()}},e,this)})),function(e,t){return O.apply(this,arguments)})},{key:"removeReferencedBy",value:(x=(0,c.default)(o.default.mark(function e(t,n){var r,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.map(function(e){return{id:e._id||e.id,type:e._type||e.type}}),e.next=3,this.stackClient.fetchJSON("DELETE",(0,w.uri)(V(),t._id||t.id),{data:r});case 3:return a=e.sent,e.abrupt("return",{data:ei(a.data),meta:a.meta});case 5:case"end":return e.stop()}},e,this)})),function(e,t){return x.apply(this,arguments)})},{key:"addReferencesTo",value:(ee=(0,c.default)(o.default.mark(function e(t,n){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.map(function(e){return{id:e._id,type:"io.cozy.files"}}),e.abrupt("return",this.stackClient.fetchJSON("POST",(0,w.uri)(K(),t._type,t._id),{data:r}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return ee.apply(this,arguments)})},{key:"removeReferencesTo",value:(er=(0,c.default)(o.default.mark(function e(t,n){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.map(function(e){return{id:e._id,type:"io.cozy.files"}}),e.abrupt("return",this.stackClient.fetchJSON("DELETE",(0,w.uri)(W(),t._type,t._id),{data:r}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return er.apply(this,arguments)})},{key:"destroy",value:(el=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u,c,s=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0===(n=(s.length>1&&void 0!==s[1]?s[1]:{}).ifMatch)?"":n,a=t._id,i=t.relationships,e.next=4,this.stackClient.fetchJSON("DELETE",(0,w.uri)(Y(),a),void 0,{headers:{"If-Match":r}});case 4:if(u=e.sent,!Array.isArray(c=(0,b.default)(i,"referenced_by.data",t.referenced_by))){e.next=9;break}return e.next=9,this.removeReferencedBy(t,c);case 9:return e.abrupt("return",{data:ea(u.data)});case 10:case"end":return e.stop()}},e,this)})),function(e){return el.apply(this,arguments)})},{key:"emptyTrash",value:function(){return this.stackClient.fetchJSON("DELETE","/files/trash")}},{key:"restore",value:function(e){return this.stackClient.fetchJSON("POST",(0,w.uri)(J(),e))}},{key:"copy",value:(ed=(0,c.default)(o.default.mark(function e(t,n,r){var a,i,u,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={name:void 0===n?void 0:eu(n),DirID:r},i=(0,w.uri)(H(),t),u=E.buildURL(i,a),e.next=5,this.stackClient.fetchJSON("POST",u);case 5:return c=e.sent,e.abrupt("return",{data:ea(c.data)});case 7:case"end":return e.stop()}},e,this)})),function(e,t,n){return ed.apply(this,arguments)})},{key:"deleteFilePermanently",value:(ef=(0,c.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("PATCH",(0,w.uri)(Q(),t),{data:{type:"io.cozy.files",id:t,attributes:{permanent_delete:!0}}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return ef.apply(this,arguments)})},{key:"upload",value:(ep=(0,c.default)(o.default.mark(function e(t,n){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureDirectoryExists(n);case 2:return r=e.sent,e.abrupt("return",this.createFile(t,{dirId:r}));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return ep.apply(this,arguments)})},{key:"create",value:(eh=(0,c.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("directory"!==t.type){e.next=4;break}return e.abrupt("return",this.createDirectory(t));case 4:return n=t.data,r=(0,i.default)(t,["data"]),e.abrupt("return",this.createFile(n,r));case 6:case"end":return e.stop()}},e,this)})),function(e){return eh.apply(this,arguments)})},{key:"update",value:(ey=(0,c.default)(o.default.mark(function e(t){var n,r,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.data,r=(0,i.default)(t,["data"]),a=t.id||t._id,!n){e.next=7;break}if("directory"!==t.type){e.next=5;break}throw Error("You cannot pass a data object for a directory");case 5:return r.fileId=a,e.abrupt("return",this.updateFile(n,r));case 7:return e.abrupt("return",this.updateAttributes(a,t));case 8:case"end":return e.stop()}},e,this)})),function(e){return ey.apply(this,arguments)})},{key:"createFile",value:(ev=(0,c.default)(o.default.mark(function e(t){var n,r,a,u,c,s,l,d,f,p,h,y,v,m,b,g,k,_,O=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=O.length>1&&void 0!==O[1]?O[1]:{}).name,u=void 0===(a=n.dirId)?"":a,s=void 0!==(c=n.executable)&&c,d=void 0!==(l=n.encrypted)&&l,f=n.metadata,h=void 0===(p=n.sourceAccount)?"":p,v=void 0===(y=n.sourceAccountIdentifier)?"":y,m=(0,i.default)(n,["name","dirId","executable","encrypted","metadata","sourceAccount","sourceAccountIdentifier"]),!(b=r)&&"string"==typeof t.name&&(b=t.name),b=eu(b),g="",!f){e.next=11;break}return e.next=9,this.createFileMetadata(f);case 9:g=e.sent.data.id;case 11:return k="",m.contentLength&&(k=String(m.contentLength)),_=(0,w.uri)(G(),u,b,s,d,g,k,h,v),e.abrupt("return",this.doUpload(t,_,m));case 15:case"end":return e.stop()}},e,this)})),function(e){return ev.apply(this,arguments)})},{key:"updateFile",value:(em=(0,c.default)(o.default.mark(function e(t){var n,r,a,u,c,s,l,d,f,p,h,y,v,m,b,g=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=void 0!==(r=(n=g.length>1&&void 0!==g[1]?g[1]:{}).executable)&&r,c=void 0!==(u=n.encrypted)&&u,s=n.fileId,d=void 0===(l=n.name)?"":l,f=n.metadata,p=(0,i.default)(n,["executable","encrypted","fileId","name","metadata"]),!(!s||"string"!=typeof s)){e.next=4;break}throw Error("missing fileId argument");case 4:if(!(!(h=d||t.name)||"string"!=typeof h)){e.next=7;break}throw Error("missing name in data argument");case 7:if(y=eu(h),m=(0,w.uri)(q(),s,y,a,c),!f){e.next=15;break}return e.next=12,this.createFileMetadata(f);case 12:v=e.sent.data.id,m+="&MetadataID=".concat(v);case 15:return b="",p.contentLength&&(b=String(p.contentLength),m+="&Size=".concat(b)),e.abrupt("return",this.doUpload(t,m,p,"PUT"));case 18:case"end":return e.stop()}},e,this)})),function(e){return em.apply(this,arguments)})},{key:"getDownloadLinkById",value:function(e,t){return this.stackClient.fetchJSON("POST",(0,w.uri)(U(),e,encodeURIComponent(t))).then(this.extractResponseLinkRelated)}},{key:"getDownloadLinkByRevision",value:function(e,t){return this.stackClient.fetchJSON("POST",(0,w.uri)(z(),e,encodeURIComponent(t))).then(this.extractResponseLinkRelated)}},{key:"getDownloadLinkByPath",value:function(e){return this.stackClient.fetchJSON("POST",(0,w.uri)(B(),e)).then(this.extractResponseLinkRelated)}},{key:"download",value:(eb=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:null,i=(r=u.length>2&&void 0!==u[2]?u[2]:void 0)||t.name,n){e.next=9;break}return e.next=6,this.getDownloadLinkById(t._id,i);case 6:a=e.sent,e.next=12;break;case 9:return e.next=11,this.getDownloadLinkByRevision(n,i);case 11:a=e.sent;case 12:this.forceFileDownload("".concat(a,"?Dl=1"),i);case 13:case"end":return e.stop()}},e,this)})),function(e){return eb.apply(this,arguments)})},{key:"fetchFileContent",value:(eg=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.default.warn("FileCollection.fetchFileContent() is deprecated. Use FileCollection.fetchFileContentById() instead"),e.abrupt("return",this.fetchFileContentById(t));case 2:case"end":return e.stop()}},e,this)})),function(e){return eg.apply(this,arguments)})},{key:"fetchFileContentById",value:(ek=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.stackClient.fetch("GET","/files/download/".concat(t)));case 1:case"end":return e.stop()}},e,this)})),function(e){return ek.apply(this,arguments)})},{key:"getBeautifulSize",value:function(e,t){return(0,w.formatBytes)(parseInt(e.size),t)}},{key:"downloadArchive",value:(e_=(0,c.default)(o.default.mark(function e(t,n){var r,a,i,u,c=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(c.length>2&&void 0!==c[2]?c[2]:{}).pages,a=n?(0,w.slugify)(n):"files",e.next=4,this.createArchiveLinkByIds({ids:t,name:a,pages:r});case 4:i=e.sent,u=this.stackClient.fullpath(i),this.forceFileDownload(u,a+".zip");case 7:case"end":return e.stop()}},e,this)})),function(e,t){return e_.apply(this,arguments)})},{key:"getArchiveLinkByIds",value:(eO=(0,c.default)(o.default.mark(function e(t){var n,r,a=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:"files",P.default.warn("CozyClient FileCollection getArchiveLinkByIds method is deprecated. Use createArchiveLinkByIds instead"),e.next=4,this.stackClient.fetchJSON("POST","/files/archive",{data:{type:"io.cozy.archives",attributes:{name:n,ids:t}}});case 4:return r=e.sent,e.abrupt("return",r.links.related);case 6:case"end":return e.stop()}},e,this)})),function(e){return eO.apply(this,arguments)})},{key:"createArchiveLinkByIds",value:(ew=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.ids,a=void 0===(r=t.name)?"files":r,i=t.pages,e.next=3,this.stackClient.fetchJSON("POST","/files/archive",{data:{type:"io.cozy.archives",attributes:et({name:a,ids:n},i&&{pages:i})}});case 3:return u=e.sent,e.abrupt("return",u.links.related);case 5:case"end":return e.stop()}},e,this)})),function(e){return ew.apply(this,arguments)})},{key:"isChildOf",value:(eS=(0,c.default)(o.default.mark(function e(t,n){var r,a,i,u,c,s,l,d,f,p=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(r="object"==typeof t?t:{_id:t})._id,i=r.dirID,u=r.path,c=("object"==typeof n?n:{_id:n})._id,!(a===c||i===c)){e.next=4;break}return e.abrupt("return",!0);case 4:if(u){e.next=10;break}return e.next=7,this.statById(a);case 7:u=(s=e.sent).data.path,i=s.data.dirID;case 10:for(l=u,d=[u];""!=l;)""!=(f=es(l))&&d.push(f),l=f;return d.reverse(),e.abrupt("return",ec(d.map(function(e){return p.statByPath(e)}),function(e){return e.data._id==c}));case 15:case"end":return e.stop()}},e,this)})),function(e,t){return eS.apply(this,arguments)})},{key:"statById",value:(ex=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u,c=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},r=(0,k.default)(n,["page[limit]","page[skip]","page[cursor]"]),a=(0,w.uri)(L(),t),i=E.buildURL(a,r),e.next=6,this.stackClient.fetchJSON("GET",i);case 6:return u=e.sent,e.abrupt("return",{data:ea(u.data),included:u.included&&u.included.map(function(e){return ea(e)}),links:u.links});case 8:case"end":return e.stop()}},e,this)})),function(e){return ex.apply(this,arguments)})},{key:"statByPath",value:(eE=(0,c.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",(0,w.uri)(F(),t));case 2:return n=e.sent,e.abrupt("return",{data:ea(n.data),included:n.included&&n.included.map(function(e){return ea(e)})});case 4:case"end":return e.stop()}},e,this)})),function(e){return eE.apply(this,arguments)})},{key:"createDirectory",value:(eP=(0,c.default)(o.default.mark(function e(){var t,n,r,a,i,u,c,s,l,d=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=d.length>0&&void 0!==d[0]?d[0]:{}).name,r=t.dirId,a=t.lastModifiedDate,i=t.metadata,u="",!i){e.next=8;break}return e.next=6,this.createFileMetadata(i);case 6:u=e.sent.data.id;case 8:return c=eu(n),s=a&&("string"==typeof a?new Date(a):a),e.next=12,this.stackClient.fetchJSON("POST",(0,w.uri)(N(),r,c,u),void 0,{headers:{Date:s?s.toGMTString():""}});case 12:return l=e.sent,e.abrupt("return",{data:ea(l.data)});case 14:case"end":return e.stop()}},e,this)})),function(){return eP.apply(this,arguments)})},{key:"ensureDirectoryExists",value:(eC=(0,c.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.specialDirectories[t]){e.next=5;break}return e.next=3,this.createDirectoryByPath(t);case 3:n=e.sent,this.specialDirectories[t]=n.data._id;case 5:return e.abrupt("return",this.specialDirectories[t]);case 6:case"end":return e.stop()}},e,this)})),function(e){return eC.apply(this,arguments)})},{key:"getDirectoryOrCreate",value:(eD=(0,c.default)(o.default.mark(function e(t,n){var r,a,i,u;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n&&!n.attributes)){e.next=2;break}throw Error("Malformed parent directory");case 2:return r=eo(t),a="".concat(n._id===en?"":n.attributes.path,"/").concat(r),e.prev=4,e.next=7,this.statByPath(a||"/");case 7:return i=e.sent,e.abrupt("return",i);case 11:if(e.prev=11,e.t0=e.catch(4),!((u=JSON.parse(e.t0.message).errors)&&u.length&&"404"===u[0].status)){e.next=17;break}return e.abrupt("return",this.createDirectory({name:r,dirId:n&&n._id}));case 17:throw u;case 18:case"end":return e.stop()}},e,this,[[4,11]])})),function(e,t){return eD.apply(this,arguments)})},{key:"createDirectoryByPath",value:(ej=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.split("/").filter(function(e){return""!==e}),e.next=3,this.statById(en);case 3:if(r=e.sent,n.length){e.next=6;break}return e.abrupt("return",r);case 6:a=r,i=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(n),e.prev=8,i.s();case 10:if((u=i.n()).done){e.next=17;break}return c=u.value,e.next=14,this.getDirectoryOrCreate(c,a.data);case 14:a=e.sent;case 15:e.next=10;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),i.e(e.t0);case 22:return e.prev=22,i.f(),e.finish(22);case 25:return e.abrupt("return",a);case 26:case"end":return e.stop()}},e,this,[[8,19,22,25]])})),function(e){return ej.apply(this,arguments)})},{key:"updateAttributes",value:(eA=(0,c.default)(o.default.mark(function e(t,n){var r,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=et({},n),n.name&&(r.name=eu(n.name)),e.next=4,this.stackClient.fetchJSON("PATCH",(0,w.uri)(I(),t),{data:{type:"io.cozy.files",id:t,attributes:r}});case 4:return a=e.sent,e.abrupt("return",{data:ea(a.data)});case 6:case"end":return e.stop()}},e,this)})),function(e,t){return eA.apply(this,arguments)})},{key:"updateFileMetadata",value:(eT=(0,c.default)(o.default.mark(function e(t,n){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.default.warn("CozyClient FileCollection updateFileMetadata method is deprecated. Use updateAttributes instead"),e.abrupt("return",this.updateAttributes(t,n));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return eT.apply(this,arguments)})},{key:"createFileMetadata",value:(eR=(0,c.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST",(0,w.uri)(R()),{data:{type:"io.cozy.files.metadata",attributes:t}});case 2:return n=e.sent,e.abrupt("return",{data:n.data});case 4:case"end":return e.stop()}},e,this)})),function(e){return eR.apply(this,arguments)})},{key:"updateMetadataAttribute",value:(eI=(0,c.default)(o.default.mark(function e(t,n){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST",(0,w.uri)(T(),t),{data:{type:"io.cozy.files.metadata",attributes:n}});case 2:return r=e.sent,e.abrupt("return",{data:r.data});case 4:case"end":return e.stop()}},e,this)})),function(e,t){return eI.apply(this,arguments)})},{key:"getFileTypeFromName",value:function(e){return v.default.getType(e)||"application/octet-stream"}},{key:"doUpload",value:(eM=(0,c.default)(o.default.mark(function e(t,n,r){var a,i,u,c,s,l,d,f,p,h,y,v,m,b,g,k,_,O,w,S=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=S.length>3&&void 0!==S[3]?S[3]:"POST",i=n,u=t){e.next=5;break}throw Error("missing data argument");case 5:if(u.buffer&&u.buffer instanceof ArrayBuffer&&(u=u.buffer),c="undefined"!=typeof ArrayBuffer&&u instanceof ArrayBuffer,s="undefined"!=typeof File&&u instanceof File,l="undefined"!=typeof Blob&&u instanceof Blob,d=!0===u.readable&&"function"==typeof u.pipe,f="string"==typeof u,!(!c&&!s&&!l&&!d&&!f)){e.next=13;break}throw Error("invalid data type");case 13:return h=(p=r||{}).contentType,y=p.contentLength,v=p.checksum,m=p.lastModifiedDate,b=p.ifMatch,!h&&("string"==typeof u?h="text/plain":u.type?h=u.type:(k=new URLSearchParams((g=i.split("?")).length>1?g[1]:"").get("Name"),h=this.getFileTypeFromName(k.toLowerCase()))),(m=m||u.lastModified)&&(m=new Date(m)),_={"Content-Type":h},y&&(_["Content-Length"]=String(y)),v&&(_["Content-MD5"]=v),m&&(O=m.toISOString(),i="".concat(i,"&UpdatedAt=").concat(O,"&CreatedAt=").concat(O)),b&&(_["If-Match"]=b),e.next=24,this.stackClient.fetchJSON(a,i,u,{headers:_,onUploadProgress:r.onUploadProgress});case 24:return w=e.sent,e.abrupt("return",{data:ea(w.data)});case 26:case"end":return e.stop()}},e,this)})),function(e,t,n){return eM.apply(this,arguments)})},{key:"findNotSynchronizedDirectories",value:(eN=(0,c.default)(o.default.mark(function e(t){var n,r,a,i,u,c,s,l,d,f,p=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(r=(n=p.length>1&&void 0!==p[1]?p[1]:{}).skip)?0:r,i=n.limit,u=n.cursor,s={include:void 0!==(c=n.includeFiles)&&c?"files":void 0,"page[limit]":i,"page[cursor]":u,sort:"id"},l=(0,w.uri)(A(),t._type,t._id),d=E.buildURL(l,s),e.next=6,this.stackClient.fetchJSON("GET",d);case 6:return f=e.sent,e.abrupt("return",{data:f.data.map(function(e){return ea(e)}),included:f.included?f.included.map(function(e){return ea(e)}):[],next:(0,m.default)(f,"links.next"),meta:f.meta,skip:a});case 8:case"end":return e.stop()}},e,this)})),function(e){return eN.apply(this,arguments)})},{key:"addNotSynchronizedDirectories",value:function(e,t){var n=t.map(function(e){return{id:e._id,type:e._type}});return this.stackClient.fetchJSON("POST",(0,w.uri)(j(),e._type,e._id),{data:n})}},{key:"removeNotSynchronizedDirectories",value:function(e,t){var n=t.map(function(e){return{id:e._id,type:e._type}});return this.stackClient.fetchJSON("DELETE",(0,w.uri)(D(),e._type,e._id),{data:n})}},{key:"fetchChanges",value:(eF=(0,c.default)(o.default.mark(function e(){var t,n,r,a,i,u,c,s,l,d,f=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]?f[0]:{},n=f.length>1&&void 0!==f[1]?f[1]:{},r={},"object"!=typeof t?(r.since=t,P.default.warn('fetchChanges use couchOptions as Object not a string, since is deprecated, please use fetchChanges({since: "'.concat(t,'"}).'))):Object.keys(t).length>0&&Object.assign(r,t),Object.keys(n).length>0&&(Object.assign(r,n),(n.skipTrashed||n.includeFilePath)&&(r.includeDocs=!0)),a=et(et({},(0,g.default)(r,["fields","includeDocs","includeFilePath","skipDeleted","skipTrashed"])),{},{fields:r.fields?r.fields.join(","):null,include_docs:r.includeDocs,include_file_path:r.includeFilePath,skip_deleted:r.skipDeleted,skip_trashed:r.skipTrashed}),i=(0,w.uri)(C()),u=E.buildURL(i,a),e.next=10,this.stackClient.fetchJSON("GET",u);case 10:return s=(c=e.sent).last_seq,l=c.pending,d=c.results,e.abrupt("return",{newLastSeq:s,pending:l,results:d});case 15:case"end":return e.stop()}},e,this)})),function(){return eF.apply(this,arguments)})}]),eB}(_.default);t.default=el},54056:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.hasJobFinished=t.normalizeJob=t.JOBS_DOCTYPE=void 0;var a=r(n(68434)),i=r(n(41)),o=r(n(82007)),u=r(n(65105)),c=r(n(19723)),s=r(n(25665)),l=r(n(27952)),d=r(n(12323)),f=r(n(78140)),p=r(n(67267)),h=n(66804),y=n(26070);function v(){var e=(0,i.default)(["/jobs/",""]);return v=function(){return e},e}var m="io.cozy.jobs";t.JOBS_DOCTYPE=m;var b=function(e){return new Promise(function(t){return setTimeout(t,e)})},g=(0,y.normalizeDoctypeJsonApi)(m);t.normalizeJob=g;var k=function(e){return"done"===e.state||"errored"===e.state};t.hasJobFinished=k;var _=function(e){(0,s.default)(_,e);var t,n,r,i,p,y=(t=_,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,d.default)(t);return e=n?Reflect.construct(r,arguments,(0,d.default)(this).constructor):r.apply(this,arguments),(0,l.default)(this,e)});function _(e){return(0,u.default)(this,_),y.call(this,m,e)}return(0,c.default)(_,[{key:"queued",value:function(e){return this.stackClient.fetchJSON("GET","/jobs/queue/".concat(e))}},{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.stackClient.fetchJSON("POST","/jobs/queue/".concat(e),{data:{type:m,attributes:{arguments:t,options:n,manual:r}}})}},{key:"get",value:(r=(0,o.default)(a.default.mark(function e(t){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.default.get(this.stackClient,(0,h.uri)(v(),t),{normalize:g}));case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"update",value:(i=(0,o.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("client"!==t.worker)){e.next=2;break}throw Error("JobCollection.update only works for client workers. ".concat(t.worker," given"));case 2:return e.next=4,this.stackClient.fetchJSON("PATCH","/jobs/".concat(t._id),{data:{type:m,id:t._id,attributes:{state:t.attributes.state,error:t.attributes.error}}});case 4:return n=e.sent,e.abrupt("return",g(n.data));case 6:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"waitFor",value:(p=(0,o.default)(a.default.mark(function e(t){var n,r,i,o,u,c,s,l,d,f,p,h,y=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0===(r=(n=y.length>1&&void 0!==y[1]?y[1]:{}).onUpdate)?null:r,u=void 0===(o=n.until)?k:o,s=void 0===(c=n.delay)?5e3:c,d=void 0===(l=n.timeout)?3e5:l,f=Date.now(),e.next=4,this.get(t);case 4:p=e.sent.data.attributes;case 5:if(!(!p||!u(p))){e.next=17;break}return e.next=8,b(s);case 8:return e.next=10,this.get(t);case 10:if(p=e.sent.data.attributes,i&&i(p),h=Date.now(),!(f-h>d)){e.next=15;break}throw Error("Timeout for JobCollection::waitFor");case 15:e.next=5;break;case 17:return e.abrupt("return",p);case 18:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})}]),_}(p.default);t.default=_},76812:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.KONNECTORS_DOCTYPE=void 0;var i=a(n(68434)),o=a(n(82007)),u=a(n(65105)),c=a(n(19723)),s=a(n(25665)),l=a(n(27952)),d=a(n(12323)),f=a(n(78718)),p=a(n(14324)),h=r(n(54026)),y=n(26070),v="io.cozy.konnectors";t.KONNECTORS_DOCTYPE=v;var m=function(e){(0,s.default)(k,e);var t,n,r,a,p,m,b,g=(t=k,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,d.default)(t);return e=n?Reflect.construct(r,arguments,(0,d.default)(this).constructor):r.apply(this,arguments),(0,l.default)(this,e)});function k(e){var t;return(0,u.default)(this,k),(t=g.call(this,e)).doctype=v,t.endpoint="/konnectors/",t}return(0,c.default)(k,[{key:"create",value:(r=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("create() method is not available for konnectors");case 1:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"destroy",value:(a=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("destroy() method is not available for konnectors");case 1:case"end":return e.stop()}},e)})),function(){return a.apply(this,arguments)})},{key:"findTriggersBySlug",value:(p=(0,o.default)(i.default.mark(function e(t){var n,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new h.default(this.stackClient),e.next=3,n.all({limit:null});case 3:return r=e.sent.data,e.abrupt("return",r.map(function(e){return e.attributes}).filter(function(e){return(0,h.isForKonnector)(e,t)}));case 6:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"launch",value:(m=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u,c=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},r=new h.default(this.stackClient),e.next=4,this.findTriggersBySlug(t);case 4:if(a=e.sent,1!==(o=n.accountId?a.filter(function(e){return(0,h.isForAccount)(e,n.accountId)}):a).length){e.next=10;break}return e.abrupt("return",r.launch(a[0]));case 10:if(u=JSON.stringify((0,f.default)({slug:t,accountId:n.accountId})),0!==o.length){e.next=15;break}throw Error("No trigger found for ".concat(u));case 15:if(!(o.length>1)){e.next=17;break}throw Error("More than 1 trigger found for ".concat(u));case 17:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"update",value:(b=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:{},t){e.next=3;break}throw Error("Cannot call update with no slug");case 3:return r=n.source||null,a=n.sync?{headers:{Accept:"text/event-stream"}}:{},e.next=8,this.stackClient.fetchJSON("PUT","/konnectors/".concat(t)+(r?"?Source=".concat(r):""),a);case 8:return o=e.sent,e.abrupt("return",(0,y.normalizeDoc)(o));case 10:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})}]),k}(p.default);t.default=m},68512:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.NEXTCLOUD_FILES_DOCTYPE=t.NextcloudFilesCollection=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=r(n(25665)),s=r(n(27952)),l=r(n(12323)),d=r(n(64512)),f=r(n(67267)),p=n(66804),h=n(45051),y=n(26070);function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,d.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var g="io.cozy.remote.nextcloud.files";t.NEXTCLOUD_FILES_DOCTYPE=g;var k=(0,y.normalizeDoctypeJsonApi)(g),_=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.fromTrash,a=void 0!==r&&r;return function(n){var r=k(n);return b(b({},r),{},{parentPath:t,path:a?r.path:(0,p.joinPath)(t,r.name),cozyMetadata:b(b({},r.cozyMetadata),{},{sourceAccount:e})})}},O=function(e){(0,c.default)(P,e);var t,n,r,d,f,y,m,b,k,O,w,S,x,E=(t=P,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,l.default)(t);return e=n?Reflect.construct(r,arguments,(0,l.default)(this).constructor):r.apply(this,arguments),(0,s.default)(this,e)});function P(e){return(0,o.default)(this,P),E.call(this,g,e)}return(0,u.default)(P,[{key:"find",value:(r=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t["cozyMetadata.sourceAccount"]&&t.parentPath)){e.next=5;break}return e.next=3,this.stackClient.fetchJSON("GET","/remote/nextcloud/".concat(t["cozyMetadata.sourceAccount"]).concat((0,p.encodePath)(t.parentPath)));case 3:return n=e.sent,e.abrupt("return",{data:n.data.map(_(t["cozyMetadata.sourceAccount"],t.parentPath,{fromTrash:t.trashed}))});case 5:throw Error("Not implemented");case 6:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"destroy",value:(d=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("DELETE","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount).concat((0,p.encodePath)(t.path)));case 2:if(204!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",n);case 5:throw new h.FetchError(n,n.json());case 6:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"destroyAll",value:(f=(0,i.default)(a.default.mark(function e(t){var n,r,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,this.destroy(i);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}},e,this,[[1,11,14,17]])})),function(e){return f.apply(this,arguments)})},{key:"download",value:(y=(0,i.default)(a.default.mark(function e(t){var n,r,i,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("GET","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount).concat((0,p.encodePath)(t.path),"?Dl=1"));case 2:return n=e.sent,e.next=5,n.blob();case 5:r=e.sent,i=URL.createObjectURL(r),o=t.path.split("/").pop(),(0,p.forceDownload)(i,o);case 9:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"move",value:(m=(0,i.default)(a.default.mark(function e(t,n){var r,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,p.joinPath)(n.path,t.name),e.next=3,this.stackClient.fetch("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/move").concat((0,p.encodePath)(t.path),"?To=").concat((0,p.encodePath)(r)));case 3:if(204!==(i=e.sent).status){e.next=6;break}return e.abrupt("return",i);case 6:throw new h.FetchError(i,i.json());case 7:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"moveToCozy",value:(b=(0,i.default)(a.default.mark(function e(t,n){var r,i,o,u=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0!==(r=(u.length>2&&void 0!==u[2]?u[2]:{}).copy)&&r,e.next=3,this.stackClient.fetch("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/downstream").concat((0,p.encodePath)(t.path),"?To=").concat(n._id).concat(i?"&Copy=true":""));case 3:if(201!==(o=e.sent).status){e.next=6;break}return e.abrupt("return",o);case 6:throw new h.FetchError(o,o.json());case 7:case"end":return e.stop()}},e,this)})),function(e,t){return b.apply(this,arguments)})},{key:"moveFromCozy",value:(k=(0,i.default)(a.default.mark(function e(t,n){var r,i,o,u,c=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0!==(r=(c.length>2&&void 0!==c[2]?c[2]:{}).copy)&&r,o=(0,p.joinPath)(t.path,n.name),e.next=4,this.stackClient.fetch("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/upstream").concat((0,p.encodePath)(o),"?From=").concat(n._id).concat(i?"&Copy=true":""));case 4:if(204!==(u=e.sent).status){e.next=7;break}return e.abrupt("return",u);case 7:throw new h.FetchError(u,u.json());case 8:case"end":return e.stop()}},e,this)})),function(e,t){return k.apply(this,arguments)})},{key:"restore",value:(O=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/restore").concat((0,p.encodePath)(t.path)));case 2:if(204!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",n);case 5:throw new h.FetchError(n,n.json());case 6:case"end":return e.stop()}},e,this)})),function(e){return O.apply(this,arguments)})},{key:"emptyTrash",value:(w=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("DELETE","/remote/nextcloud/".concat(t,"/trash"));case 2:if(204!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",n);case 5:throw new h.FetchError(n,n.json());case 6:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"deletePermanently",value:(S=(0,i.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("DELETE","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount).concat((0,p.encodePath)(t.path)));case 2:if(204!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",n);case 5:throw new h.FetchError(n,n.json());case 6:case"end":return e.stop()}},e,this)})),function(e){return S.apply(this,arguments)})},{key:"copy",value:(x=(0,i.default)(a.default.mark(function e(t,n){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/copy/").concat(t.path).concat(n?"?Path=".concat(n.path,"/").concat(t.name):""));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return x.apply(this,arguments)})}]),P}(f.default);t.NextcloudFilesCollection=O},45082:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.NOTES_URL_DOCTYPE=t.NOTES_DOCTYPE=void 0;var a=r(n(41)),i=r(n(64512)),o=r(n(68434)),u=r(n(82007)),c=r(n(65105)),s=r(n(19723)),l=r(n(25665)),d=r(n(27952)),f=r(n(12323)),p=r(n(67267)),h=n(26070),y=n(66804),v=n(10223);function m(){var e=(0,a.default)(["/notes/","/open"]);return m=function(){return e},e}function b(){var e=(0,a.default)(["/files/",""]);return b=function(){return e},e}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _="io.cozy.notes";t.NOTES_DOCTYPE=_;var O="io.cozy.notes.url";t.NOTES_URL_DOCTYPE=O;var w=(0,h.normalizeDoctypeJsonApi)(_),S=(0,h.normalizeDoctypeJsonApi)(O),x=function(e){(0,l.default)(O,e);var t,n,r,a,i,p,h,g=(t=O,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,f.default)(t);return e=n?Reflect.construct(r,arguments,(0,f.default)(this).constructor):r.apply(this,arguments),(0,d.default)(this,e)});function O(e){return(0,c.default)(this,O),g.call(this,_,e)}return(0,s.default)(O,[{key:"get",value:(r=(0,u.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET","/notes/".concat(t));case 2:return n=e.sent,e.abrupt("return",{data:w(n.data)});case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"all",value:(a=(0,u.default)(o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET","/notes");case 2:return t=e.sent,e.abrupt("return",k(k({},t),{},{data:t.data.map(w)}));case 4:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"destroy",value:(i=(0,u.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id,e.next=3,this.stackClient.fetchJSON("DELETE",(0,y.uri)(b(),n));case 3:return r=e.sent,e.abrupt("return",{data:k(k({},w(r.data)),{},{_deleted:!0})});case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"create",value:(p=(0,u.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dir_id,e.next=3,this.stackClient.fetchJSON("POST","/notes",{data:{type:"io.cozy.notes.documents",attributes:{title:"",schema:(0,v.getDefaultSchema)(),dir_id:n}}});case 3:return r=e.sent,e.abrupt("return",k(k({},r),{},{data:w(r.data)}));case 5:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"fetchURL",value:(h=(0,u.default)(o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id,e.next=3,this.stackClient.fetchJSON("GET",(0,y.uri)(m(),n));case 3:return r=e.sent,e.abrupt("return",{data:S(r.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"getDefaultSchema",value:function(){return(0,v.getDefaultSchema)()}}]),O}(p.default);x.normalizeDoctype=h.normalizeDoctypeJsonApi;t.default=x},10223:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultSchema=t.marks=t.nodes=void 0;var n=[["doc",{content:"(block)+",marks:"link"}],["paragraph",{content:"inline*",group:"block",marks:"strong code em link strike subsup textColor typeAheadQuery underline",parseDOM:[{tag:"p"}]}],["text",{group:"inline"}],["bulletList",{group:"block",content:"listItem+",parseDOM:[{tag:"ul"}]}],["orderedList",{group:"block",content:"listItem+",parseDOM:[{tag:"ol"}]}],["listItem",{content:"(paragraph ) (paragraph | bulletList | orderedList )*",defining:!0,parseDOM:[{tag:"li"}]}],["heading",{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}]}],["blockquote",{content:"paragraph+",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"blockquote"}]}],["rule",{group:"block",parseDOM:[{tag:"hr"}]}],["panel",{group:"block",content:"(paragraph | heading | bulletList | orderedList)+",attrs:{panelType:{default:"info"}},parseDOM:[{tag:"div[data-panel-type]"}]}],["confluenceUnsupportedBlock",{group:"block",attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedBlock"]'}]}],["confluenceUnsupportedInline",{group:"inline",inline:!0,atom:!0,attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedInline"]'}]}],["unsupportedBlock",{inline:!1,group:"block",atom:!0,selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedBlock"]'}]}],["unsupportedInline",{inline:!0,group:"inline",selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedInline"]'}]}],["hardBreak",{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}]}],["table",{content:"tableRow+",attrs:{isNumberColumnEnabled:{default:!1},layout:{default:"default"},__autoSize:{default:!1}},tableRole:"table",isolating:!0,selectable:!1,group:"block",parseDOM:[{tag:"table"}]}],["tableHeader",{content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading )+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"header_cell",isolating:!0,marks:"",parseDOM:[{tag:"th"}]}],["tableRow",{content:"(tableCell | tableHeader)+",tableRole:"row",parseDOM:[{tag:"tr"}]}],["tableCell",{content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | unsupportedBlock)+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"cell",marks:"",isolating:!0,parseDOM:[{tag:".ak-renderer-table-number-column",ignore:!0},{tag:"td"}]}]];t.nodes=n;var r=[["link",{excludes:"color",group:"link",attrs:{href:{},__confluenceMetadata:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]"}]}],["em",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}]}],["strong",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strong"},{tag:"b"},{style:"font-weight"}]}],["textColor",{attrs:{color:{}},inclusive:!0,group:"color",parseDOM:[{style:"color"}]}],["strike",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strike"},{tag:"s"},{tag:"del"},{style:"text-decoration"}]}],["subsup",{inclusive:!0,group:"fontStyle",attrs:{type:{default:"sub"}},parseDOM:[{tag:"sub",attrs:{type:"sub"}},{tag:"sup",attrs:{type:"sup"}}]}],["underline",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"u"},{style:"text-decoration"}]}],["code",{excludes:"fontStyle link searchQuery color",inclusive:!0,parseDOM:[{tag:"span.code",preserveWhitespace:!0},{tag:"code",preserveWhitespace:!0},{tag:"tt",preserveWhitespace:!0},{tag:"span",preserveWhitespace:!0}]}],["typeAheadQuery",{excludes:"searchQuery",inclusive:!0,group:"searchQuery",parseDOM:[{tag:"span[data-type-ahead-query]"}],attrs:{trigger:{default:""}}}]];t.marks=r;t.getDefaultSchema=function(){return{nodes:n,marks:r}}},29985:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(15500)),i=r(n(68434)),o=r(n(82007)),u=r(n(64512)),c=r(n(80295)),s=r(n(65105)),l=r(n(19723)),d=r(n(25665)),f=r(n(27952)),p=r(n(12323)),h=r(n(29328)),y=r(n(88928)),v=r(n(66605)),m=r(n(45051)),b=r(n(79271));function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,u.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=(0,p.default)(e);return n=t?Reflect.construct(r,arguments,(0,p.default)(this).constructor):r.apply(this,arguments),(0,f.default)(this,n)}}var O={clientID:"",clientName:"",clientKind:"",clientSecret:"",clientURI:"",registrationAccessToken:"",redirectURI:"",softwareID:"",softwareVersion:"",logoURI:"",policyURI:"",notificationPlatform:"",notificationDeviceToken:""},w=function(e){(0,d.default)(P,e);var t,n,r,a,u,f,p,h,g,w,x,E=_(P);function P(e){var t,n=e.oauth,r=e.scope,a=e.onTokenRefresh,i=(0,c.default)(e,["oauth","scope","onTokenRefresh"]);return(0,s.default)(this,P),(t=E.call(this,i)).setOAuthOptions(k(k({},O),n)),n.token&&t.setToken(n.token),t.scope=void 0===r?[]:r,t.onTokenRefresh=a,t}return(0,l.default)(P,[{key:"isRegistered",value:function(){return""!==this.oauthOptions.clientID}},{key:"snakeCaseOAuthData",value:function(e){var t={softwareID:"software_id",softwareVersion:"software_version",clientID:"client_id",clientName:"client_name",clientKind:"client_kind",clientURI:"client_uri",logoURI:"logo_uri",policyURI:"policy_uri",notificationPlatform:"notification_platform",notificationDeviceToken:"notification_device_token",redirectURI:"redirect_uris"},n={};return Object.keys(e).forEach(function(r){var a=t[r]||r,i=e[r];n[a]=i}),n.redirect_uris&&n.redirect_uris instanceof Array==!1&&(n.redirect_uris=[n.redirect_uris]),n}},{key:"camelCaseOAuthData",value:function(e){var t={client_id:"clientID",client_name:"clientName",client_secret:"clientSecret",registration_access_token:"registrationAccessToken",software_id:"softwareID",redirect_uris:"redirectURI"},n={};return Object.keys(e).forEach(function(r){var a=t[r]||r,i=e[r];n[a]=i}),n}},{key:"doRegistration",value:function(){return this.fetchJSON("POST","/auth/register",this.snakeCaseOAuthData({redirectURI:this.oauthOptions.redirectURI,clientName:this.oauthOptions.clientName,softwareID:this.oauthOptions.softwareID,clientKind:this.oauthOptions.clientKind,clientURI:this.oauthOptions.clientURI,logoURI:this.oauthOptions.logoURI,policyURI:this.oauthOptions.policyURI,softwareVersion:this.oauthOptions.softwareVersion,notificationPlatform:this.oauthOptions.notificationPlatform,notificationDeviceToken:this.oauthOptions.notificationDeviceToken}))}},{key:"register",value:(t=(0,o.default)(i.default.mark(function e(){var t,n,r,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRegistered()){e.next=2;break}throw Error("Client already registered");case 2:if(t=["redirectURI"],n=Object.keys(this.oauthOptions),!((r=t.filter(function(e){return n[e]})).length>0)){e.next=7;break}throw Error("Can't register client : missing ".concat(r," fields"));case 7:return e.next=9,this.doRegistration();case 9:return a=e.sent,this.setOAuthOptions(k(k({},this.oauthOptions),{},{client_id:a.client_id,client_name:a.client_name,client_secret:a.client_secret,registration_access_token:a.registration_access_token,software_id:a.software_id})),e.abrupt("return",this.oauthOptions);case 12:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"unregister",value:(n=(0,o.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRegistered()){e.next=2;break}throw new S;case 2:return t=this.oauthOptions.clientID,this.oauthOptions.clientID="",e.abrupt("return",this.fetchJSON("DELETE","/auth/register/".concat(t),null,{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}}));case 5:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"fetchInformation",value:(r=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRegistered()){e.next=2;break}throw new S;case 2:return e.abrupt("return",this.fetchJSON("GET","/auth/register/".concat(this.oauthOptions.clientID),null,{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}}));case 3:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"updateInformation",value:(a=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]&&u[1],this.isRegistered()){e.next=3;break}throw new S;case 3:return r={clientID:this.oauthOptions.clientID,clientName:this.oauthOptions.clientName,redirectURI:this.oauthOptions.redirectURI,softwareID:this.oauthOptions.softwareID},a=this.snakeCaseOAuthData(k(k({},r),t)),n&&(a.client_secret=this.oauthOptions.clientSecret),e.next=8,this.fetchJSON("PUT","/auth/register/".concat(this.oauthOptions.clientID),a,{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}});case 8:return o=e.sent,this.setOAuthOptions(k(k({},a),o)),e.abrupt("return",this.oauthOptions);case 11:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"generateStateCode",value:function(){var e;if("undefined"!=typeof window&&void 0!==window.crypto&&"function"==typeof window.crypto.getRandomValues)e=new Uint8Array(16),window.crypto.getRandomValues(e);else{e=Array(16);for(var t=0;t<e.length;t++)e[t]=Math.floor(255*Math.random())}return btoa(String.fromCharCode.apply(null,e)).replace(/=+$/,"").replace(/\//g,"_").replace(/\+/g,"-")}},{key:"getAuthCodeURL",value:function(e){var t=e.stateCode,n=e.scopes,r=void 0===n?this.scope:n,a=e.sessionCode,i=void 0===a?void 0:a,o=e.codeChallenge,u=void 0===o?void 0:o;if(!this.isRegistered())throw new S;var c={client_id:this.oauthOptions.clientID,redirect_uri:this.oauthOptions.redirectURI,state:t,response_type:"code",scope:r.join(" ")};return this.oauthOptions.registerToken&&(c=k(k({},c),{},{registerToken:this.oauthOptions.registerToken})),i&&(c=k(k({},c),{},{session_code:i})),u&&(c=k(k({},c),{},{code_challenge:u,code_challenge_method:"S256"})),"".concat(this.uri,"/auth/authorize?").concat(this.dataToQueryString(c))}},{key:"dataToQueryString",value:function(e){return Object.keys(e).map(function(t){return"".concat(t,"=").concat(encodeURIComponent(e[t]))}).join("&")}},{key:"getAccessCodeFromURL",value:function(e,t){if(!t)throw Error("Missing state code");var n=new URL(e).searchParams,r=n.get("state"),a=n.get("access_code");if(t!==r)throw Error("Given state does not match url query state");return a}},{key:"fetchAccessToken",value:(u=(0,o.default)(i.default.mark(function e(t,n,r,a){var o,u,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!this.isRegistered()&&!n)){e.next=2;break}throw new S;case 2:return u={grant_type:"authorization_code",code:t,client_id:(o=n||this.oauthOptions).clientID,client_secret:o.clientSecret},a&&(u=k(k({},u),{},{code_verifier:a})),e.next=7,this.fetchJSON("POST",(r||"")+"/auth/access_token",this.dataToQueryString(u),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 7:return c=e.sent,e.abrupt("return",new y.default(c));case 9:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return u.apply(this,arguments)})},{key:"fetchKonnectorToken",value:(f=(0,o.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchJSON("POST","/auth/tokens/konnectors/".concat(t));case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),Error('oAuthClient.fetchKonnectorToken(): Could not create a token for the konnector with slug "'.concat(t,'". \n\n').concat(e.t0));case 9:case"end":return e.stop()}},e,this,[[0,6]])})),function(e){return f.apply(this,arguments)})},{key:"fetchSessionCode",value:(p=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchJSON("POST","/auth/session_code"));case 1:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"fetchSessionCodeWithPassword",value:(h=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.passwordHash,a=void 0===(r=t.twoFactorToken)?void 0:r,u=void 0===(o=t.twoFactorPasscode)?void 0:o,e.abrupt("return",this.fetchJSON("POST","/auth/session_code",{passphrase:n,two_factor_token:a,two_factor_passcode:u}));case 2:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"loginFlagship",value:(g=(0,o.default)(i.default.mark(function e(t){var n,r,a,o,u,c,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0===(n=t.emailVerifiedCode)?void 0:n,a=t.passwordHash,u=void 0===(o=t.twoFactorToken)?void 0:o,s=void 0===(c=t.twoFactorPasscode)?void 0:c,e.abrupt("return",this.fetchJSON("POST","/auth/login/flagship",{client_id:this.oauthOptions.clientID,client_secret:this.oauthOptions.clientSecret,email_verified_code:r,passphrase:a,two_factor_token:u,two_factor_passcode:s}));case 2:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"refreshToken",value:(w=(0,o.default)(i.default.mark(function e(){var t,n,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRegistered()){e.next=2;break}throw new S;case 2:if(this.token){e.next=4;break}throw Error("No token to refresh");case 4:return t={grant_type:"refresh_token",refresh_token:this.token.refreshToken,client_id:this.oauthOptions.clientID,client_secret:this.oauthOptions.clientSecret},e.prev=5,e.next=8,this.fetchJSONWithCurrentToken("POST","/auth/access_token",this.dataToQueryString(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 8:return n=e.sent,r=new y.default(k({refresh_token:this.token.refreshToken},n)),this.setToken(r),this.onTokenRefresh&&"function"==typeof this.onTokenRefresh&&this.onTokenRefresh(r),e.abrupt("return",r);case 15:if(e.prev=15,e.t0=e.catch(5),!this.isRevocationError(e.t0)){e.next=21;break}throw this.onRevocationChange(!0),b.default.warn("Client has been revoked. Please authenticate again."),e.t0;case 21:if(!(m.default.EXPIRED_TOKEN.test(e.t0.message)||m.default.INVALID_TOKEN.test(e.t0.message)||m.default.INVALID_TOKEN_ALT.test(e.t0.message))){e.next=28;break}return e.next=24,this.checkForRevocation();case 24:if(!e.sent){e.next=28;break}throw b.default.warn("Client has been revoked. Please authenticate again."),e.t0;case 28:throw e.t0;case 29:case"end":return e.stop()}},e,this,[[5,15]])})),function(){return w.apply(this,arguments)})},{key:"exchangeOAuthSecret",value:function(e,t){return this.fetchJSON("POST",e+"/auth/secret_exchange",{secret:t})}},{key:"setToken",value:function(e){e?this.token=e instanceof y.default?e:new y.default(e):this.token=null}},{key:"setCredentials",value:function(e){return(0,v.default)("setCredentials is deprecated, please replace by setToken"),this.setToken(e)}},{key:"setOAuthOptions",value:function(e){this.oauthOptions=this.camelCaseOAuthData(e)}},{key:"resetClientId",value:function(){this.oauthOptions.clientID=""}},{key:"resetClient",value:function(){this.resetClientId(),this.setUri(null),this.setToken(null)}},{key:"registrationAccessTokenToAuthHeader",value:function(){if(!this.oauthOptions.registrationAccessToken)throw Error("No registration access token");return"Bearer "+this.oauthOptions.registrationAccessToken}},{key:"setPassphraseFlagship",value:function(e){var t=e.registerToken,n=e.passwordHash,r=e.hint,a=e.key,i=e.publicKey,o=e.privateKey,u=e.iterations;return this.fetchJSON("POST","/settings/passphrase/flagship",{register_token:t,passphrase:n,hint:r,key:a,public_key:i,private_key:o,iterations:u,client_id:this.oauthOptions.clientID,client_secret:this.oauthOptions.clientSecret},{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}})}},{key:"checkForRevocation",value:(x=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchInformation();case 3:case 11:return e.abrupt("return",!1);case 6:if(e.prev=6,e.t0=e.catch(0),!this.isRevocationError(e.t0)){e.next=11;break}return this.onRevocationChange(!0),e.abrupt("return",!0);case 12:case"end":return e.stop()}},e,this,[[0,6]])})),function(){return x.apply(this,arguments)})}]),P}(h.default),S=function(e){(0,d.default)(n,e);var t=_(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Client not registered or missing OAuth information";return(0,s.default)(this,n),(e=t.call(this,r)).message=r,e.name="NotRegisteredException",e}return n}((0,a.default)(Error));t.default=w},54348:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.OAUTH_CLIENTS_DOCTYPE=void 0;var i=a(n(68434)),o=a(n(64512)),u=a(n(41)),c=a(n(82007)),s=a(n(65105)),l=a(n(19723)),d=a(n(25665)),f=a(n(27952)),p=a(n(12323)),h=a(n(27361)),y=a(n(67267)),v=n(26070),m=n(66804),b=r(n(93726)),g=n(78140),k=n(45051);function _(){var e=(0,u.default)(["/settings/clients/",""]);return _=function(){return e},e}function O(){var e=(0,u.default)(["/settings/clients/",""]);return O=function(){return e},e}function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function x(){var e=(0,u.default)(["/settings/clients"]);return x=function(){return e},e}var E="io.cozy.oauth.clients";t.OAUTH_CLIENTS_DOCTYPE=E;var P=(0,v.normalizeDoctypeJsonApi)(E),C=function(e){(0,d.default)(y,e);var t,n,r,a,o,u=(t=y,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,p.default)(t);return e=n?Reflect.construct(r,arguments,(0,p.default)(this).constructor):r.apply(this,arguments),(0,f.default)(this,e)});function y(e){return(0,s.default)(this,y),u.call(this,E,e)}return(0,l.default)(y,[{key:"all",value:(r=(0,c.default)(i.default.mark(function e(){var t,n,r,a,o,u,c,s,l,d,f,p,y,v,k=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0===(n=(t=k.length>0&&void 0!==k[0]?k[0]:{}).limit)?100:n,a=t.bookmark,o=t.keys,u={"page[limit]":r,"page[cursor]":a},c=(0,m.uri)(x()),s=b.buildURL(c,u),e.prev=5,e.next=8,this.stackClient.fetchJSON("GET",s);case 8:l=e.sent,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(5),e.abrupt("return",(0,g.dontThrowNotFoundError)(e.t0));case 14:if(d=(0,h.default)(l,"links.next",""),p=void 0!==(f=new URL("".concat(this.stackClient.uri).concat(d)).searchParams.get("page[cursor]")||void 0),!o){e.next=24;break}return y=l.data.filter(function(e){return o.includes(e.id)}).map(function(e){return P(e)}),v=S(S({},l.meta),{},{count:y.length}),e.abrupt("return",{data:y,meta:v,next:o.length>y.length&&p,bookmark:f});case 24:return e.abrupt("return",{data:l.data.map(function(e){return P(e)}),meta:l.meta,next:p,bookmark:f});case 25:case"end":return e.stop()}},e,this,[[5,11]])})),function(){return r.apply(this,arguments)})},{key:"get",value:(a=(0,c.default)(i.default.mark(function e(t){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.all({keys:[t]});case 2:n=e.sent;case 3:if(!n.next){e.next=9;break}return e.next=6,this.all({keys:[t],bookmark:n.bookmark});case 6:n=e.sent,e.next=3;break;case 9:if(!n.data.length){e.next=13;break}return e.abrupt("return",{data:P(n.data[0])});case 13:throw n.url=(0,m.uri)(O(),t),n.status="404",new k.FetchError(n,"Not Found");case 16:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"destroy",value:(o=(0,c.default)(i.default.mark(function e(t){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id,e.next=3,this.stackClient.fetchJSON("DELETE",(0,m.uri)(_(),n));case 3:return e.abrupt("return",{data:S(S({},P(t)),{},{_deleted:!0})});case 4:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})}]),y}(y.default);C.normalizeDoctype=v.normalizeDoctypeJsonApi;t.default=C},96302:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.getPermissionsFor=void 0;var a=r(n(98235)),i=r(n(64512)),o=r(n(80295)),u=r(n(68434)),c=r(n(41)),s=r(n(82007)),l=r(n(65105)),d=r(n(19723)),f=r(n(25665)),p=r(n(27952)),h=r(n(12323)),y=r(n(67267)),v=n(26070),m=n(49129),b=n(66804),g=r(n(79271));function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function w(){var e=(0,c.default)(["/permissions/doctype/","/shared-by-link"]);return w=function(){return e},e}function S(){var e=(0,c.default)(["/permissions/",""]);return S=function(){return e},e}function x(){var e=(0,c.default)(["/permissions/",""]);return x=function(){return e},e}var E=function(e){return(0,v.normalizeDoc)(e,"io.cozy.permissions")},P=function(e){(0,f.default)(I,e);var t,n,r,i,c,y,v,m,_,P,j,A,T,R=(t=I,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,h.default)(t);return e=n?Reflect.construct(r,arguments,(0,h.default)(this).constructor):r.apply(this,arguments),(0,p.default)(this,e)});function I(){return(0,l.default)(this,I),R.apply(this,arguments)}return(0,d.default)(I,[{key:"get",value:(r=(0,s.default)(u.default.mark(function e(t){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",(0,b.uri)(x(),t));case 2:return n=e.sent,e.abrupt("return",{data:E(n.data)});case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"create",value:(i=(0,s.default)(u.default.mark(function e(t){var n,r,a,i,c,s,l,d,f;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t._id,t._type,i=void 0===(a=t.codes)?"code":a,c=t.ttl,s=t.tiny,l=(0,o.default)(t,["_id","_type","codes","ttl","tiny"]),(d=new URLSearchParams).append("codes",i),c&&d.append("ttl",c),s&&d.append("tiny",!0),e.next=7,this.stackClient.fetchJSON("POST","/permissions?".concat(d),{data:{type:"io.cozy.permissions",attributes:l}});case 7:return f=e.sent,e.abrupt("return",{data:E(f.data)});case 9:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"add",value:(c=(0,s.default)(u.default.mark(function e(t,n){var r,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t._type,e.next="io.cozy.apps"===e.t0?3:"io.cozy.konnectors"===e.t0?5:"io.cozy.permissions"===e.t0?7:9;break;case 3:return r="/permissions/apps/".concat(t.slug),e.abrupt("break",10);case 5:return r="/permissions/konnectors/".concat(t.slug),e.abrupt("break",10);case 7:return r="/permissions/".concat(t._id),e.abrupt("break",10);case 9:throw Error("Permissions can only be added on existing permissions, apps and konnectors.");case 10:return e.next=12,this.stackClient.fetchJSON("PATCH",r,{data:{type:"io.cozy.permissions",attributes:{permissions:n}}});case 12:return a=e.sent,e.abrupt("return",{data:E(a.data)});case 14:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"destroy",value:function(e){return this.stackClient.fetchJSON("DELETE",(0,b.uri)(S(),e.id))}},{key:"findLinksByDoctype",value:(y=(0,s.default)(u.default.mark(function e(t){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",(0,b.uri)(w(),t));case 2:return n=e.sent,e.abrupt("return",O(O({},n),{},{data:n.data.map(E)}));case 4:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"findApps",value:(v=(0,s.default)(u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g.default.warn("PermissionCollection.findApps will be removed in next version of cozy-client. \n\n      You can use AppCollection.all() instead \n\n      or even better client.query(Q('io.cozy.apps'), {as: 'io.cozy.apps'})"),e.next=3,this.stackClient.fetchJSON("GET","/apps/");case 3:return t=e.sent,e.abrupt("return",O(O({},t),{},{data:t.data.map(function(e){return O({_id:e.id},e)})}));case 5:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"createSharingLink",value:(m=(0,s.default)(u.default.mark(function e(t){var n,r,a=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(a.length>1&&void 0!==a[1]?a[1]:{}).verbs,e.next=4,this.stackClient.fetchJSON("POST","/permissions?codes=email",{data:{type:"io.cozy.permissions",attributes:{permissions:C(t,!0,n?{verbs:n}:{})}}});case 4:return r=e.sent,e.abrupt("return",{data:E(r.data)});case 6:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"fetchPermissionsByLink",value:(_=(0,s.default)(u.default.mark(function e(t){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.links&&t.links.next)){e.next=5;break}return e.next=3,this.stackClient.fetchJSON("GET",t.links.next);case 3:return n=e.sent,e.abrupt("return",O(O({},n),{},{data:n.data.map(E)}));case 5:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"fetchAllLinks",value:(P=(0,s.default)(u.default.mark(function e(t){var n,r,i;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findLinksByDoctype(t._type);case 2:r=n=e.sent;case 4:if(!(r.links&&r.links.next)){e.next=11;break}return e.next=7,this.fetchPermissionsByLink(r);case 7:r=e.sent,(i=n.data).push.apply(i,(0,a.default)(r.data)),e.next=4;break;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this)})),function(e){return P.apply(this,arguments)})},{key:"revokeSharingLink",value:(j=(0,s.default)(u.default.mark(function e(t){var n,r,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchAllLinks(t);case 2:n=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(e.sent.data.filter(function(e){return D(e,t)})),e.prev=5,n.s();case 7:if((r=n.n()).done){e.next=13;break}return a=r.value,e.next=11,this.destroy(a);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}},e,this,[[5,15,18,21]])})),function(e){return j.apply(this,arguments)})},{key:"getOwnPermissions",value:(A=(0,s.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g.default.warn("getOwnPermissions is deprecated, please use fetchOwnPermissions instead"),e.abrupt("return",this.fetchOwnPermissions());case 2:case"end":return e.stop()}},e,this)})),function(){return A.apply(this,arguments)})},{key:"fetchOwnPermissions",value:(T=(0,s.default)(u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET","/permissions/self");case 2:return t=e.sent,e.abrupt("return",{data:E(t.data),included:t.included?t.included.map(E):[]});case 4:case"end":return e.stop()}},e,this)})),function(){return T.apply(this,arguments)})}]),I}(y.default),C=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e._id,a=e._type,i=n.verbs?n.verbs:t?["GET"]:["ALL"];return(0,m.isFile)(e)?{files:{type:"io.cozy.files",verbs:i,values:[r]}}:{collection:{type:a,verbs:i,values:[r]},files:{type:"io.cozy.files",verbs:i,values:["".concat(a,"/").concat(r)],selector:"referenced_by"}}};t.getPermissionsFor=C;var D=function(e,t){var n=t._id;return(0,m.isFile)(t)?-1!==e.attributes.permissions.files.values.indexOf(n):-1!==e.attributes.permissions.collection.values.indexOf(n)};t.default=P},96727:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.normalizeSettings=t.SETTINGS_DOCTYPE=void 0;var a=r(n(41)),i=r(n(68434)),o=r(n(64512)),u=r(n(82007)),c=r(n(65105)),s=r(n(19723)),l=r(n(25665)),d=r(n(27952)),f=r(n(12323)),p=r(n(67267)),h=r(n(79271)),y=n(66804),v=n(26070);function m(){var e=(0,a.default)(["/data/","/",""]);return m=function(){return e},e}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var g="io.cozy.settings";t.SETTINGS_DOCTYPE=g;var k=(0,v.normalizeDoctypeJsonApi)(g);t.normalizeSettings=k;var _=function(e){(0,l.default)(v,e);var t,n,r,a,p=(t=v,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,f.default)(t);return e=n?Reflect.construct(r,arguments,(0,f.default)(this).constructor):r.apply(this,arguments),(0,d.default)(this,e)});function v(e){return(0,c.default)(this,v),p.call(this,g,e)}return(0,s.default)(v,[{key:"get",value:(r=(0,u.default)(i.default.mark(function e(t){var n,r,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("io.cozy.settings.bitwarden"!==t){e.next=5;break}return e.next=3,this.stackClient.fetchJSON("GET","/data/io.cozy.settings/io.cozy.settings.bitwarden");case 3:return n=e.sent,e.abrupt("return",{data:k(n)});case 5:return t.startsWith("io.cozy.settings.")?r=t.substring(17):(h.default.warn("Deprecated: in next versions of cozy-client, it will not be possible to query settings with an incomplete id\n\n- Q('io.cozy.settings').getById('instance')\n+ Q('io.cozy.settings').getById('io.cozy.settings.instance')"),r=t),e.next=8,this.stackClient.fetchJSON("GET","/settings/".concat(r));case 8:return a=e.sent,e.abrupt("return",{data:k(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({id:"/settings/".concat(r)},a.data))});case 10:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"update",value:(a=(0,u.default)(i.default.mark(function e(t){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("io.cozy.settings.instance"!==t._id){e.next=6;break}return e.next=3,this.stackClient.fetchJSON("PUT","/settings/instance",{data:t});case 3:n=e.sent,e.next=9;break;case 6:return e.next=8,this.stackClient.fetchJSON("PUT",(0,y.uri)(m(),this.doctype,t._id),t);case 8:n=e.sent;case 9:return e.abrupt("return",{data:k(n.data)});case 10:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})}]),v}(p.default);_.normalizeDoctype=v.normalizeDoctypeJsonApi;t.default=_},67207:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.getSharingRules=t.BITWARDEN_CIPHERS_DOCTYPE=t.BITWARDEN_ORGANIZATIONS_DOCTYPE=t.SHARING_DOCTYPE=void 0;var a=r(n(68434)),i=r(n(64512)),o=r(n(41)),u=r(n(82007)),c=r(n(65105)),s=r(n(19723)),l=r(n(25665)),d=r(n(27952)),f=r(n(12323)),p=r(n(67267)),h=n(26070),y=n(49129),v=n(66804),m=r(n(79271));function b(){var e=(0,o.default)(["/sharings/","/recipients"]);return b=function(){return e},e}function g(){var e=(0,o.default)(["/sharings/","/recipients/self"]);return g=function(){return e},e}function k(){var e=(0,o.default)(["/sharings/","/groups/",""]);return k=function(){return e},e}function _(){var e=(0,o.default)(["/sharings/","/recipients/",""]);return _=function(){return e},e}function O(){var e=(0,o.default)(["/sharings/","/recipients"]);return O=function(){return e},e}function w(){var e=(0,o.default)(["/sharings/",""]);return w=function(){return e},e}function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function E(){var e=(0,o.default)(["/sharings/doctype/",""]);return E=function(){return e},e}var P="io.cozy.sharings";t.SHARING_DOCTYPE=P;var C="com.bitwarden.organizations";t.BITWARDEN_ORGANIZATIONS_DOCTYPE=C;var D="com.bitwarden.ciphers";t.BITWARDEN_CIPHERS_DOCTYPE=D;var j=(0,h.normalizeDoctypeJsonApi)(P),A=function(e){(0,l.default)(S,e);var t,n,r,i,o,p,h,y=(t=S,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,f.default)(t);return e=n?Reflect.construct(r,arguments,(0,f.default)(this).constructor):r.apply(this,arguments),(0,d.default)(this,e)});function S(){return(0,c.default)(this,S),y.apply(this,arguments)}return(0,s.default)(S,[{key:"findByDoctype",value:(r=(0,u.default)(a.default.mark(function e(t){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",(0,v.uri)(E(),t));case 2:return n=e.sent,e.abrupt("return",x(x({},n),{},{data:n.data.map(j)}));case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"get",value:(i=(0,u.default)(a.default.mark(function e(t){var n,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,v.uri)(w(),t),e.next=3,this.stackClient.fetchJSON("GET",n);case 3:return r=e.sent,e.abrupt("return",{data:j(r.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"create",value:(o=(0,u.default)(a.default.mark(function e(t){var n,r,i,o,u,c,s,l,d,f,p,h,y;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.document,r=t.description,i=t.previewPath,o=t.rules,c=void 0===(u=t.recipients)?[]:u,l=void 0===(s=t.readOnlyRecipients)?[]:s,d=t.openSharing,f=t.appSlug,p={description:r,preview_path:i,open_sharing:d,rules:o||R(n)},h={},f&&(h={app_slug:f}),e.next=6,this.stackClient.fetchJSON("POST","/sharings/",{data:{type:"io.cozy.sharings",attributes:x(x({},p),h),relationships:x(x({},c.length>0&&{recipients:{data:c.map(z)}}),l.length>0&&{read_only_recipients:{data:l.map(z)}})}});case 6:return y=e.sent,e.abrupt("return",{data:j(y.data)});case 8:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"share",value:(p=(0,u.default)(a.default.mark(function e(t,n,r,i){var o,u,c=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=c.length>4&&void 0!==c[4]?c[4]:null,m.default.warn("SharingCollection.share is deprecated, use SharingCollection.create instead"),u="two-way"===r?{recipients:n}:{readOnlyRecipients:n},e.abrupt("return",this.create(x(x({document:t},u),{},{description:i,previewPath:o,openSharing:"two-way"===r,rules:R(t,r)})));case 4:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return p.apply(this,arguments)})},{key:"getDiscoveryLink",value:function(e,t){return this.stackClient.fullpath("/sharings/".concat(e,"/discovery?sharecode=").concat(t))}},{key:"addRecipients",value:(h=(0,u.default)(a.default.mark(function e(t){var n,r,i,o,u,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.document,i=void 0===(r=t.recipients)?[]:r,u=void 0===(o=t.readOnlyRecipients)?[]:o,e.next=3,this.stackClient.fetchJSON("POST",(0,v.uri)(O(),n._id),{data:{type:"io.cozy.sharings",id:n._id,relationships:x(x({},i.length>0&&{recipients:{data:i.map(z)}}),u.length>0&&{read_only_recipients:{data:u.map(z)}})}});case 3:return c=e.sent,e.abrupt("return",{data:j(c.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"revokeRecipient",value:function(e,t){return this.stackClient.fetchJSON("DELETE",(0,v.uri)(_(),e._id,t))}},{key:"revokeGroup",value:function(e,t){return this.stackClient.fetchJSON("DELETE",(0,v.uri)(k(),e._id,t))}},{key:"revokeSelf",value:function(e){return this.stackClient.fetchJSON("DELETE",(0,v.uri)(g(),e._id))}},{key:"revokeAllRecipients",value:function(e){return this.stackClient.fetchJSON("DELETE",(0,v.uri)(b(),e._id))}}]),S}(p.default);A.normalizeDoctype=h.normalizeDoctypeJsonApi;var T=function(e,t){return(0,y.isFile)(e)?F(e,t):e._type===C?B(e):I(e,t)},R=function(e,t){return t&&m.default.warn("sharingType is deprecated and will be removed. We now set this default rules: ".concat(T(e),"} \n      \n      If this default rules do not fill your need, please set custom rules \n      by using the 'rules' object of the SharingCollection.create() method")),T(e,t)};t.getSharingRules=R;var I=function(e,t){var n=e._id,r=e._type;return[x({title:"collection",doctype:r,values:[n]},N(t)),x({title:"items",doctype:"io.cozy.files",values:["".concat(r,"/").concat(n)],selector:"referenced_by"},M(t))]},M=function(e){return"two-way"===e?{add:"sync",update:"sync",remove:"sync"}:{add:"push",update:"none",remove:"push"}},N=function(e){return e?"two-way"===e?{update:"sync",remove:"revoke"}:{update:"push",remove:"revoke"}:{update:"sync",remove:"revoke"}},F=function(e,t){var n=e._id;return[x({title:e.name,doctype:"io.cozy.files",values:[n]},L(e,t))]},L=function(e,t){if((0,y.isDirectory)(e))return t?"two-way"===t?{add:"sync",update:"sync",remove:"sync"}:{add:"push",update:"push",remove:"push"}:{add:"sync",update:"sync",remove:"sync"};return t?"two-way"===t?{update:"sync",remove:"revoke"}:{update:"push",remove:"revoke"}:{update:"sync",remove:"revoke"}},B=function(e){var t=e._id;return[{title:e.name,doctype:C,values:[t],add:"sync",update:"sync",remove:"revoke"},{title:"Ciphers",doctype:D,values:[t],add:"sync",update:"sync",remove:"sync",selector:"organization_id"}]},z=function(e){return{id:e._id,type:e._type}};t.default=A},86247:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SHORTCUTS_DOCTYPE=void 0;var a=r(n(68434)),i=r(n(41)),o=r(n(82007)),u=r(n(65105)),c=r(n(19723)),s=r(n(25665)),l=r(n(27952)),d=r(n(12323)),f=r(n(64512)),p=r(n(67267)),h=n(26070),y=n(66804),v=n(77069);function m(){var e=(0,i.default)(["/shortcuts/",""]);return m=function(){return e},e}function b(){var e=(0,i.default)(["/shortcuts"]);return b=function(){return e},e}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,f.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _="io.cozy.files.shortcuts";t.SHORTCUTS_DOCTYPE=_;var O=(0,h.normalizeDoctypeJsonApi)(_),w=function(e){return k(k({},O(e)),{},{_id:e._id})},S=function(e){(0,s.default)(p,e);var t,n,r,i,f=(t=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,d.default)(t);return e=n?Reflect.construct(r,arguments,(0,d.default)(this).constructor):r.apply(this,arguments),(0,l.default)(this,e)});function p(e){return(0,u.default)(this,p),f.call(this,_,e)}return(0,c.default)(p,[{key:"create",value:(r=(0,o.default)(a.default.mark(function e(t){var n,r,i,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.type&&(t.type=_),!(!t.name||!t.name.trim()||!t.url||!t.dir_id)){e.next=3;break}throw Error("you need at least a name, an url and a dir_id attributes to create a shortcut");case 3:if(!("."===(n=t.name.trim())||".."===n)){e.next=6;break}throw Error("Invalid filename: ".concat(n));case 6:if(!(r=(0,v.getIllegalCharacters)(n)).length){e.next=9;break}throw Error("Invalid filename containing illegal character(s): ".concat(r));case 9:return i=(0,y.uri)(b()),e.next=12,this.stackClient.fetchJSON("POST",i,{data:{attributes:t,type:"io.cozy.files.shortcuts"}});case 12:return o=e.sent,e.abrupt("return",{data:w(o.data)});case 14:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"get",value:(i=(0,o.default)(a.default.mark(function e(t){var n,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,y.uri)(m(),t),e.next=3,this.stackClient.fetchJSON("GET",n);case 3:return r=e.sent,e.abrupt("return",{data:w(r.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})}]),p}(p.default);S.normalizeDoctype=h.normalizeDoctypeJsonApi;t.default=S},54026:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isForAccount=t.isForKonnector=t.normalizeTrigger=t.TRIGGERS_DOCTYPE=t.JOBS_DOCTYPE=void 0;var i=a(n(80295)),o=a(n(64512)),u=a(n(41)),c=a(n(68434)),s=a(n(82007)),l=a(n(65105)),d=a(n(19723)),f=a(n(59655)),p=a(n(25665)),h=a(n(27952)),y=a(n(12323)),v=r(n(78140)),m=n(26070),b=n(54056),g=n(66804),k=a(n(67267));function _(){var e=(0,u.default)(["/jobs/triggers/","/launch"]);return _=function(){return e},e}function O(){var e=(0,u.default)(["/jobs/triggers/",""]);return O=function(){return e},e}function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function x(){var e=(0,u.default)(["/jobs/triggers/",""]);return x=function(){return e},e}function E(){var e=(0,u.default)(["/jobs/triggers"]);return E=function(){return e},e}n(45051);t.JOBS_DOCTYPE="io.cozy.jobs";var P="io.cozy.triggers";t.TRIGGERS_DOCTYPE=P;var C=(0,m.normalizeDoctypeJsonApi)(P);t.normalizeTrigger=C;t.isForKonnector=function(e,t){return"konnector"===e.worker&&e.message.konnector==t};t.isForAccount=function(e,t){return e.message.account==t};var D=function(e,t){var n=new URLSearchParams;return e&&(Array.isArray(e.$in)?n.set("Worker",e.$in.join(",")):n.set("Worker",e)),t&&(Array.isArray(t.$in)?n.set("Type",t.$in.join(",")):n.set("Type",t)),n.toString()},j=function(e){(0,p.default)(A,e);var t,n,r,a,o,u,m,k,w,j=(t=A,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,y.default)(t);return e=n?Reflect.construct(r,arguments,(0,y.default)(this).constructor):r.apply(this,arguments),(0,h.default)(this,e)});function A(e){return(0,l.default)(this,A),j.call(this,P,e)}return(0,d.default)(A,[{key:"all",value:(r=(0,s.default)(c.default.mark(function e(){var t,n,r=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>0&&void 0!==r[0]&&r[0],e.prev=1,e.next=4,this.stackClient.fetchJSON("GET","/jobs/triggers");case 4:return n=e.sent,e.abrupt("return",{data:n.data.map(function(e){return C(e)}),meta:{count:n.data.length},next:!1,skip:0});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",(0,v.dontThrowNotFoundError)(e.t0));case 11:case"end":return e.stop()}},e,this,[[1,8]])})),function(){return r.apply(this,arguments)})},{key:"create",value:(a=(0,s.default)(c.default.mark(function e(t){var n,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,g.uri)(E()),e.next=3,this.stackClient.fetchJSON("POST",n,{data:{attributes:t}});case 3:return r=e.sent,e.abrupt("return",{data:C(r.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"destroy",value:(o=(0,s.default)(c.default.mark(function e(t){var n;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t._id){e.next=3;break}throw Error("TriggerCollection.destroy needs a document with an _id");case 3:return e.next=5,this.stackClient.fetchJSON("DELETE",(0,g.uri)(x(),n));case 5:return e.abrupt("return",{data:C(S(S({},t),{},{_deleted:!0}))});case 6:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"find",value:(u=(0,s.default)(c.default.mark(function e(){var t,n,r,a,o,u,s=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:{},r=t.worker,a=t.type,0!==Object.keys((0,i.default)(t,["worker","type"])).length){e.next=18;break}return o="/jobs/triggers?".concat(D(r,a)),e.prev=6,e.next=9,this.stackClient.fetchJSON("GET",o);case 9:return u=e.sent,e.abrupt("return",{data:u.data.map(function(e){return C(e)}),meta:{count:u.data.length},next:!1,skip:0});case 13:return e.prev=13,e.t0=e.catch(6),e.abrupt("return",(0,v.dontThrowNotFoundError)(e.t0));case 16:e.next=19;break;case 18:return e.abrupt("return",(0,f.default)((0,y.default)(A.prototype),"find",this).call(this,t,n));case 19:case"end":return e.stop()}},e,this,[[6,13]])})),function(){return u.apply(this,arguments)})},{key:"get",value:(m=(0,s.default)(c.default.mark(function e(t){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",v.default.get(this.stackClient,(0,g.uri)(O(),t),{normalize:C}));case 1:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"launch",value:(k=(0,s.default)(c.default.mark(function e(t){var n,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,g.uri)(_(),t._id),e.next=3,this.stackClient.fetchJSON("POST",n);case 3:return r=e.sent,e.abrupt("return",{data:(0,b.normalizeJob)(r.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"update",value:(w=(0,s.default)(c.default.mark(function e(t){var n,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=c.default.keys(t);case 1:if((e.t1=e.t0()).done){e.next=7;break}if(["_id","_rev","_type","arguments","message","cozyMetadata"].includes(e.t1.value)){e.next=5;break}throw Error("TriggerCollection.update only works for 'arguments', and 'message' attributes.");case 5:e.next=1;break;case 7:return n=S(S({},t.arguments?{arguments:t.arguments}:{}),t.message?{message:t.message}:{}),e.next=10,this.stackClient.fetchJSON("PATCH","/jobs/triggers/".concat(t._id),{data:{attributes:n}});case 10:return r=e.sent,e.abrupt("return",{data:C(r.data)});case 12:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})}]),A}(k.default);j.normalizeDoctype=m.normalizeDoctypeJsonApi;t.default=j},45051:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.FetchError=t.default=void 0;var a=r(n(65105)),i=r(n(8997)),o=r(n(25665)),u=r(n(27952)),c=r(n(12323)),s=r(n(15500)),l=/the client must be registered/;t.default={EXPIRED_TOKEN:/Expired token/,CLIENT_NOT_FOUND:/Client not found/,INVALID_TOKEN:/Invalid JWT token/,INVALID_TOKEN_ALT:/Invalid token/,UNREGISTERED_CLIENT:l};var d=/invalid_token/,f=/access_token_expired/,p=function(e){var t,n=null===(t=e.headers)||void 0===t?void 0:t.get("www-authenticate");if(n){if(f.test(n))return"Expired token";if(d.test(n))return"Invalid token"}},h=function(e){(0,o.default)(s,e);var t,n,r=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,c.default)(t);return e=n?Reflect.construct(r,arguments,(0,c.default)(this).constructor):r.apply(this,arguments),(0,u.default)(this,e)});function s(e,t){if((0,a.default)(this,s),c=r.call(this),null===(u=Error.captureStackTrace)||void 0===u||u.call(Error,(0,i.default)(c),c.constructor),c.name="FetchError",c.response=e,c.url=e.url,c.status=e.status,c.reason=t,null===t)throw Error("FetchError received a ".concat(e.status," error without a Response Body when calling ").concat(e.url));var n,o,u,c,d=p(e);return Object.defineProperty((0,i.default)(c),"message",{value:(n=t,o=d,("string"==typeof n.error&&l.test(n.error)?n.error:void 0)||n.message||o||("string"==typeof n?n:JSON.stringify(n)))}),c}return s}((0,s.default)(Error));t.FetchError=h},79954:function(e,t,n){var r,a,i=n(14746),o=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getIconURL=t.default=t._getIconURL=void 0;var u=o(n(68434)),c=o(n(82007));n(79312);var s=i(n(23355));function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var d=function(e,t,n,r){if(!n)throw Error("Cannot fetch icon: missing domain");var a=f(e,t,n,r);if(!a)throw Error("Cannot get icon source for app ".concat(e.name));return a},f=function(e,t,n,r){var a=e&&e.links&&e.links.icon||p(e,t);return a?"".concat(r,"//").concat(n).concat(a):null},p=function(e,t){return t?"/registry/".concat(t,"/icon"):e&&e.latest_version&&e.latest_version.version&&"/registry/".concat(e.slug,"/").concat(e.latest_version.version,"/icon")},h={gif:"image/gif",ico:"image/vnd.microsoft.icon",jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml"},y=function(e){if(!e.icon)throw Error("".concat(e.name,": Cannot detect icon mime type since app has no icon"));var t=e.icon.split(".").pop();if(!t)throw Error("".concat(e.name,": Unable to detect icon mime type from extension (").concat(e.icon,")"));return t};var v=(r=(0,c.default)(u.default.mark(function e(t,n){var r,a,i,o,c;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}(e))){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(t),e.prev=1,a.s();case 3:if((i=a.n()).done){e.next=18;break}return o=i.value,e.prev=5,e.next=8,o();case 8:return c=e.sent,n&&n(c),e.abrupt("return",c);case 13:e.prev=13,e.t0=e.catch(5),r=e.t0;case 16:e.next=3;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(1),a.e(e.t1);case 23:return e.prev=23,a.f(),e.finish(23);case 26:throw r;case 27:case"end":return e.stop()}},e,null,[[1,20,23,26],[5,13]])})),function(e,t){return r.apply(this,arguments)});var m=(a=(0,c.default)(u.default.mark(function e(t,n){var r,a,i,o,c,s,l,f,p,m,b,g,k,_;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.type,a=n.slug,i=n.appData,c=void 0===(o=n.priority)?"stack":o,!t.oauthOptions){e.next=29;break}return s=[function(){return t.fetch("GET","/".concat(r,"s/").concat(a,"/icon"))},function(){return t.fetch("GET","/registry/".concat(a,"/icon"))}],"registry"===c&&s.reverse(),e.next=6,v(s,function(e){if(!e.ok)throw Error("Error while fetching icon ".concat(e.statusText))});case 6:return l=e.sent,e.next=9,l.blob();case 9:if((f=e.sent).type){e.next=26;break}if(m=[function(){var e,n,i;return e=t,n=r,i=a,e.fetchJSON("GET","/".concat(n,"s/").concat(i)).then(function(e){return e.data.attributes})},function(){var e,n,r;return e=t,n=0,r=a,e.fetchJSON("GET","/registry/".concat(r)).then(function(e){return e.latest_version.manifest})}],"registry"===c&&m.reverse(),e.t1=i,e.t1){e.next=18;break}return e.next=17,v(m);case 17:e.t1=e.sent;case 18:if(e.t0=e.t1,e.t0){e.next=21;break}e.t0={};case 21:if(h[b=y(p=e.t0)]){e.next=25;break}throw Error('Unknown image extension "'.concat(b,'" for app ').concat(p.name));case 25:f=new Blob([f],{type:h[b]});case 26:return e.abrupt("return",URL.createObjectURL(f));case 29:return e.prev=29,k=(g=new URL(t.uri)).host,_=g.protocol,e.abrupt("return",d(i,a,k,_));case 34:throw e.prev=34,e.t2=e.catch(29),Error("Cannot fetch icon: invalid stackClient.uri: ".concat(e.t2.message));case 37:case"end":return e.stop()}},e,null,[[29,34]])})),function(e,t){return a.apply(this,arguments)});t._getIconURL=m;var b=function(){return m.apply(this,arguments).catch(function(){return new s.ErrorReturned})};t.getIconURL=b;var g=(0,s.default)(b,{maxDuration:3e5,key:function(e,t){var n=t.type,r=t.slug,a=t.priority;return e.uri+NaN+n+":"+r+":"+a}});t.default=g},77069:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getIllegalCharacters=void 0;t.getIllegalCharacters=function(e){var t=e.match(/\/|\x00|\n|\r/g);return t?t.join(" "):""}},60359:function(e,t,n){var r=n(14746),a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"OAuthClient",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"errors",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"FetchError",{enumerable:!0,get:function(){return u.FetchError}}),Object.defineProperty(t,"normalizeDoc",{enumerable:!0,get:function(){return c.normalizeDoc}});var i=a(n(29328)),o=a(n(29985)),u=r(n(45051)),c=n(26070)},66605:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(79271));t.default=function(){a.default.warn.apply(a.default,arguments)}},79271:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(60732)),i=(0,a.default)("cozy-stack-client");a.default.suggest.deny("cozy-stack-client","info");t.default=i},35946:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.makeOperatorsExplicit=t.isMatchingIndex=t.getIndexFields=t.transformSort=t.getIndexNameFromFields=t.makeKeyFromPartialFilter=t.normalizeDesignDoc=void 0;var a=r(n(98235)),i=r(n(90402)),o=r(n(64512)),u=r(n(91175)),c=r(n(27361)),s=r(n(18446)),l=r(n(13218));function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}t.normalizeDesignDoc=function(e){var t=e._id||e.id;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({id:t,_id:t},e.doc)};var f=function e(t){return"object"!=typeof t||null===t?String(t):Object.entries(t).map(function(t){var n=(0,i.default)(t,2),r=n[0],a=n[1];if(Array.isArray(a)&&a.every(function(e){return"string"==typeof e}))return"".concat(r,"_(").concat(a.join("_"),")");if(Array.isArray(a))return"(".concat(a.map(function(t){return"".concat(e(t))}).join(")_".concat(r,"_(")),")");if("object"==typeof a)return"".concat(r,"_").concat(e(a));else return"".concat(r,"_").concat(a)}).join(")_and_(")};t.makeKeyFromPartialFilter=f;t.getIndexNameFromFields=function(e,t){var n="by_".concat(e.join("_and_"));return t?"".concat(n,"_filter_(").concat(f(t),")"):n};t.transformSort=function(e){if(!e||Array.isArray(e))return e;throw Error('Passing an object to the "sort" is not supported')};t.getIndexFields=function(e){var t=e.selector,n=e.partialFilter,r=e.sort;return Array.from(new Set([].concat((0,a.default)((void 0===r?[]:r).map(function(e){return(0,u.default)(Object.keys(e))})),(0,a.default)(t?Object.keys(t):[]),(0,a.default)(n?Object.keys(n):[]))))};t.isMatchingIndex=function(e,t,n){var r=Object.keys((0,c.default)(e,"views"))[0],a=Object.keys((0,c.default)(e,"views.".concat(r,".map.fields")));if((0,s.default)(a,t)){var i=(0,c.default)(e,"views.".concat(r,".map.partial_filter_selector"));if(!n&&!i)return!0;var o=p(null!=n?n:{});if((0,s.default)(o,i))return!0}return!1};var p=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Object.entries(t).reduce(function(t,r){var a,u=(0,i.default)(r,2),c=u[0],s=u[1];if("$nor"===c)t.$and=s.map(function(e){return Object.entries(e).reduce(function(e,t){var n=(0,i.default)(t,2),r=n[0],a=n[1];return"string"==typeof a?e[r]={$ne:a}:e[r]=p(a,!0),e},{})}).sort(h);else null!==(a=s.$or)&&void 0!==a&&a.every(function(e){return"string"==typeof e})?t.$or=s.$or.map(function(t){return e((0,o.default)({},c,t),n)}).sort(h):Array.isArray(s)&&s.every(l.default)?t[c]=s.map(function(t){return e(t,n)}).sort(h):(0,l.default)(s)&&!Array.isArray(s)?t[c]=e(s,n):n&&"$eq"===c?t.$ne=s:c.startsWith("$")?t[c]=s:t[c]={$eq:s};return t},{}),a=Object.keys(r).sort();return 1===a.length?r:{$and:a.map(function(e){return(0,o.default)({},e,r[e])})}};t.makeOperatorsExplicit=p;var h=function(e,t){var n=Object.keys(e)[0],r=Object.keys(t)[0];return n.localeCompare(r)}},23355:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorReturned=t.default=void 0;var a=r(n(65105)),i=r(n(25665)),o=r(n(27952)),u=r(n(12323)),c=r(n(15500)),s=function(e){(0,i.default)(c,e);var t,n,r=(t=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,u.default)(t);return e=n?Reflect.construct(r,arguments,(0,u.default)(this).constructor):r.apply(this,arguments),(0,o.default)(this,e)});function c(){return(0,a.default)(this,c),r.apply(this,arguments)}return c}((0,c.default)(String));t.ErrorReturned=s;var l=function(e,t){for(var n=Date.now(),r=0,a=Object.keys(e);r<a.length;r++){var i=a[r];n-e[i].date>t&&delete e[i]}};t.default=function(e,t){var n={};return function(){var r,a=t.key.apply(null,arguments);l(n,t.maxDuration);var i=n[a];if(i)return i.result;var o=e.apply(this,arguments);if(n[a]={result:o,date:Date.now()},"object"==typeof(r=o)&&"function"==typeof r.then)o.then(function(e){e instanceof s&&delete n[a]}).catch(function(e){delete n[a]});return o}}},26070:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeDoc=u,t.normalizeDoctypeJsonApi=function(e){return function(t,n){var r=u(t,e);return o(o({},r),r.attributes||{})}},t.normalizeDoctypeRawApi=function(e){return function(t,n){var r=u(n,e);return o(o({},r),r.attributes||{})}};var a=r(n(64512));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=e._id||e.id;return o({id:n,_id:n,_type:t},e)}},20368:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(68434)),i=r(n(82007)),o=r(n(65105)),u=r(n(19723)),c=function(){var e;function t(){(0,o.default)(this,t),this.pending={}}return(0,u.default)(t,[{key:"exec",value:(e=(0,i.default)(a.default.mark(function e(t,n){var r,i,o,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n(),(i=this.pending[r])?o=i:(o=t(),this.pending[r]=o),e.prev=3,e.next=6,o;case 6:return u=e.sent,e.abrupt("return",u);case 8:return e.prev=8,this.pending[r]=null,e.finish(8);case 11:case"end":return e.stop()}},e,this,[[3,,8,11]])})),function(t,n){return e.apply(this,arguments)})},{key:"get",value:function(e){var t=e(),n=this.pending[t];return n?n:null}}]),t}();t.default=c},93726:function(e,t,n){var r=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.buildURL=t.encode=void 0;var a=r(n(90402)),i=r(n(35937)),o=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.isArray(t)?"["+t.map(function(t){return e(t,!0)}).join(",")+"]":n?encodeURIComponent('"'.concat(t,'"')):encodeURIComponent(t)},u=function(e){return Object.entries(e).map(function(e){var t=(0,a.default)(e,2),n=t[0],r=o(t[1]);return"".concat(n,"=").concat(r)}).join("&")};t.encode=u;t.buildURL=function(e,t){var n=u((0,i.default)(t));return n?"".concat(e,"?").concat(n):e}},79312:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={}},66804:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.joinPath=function(e,t){return"".concat(e).concat(e.endsWith("/")?"":"/").concat(t)},t.encodePath=t.forceDownload=t.formatBytes=t.slugify=t.sleep=t.attempt=t.uri=void 0;t.uri=function(e){for(var t=[e[0]],n=0;n<(arguments.length<=1?0:arguments.length-1);n++)t.push(encodeURIComponent(n+1<1||arguments.length<=n+1?void 0:arguments[n+1])+e[n+1]);return t.join("")};t.attempt=function(e){return e.then(function(){return!0}).catch(function(){return!1})};t.sleep=function(e,t){return new Promise(function(n){setTimeout(n,e,t)})};t.slugify=function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")};t.formatBytes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(t<0?0:t))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]};t.forceDownload=function(e,t){var n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)};t.encodePath=function(e){return e.split("/").map(function(e){return encodeURIComponent(e).replace(/\(/g,"%28").replace(/\)/g,"%29")}).join("/")}},38558:function(e,t,n){var r,a=n(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.shouldXMLHTTPRequestBeUsed=t.fetchWithXMLHttpRequest=void 0;var i=a(n(68434)),o=a(n(90402)),u=a(n(82007)),c=a(n(88306));var s=(r=(0,u.default)(i.default.mark(function e(t,n){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(e,r){var a=new XMLHttpRequest;n.onUploadProgress&&a.upload&&a.upload.addEventListener("progress",n.onUploadProgress,!1),a.onload=function(){4==this.readyState?e(this):r(this)},a.onerror=function(e){r(e)},a.open(n.method,t,!0),a.withCredentials=!0;for(var i=0,u=Object.entries(n.headers);i<u.length;i++){var c=(0,o.default)(u[i],2),s=c[0],l=c[1];a.setRequestHeader(s,l)}a.send(n.body)});case 2:return r=e.sent,e.abrupt("return",{headers:new Headers(r.getAllResponseHeaders().split("\r\n").map(function(e){return e.split(":",2)}).filter(function(e){return 2==e.length})),ok:r.status>=200&&r.status<300,text:function(){var e=(0,u.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.responseText);case 1:case"end":return e.stop()}},e)}));return function t(){return e.apply(this,arguments)}}(),json:function(){var e=(0,u.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",JSON.parse(r.responseText));case 1:case"end":return e.stop()}},e)}));return function t(){return e.apply(this,arguments)}}(),status:r.status,statusText:r.statusText});case 4:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});t.fetchWithXMLHttpRequest=s;var l=(0,c.default)(function(){var e=new XMLHttpRequest;return"onload"in e&&"onprogress"in e});t.shouldXMLHTTPRequestBeUsed=function(e,t,n){return!!n.onUploadProgress&&l()}},37504:function(e){e.exports=JSON.parse('{"qualifications":[{"label":"identity_photo","purpose":"attestation","subjects":["identity"]},{"label":"national_id_card","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["identity"]},{"label":"passport","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["identity"]},{"label":"residence_permit","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"immigration","subjects":["permit","identity"]},{"label":"family_record_book","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["family"]},{"label":"birth_certificate","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["identity","family"]},{"label":"driver_license","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"transport","subjects":["permit","driving"]},{"label":"other_identity_document","purpose":"attestation","subjects":["identity"]},{"label":"wedding","purpose":"contract","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["family"]},{"label":"pacs","purpose":"contract","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["family"]},{"label":"divorce","purpose":"contract","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["family"]},{"label":"large_family_card","purpose":"attestation","sourceCategory":"transport","subjects":["right"]},{"label":"caf","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"family","subjects":["right"]},{"label":"other_family_document","subjects":["family"]},{"label":"diploma","purpose":"attestation","sourceCategory":"education","subjects":["achievement"]},{"label":"work_contract","purpose":"contract","sourceCategory":"employer","subjects":["work","employment"]},{"label":"pay_sheet","purpose":"attestation","sourceCategory":"employer","subjects":["work","revenues"]},{"label":"fidelity_card","sourceCategory":"shopping"},{"label":"single_parent_benefit","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"family","subjects":["revenues"]},{"label":"transport_card","sourceCategory":"transport","subjects":["vehicule"]},{"label":"electoral_card","sourceCategory":"gov"},{"label":"employment_center_certificate","purpose":"attestation","sourceCategory":"gov","subjects":["employment"]},{"label":"unemployment_benefit","purpose":"attestation","sourceCategory":"gov","subjects":["revenues"]},{"label":"pension","purpose":"attestation","sourceCategory":"gov","subjects":["revenues"]},{"label":"other_revenue","purpose":"attestation","subjects":["revenues"]},{"label":"gradebook","purpose":"report","sourceCategory":"education","subjects":["history"]},{"label":"student_card","purpose":"attestation","sourceCategory":"education","subjects":["identity","right","employment","education"]},{"label":"resume","purpose":"description","subjects":["employment"]},{"label":"motivation_letter","purpose":"description","subjects":["employment"]},{"label":"other_work_document","purpose":"employment"},{"label":"health_book","purpose":"attestation","sourceCategory":"health","subjects":["capacity","vaccine"]},{"label":"health_certificate","purpose":"attestation","sourceCategory":"health","subjects":["capacity","vaccine"]},{"label":"pregnancy_medical_certificate","purpose":"attestation","sourceCategory":"health","subjects":["pregnancy"]},{"label":"work_disability_recognition","purpose":"attestation","sourceCategory":"health","subjects":["right"]},{"label":"national_health_insurance_card","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"health","subjects":["insurance"]},{"label":"national_health_insurance_right_certificate","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"health","subjects":["right","insurance"]},{"label":"health_insurance_card","purpose":"attestation","sourceCategory":"insurance","sourceSubCategory":"health","subjects":["insurance"]},{"label":"prescription","purpose":"attestation","sourceCategory":"health","subjects":["right","medecine"]},{"label":"health_invoice","purpose":"invoice","sourceCategory":"health"},{"label":"other_health_document","subjects":["health"]},{"label":"vehicle_registration","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"transport","subjects":["vehicule","identity","right"]},{"label":"car_insurance","purpose":"attestation","sourceCategory":"insurance","sourceSubCategory":"transport","subjects":["insurance","car"]},{"label":"mechanic_invoice","purpose":"invoice","sourceCategory":"transport"},{"label":"transport_invoice","purpose":"invoice","sourceCategory":"transport"},{"label":"other_transport_document","sourceCategory":"transport"},{"label":"house_sale_agreeement","purpose":"contract","sourceCategory":"real_estate","subjects":["house"]},{"label":"real_estate_tax","purpose":"invoice","sourceCategory":"gov","sourceSubCategory":"real_estate","subjects":["tax","house"]},{"label":"building_permit","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"real_estate","subjects":["permit","house"]},{"label":"technical_diagnostic_record","purpose":"report","sourceCategory":"real_estate","subjects":["compliance","house"]},{"label":"lease","purpose":"contract","sourceCategory":"real_estate","subjects":["house"]},{"label":"rent_receipt","purpose":"invoice","sourceCategory":"real_estate","subjects":["house"]},{"label":"house_insurance","purpose":"contract","sourceCategory":"insurance","sourceSubCategory":"real_estate","subjects":["insurance","house"]},{"label":"work_quote","purpose":"description","sourceCategory":"building","subjects":["building","house"]},{"label":"work_invoice","purpose":"invoice","sourceCategory":"building","subjects":["building","house"]},{"label":"other_house_document","subjects":["house"]},{"label":"phone_invoice","purpose":"invoice","sourceCategory":"telecom","sourceSubCategory":"mobile"},{"label":"isp_invoice","purpose":"invoice","sourceCategory":"telecom","sourceSubCategory":"internet","subjects":["subscription"]},{"label":"telecom_invoice","purpose":"invoice","sourceCategory":"telecom"},{"label":"energy_invoice","purpose":"invoice","sourceCategory":"energy"},{"label":"water_invoice","purpose":"invoice","sourceCategory":"water"},{"label":"energy_contract","purpose":"contract","sourceCategory":"energy"},{"label":"appliance_invoice","purpose":"invoice","sourceCategory":"retail"},{"label":"web_service_invoice","purpose":"invoice","sourceCategory":"web"},{"label":"restaurant_invoice","purpose":"invoice","sourceCategory":"alimentation"},{"label":"grocery_invoice","purpose":"invoice","sourceCategory":"shopping"},{"label":"other_invoice","purpose":"invoice"},{"label":"tax_certificate","purpose":"attestation","sourceCategory":"gov","subjects":["tax"]},{"label":"tax_return","purpose":"report","sourceCategory":"gov","sourceSubCategory":"tax","subjects":["tax"]},{"label":"tax_notice","purpose":"invoice","sourceCategory":"gov","sourceSubCategory":"tax","subjects":["tax"]},{"label":"tax_timetable","purpose":"report","sourceCategory":"gov","sourceSubCategory":"tax","subjects":["tax"]},{"label":"other_tax_document","subjects":["tax"]},{"label":"bank_details","purpose":"attestation","sourceCategory":"bank","subjects":["bank_account"]},{"label":"bank_statement","purpose":"report","sourceCategory":"bank","subjects":["history"]},{"label":"loan_agreement","purpose":"contract","sourceCategory":"bank"},{"label":"other_bank_document","sourceCategory":"bank"},{"label":"receipt","purpose":"report"},{"label":"payment_proof_family_allowance","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"tax","subjects":["subvention"]},{"label":"school_attendance_certificate","purpose":"attestation","sourceCategory":"education","subjects":["identity","right","education"]},{"label":"school_insurance_certificate","purpose":"attestation","sourceCategory":"education","subjects":["education","insurance"]},{"label":"unfit_for_habitation_declaration","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"real_estate","subjects":["compliance"]},{"label":"accommodation_proof","purpose":"attestation","sourceCategory":"individual","subjects":["address"]},{"label":"citizen_registration_certificate","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["achievement","education"]},{"label":"personal_sporting_licence","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"sport","subjects":["permit","invoice"]},{"label":"other_activity_document","sourceSubCategory":"sport","subjects":["permit","invoice"]},{"label":"real_estate_insurance","purpose":"contract","sourceCategory":"insurance","sourceSubCategory":"real_estate","subjects":["insurance"]},{"label":"person_insurance","purpose":"contract","sourceCategory":"insurance","subjects":["insurance"]},{"label":"other_administrative_document"},{"label":"expense_claim","purpose":"invoice"},{"label":"fine","purpose":"invoice","sourceCategory":"gov"},{"label":"condition_report","purpose":"contract","sourceCategory":"real_estate","subjects":["house"]},{"label":"note_identity_document"},{"label":"note_family_document"},{"label":"note_work_document"},{"label":"note_health_document"},{"label":"note_house_document"},{"label":"note_transport_document"},{"label":"note_activity_document"},{"label":"note_finance"},{"label":"note_invoice"}],"purposeKnownValues":["attestation","contract","invoice","report","description","evaluation","employment"],"sourceCategoryKnownValues":["bank","insurance","retail","telecom","energy","water","health","gov","association","education","employer","transport","goods","alimentation","building","real_estate","web","individual","shopping"],"sourceSubCategoryKnownValues":["civil_registration","immigration","transport","family","tax","health","real_estate","mobile","internet","citizen","sport"],"subjectsKnownValues":["identity","permit","family","address","driving","right","subvention","achievement","degree","work","employment","revenues","history","insurance","medical_act","vehicule","car","moto","truck","boat","subscription","buy/sale","house","compliance","building","food","real_estate","tax","address","education","statement","course","internet","phone","vaccine","capacity","health","drugs","child","pregnancy","bank_account"]}')},20455:function(e){e.exports=JSON.parse('{"nationalities":{"AD":"Andorran","AE":"Emirian","AF":"Afghan","AG":"Antiguans","AL":"Albanian","AM":"Armenian","AO":"Angolan","AR":"Argentinean","AT":"Austrian","AU":"Australian","AX":"\xc5land Islands","AZ":"Azerbaijani","BA":"Bosnian - Herzegovinian","BB":"Barbadian","BD":"Bangladeshi","BE":"Belgian","BF":"Burkinabe","BG":"Bulgarian","BH":"Bahraini","BI":"Burundian","BJ":"Beninese","BL":"Saint Barth\xe9lemy","BM":"Bermuda","BN":"Bruneian","BO":"Bolivian","BQ":"Bonaire, Sint Eustatius and Saba","BR":"Brazilian","BS":"Bahamian","BT":"Bhutanese","BV":"Bouvet Island","BW":"Batswana","BY":"Belarusian","BZ":"Belizean","CA":"Canadian","CC":"Cocos (Keeling) Islands","CD":"Congolese (Democratic Republic of the Congo)","CF":"Central African","CG":"Congolese (Republic of the Congo)","CH":"Swiss","CI":"Ivorian","CK":"Cook Islands","CL":"Chilean","CM":"Cameroonian","CN":"Chinese","CO":"Colombian","CR":"Costa Rican","CU":"Cuban","CV":"Cape Verdean","CW":"Cura\xe7ao","CX":"Christmas Island","CY":"Cypriot","CZ":"Czech","DE":"German","DJ":"Djibouti","DK":"Danish","DM":"Dominican (Dominica)","DO":"Dominican (Dominican Republic)","DZ":"Algerian","EC":"Ecuadorean","EE":"Estonian","EG":"Egyptian","EH":"Western Sahara","ER":"Eritrean","ES":"Spanish","ET":"Ethiopian","FI":"Finnish","FJ":"Fijian","FK":"Falkland Islands (Malvinas)","FM":"Micronesian","FO":"Faroe Islands","FR":"French","GA":"Gabonese","GB":"British","GD":"Grenadian","GE":"Georgian","GF":"French (French Guiana)","GG":"Guernsey","GH":"Ghanaian","GI":"Gibraltar","GL":"Greenland","GM":"Gambian","GN":"Guinean","GP":"Guadeloupe","GQ":"Equatorial Guinean","GR":"Greek","GS":"South Georgia and the South Sandwich Islands","GT":"Guatemalan","GU":"Guam","GW":"Guinea-Bissauan","GY":"Guyanese","HK":"Hong Kong","HM":"Heard Island and Mcdonald Islands","HN":"Honduran","HR":"Croatian","HT":"Haitian","HU":"Hungarian","ID":"Indonesian","IE":"Irish","IL":"Israeli","IM":"Manx","IN":"Indian","IO":"British Indian Ocean Territory","IQ":"Iraqi","IR":"Iranian","IS":"Icelandic","IT":"Italian","JE":"Jersey","JM":"Jamaican","JO":"Jordanian","JP":"Japanese","KE":"Kenyan","KG":"Kyrgyz","KH":"Cambodian","KI":"I-Kiribati","KM":"Comoran","KN":"Kittian and Nevisian","KP":"North Korean","KR":"South Korean","KW":"Kuwaiti","KY":"Cayman Islands","KZ":"Kazakhstani","LA":"Laotian","LB":"Lebanese","LC":"Saint Lucian","LI":"Liechtensteiner","LK":"Sri Lankan","LR":"Liberian","LS":"Mosotho","LT":"Lithuanian","LU":"Luxembourger","LV":"Latvian","LY":"Libyan","MA":"Moroccan","MC":"Monacan","MD":"Moldovan","ME":"Montenegrin","MF":"Saint Martin (French part)","MG":"Malagasy","MH":"Marshallese","MK":"Macedonian","ML":"Malian","MM":"Burmese","MN":"Mongolian","MO":"Macao","MP":"Northern Mariana Islands","MQ":"Martinique","MR":"Mauritanian","MS":"Montserrat","MT":"Maltese","MU":"Mauritian","MV":"Maldivan","MW":"Malawian","MX":"Mexican","MY":"Malaysian","MZ":"Mozambican","NA":"Namibian","NC":"New Caledonia","NE":"Nigerien","NF":"Norfolk Island","NG":"Nigerian","NI":"Nicaraguan","NL":"Dutch","NO":"Norwegian","NP":"Nepalese","NR":"Nauruan","NU":"Niue","NZ":"New Zealander","OM":"Omani","PA":"Panamanian","PE":"Peruvian","PF":"French (French Polynesia)","PG":"Papua New Guinea","PH":"Filipino","PK":"Pakistani","PL":"Polish","PM":"Saint Pierre and Miquelon","PN":"Pitcairn","PR":"Puerto Rico","PS":"Palestinian Territory, Occupied","PT":"Portuguese","PW":"Palauan","PY":"Paraguayan","QA":"Qatari","RE":"Reunion","RO":"Romanian","RS":"Serbian","RU":"Russian","RW":"Rwandan","SA":"Saudi","SB":"Solomon Islander","SC":"Seychellois","SD":"Sudanese","SE":"Swedish","SG":"Singaporean","SH":"Saint Helena","SI":"Slovenian","SJ":"Svalbard and Jan Mayen","SK":"Slovakian","SL":"Sierra Leonean","SM":"San Marinese","SN":"Senegalese","SO":"Somali","SR":"Surinamer","SS":"South Sudan","ST":"Sao Tomean","SV":"Salvadoran","SX":"Sint Maarten (Dutch part)","SY":"Syrian","SZ":"Swazi","TC":"Turks and Caicos Islands","TD":"Chadian","TF":"French (French Southern Territories)","TG":"Togolese","TH":"Thai","TJ":"Tajik","TK":"Tokelau","TL":"East Timorese","TM":"Turkmenistan","TN":"Tunisian","TO":"Tongan","TR":"Turkish","TT":"Trinidadian or Tobagonian","TV":"Tuvaluan","TW":"Taiwanese","TZ":"Tanzanian","UA":"Ukrainian","UG":"Ugandan","UM":"United States Minor Outlying Islands","US":"American","UY":"Uruguayan","UZ":"Uzbekistani","VA":"Holy See (Vatican City State)","VC":"Saint Vincent and the Grenadines","VE":"Venezuelan","VG":"Virgin Islands, British","VI":"Virgin Islands, U.S.","VN":"Vietnamese","VU":"Vanuatu","WF":"Welsh","WS":"Samoan","YE":"Yemenite","YT":"Mayotte","ZA":"South African","ZM":"Zambian","ZW":"Zimbabwean"},"countries":{"AD":"Andorra","AE":"United Arab Emirates","AF":"Afghanistan","AG":"Antigua and Barbuda","AL":"Albania","AM":"Armenia","AO":"Angola","AR":"Argentina","AT":"Austria","AU":"Australia","AX":"\xc5land Islands","AZ":"Azerbaijan","BA":"Bosnia and Herzegovina","BB":"Barbados","BD":"Bangladesh","BE":"Belgium","BF":"Burkina Faso","BG":"Bulgaria","BH":"Bahrain","BI":"Burundi","BJ":"Benin","BL":"Saint Barth\xe9lemy","BM":"Bermuda","BN":"Brunei Darussalam","BO":"Bolivia","BQ":"Bonaire, Sint Eustatius and Saba","BR":"Brazil","BS":"Bahamas","BT":"Bhutan","BV":"Bouvet Island","BW":"Botswana","BY":"Belarus","BZ":"Belize","CA":"Canada","CC":"Cocos (Keeling) Islands","CD":"Democratic Republic of the Congo","CF":"Central African Republic","CG":"Republic of the Congo","CH":"Switzerland","CI":"Ivory Coast","CK":"Cook Islands","CL":"Chile","CM":"Cameroon","CN":"People\'s Republic of China","CO":"Colombia","CR":"Costa Rica","CU":"Cuba","CV":"Cape Verde","CW":"Cura\xe7ao","CX":"Christmas Island","CY":"Cyprus","CZ":"Czech Republic","DE":"Germany","DJ":"Djibouti","DK":"Denmark","DM":"Dominica","DO":"Dominican Republic","DZ":"Algeria","EC":"Ecuador","EE":"Estonia","EG":"Egypt","EH":"Western Sahara","ER":"Eritrea","ES":"Spain","ET":"Ethiopia","FI":"Finland","FJ":"Fiji","FK":"Falkland Islands (Malvinas)","FM":"Micronesia, Federated States of","FO":"Faroe Islands","FR":"France","GA":"Gabon","GB":"United Kingdom","GD":"Grenada","GE":"Georgia","GF":"French Guiana","GG":"Guernsey","GH":"Ghana","GI":"Gibraltar","GL":"Greenland","GM":"Gambia","GN":"Guinea","GP":"Guadeloupe","GQ":"Equatorial Guinea","GR":"Greece","GS":"South Georgia and the South Sandwich Islands","GT":"Guatemala","GU":"Guam","GW":"Guinea-Bissau","GY":"Guyana","HK":"Hong Kong","HM":"Heard Island and McDonald Islands","HN":"Honduras","HR":"Croatia","HT":"Haiti","HU":"Hungary","ID":"Indonesia","IE":"Ireland","IL":"Israel","IM":"Isle of Man","IN":"India","IO":"British Indian Ocean Territory","IQ":"Iraq","IR":"Iran","IS":"Iceland","IT":"Italy","JE":"Jersey","JM":"Jamaica","JO":"Jordan","JP":"Japan","KE":"Kenya","KG":"Kyrgyzstan","KH":"Cambodia","KI":"Kiribati","KM":"Comoros","KN":"Saint Kitts and Nevis","KP":"North Korea","KR":"South Korea","KW":"Kuwait","KY":"Cayman Islands","KZ":"Kazakhstan","LA":"Lao People\'s Democratic Republic","LB":"Lebanon","LC":"Saint Lucia","LI":"Liechtenstein","LK":"Sri Lanka","LR":"Liberia","LS":"Lesotho","LT":"Lithuania","LU":"Luxembourg","LV":"Latvia","LY":"Libya","MA":"Morocco","MC":"Monaco","MD":"Moldova, Republic of","ME":"Montenegro","MF":"Saint Martin (French part)","MG":"Madagascar","MH":"Marshall Islands","MK":"North Macedonia","ML":"Mali","MM":"Myanmar","MN":"Mongolia","MO":"Macao","MP":"Northern Mariana Islands","MQ":"Martinique","MR":"Mauritania","MS":"Montserrat","MT":"Malta","MU":"Mauritius","MV":"Maldives","MW":"Malawi","MX":"Mexico","MY":"Malaysia","MZ":"Mozambique","NA":"Namibia","NC":"New Caledonia","NE":"Niger","NF":"Norfolk Island","NG":"Nigeria","NI":"Nicaragua","NL":"Netherlands","NO":"Norway","NP":"Nepal","NR":"Nauru","NU":"Niue","NZ":"New Zealand","OM":"Oman","PA":"Panama","PE":"Peru","PF":"French Polynesia","PG":"Papua New Guinea","PH":"Philippines","PK":"Pakistan","PL":"Poland","PM":"Saint Pierre and Miquelon","PN":"Pitcairn Islands","PR":"Puerto Rico","PS":"Palestine","PT":"Portugal","PW":"Palau","PY":"Paraguay","QA":"Qatar","RE":"Reunion","RO":"Romania","RS":"Serbia","RU":"Russia","RW":"Rwanda","SA":"Saudi Arabia","SB":"Solomon Islands","SC":"Seychelles","SD":"Sudan","SE":"Sweden","SG":"Singapore","SH":"Saint Helena","SI":"Slovenia","SJ":"Svalbard and Jan Mayen","SK":"Slovakia","SL":"Sierra Leone","SM":"San Marino","SN":"Senegal","SO":"Somalia","SR":"Suriname","SS":"South Sudan","ST":"Sao Tome and Principe","SV":"El Salvador","SX":"Sint Maarten (Dutch part)","SY":"Syrian Arab Republic","SZ":"Eswatini","TC":"Turks and Caicos Islands","TD":"Chad","TF":"French Southern Territories","TG":"Togo","TH":"Thailand","TJ":"Tajikistan","TK":"Tokelau","TL":"Timor-Leste","TM":"Turkmenistan","TN":"Tunisia","TO":"Tonga","TR":"Turkey","TT":"Trinidad and Tobago","TV":"Tuvalu","TW":"Taiwan","TZ":"United Republic of Tanzania","UA":"Ukraine","UG":"Uganda","UM":"United States Minor Outlying Islands","US":"United States of America","UY":"Uruguay","UZ":"Uzbekistan","VA":"Holy See (Vatican City State)","VC":"Saint Vincent and the Grenadines","VE":"Venezuela","VG":"Virgin Islands, British","VI":"Virgin Islands, U.S.","VN":"Vietnam","VU":"Vanuatu","WF":"Wallis and Futuna","WS":"Samoa","YE":"Yemen","YT":"Mayotte","ZA":"South Africa","ZM":"Zambia","ZW":"Zimbabwe"}}')},40883:function(e){e.exports=JSON.parse('{"nationalities":{"AD":"Andorran","AE":"\xc9mirien","AF":"Afghan","AG":"Antiguayen","AL":"Albanais","AM":"Arm\xe9nien","AO":"Angolais","AR":"Argentin","AT":"Autrichien","AU":"Australien","AX":"\xceles Aland","AZ":"Azerba\xefdjanais","BA":"Bosnien","BB":"Barbadien","BD":"Bangladais","BE":"Belge","BF":"Burkinab\xe9","BG":"Bulgare","BH":"Bahre\xefnien","BI":"Burundais","BJ":"B\xe9ninois","BL":"Saint-Barth\xe9lemy","BM":"Bermudien","BN":"Brun\xe9ien","BO":"Bolivien","BQ":"Pays-Bas Carib\xe9ens","BR":"Br\xe9silien","BS":"Bahamien","BT":"Bhoutanais","BV":"\xcele Bouvet","BW":"Botswanais","BY":"Bi\xe9lorusse","BZ":"B\xe9lizien","CA":"Canadien","CC":"\xceles Cocos","CD":"Congolais (R\xe9publique d\xe9mocratique du Congo)","CF":"Centrafricain","CG":"Congolais (R\xe9publique du Congo)","CH":"Suisse","CI":"Ivoirien","CK":"\xceles Cook","CL":"Chilien","CM":"Camerounais","CN":"Chinois","CO":"Colombien","CR":"Costaricain","CU":"Cubain","CV":"Cap verdien","CW":"Curacien","CX":"L\'\xeele Christmas","CY":"Chypriote","CZ":"Tch\xe8que","DE":"Allemand","DJ":"Djiboutien","DK":"Danois","DM":"Dominicain (Dominique)","DO":"Dominicain (R\xe9publique dominicaine)","DZ":"Alg\xe9rien","EC":"\xc9quatorien","EE":"Estonien","EG":"\xc9gyptien","EH":"Sahara Occidental","ER":"\xc9rythr\xe9en","ES":"Espagnol","ET":"\xc9thiopien","FI":"Finlandais","FJ":"Fidjien","FK":"Malouin","FM":"Micron\xe9sien","FO":"F\xe9ro\xefen","FR":"Fran\xe7ais","GA":"Gabonais","GB":"Britannique","GD":"Grenadien","GE":"G\xe9orgien","GF":"Fran\xe7ais (Guyane)","GG":"Guernesiais","GH":"Ghan\xe9en","GI":"Gibraltariens","GL":"Groenlandais","GM":"Gambien","GN":"Guin\xe9en","GP":"Guadeloup\xe9en","GQ":"\xc9quato-guin\xe9en","GR":"Grec","GS":"G\xe9orgie du Sud et les \xeeles Sandwich du Sud","GT":"Guat\xe9malt\xe8que","GU":"Guam","GW":"Bissaoguin\xe9en","GY":"Guyanais","HK":"Hongkongais","HM":"\xceles Heard-et-MacDonald","HN":"Hondurien","HR":"Croate","HT":"Ha\xeftien","HU":"Hongrois","ID":"Indon\xe9sien","IE":"Irlandais","IL":"Isra\xe9lien","IM":"\xcele de Man","IN":"Indien","IO":"Territoire britannique de l\'oc\xe9an Indien","IQ":"Irakien","IR":"Iranien","IS":"Islandais","IT":"Italien","JE":"Jersiais","JM":"Jama\xefquain","JO":"Jordanien","JP":"Japonais","KE":"K\xe9nyan","KG":"Kirghiz","KH":"Cambodgien","KI":"Kiribatiens","KM":"Comorien","KN":"Afro-Kittitien et Afro-Nevisien","KP":"Nord cor\xe9en","KR":"Sud cor\xe9en","KW":"Kowe\xeftien","KY":"Ca\xefmanien","KZ":"Kazakhstanais","LA":"Laotien","LB":"Libanais","LC":"Saint-Lucien","LI":"Liechtensteinois","LK":"Sri Lankais","LR":"Liberian","LS":"Mosotho","LT":"Lituanien","LU":"Luxembourgeois","LV":"Letton","LY":"Libyen","MA":"Marocain","MC":"Mon\xe9gasque","MD":"Moldave","ME":"Mont\xe9n\xe9grin","MF":"Saint-Martinois (France)","MG":"Malgache","MH":"Marshallais","MK":"Mac\xe9donien","ML":"Malien","MM":"Birman","MN":"Mongol","MO":"Macan\xe9en","MP":"\xceles Mariannes du Nord","MQ":"Martiniquais","MR":"Mauritanien","MS":"Montserratien","MT":"Maltais","MU":"Mauricien","MV":"Maldivien","MW":"Malawien","MX":"Mexicain","MY":"Malaisien","MZ":"Mozambicain","NA":"Namibien","NC":"N\xe9o-Cal\xe9donien","NE":"Nig\xe9rien","NF":"Norfolkais","NG":"Nig\xe9rian","NI":"Nicaraguayen","NL":"N\xe9erlandais","NO":"Norv\xe9gien","NP":"N\xe9palais","NR":"Nauruan","NU":"Niu\xe9en","NZ":"N\xe9o-Z\xe9landais","OM":"Omanais","PA":"Panam\xe9en","PE":"P\xe9ruvien","PF":"Fran\xe7ais (Polyn\xe9sie fran\xe7aise)","PG":"Papouasien","PH":"Philippin","PK":"Pakistanais","PL":"Polonais","PM":"Saint-Pierrais ou Miquelonais","PN":"\xceles Pitcairn","PR":"Portoricain","PS":"Territoires Palestiniens, Occup\xe9s","PT":"Portugais","PW":"Palauan","PY":"Paraguayen","QA":"Qatarien","RE":"R\xe9unionnais","RO":"Roumain","RS":"Serbe","RU":"Russe","RW":"Rwandais","SA":"Saoudien","SB":"Salomonais","SC":"Seychellois","SD":"Soudanais","SE":"Su\xe9dois","SG":"Singapourien","SH":"Sainte H\xe9l\xe8ne","SI":"Slov\xe8ne","SJ":"Svalbard et Jan Mayen","SK":"Slovaque","SL":"Sierra L\xe9onais","SM":"Saint-Marinais","SN":"S\xe9n\xe9galais","SO":"Somalien","SR":"Surinamais","SS":"Sud-Soudanais","ST":"Santom\xe9en","SV":"Salvadorien","SX":"Saint-Martinois (Pays-Bas)","SY":"Syrien","SZ":"Swazi","TC":"\xceles Turques-et-Ca\xefques","TD":"Tchadien","TF":"Fran\xe7ais (TAAF)","TG":"Togolais","TH":"Tha\xeflandais","TJ":"Tadjik","TK":"Tok\xe9laou","TL":"Est-Timorais","TM":"Turkm\xe8ne","TN":"Tunisien","TO":"Tongien","TR":"Turc","TT":"Trinidadien ou Tobagonien","TV":"Tuvalais","TW":"Ta\xefwanais","TZ":"Tanzanien","UA":"Ukrainien","UG":"Ougandais","UM":"\xceles mineures \xe9loign\xe9es des \xc9tats-Unis","US":"Am\xe9ricain","UY":"Uruguayen","UZ":"Ouzbek","VA":"Saint-Si\xe8ge (\xc9tat de la cit\xe9 du Vatican)","VC":"Vincentais","VE":"V\xe9n\xe9zu\xe9lien","VG":"\xceles Vierges Britanniques","VI":"\xceles Vierges Am\xe9ricaines","VN":"Vietnamien","VU":"Vanuatais","WF":"Gallois","WS":"Samoan","YE":"Y\xe9m\xe9nite","YT":"Mahorais","ZA":"Sud Africain","ZM":"Zambien","ZW":"Zimbabw\xe9en"},"countries":{"AD":"Andorre","AE":"\xc9mirats Arabes Unis","AF":"Afghanistan","AG":"Antigua-et-Barbuda","AL":"Albanie","AM":"Arm\xe9nie","AO":"Angola","AR":"Argentine","AT":"Autriche","AU":"Australie","AX":"\xc5land","AZ":"Azerba\xefdjan","BA":"Bosnie-Herz\xe9govine","BB":"Barbade","BD":"Bangladesh","BE":"Belgique","BF":"Burkina Faso","BG":"Bulgarie","BH":"Bahre\xefn","BI":"Burundi","BJ":"B\xe9nin","BL":"Saint-Barth\xe9lemy","BM":"Bermudes","BN":"Brunei Darussalam","BO":"Bolivie","BQ":"Bonaire, Saint-Eustache et Saba","BR":"Br\xe9sil","BS":"Bahamas","BT":"Bhoutan","BV":"\xcele Bouvet","BW":"Botswana","BY":"Bi\xe9lorussie","BZ":"Belize","CA":"Canada","CC":"\xceles Cocos","CD":"R\xe9publique d\xe9mocratique du Congo","CF":"R\xe9publique Centrafricaine","CG":"R\xe9publique du Congo","CH":"Suisse","CI":"C\xf4te-d\'Ivoire","CK":"\xceles Cook","CL":"Chili","CM":"Cameroun","CN":"Chine","CO":"Colombie","CR":"Costa Rica","CU":"Cuba","CV":"Cap-Vert","CW":"Cura\xe7ao","CX":"\xcele Christmas","CY":"Chypre","CZ":"R\xe9publique Tch\xe8que","DE":"Allemagne","DJ":"Djibouti","DK":"Danemark","DM":"Dominique","DO":"R\xe9publique Dominicaine","DZ":"Alg\xe9rie","EC":"\xc9quateur","EE":"Estonie","EG":"\xc9gypte","EH":"Sahara occidental","ER":"\xc9rythr\xe9e","ES":"Espagne","ET":"\xc9thiopie","FI":"Finlande","FJ":"Fidji","FK":"\xceles Malouines","FM":"Micron\xe9sie","FO":"\xceles F\xe9ro\xe9","FR":"France","GA":"Gabon","GB":"Royaume-Uni","GD":"Grenade","GE":"G\xe9orgie","GF":"Guyane fran\xe7aise","GG":"Guernesey","GH":"Ghana","GI":"Gibraltar","GL":"Groenland","GM":"Gambie","GN":"Guin\xe9e","GP":"Guadeloupe","GQ":"Guin\xe9e \xe9quatoriale","GR":"Gr\xe8ce","GS":"G\xe9orgie du Sud-et-les \xceles Sandwich du Sud","GT":"Guatemala","GU":"Guam","GW":"Guin\xe9e-Bissau","GY":"Guyana","HK":"Hong Kong","HM":"\xceles Heard-et-MacDonald","HN":"Honduras","HR":"Croatie","HT":"Ha\xefti","HU":"Hongrie","ID":"Indon\xe9sie","IE":"Irlande","IL":"Isra\xebl","IM":"\xcele de Man","IN":"Inde","IO":"Oc\xe9an Indien Britannique","IQ":"Irak","IR":"Iran","IS":"Islande","IT":"Italie","JE":"Jersey","JM":"Jama\xefque","JO":"Jordanie","JP":"Japon","KE":"Kenya","KG":"Kirghizistan","KH":"Cambodge","KI":"Kiribati","KM":"Comores","KN":"Saint-Christophe-et-Ni\xe9v\xe8s","KP":"Cor\xe9e du Nord","KR":"Cor\xe9e du Sud","KW":"Kowe\xeft","KY":"\xceles Ca\xefmans","KZ":"Kazakhstan","LA":"Laos","LB":"Liban","LC":"Sainte-Lucie","LI":"Liechtenstein","LK":"Sri Lanka","LR":"Lib\xe9ria","LS":"Lesotho","LT":"Lituanie","LU":"Luxembourg","LV":"Lettonie","LY":"Libye","MA":"Maroc","MC":"Monaco","MD":"Moldavie","ME":"Mont\xe9n\xe9gro","MF":"Saint-Martin (partie fran\xe7aise)","MG":"Madagascar","MH":"\xceles Marshall","MK":"Mac\xe9doine du Nord","ML":"Mali","MM":"Myanmar","MN":"Mongolie","MO":"Macao","MP":"\xceles Mariannes du Nord","MQ":"Martinique","MR":"Mauritanie","MS":"Montserrat","MT":"Malte","MU":"Maurice","MV":"Maldives","MW":"Malawi","MX":"Mexique","MY":"Malaisie","MZ":"Mozambique","NA":"Namibie","NC":"Nouvelle-Cal\xe9donie","NE":"Niger","NF":"\xcele Norfolk","NG":"Nig\xe9ria","NI":"Nicaragua","NL":"Pays-Bas","NO":"Norv\xe8ge","NP":"N\xe9pal","NR":"Nauru","NU":"Niu\xe9","NZ":"Nouvelle-Z\xe9lande","OM":"Oman","PA":"Panama","PE":"P\xe9rou","PF":"Polyn\xe9sie fran\xe7aise","PG":"Papouasie-Nouvelle-Guin\xe9e","PH":"Philippines","PK":"Pakistan","PL":"Pologne","PM":"Saint-Pierre-et-Miquelon","PN":"\xceles Pitcairn","PR":"Porto Rico","PS":"Palestine","PT":"Portugal","PW":"Palaos","PY":"Paraguay","QA":"Qatar","RE":"R\xe9union","RO":"Roumanie","RS":"Serbie","RU":"Russie","RW":"Rwanda","SA":"Arabie Saoudite","SB":"\xceles Salomon","SC":"Seychelles","SD":"Soudan","SE":"Su\xe8de","SG":"Singapour","SH":"Sainte-H\xe9l\xe8ne","SI":"Slov\xe9nie","SJ":"Svalbard et \xcele Jan Mayen","SK":"Slovaquie","SL":"Sierra Leone","SM":"Saint-Marin","SN":"S\xe9n\xe9gal","SO":"Somalie","SR":"Suriname","SS":"Soudan du Sud","ST":"S\xe3o Tom\xe9-et-Principe","SV":"El Salvador","SX":"Saint-Martin (partie n\xe9erlandaise)","SY":"Syrie","SZ":"Royaume d\'Eswatini","TC":"\xceles Turques-et-Ca\xefques","TD":"Tchad","TF":"Terres australes fran\xe7aises","TG":"Togo","TH":"Tha\xeflande","TJ":"Tadjikistan","TK":"Tokelau","TL":"Timor-Leste","TM":"Turkm\xe9nistan","TN":"Tunisie","TO":"Tonga","TR":"Turquie","TT":"Trinit\xe9-et-Tobago","TV":"Tuvalu","TW":"Ta\xefwan","TZ":"R\xe9publique unie de Tanzanie","UA":"Ukraine","UG":"Ouganda","UM":"\xceles mineures \xe9loign\xe9es des \xc9tats-Unis","US":"\xc9tats-Unis d\'Am\xe9rique","UY":"Uruguay","UZ":"Ouzb\xe9kistan","VA":"Saint-Si\xe8ge (Vatican)","VC":"Saint-Vincent-et-les-Grenadines","VE":"Venezuela","VG":"\xceles vierges britanniques","VI":"\xceles vierges am\xe9ricaines","VN":"Vietnam","VU":"Vanuatu","WF":"Wallis-et-Futuna","WS":"Samoa","YE":"Y\xe9men","YT":"Mayotte","ZA":"Afrique du Sud","ZM":"Zambie","ZW":"Zimbabwe"}}')},28330:function(e){e.exports=JSON.parse('{"country":{"foreign":"Foreign"},"Scan":{"scan_a_doc":"Scan a doc","save_doc":"Save the doc","filename":"Filename","save":"Save","cancel":"Cancel","qualify":"Describe","apply":"Apply","error":{"offline":"You are currently offline and you can\'t use this functionality. Please, try again later.","uploading":"You are already uploading a file. Please wait until the end of this upload and try again.","generic":"Something went wrong. Please try again."},"successful":{"qualified_ok":"You just have successfully described your file! "},"items":{"accommodation_proof":"Proof of accommodation |||| Proof of accommodations","appliance_invoice":"Appliance invoice |||| Appliance invoices","bank_details":"Bank detail |||| Bank details","bank_statement":"Bank statement |||| Bank statements","birth_certificate":"Birth certificate |||| Birth certificates","building_permit":"Building permit |||| Building permits","caf":"Social benefit rate |||| Social benefit rates","car_insurance":"Car insurance certificate |||| Car insurance certificates","citizen_registration_certificate":"Certificate of citizen registration |||| Certificates of citizen registration","condition_report":"Condition report |||| Condition reports","diploma":"Diploma |||| Diplomas","divorce":"Divorce |||| Divorces","driver_license":"Driving license |||| Driving licenses","electoral_card":"Electoral card |||| Electoral cards","employment_center_certificate":"Employment center certificate |||| Employment center certificates","energy_contract":"Energy provider contract |||| Energy provider contracts","energy_invoice":"Energy invoice |||| Energy invoices","expense_claim":"Expense claim |||| Expense claims","family_record_book":"Family record book |||| Family record books","family":"Family","fidelity_card":"Benefit card |||| Benefit cards","fine":"Fine |||| Fines","gradebook":"Gradebook |||| Gradebooks","grocery_invoice":"Grocery invoice |||| Grocery invoices","health_book":"Health book |||| Health books","health_certificate":"Health/Vaccination certificate |||| Health/Vaccination certificates","health_insurance_card":"Insurance card |||| Insurance cards","health_invoice":"Health invoice |||| Health invoices","health":"Health","home":"Home","house_insurance":"Home insurance |||| Home insurances","house_sale_agreeement":"House sale agreement |||| House sale agreements","identity_photo":"Identity photo |||| Identity photos","identity":"Identity","invoice":"Invoice |||| Invoices","isp_invoice":"ISP invoice |||| ISP invoices","large_family_card":" Large Family Card |||| Large Family Cards","lease":"Lease |||| Leases","loan_agreement":"Loan agreement |||| Loan agreements","mechanic_invoice":"Repair bill |||| Repair bills","motivation_letter":"Motivation letter |||| Motivation letters","national_health_insurance_card":"National health insurance card |||| National health insurance cards","national_health_insurance_right_certificate":"National health insurance right certificate |||| National health insurance right certificates","national_id_card":"ID card |||| ID cards","note_identity_document":"Note Identity |||| Notes Identity","note_family_document":"Note Family |||| Notes Family","note_work_document":"Note Work & Study |||| Notes Work & Study","note_health_document":"Note Health |||| Notes Health","note_house_document":"Note Home |||| Notes Home","note_transport_document":"Note Transport |||| Notes Transport","note_activity_document":"Note Activities |||| Notes Activities","note_finance":"Note Finance |||| Notes Finance","note_invoice":"Note Invoice |||| Notes Invoice","other_activity_document":"Other activities document |||| Other activities documents","other_bank_document":"Other financial document |||| Other financial documents","other_family_document":"Other family document |||| Other family documents","other_health_document":"Other health document |||| Other health documents","other_house_document":"Other house document |||| Other house documents","other_identity_document":"Other document of identity |||| Other documents of identity","other_invoice":"Other invoice |||| Other invoices","other_revenue":"Other revenue |||| Other revenues","other_tax_document":"Other tax document |||| Other tax documents","other_transport_document":"Other transport document |||| Other transport documents","other_work_document":"Other work document |||| Other work documents","other_administrative_document":"Other administrative document |||| Other administrative documents","others":"Others","pacs":"Civil union |||| Civil unions","passport":"Passeport |||| Passeports","pay_sheet":"Pay sheet |||| Pay sheets","payment_proof_family_allowance":"family allowance payment proof |||| family allowance payment proofs","pension":"Pension |||| Pensions","person_insurance":"Individual insurance certificate |||| Individual insurance certificates","personal_sporting_licence":"Sporting licence |||| Sporting licences","phone_invoice":"Phone invoice |||| Phone invoices","pregnancy_medical_certificate":"Certificate of pregnancy |||| Certificates of pregnancy","prescription":"Prescription |||| Prescriptions","real_estate_insurance":"Real estate insurance certificate |||| Real estate insurance certificates","real_estate_tax":"Real estate tax |||| Real estate taxes","receipt":"Receipt |||| Receipts","rent_receipt":"Rent receipt |||| Rent receipts","residence_permit":"Residence permit |||| Residence permits","restaurant_invoice":"Restaurant invoice |||| Restaurant invoices","resume":"Resume |||| Resumes","school_attendance_certificate":"Certificate of school attendance |||| Certificates of school attendance","school_insurance_certificate":"Certificate of school insurance |||| Certificates of school insurance","single_parent_benefit":"Single parent benefit |||| Single parent benefits","student_card":"Student card |||| Student cards","tax_certificate":"Tax certificate |||| Tax certificates","tax_notice":"Tax notice |||| Tax notices","tax_return":"Tax return |||| Tax returns","tax_timetable":"Payment Plans Installment Agreement |||| Payment Plans Installment Agreements","technical_diagnostic_record":"Technical diagnostic record |||| Technical diagnostic records","telecom_invoice":"Telecom invoice |||| Telecom invoices","transport_card":"Transport card |||| Transport cards","transport_invoice":"Transport invoice |||| Transport invoices","transport":"Transport","unemployment_benefit":"Unemployment benefit |||| Unemployment benefits","unfit_for_habitation_declaration":"Declaration of unfit for habitation |||| Declarations of unfit for habitation","vehicle_registration":"Vehicle registration |||| Vehicle registrations","water_invoice":"Water invoice |||| Water invoices","web_service_invoice":"Web service invoice |||| Web service invoices","wedding":"Wedding contract |||| Wedding contracts","work_contract":"Work contract |||| Work contracts","work_disability_recognition":"Recognition of disability |||| Recognitions of disability","work_invoice":"Work invoice |||| Work invoices","work_quote":"Work quote |||| Work quotes","work_study":"Work & Study"},"attributes":{"contractType":{"cdi":"CDI","cdd":"CDD","alternate":"Alternate","internship":"Internship","other":"Other"},"noticePeriod":{"oneWeek":"1 week before","oneMonth":"1 month before","threeMonth":"3 months before","oneYear":"1 year before","custom":"Custom","noAlert":"Do not be alerted"}},"themes":{"activity":"Activities","family":"Family","finance":"Finance","health":"Health","home":"Home","identity":"Identity","invoice":"Invoice","others":"Others","transport":"Transport","undefined":"Undefined","work_study":"Work & Study"},"expiration":{"expired":"Expired","expiresIn":"Expires in %{duration}","description":"This document expires in %{duration}, consider renewing it"},"qualification":{"date":{"title":{"datetime":"Added on","AObtentionDate":"License A, delivered on","BObtentionDate":"License B, delivered on","CObtentionDate":"License C, delivered on","DObtentionDate":"License D, delivered on","issueDate":"Delivered on","expirationDate":"Expiration date","referencedDate":"Referenced date","shootingDate":"Shooting date","obtentionDate":"Date obtained","date":"Document date"}},"information":{"title":{"fine":{"number":"Amount of the fine"},"fidelity_card":{"number":"Card number"},"caf":{"number":"CAF file number"},"payment_proof_family_allowance":{"number":"CAF file number"},"vehicle":{"licenseNumber":"Vehicle registration number","confidentialNumber":"Confidential vehicle registration code"},"vehicle_registration":{"number":"Vehicle registration number (VIN)"},"national_id_card":{"number":"National ID card number"},"bank_details":{"number":"IBAN number"},"passport":{"number":"Passport number"},"driver_license":{"number":"License number"},"residence_permit":{"number":"License number"},"national_health_insurance_card":{"number":"National health insurance card number"},"pay_sheet":{"number":"Gross remuneration"},"tax_return":{"number":"Reference tax number"},"tax_notice":{"number":"Reference tax number"},"real_estate_tax":{"number":"Reference tax number"},"tax_timetable":{"number":"Reference tax number"},"country":"Document issuing country","refTaxIncome":"Reference tax income","contractType":"Contract type","noticePeriod":"Expiration alert","netSocialAmount":"Net social amount","employerName":"Name of employer","employer":"Name of employer","amount":"Amount of expenditure","subtype":"Purpose of expenditure","bicNumber":"BIC number"},"day":"day |||| days"},"contact":"Owner","page":"Side of the document","front":"Front side","back":"Back side","qualification":"Qualification","noInfo":"No information"}},"MagicFolders":{"administrative":"Administrative","photos":"Photos"}}')},6765:function(e){e.exports=JSON.parse('{"country":{"foreign":"\xc9tranger"},"Scan":{"scan_a_doc":"Num\xe9riser un doc","save_doc":"Enregistrer le document","filename":"Nom du fichier","save":"Sauvegarder","cancel":"Annuler","qualify":"Qualifier","apply":"Appliquer","error":{"offline":"Vous \xeates actuellement d\xe9connect\xe9, vous ne pouvez donc pas utiliser cette fonctionnalit\xe9. Connectez-vous \xe0 internet et recommencez. ","uploading":"Vous avez d\xe9j\xe0 un fichier en cours de t\xe9l\xe9chargement. Attendez la fin et recommencez.","generic":"Un probl\xe8me est survenu. Veuillez r\xe9essayer. "},"successful":{"qualified_ok":"Vous venez de qualifier votre fichier avec succ\xe8s !"},"items":{"accommodation_proof":"Attestation d\'h\xe9bergement |||| Attestations d\'h\xe9bergement","appliance_invoice":"Facture d\'\xe9lectrom\xe9nager |||| Factures d\'\xe9lectrom\xe9nager","bank_details":"RIB","bank_statement":"Relev\xe9 de compte |||| Relev\xe9s de compte","birth_certificate":"Acte de naissance |||| Actes de naissance","building_permit":"Permis de construire","caf":"Attestation de quotient familial CAF |||| Attestations de quotient familial CAF","car_insurance":"Attestation d\'assurance auto |||| Attestations d\'assurance auto","citizen_registration_certificate":"Attestation de recensement citoyen |||| Attestations de recensement citoyen","condition_report":"\xc9tat des lieux - Entr\xe9e/Sortie |||| \xc9tats des lieux - Entr\xe9e/Sortie","diploma":"Dipl\xf4me |||| Dipl\xf4mes","divorce":"Attestation de divorce |||| Attestations de divorce","driver_license":"Permis de conduire","electoral_card":"Carte \xe9lectorale |||| Cartes \xe9lectorales","employment_center_certificate":"Attestation de France Travail |||| Attestations de France Travail","energy_contract":"Contrat de fournisseur d\'\xe9nergies |||| Contrats de fournisseur d\'\xe9nergies","energy_invoice":"Facture d\'\xe9nergie |||| Factures d\'\xe9nergie","expense_claim":"Note de frais |||| Notes de frais","family_record_book":"Livret de famille |||| Livrets de famille","family":"Famille","fidelity_card":"Carte avantage |||| Cartes avantages","fine":"Amende |||| Amendes","gradebook":"Bulletin de notes |||| Bulletins de notes","grocery_invoice":"Facture de courses |||| Factures de courses","health_book":"Carnet de sant\xe9 |||| Carnets de sant\xe9","health_certificate":"Certificat de sant\xe9/vaccination |||| Certificats de sant\xe9/vaccination","health_insurance_card":"Carte de mutuelle |||| Cartes de mutuelle","health_invoice":"Facture m\xe9dicale |||| Factures m\xe9dicales","health":"Sant\xe9","home":"Logement","house_insurance":"Assurance logement |||| Assurances logement","house_sale_agreeement":"Compromis de vente","identity_photo":"Photo d\'identit\xe9 |||| Photos d\'identit\xe9","identity":"Identit\xe9","invoice":"Facture |||| Factures","isp_invoice":"Facture d\'internet |||| Factures d\'internet","large_family_card":"Carte famille nombreuse |||| Cartes famille nombreuse","lease":"Bail |||| Baux","loan_agreement":"Contrat de pr\xeat |||| Contrats de pr\xeat","mechanic_invoice":"Facture de r\xe9paration |||| Factures de r\xe9paration","motivation_letter":"Lettre de motivation |||| Lettres de motivation","national_health_insurance_card":"Carte vitale |||| Cartes vitales","national_health_insurance_right_certificate":"Attestation de droits de l\'Assurance Maladie |||| Attestations de droits de l\'Assurance Maladie","national_id_card":"Carte d\'identit\xe9 |||| Cartes d\'identit\xe9","note_identity_document":"Note Identit\xe9 |||| Notes Identit\xe9","note_family_document":"Note Famille |||| Notes Famille","note_work_document":"Note Travail & \xc9tudes |||| Notes Travail & \xc9tudes","note_health_document":"Note Sant\xe9 |||| Notes Sant\xe9","note_house_document":"Note Logement |||| Notes Logement","note_transport_document":"Note Transport |||| Notes Transport","note_activity_document":"Note Activit\xe9s & loisirs |||| Notes Activit\xe9s & loisirs","note_finance":"Note Finances |||| Notes Finances","note_invoice":"Note Factures |||| Notes Factures","other_activity_document":"Autre document de loisirs |||| Autres documents de loisirs","other_bank_document":"Autre document financier |||| Autres documents financiers","other_family_document":"Autre document de famille |||| Autres documents de famille","other_health_document":"Autre document de sant\xe9 |||| Autres documents de sant\xe9","other_house_document":"Autre document de logement |||| Autres documents de logement","other_identity_document":"Autre document d\'identit\xe9 |||| Autres documents d\'identit\xe9","other_invoice":"Autre facture |||| Autres factures","other_revenue":"Autre revenu |||| Autres revenus","other_tax_document":"Imp\xf4ts - Autre document |||| Imp\xf4ts - Autres documents","other_transport_document":"Autre document de transport |||| Autres documents de transport","other_work_document":"Autre document de travail |||| Autres documents de travail","other_administrative_document":"Autre document administratif |||| Autres documents administratifs","others":"Autres","pacs":"Attestation de PACS |||| Attestations de PACS","passport":"Passeport |||| Passeports","pay_sheet":"Fiche de paie |||| Fiches de paie","payment_proof_family_allowance":"Attestation de paiement CAF |||| Attestations de paiement CAF","pension":"Retraite |||| Retraites","person_insurance":"Attestation d\'assurance individuelle |||| Attestations d\'assurance individuelle","personal_sporting_licence":"Licence sportive |||| Licences sportives","phone_invoice":"Facture de t\xe9l\xe9phone |||| Factures de t\xe9l\xe9phone","pregnancy_medical_certificate":"Certificat de grossesse |||| Certificats de grossesse","prescription":"Ordonnance |||| Ordonnances","real_estate_insurance":"Attestation d\'assurance immobili\xe8re |||| Attestations d\'assurance immobili\xe8re","real_estate_tax":"Imp\xf4ts - Taxe fonci\xe8re |||| Imp\xf4ts - Taxes fonci\xe8res","receipt":"Accus\xe9 de r\xe9ception |||| Accus\xe9s de r\xe9ception","rent_receipt":"Quittance de loyer |||| Quittances de loyer","residence_permit":"Titre de s\xe9jour |||| Titres de s\xe9jour","restaurant_invoice":"Facture de restaurant |||| Factures de restaurant","resume":"CV","school_attendance_certificate":"Certificat de scolarit\xe9 |||| Certificats de scolarit\xe9","school_insurance_certificate":"Attestation d\'assurance scolaire |||| Attestations d\'assurance scolaire","single_parent_benefit":"Allocation parent isol\xe9 |||| Allocations parent isol\xe9","student_card":"Carte d\'\xe9tudiant |||| Cartes d\'\xe9tudiant","tax_certificate":"Attestation fiscale |||| Attestations fiscales","tax_notice":"Imp\xf4ts - Avis d\'imposition","tax_return":"Imp\xf4ts - D\xe9claration de revenus |||| Imp\xf4ts - D\xe9clarations de revenus","tax_timetable":"Imp\xf4ts - Ech\xe9ancier |||| Imp\xf4ts - Ech\xe9anciers","technical_diagnostic_record":"Dossier de diagnostic technique |||| Dossiers de diagnostic technique","telecom_invoice":"Facture de t\xe9l\xe9com |||| Factures de t\xe9l\xe9com","transport_card":"Carte de transport |||| Cartes de transport","transport_invoice":"Facture de transport |||| Factures de transport","transport":"Transport","unemployment_benefit":"Allocation ch\xf4mage |||| Allocations ch\xf4mage","unfit_for_habitation_declaration":"Arr\xeat\xe9 d\'insalubrit\xe9 |||| Arr\xeat\xe9s d\'insalubrit\xe9","vehicle_registration":"Carte grise |||| Cartes grises","water_invoice":"Facture d\'eau |||| Factures d\'eau","web_service_invoice":"Facture de service web |||| Factures de service web","wedding":"Contrat de mariage |||| Contrats de mariage","work_contract":"Contrat de travail |||| Contrats de travail","work_disability_recognition":"Reconnaissance de handicap - RQTH |||| Reconnaissances de handicap - RQTH","work_invoice":"Facture de travaux |||| Factures de travaux","work_quote":"Devis de travaux","work_study":"Travail & \xc9tudes"},"attributes":{"contractType":{"cdi":"CDI","cdd":"CDD","alternate":"Alternance","internship":"Stage","other":"Autre"},"noticePeriod":{"oneWeek":"1 semaine avant","oneMonth":"1 mois avant","threeMonth":"3 mois avant","oneYear":"1 an avant","custom":"Personnalis\xe9","noAlert":"Ne pas \xeatre alert\xe9"}},"themes":{"activity":"Activit\xe9s & loisirs","family":"Famille","finance":"Finances","health":"Sant\xe9","home":"Logement","identity":"Identit\xe9","invoice":"Factures","others":"Autres","transport":"Transport","undefined":"Ind\xe9fini","work_study":"Travail & \xc9tudes"},"expiration":{"expired":"Expir\xe9","expiresIn":"Expire dans %{duration}","description":"Ce document expire dans %{duration}, pensez \xe0 le renouveler"},"qualification":{"date":{"title":{"datetime":"Ajout\xe9 le","AObtentionDate":"Permis A, d\xe9livr\xe9 le","BObtentionDate":"Permis B, d\xe9livr\xe9 le","CObtentionDate":"Permis C, d\xe9livr\xe9 le","DObtentionDate":"Permis D, d\xe9livr\xe9 le","issueDate":"D\xe9livr\xe9 le","expirationDate":"Date d\'expiration","referencedDate":"Date de r\xe9f\xe9rence","shootingDate":"Date de prise de vue","obtentionDate":"Date d\'obtention","date":"Date du document"}},"information":{"title":{"fine":{"number":"Montant de l\'amende"},"fidelity_card":{"number":"Num\xe9ro de la carte"},"caf":{"number":"Num\xe9ro de dossier CAF"},"payment_proof_family_allowance":{"number":"Num\xe9ro de dossier CAF"},"vehicle":{"licenseNumber":"Num\xe9ro d\'immatriculation","confidentialNumber":"Code confidentiel de la carte grise"},"vehicle_registration":{"number":"Num\xe9ro de la carte grise (VIN)"},"national_id_card":{"number":"Num\xe9ro de la carte d\'identit\xe9"},"bank_details":{"number":"Num\xe9ro d\'IBAN"},"passport":{"number":"Num\xe9ro du passeport"},"driver_license":{"number":"Num\xe9ro du permis"},"residence_permit":{"number":"Num\xe9ro du permis"},"national_health_insurance_card":{"number":"Num\xe9ro de s\xe9curit\xe9 sociale"},"pay_sheet":{"number":"R\xe9mun\xe9ration brute"},"tax_return":{"number":"Num\xe9ro fiscal de r\xe9f\xe9rence"},"tax_notice":{"number":"Num\xe9ro fiscal de r\xe9f\xe9rence"},"real_estate_tax":{"number":"Num\xe9ro fiscal de r\xe9f\xe9rence"},"tax_timetable":{"number":"Num\xe9ro fiscal de r\xe9f\xe9rence"},"country":"Pays \xe9metteur du document","refTaxIncome":"Revenu fiscal de r\xe9f\xe9rence","contractType":"Type de contrat","noticePeriod":"Alerte dexpiration","netSocialAmount":"Montant net social","employerName":"Nom de l\'employeur","employer":"Nom de l\'employeur","amount":"Montant de la d\xe9pense","subtype":"Objet de la d\xe9pense","bicNumber":"Num\xe9ro BIC"},"day":"jour |||| jours"},"contact":"Titulaire","page":"Face du document","front":"Face avant","back":"Face arri\xe8re","qualification":"Qualification","noInfo":"Non renseign\xe9(e)"}},"MagicFolders":{"administrative":"Administratif","photos":"Photos"}}')},5825:function(e){e.exports=JSON.parse('{"qualifications":[{"label":"identity_photo","purpose":"attestation","subjects":["identity"]},{"label":"national_id_card","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["identity"]},{"label":"passport","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["identity"]},{"label":"residence_permit","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"immigration","subjects":["permit","identity"]},{"label":"family_record_book","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["family"]},{"label":"birth_certificate","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["identity","family"]},{"label":"driver_license","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"transport","subjects":["permit","driving"]},{"label":"other_identity_document","purpose":"attestation","subjects":["identity"]},{"label":"wedding","purpose":"contract","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["family"]},{"label":"pacs","purpose":"contract","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["family"]},{"label":"divorce","purpose":"contract","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["family"]},{"label":"large_family_card","purpose":"attestation","sourceCategory":"transport","subjects":["right"]},{"label":"caf","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"family","subjects":["right"]},{"label":"other_family_document","subjects":["family"]},{"label":"diploma","purpose":"attestation","sourceCategory":"education","subjects":["achievement"]},{"label":"work_contract","purpose":"contract","sourceCategory":"employer","subjects":["work","employment"]},{"label":"pay_sheet","purpose":"attestation","sourceCategory":"employer","subjects":["work","revenues"]},{"label":"fidelity_card","sourceCategory":"shopping"},{"label":"single_parent_benefit","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"family","subjects":["revenues"]},{"label":"transport_card","sourceCategory":"transport","subjects":["vehicule"]},{"label":"electoral_card","sourceCategory":"gov"},{"label":"employment_center_certificate","purpose":"attestation","sourceCategory":"gov","subjects":["employment"]},{"label":"unemployment_benefit","purpose":"attestation","sourceCategory":"gov","subjects":["revenues"]},{"label":"pension","purpose":"attestation","sourceCategory":"gov","subjects":["revenues"]},{"label":"other_revenue","purpose":"attestation","subjects":["revenues"]},{"label":"gradebook","purpose":"report","sourceCategory":"education","subjects":["history"]},{"label":"student_card","purpose":"attestation","sourceCategory":"education","subjects":["identity","right","employment","education"]},{"label":"resume","purpose":"description","subjects":["employment"]},{"label":"motivation_letter","purpose":"description","subjects":["employment"]},{"label":"other_work_document","purpose":"employment"},{"label":"health_book","purpose":"attestation","sourceCategory":"health","subjects":["capacity","vaccine"]},{"label":"health_certificate","purpose":"attestation","sourceCategory":"health","subjects":["capacity","vaccine"]},{"label":"pregnancy_medical_certificate","purpose":"attestation","sourceCategory":"health","subjects":["pregnancy"]},{"label":"work_disability_recognition","purpose":"attestation","sourceCategory":"health","subjects":["right"]},{"label":"national_health_insurance_card","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"health","subjects":["insurance"]},{"label":"national_health_insurance_right_certificate","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"health","subjects":["right","insurance"]},{"label":"health_insurance_card","purpose":"attestation","sourceCategory":"insurance","sourceSubCategory":"health","subjects":["insurance"]},{"label":"prescription","purpose":"attestation","sourceCategory":"health","subjects":["right","medecine"]},{"label":"health_invoice","purpose":"invoice","sourceCategory":"health"},{"label":"other_health_document","subjects":["health"]},{"label":"vehicle_registration","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"transport","subjects":["vehicule","identity","right"]},{"label":"car_insurance","purpose":"attestation","sourceCategory":"insurance","sourceSubCategory":"transport","subjects":["insurance","car"]},{"label":"mechanic_invoice","purpose":"invoice","sourceCategory":"transport"},{"label":"transport_invoice","purpose":"invoice","sourceCategory":"transport"},{"label":"other_transport_document","sourceCategory":"transport"},{"label":"house_sale_agreeement","purpose":"contract","sourceCategory":"real_estate","subjects":["house"]},{"label":"real_estate_tax","purpose":"invoice","sourceCategory":"gov","sourceSubCategory":"real_estate","subjects":["tax","house"]},{"label":"building_permit","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"real_estate","subjects":["permit","house"]},{"label":"technical_diagnostic_record","purpose":"report","sourceCategory":"real_estate","subjects":["compliance","house"]},{"label":"lease","purpose":"contract","sourceCategory":"real_estate","subjects":["house"]},{"label":"rent_receipt","purpose":"invoice","sourceCategory":"real_estate","subjects":["house"]},{"label":"house_insurance","purpose":"contract","sourceCategory":"insurance","sourceSubCategory":"real_estate","subjects":["insurance","house"]},{"label":"work_quote","purpose":"description","sourceCategory":"building","subjects":["building","house"]},{"label":"work_invoice","purpose":"invoice","sourceCategory":"building","subjects":["building","house"]},{"label":"other_house_document","subjects":["house"]},{"label":"phone_invoice","purpose":"invoice","sourceCategory":"telecom","sourceSubCategory":"mobile"},{"label":"isp_invoice","purpose":"invoice","sourceCategory":"telecom","sourceSubCategory":"internet","subjects":["subscription"]},{"label":"telecom_invoice","purpose":"invoice","sourceCategory":"telecom"},{"label":"energy_invoice","purpose":"invoice","sourceCategory":"energy"},{"label":"water_invoice","purpose":"invoice","sourceCategory":"water"},{"label":"energy_contract","purpose":"contract","sourceCategory":"energy"},{"label":"appliance_invoice","purpose":"invoice","sourceCategory":"retail"},{"label":"web_service_invoice","purpose":"invoice","sourceCategory":"web"},{"label":"restaurant_invoice","purpose":"invoice","sourceCategory":"alimentation"},{"label":"grocery_invoice","purpose":"invoice","sourceCategory":"shopping"},{"label":"other_invoice","purpose":"invoice"},{"label":"tax_certificate","purpose":"attestation","sourceCategory":"gov","subjects":["tax"]},{"label":"tax_return","purpose":"report","sourceCategory":"gov","sourceSubCategory":"tax","subjects":["tax"]},{"label":"tax_notice","purpose":"invoice","sourceCategory":"gov","sourceSubCategory":"tax","subjects":["tax"]},{"label":"tax_timetable","purpose":"report","sourceCategory":"gov","sourceSubCategory":"tax","subjects":["tax"]},{"label":"other_tax_document","subjects":["tax"]},{"label":"bank_details","purpose":"attestation","sourceCategory":"bank","subjects":["bank_account"]},{"label":"bank_statement","purpose":"report","sourceCategory":"bank","subjects":["history"]},{"label":"loan_agreement","purpose":"contract","sourceCategory":"bank"},{"label":"other_bank_document","sourceCategory":"bank"},{"label":"receipt","purpose":"report"},{"label":"payment_proof_family_allowance","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"tax","subjects":["subvention"]},{"label":"school_attendance_certificate","purpose":"attestation","sourceCategory":"education","subjects":["identity","right","education"]},{"label":"school_insurance_certificate","purpose":"attestation","sourceCategory":"education","subjects":["education","insurance"]},{"label":"unfit_for_habitation_declaration","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"real_estate","subjects":["compliance"]},{"label":"accommodation_proof","purpose":"attestation","sourceCategory":"individual","subjects":["address"]},{"label":"citizen_registration_certificate","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["achievement","education"]},{"label":"personal_sporting_licence","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"sport","subjects":["permit","invoice"]},{"label":"other_activity_document","sourceSubCategory":"sport","subjects":["permit","invoice"]},{"label":"real_estate_insurance","purpose":"contract","sourceCategory":"insurance","sourceSubCategory":"real_estate","subjects":["insurance"]},{"label":"person_insurance","purpose":"contract","sourceCategory":"insurance","subjects":["insurance"]},{"label":"other_administrative_document"},{"label":"expense_claim","purpose":"invoice"},{"label":"fine","purpose":"invoice","sourceCategory":"gov"},{"label":"condition_report","purpose":"contract","sourceCategory":"real_estate","subjects":["house"]},{"label":"note_identity_document"},{"label":"note_family_document"},{"label":"note_work_document"},{"label":"note_health_document"},{"label":"note_house_document"},{"label":"note_transport_document"},{"label":"note_activity_document"},{"label":"note_finance"},{"label":"note_invoice"}],"purposeKnownValues":["attestation","contract","invoice","report","description","evaluation","employment"],"sourceCategoryKnownValues":["bank","insurance","retail","telecom","energy","water","health","gov","association","education","employer","transport","goods","alimentation","building","real_estate","web","individual","shopping"],"sourceSubCategoryKnownValues":["civil_registration","immigration","transport","family","tax","health","real_estate","mobile","internet","citizen","sport"],"subjectsKnownValues":["identity","permit","family","address","driving","right","subvention","achievement","degree","work","employment","revenues","history","insurance","medical_act","vehicule","car","moto","truck","boat","subscription","buy/sale","house","compliance","building","food","real_estate","tax","address","education","statement","course","internet","phone","vaccine","capacity","health","drugs","child","pregnancy","bank_account"]}')},16300:function(e){e.exports=JSON.parse('{"nationalities":{"AD":"Andorran","AE":"Emirian","AF":"Afghan","AG":"Antiguans","AL":"Albanian","AM":"Armenian","AO":"Angolan","AR":"Argentinean","AT":"Austrian","AU":"Australian","AX":"\xc5land Islands","AZ":"Azerbaijani","BA":"Bosnian - Herzegovinian","BB":"Barbadian","BD":"Bangladeshi","BE":"Belgian","BF":"Burkinabe","BG":"Bulgarian","BH":"Bahraini","BI":"Burundian","BJ":"Beninese","BL":"Saint Barth\xe9lemy","BM":"Bermuda","BN":"Bruneian","BO":"Bolivian","BQ":"Bonaire, Sint Eustatius and Saba","BR":"Brazilian","BS":"Bahamian","BT":"Bhutanese","BV":"Bouvet Island","BW":"Batswana","BY":"Belarusian","BZ":"Belizean","CA":"Canadian","CC":"Cocos (Keeling) Islands","CD":"Congolese (Democratic Republic of the Congo)","CF":"Central African","CG":"Congolese (Republic of the Congo)","CH":"Swiss","CI":"Ivorian","CK":"Cook Islands","CL":"Chilean","CM":"Cameroonian","CN":"Chinese","CO":"Colombian","CR":"Costa Rican","CU":"Cuban","CV":"Cape Verdean","CW":"Cura\xe7ao","CX":"Christmas Island","CY":"Cypriot","CZ":"Czech","DE":"German","DJ":"Djibouti","DK":"Danish","DM":"Dominican (Dominica)","DO":"Dominican (Dominican Republic)","DZ":"Algerian","EC":"Ecuadorean","EE":"Estonian","EG":"Egyptian","EH":"Western Sahara","ER":"Eritrean","ES":"Spanish","ET":"Ethiopian","FI":"Finnish","FJ":"Fijian","FK":"Falkland Islands (Malvinas)","FM":"Micronesian","FO":"Faroe Islands","FR":"French","GA":"Gabonese","GB":"British","GD":"Grenadian","GE":"Georgian","GF":"French (French Guiana)","GG":"Guernsey","GH":"Ghanaian","GI":"Gibraltar","GL":"Greenland","GM":"Gambian","GN":"Guinean","GP":"Guadeloupe","GQ":"Equatorial Guinean","GR":"Greek","GS":"South Georgia and the South Sandwich Islands","GT":"Guatemalan","GU":"Guam","GW":"Guinea-Bissauan","GY":"Guyanese","HK":"Hong Kong","HM":"Heard Island and Mcdonald Islands","HN":"Honduran","HR":"Croatian","HT":"Haitian","HU":"Hungarian","ID":"Indonesian","IE":"Irish","IL":"Israeli","IM":"Manx","IN":"Indian","IO":"British Indian Ocean Territory","IQ":"Iraqi","IR":"Iranian","IS":"Icelandic","IT":"Italian","JE":"Jersey","JM":"Jamaican","JO":"Jordanian","JP":"Japanese","KE":"Kenyan","KG":"Kyrgyz","KH":"Cambodian","KI":"I-Kiribati","KM":"Comoran","KN":"Kittian and Nevisian","KP":"North Korean","KR":"South Korean","KW":"Kuwaiti","KY":"Cayman Islands","KZ":"Kazakhstani","LA":"Laotian","LB":"Lebanese","LC":"Saint Lucian","LI":"Liechtensteiner","LK":"Sri Lankan","LR":"Liberian","LS":"Mosotho","LT":"Lithuanian","LU":"Luxembourger","LV":"Latvian","LY":"Libyan","MA":"Moroccan","MC":"Monacan","MD":"Moldovan","ME":"Montenegrin","MF":"Saint Martin (French part)","MG":"Malagasy","MH":"Marshallese","MK":"Macedonian","ML":"Malian","MM":"Burmese","MN":"Mongolian","MO":"Macao","MP":"Northern Mariana Islands","MQ":"Martinique","MR":"Mauritanian","MS":"Montserrat","MT":"Maltese","MU":"Mauritian","MV":"Maldivan","MW":"Malawian","MX":"Mexican","MY":"Malaysian","MZ":"Mozambican","NA":"Namibian","NC":"New Caledonia","NE":"Nigerien","NF":"Norfolk Island","NG":"Nigerian","NI":"Nicaraguan","NL":"Dutch","NO":"Norwegian","NP":"Nepalese","NR":"Nauruan","NU":"Niue","NZ":"New Zealander","OM":"Omani","PA":"Panamanian","PE":"Peruvian","PF":"French (French Polynesia)","PG":"Papua New Guinea","PH":"Filipino","PK":"Pakistani","PL":"Polish","PM":"Saint Pierre and Miquelon","PN":"Pitcairn","PR":"Puerto Rico","PS":"Palestinian Territory, Occupied","PT":"Portuguese","PW":"Palauan","PY":"Paraguayan","QA":"Qatari","RE":"Reunion","RO":"Romanian","RS":"Serbian","RU":"Russian","RW":"Rwandan","SA":"Saudi","SB":"Solomon Islander","SC":"Seychellois","SD":"Sudanese","SE":"Swedish","SG":"Singaporean","SH":"Saint Helena","SI":"Slovenian","SJ":"Svalbard and Jan Mayen","SK":"Slovakian","SL":"Sierra Leonean","SM":"San Marinese","SN":"Senegalese","SO":"Somali","SR":"Surinamer","SS":"South Sudan","ST":"Sao Tomean","SV":"Salvadoran","SX":"Sint Maarten (Dutch part)","SY":"Syrian","SZ":"Swazi","TC":"Turks and Caicos Islands","TD":"Chadian","TF":"French (French Southern Territories)","TG":"Togolese","TH":"Thai","TJ":"Tajik","TK":"Tokelau","TL":"East Timorese","TM":"Turkmenistan","TN":"Tunisian","TO":"Tongan","TR":"Turkish","TT":"Trinidadian or Tobagonian","TV":"Tuvaluan","TW":"Taiwanese","TZ":"Tanzanian","UA":"Ukrainian","UG":"Ugandan","UM":"United States Minor Outlying Islands","US":"American","UY":"Uruguayan","UZ":"Uzbekistani","VA":"Holy See (Vatican City State)","VC":"Saint Vincent and the Grenadines","VE":"Venezuelan","VG":"Virgin Islands, British","VI":"Virgin Islands, U.S.","VN":"Vietnamese","VU":"Vanuatu","WF":"Welsh","WS":"Samoan","YE":"Yemenite","YT":"Mayotte","ZA":"South African","ZM":"Zambian","ZW":"Zimbabwean"},"countries":{"AD":"Andorra","AE":"United Arab Emirates","AF":"Afghanistan","AG":"Antigua and Barbuda","AL":"Albania","AM":"Armenia","AO":"Angola","AR":"Argentina","AT":"Austria","AU":"Australia","AX":"\xc5land Islands","AZ":"Azerbaijan","BA":"Bosnia and Herzegovina","BB":"Barbados","BD":"Bangladesh","BE":"Belgium","BF":"Burkina Faso","BG":"Bulgaria","BH":"Bahrain","BI":"Burundi","BJ":"Benin","BL":"Saint Barth\xe9lemy","BM":"Bermuda","BN":"Brunei Darussalam","BO":"Bolivia","BQ":"Bonaire, Sint Eustatius and Saba","BR":"Brazil","BS":"Bahamas","BT":"Bhutan","BV":"Bouvet Island","BW":"Botswana","BY":"Belarus","BZ":"Belize","CA":"Canada","CC":"Cocos (Keeling) Islands","CD":"Democratic Republic of the Congo","CF":"Central African Republic","CG":"Republic of the Congo","CH":"Switzerland","CI":"Ivory Coast","CK":"Cook Islands","CL":"Chile","CM":"Cameroon","CN":"People\'s Republic of China","CO":"Colombia","CR":"Costa Rica","CU":"Cuba","CV":"Cape Verde","CW":"Cura\xe7ao","CX":"Christmas Island","CY":"Cyprus","CZ":"Czech Republic","DE":"Germany","DJ":"Djibouti","DK":"Denmark","DM":"Dominica","DO":"Dominican Republic","DZ":"Algeria","EC":"Ecuador","EE":"Estonia","EG":"Egypt","EH":"Western Sahara","ER":"Eritrea","ES":"Spain","ET":"Ethiopia","FI":"Finland","FJ":"Fiji","FK":"Falkland Islands (Malvinas)","FM":"Micronesia, Federated States of","FO":"Faroe Islands","FR":"France","GA":"Gabon","GB":"United Kingdom","GD":"Grenada","GE":"Georgia","GF":"French Guiana","GG":"Guernsey","GH":"Ghana","GI":"Gibraltar","GL":"Greenland","GM":"Gambia","GN":"Guinea","GP":"Guadeloupe","GQ":"Equatorial Guinea","GR":"Greece","GS":"South Georgia and the South Sandwich Islands","GT":"Guatemala","GU":"Guam","GW":"Guinea-Bissau","GY":"Guyana","HK":"Hong Kong","HM":"Heard Island and McDonald Islands","HN":"Honduras","HR":"Croatia","HT":"Haiti","HU":"Hungary","ID":"Indonesia","IE":"Ireland","IL":"Israel","IM":"Isle of Man","IN":"India","IO":"British Indian Ocean Territory","IQ":"Iraq","IR":"Iran","IS":"Iceland","IT":"Italy","JE":"Jersey","JM":"Jamaica","JO":"Jordan","JP":"Japan","KE":"Kenya","KG":"Kyrgyzstan","KH":"Cambodia","KI":"Kiribati","KM":"Comoros","KN":"Saint Kitts and Nevis","KP":"North Korea","KR":"South Korea","KW":"Kuwait","KY":"Cayman Islands","KZ":"Kazakhstan","LA":"Lao People\'s Democratic Republic","LB":"Lebanon","LC":"Saint Lucia","LI":"Liechtenstein","LK":"Sri Lanka","LR":"Liberia","LS":"Lesotho","LT":"Lithuania","LU":"Luxembourg","LV":"Latvia","LY":"Libya","MA":"Morocco","MC":"Monaco","MD":"Moldova, Republic of","ME":"Montenegro","MF":"Saint Martin (French part)","MG":"Madagascar","MH":"Marshall Islands","MK":"North Macedonia","ML":"Mali","MM":"Myanmar","MN":"Mongolia","MO":"Macao","MP":"Northern Mariana Islands","MQ":"Martinique","MR":"Mauritania","MS":"Montserrat","MT":"Malta","MU":"Mauritius","MV":"Maldives","MW":"Malawi","MX":"Mexico","MY":"Malaysia","MZ":"Mozambique","NA":"Namibia","NC":"New Caledonia","NE":"Niger","NF":"Norfolk Island","NG":"Nigeria","NI":"Nicaragua","NL":"Netherlands","NO":"Norway","NP":"Nepal","NR":"Nauru","NU":"Niue","NZ":"New Zealand","OM":"Oman","PA":"Panama","PE":"Peru","PF":"French Polynesia","PG":"Papua New Guinea","PH":"Philippines","PK":"Pakistan","PL":"Poland","PM":"Saint Pierre and Miquelon","PN":"Pitcairn Islands","PR":"Puerto Rico","PS":"Palestine","PT":"Portugal","PW":"Palau","PY":"Paraguay","QA":"Qatar","RE":"Reunion","RO":"Romania","RS":"Serbia","RU":"Russia","RW":"Rwanda","SA":"Saudi Arabia","SB":"Solomon Islands","SC":"Seychelles","SD":"Sudan","SE":"Sweden","SG":"Singapore","SH":"Saint Helena","SI":"Slovenia","SJ":"Svalbard and Jan Mayen","SK":"Slovakia","SL":"Sierra Leone","SM":"San Marino","SN":"Senegal","SO":"Somalia","SR":"Suriname","SS":"South Sudan","ST":"Sao Tome and Principe","SV":"El Salvador","SX":"Sint Maarten (Dutch part)","SY":"Syrian Arab Republic","SZ":"Eswatini","TC":"Turks and Caicos Islands","TD":"Chad","TF":"French Southern Territories","TG":"Togo","TH":"Thailand","TJ":"Tajikistan","TK":"Tokelau","TL":"Timor-Leste","TM":"Turkmenistan","TN":"Tunisia","TO":"Tonga","TR":"Turkey","TT":"Trinidad and Tobago","TV":"Tuvalu","TW":"Taiwan","TZ":"United Republic of Tanzania","UA":"Ukraine","UG":"Uganda","UM":"United States Minor Outlying Islands","US":"United States of America","UY":"Uruguay","UZ":"Uzbekistan","VA":"Holy See (Vatican City State)","VC":"Saint Vincent and the Grenadines","VE":"Venezuela","VG":"Virgin Islands, British","VI":"Virgin Islands, U.S.","VN":"Vietnam","VU":"Vanuatu","WF":"Wallis and Futuna","WS":"Samoa","YE":"Yemen","YT":"Mayotte","ZA":"South Africa","ZM":"Zambia","ZW":"Zimbabwe"}}')},61127:function(e){e.exports=JSON.parse('{"nationalities":{"AD":"Andorran","AE":"\xc9mirien","AF":"Afghan","AG":"Antiguayen","AL":"Albanais","AM":"Arm\xe9nien","AO":"Angolais","AR":"Argentin","AT":"Autrichien","AU":"Australien","AX":"\xceles Aland","AZ":"Azerba\xefdjanais","BA":"Bosnien","BB":"Barbadien","BD":"Bangladais","BE":"Belge","BF":"Burkinab\xe9","BG":"Bulgare","BH":"Bahre\xefnien","BI":"Burundais","BJ":"B\xe9ninois","BL":"Saint-Barth\xe9lemy","BM":"Bermudien","BN":"Brun\xe9ien","BO":"Bolivien","BQ":"Pays-Bas Carib\xe9ens","BR":"Br\xe9silien","BS":"Bahamien","BT":"Bhoutanais","BV":"\xcele Bouvet","BW":"Botswanais","BY":"Bi\xe9lorusse","BZ":"B\xe9lizien","CA":"Canadien","CC":"\xceles Cocos","CD":"Congolais (R\xe9publique d\xe9mocratique du Congo)","CF":"Centrafricain","CG":"Congolais (R\xe9publique du Congo)","CH":"Suisse","CI":"Ivoirien","CK":"\xceles Cook","CL":"Chilien","CM":"Camerounais","CN":"Chinois","CO":"Colombien","CR":"Costaricain","CU":"Cubain","CV":"Cap verdien","CW":"Curacien","CX":"L\'\xeele Christmas","CY":"Chypriote","CZ":"Tch\xe8que","DE":"Allemand","DJ":"Djiboutien","DK":"Danois","DM":"Dominicain (Dominique)","DO":"Dominicain (R\xe9publique dominicaine)","DZ":"Alg\xe9rien","EC":"\xc9quatorien","EE":"Estonien","EG":"\xc9gyptien","EH":"Sahara Occidental","ER":"\xc9rythr\xe9en","ES":"Espagnol","ET":"\xc9thiopien","FI":"Finlandais","FJ":"Fidjien","FK":"Malouin","FM":"Micron\xe9sien","FO":"F\xe9ro\xefen","FR":"Fran\xe7ais","GA":"Gabonais","GB":"Britannique","GD":"Grenadien","GE":"G\xe9orgien","GF":"Fran\xe7ais (Guyane)","GG":"Guernesiais","GH":"Ghan\xe9en","GI":"Gibraltariens","GL":"Groenlandais","GM":"Gambien","GN":"Guin\xe9en","GP":"Guadeloup\xe9en","GQ":"\xc9quato-guin\xe9en","GR":"Grec","GS":"G\xe9orgie du Sud et les \xeeles Sandwich du Sud","GT":"Guat\xe9malt\xe8que","GU":"Guam","GW":"Bissaoguin\xe9en","GY":"Guyanais","HK":"Hongkongais","HM":"\xceles Heard-et-MacDonald","HN":"Hondurien","HR":"Croate","HT":"Ha\xeftien","HU":"Hongrois","ID":"Indon\xe9sien","IE":"Irlandais","IL":"Isra\xe9lien","IM":"\xcele de Man","IN":"Indien","IO":"Territoire britannique de l\'oc\xe9an Indien","IQ":"Irakien","IR":"Iranien","IS":"Islandais","IT":"Italien","JE":"Jersiais","JM":"Jama\xefquain","JO":"Jordanien","JP":"Japonais","KE":"K\xe9nyan","KG":"Kirghiz","KH":"Cambodgien","KI":"Kiribatiens","KM":"Comorien","KN":"Afro-Kittitien et Afro-Nevisien","KP":"Nord cor\xe9en","KR":"Sud cor\xe9en","KW":"Kowe\xeftien","KY":"Ca\xefmanien","KZ":"Kazakhstanais","LA":"Laotien","LB":"Libanais","LC":"Saint-Lucien","LI":"Liechtensteinois","LK":"Sri Lankais","LR":"Liberian","LS":"Mosotho","LT":"Lituanien","LU":"Luxembourgeois","LV":"Letton","LY":"Libyen","MA":"Marocain","MC":"Mon\xe9gasque","MD":"Moldave","ME":"Mont\xe9n\xe9grin","MF":"Saint-Martinois (France)","MG":"Malgache","MH":"Marshallais","MK":"Mac\xe9donien","ML":"Malien","MM":"Birman","MN":"Mongol","MO":"Macan\xe9en","MP":"\xceles Mariannes du Nord","MQ":"Martiniquais","MR":"Mauritanien","MS":"Montserratien","MT":"Maltais","MU":"Mauricien","MV":"Maldivien","MW":"Malawien","MX":"Mexicain","MY":"Malaisien","MZ":"Mozambicain","NA":"Namibien","NC":"N\xe9o-Cal\xe9donien","NE":"Nig\xe9rien","NF":"Norfolkais","NG":"Nig\xe9rian","NI":"Nicaraguayen","NL":"N\xe9erlandais","NO":"Norv\xe9gien","NP":"N\xe9palais","NR":"Nauruan","NU":"Niu\xe9en","NZ":"N\xe9o-Z\xe9landais","OM":"Omanais","PA":"Panam\xe9en","PE":"P\xe9ruvien","PF":"Fran\xe7ais (Polyn\xe9sie fran\xe7aise)","PG":"Papouasien","PH":"Philippin","PK":"Pakistanais","PL":"Polonais","PM":"Saint-Pierrais ou Miquelonais","PN":"\xceles Pitcairn","PR":"Portoricain","PS":"Territoires Palestiniens, Occup\xe9s","PT":"Portugais","PW":"Palauan","PY":"Paraguayen","QA":"Qatarien","RE":"R\xe9unionnais","RO":"Roumain","RS":"Serbe","RU":"Russe","RW":"Rwandais","SA":"Saoudien","SB":"Salomonais","SC":"Seychellois","SD":"Soudanais","SE":"Su\xe9dois","SG":"Singapourien","SH":"Sainte H\xe9l\xe8ne","SI":"Slov\xe8ne","SJ":"Svalbard et Jan Mayen","SK":"Slovaque","SL":"Sierra L\xe9onais","SM":"Saint-Marinais","SN":"S\xe9n\xe9galais","SO":"Somalien","SR":"Surinamais","SS":"Sud-Soudanais","ST":"Santom\xe9en","SV":"Salvadorien","SX":"Saint-Martinois (Pays-Bas)","SY":"Syrien","SZ":"Swazi","TC":"\xceles Turques-et-Ca\xefques","TD":"Tchadien","TF":"Fran\xe7ais (TAAF)","TG":"Togolais","TH":"Tha\xeflandais","TJ":"Tadjik","TK":"Tok\xe9laou","TL":"Est-Timorais","TM":"Turkm\xe8ne","TN":"Tunisien","TO":"Tongien","TR":"Turc","TT":"Trinidadien ou Tobagonien","TV":"Tuvalais","TW":"Ta\xefwanais","TZ":"Tanzanien","UA":"Ukrainien","UG":"Ougandais","UM":"\xceles mineures \xe9loign\xe9es des \xc9tats-Unis","US":"Am\xe9ricain","UY":"Uruguayen","UZ":"Ouzbek","VA":"Saint-Si\xe8ge (\xc9tat de la cit\xe9 du Vatican)","VC":"Vincentais","VE":"V\xe9n\xe9zu\xe9lien","VG":"\xceles Vierges Britanniques","VI":"\xceles Vierges Am\xe9ricaines","VN":"Vietnamien","VU":"Vanuatais","WF":"Gallois","WS":"Samoan","YE":"Y\xe9m\xe9nite","YT":"Mahorais","ZA":"Sud Africain","ZM":"Zambien","ZW":"Zimbabw\xe9en"},"countries":{"AD":"Andorre","AE":"\xc9mirats Arabes Unis","AF":"Afghanistan","AG":"Antigua-et-Barbuda","AL":"Albanie","AM":"Arm\xe9nie","AO":"Angola","AR":"Argentine","AT":"Autriche","AU":"Australie","AX":"\xc5land","AZ":"Azerba\xefdjan","BA":"Bosnie-Herz\xe9govine","BB":"Barbade","BD":"Bangladesh","BE":"Belgique","BF":"Burkina Faso","BG":"Bulgarie","BH":"Bahre\xefn","BI":"Burundi","BJ":"B\xe9nin","BL":"Saint-Barth\xe9lemy","BM":"Bermudes","BN":"Brunei Darussalam","BO":"Bolivie","BQ":"Bonaire, Saint-Eustache et Saba","BR":"Br\xe9sil","BS":"Bahamas","BT":"Bhoutan","BV":"\xcele Bouvet","BW":"Botswana","BY":"Bi\xe9lorussie","BZ":"Belize","CA":"Canada","CC":"\xceles Cocos","CD":"R\xe9publique d\xe9mocratique du Congo","CF":"R\xe9publique Centrafricaine","CG":"R\xe9publique du Congo","CH":"Suisse","CI":"C\xf4te-d\'Ivoire","CK":"\xceles Cook","CL":"Chili","CM":"Cameroun","CN":"Chine","CO":"Colombie","CR":"Costa Rica","CU":"Cuba","CV":"Cap-Vert","CW":"Cura\xe7ao","CX":"\xcele Christmas","CY":"Chypre","CZ":"R\xe9publique Tch\xe8que","DE":"Allemagne","DJ":"Djibouti","DK":"Danemark","DM":"Dominique","DO":"R\xe9publique Dominicaine","DZ":"Alg\xe9rie","EC":"\xc9quateur","EE":"Estonie","EG":"\xc9gypte","EH":"Sahara occidental","ER":"\xc9rythr\xe9e","ES":"Espagne","ET":"\xc9thiopie","FI":"Finlande","FJ":"Fidji","FK":"\xceles Malouines","FM":"Micron\xe9sie","FO":"\xceles F\xe9ro\xe9","FR":"France","GA":"Gabon","GB":"Royaume-Uni","GD":"Grenade","GE":"G\xe9orgie","GF":"Guyane fran\xe7aise","GG":"Guernesey","GH":"Ghana","GI":"Gibraltar","GL":"Groenland","GM":"Gambie","GN":"Guin\xe9e","GP":"Guadeloupe","GQ":"Guin\xe9e \xe9quatoriale","GR":"Gr\xe8ce","GS":"G\xe9orgie du Sud-et-les \xceles Sandwich du Sud","GT":"Guatemala","GU":"Guam","GW":"Guin\xe9e-Bissau","GY":"Guyana","HK":"Hong Kong","HM":"\xceles Heard-et-MacDonald","HN":"Honduras","HR":"Croatie","HT":"Ha\xefti","HU":"Hongrie","ID":"Indon\xe9sie","IE":"Irlande","IL":"Isra\xebl","IM":"\xcele de Man","IN":"Inde","IO":"Oc\xe9an Indien Britannique","IQ":"Irak","IR":"Iran","IS":"Islande","IT":"Italie","JE":"Jersey","JM":"Jama\xefque","JO":"Jordanie","JP":"Japon","KE":"Kenya","KG":"Kirghizistan","KH":"Cambodge","KI":"Kiribati","KM":"Comores","KN":"Saint-Christophe-et-Ni\xe9v\xe8s","KP":"Cor\xe9e du Nord","KR":"Cor\xe9e du Sud","KW":"Kowe\xeft","KY":"\xceles Ca\xefmans","KZ":"Kazakhstan","LA":"Laos","LB":"Liban","LC":"Sainte-Lucie","LI":"Liechtenstein","LK":"Sri Lanka","LR":"Lib\xe9ria","LS":"Lesotho","LT":"Lituanie","LU":"Luxembourg","LV":"Lettonie","LY":"Libye","MA":"Maroc","MC":"Monaco","MD":"Moldavie","ME":"Mont\xe9n\xe9gro","MF":"Saint-Martin (partie fran\xe7aise)","MG":"Madagascar","MH":"\xceles Marshall","MK":"Mac\xe9doine du Nord","ML":"Mali","MM":"Myanmar","MN":"Mongolie","MO":"Macao","MP":"\xceles Mariannes du Nord","MQ":"Martinique","MR":"Mauritanie","MS":"Montserrat","MT":"Malte","MU":"Maurice","MV":"Maldives","MW":"Malawi","MX":"Mexique","MY":"Malaisie","MZ":"Mozambique","NA":"Namibie","NC":"Nouvelle-Cal\xe9donie","NE":"Niger","NF":"\xcele Norfolk","NG":"Nig\xe9ria","NI":"Nicaragua","NL":"Pays-Bas","NO":"Norv\xe8ge","NP":"N\xe9pal","NR":"Nauru","NU":"Niu\xe9","NZ":"Nouvelle-Z\xe9lande","OM":"Oman","PA":"Panama","PE":"P\xe9rou","PF":"Polyn\xe9sie fran\xe7aise","PG":"Papouasie-Nouvelle-Guin\xe9e","PH":"Philippines","PK":"Pakistan","PL":"Pologne","PM":"Saint-Pierre-et-Miquelon","PN":"\xceles Pitcairn","PR":"Porto Rico","PS":"Palestine","PT":"Portugal","PW":"Palaos","PY":"Paraguay","QA":"Qatar","RE":"R\xe9union","RO":"Roumanie","RS":"Serbie","RU":"Russie","RW":"Rwanda","SA":"Arabie Saoudite","SB":"\xceles Salomon","SC":"Seychelles","SD":"Soudan","SE":"Su\xe8de","SG":"Singapour","SH":"Sainte-H\xe9l\xe8ne","SI":"Slov\xe9nie","SJ":"Svalbard et \xcele Jan Mayen","SK":"Slovaquie","SL":"Sierra Leone","SM":"Saint-Marin","SN":"S\xe9n\xe9gal","SO":"Somalie","SR":"Suriname","SS":"Soudan du Sud","ST":"S\xe3o Tom\xe9-et-Principe","SV":"El Salvador","SX":"Saint-Martin (partie n\xe9erlandaise)","SY":"Syrie","SZ":"Royaume d\'Eswatini","TC":"\xceles Turques-et-Ca\xefques","TD":"Tchad","TF":"Terres australes fran\xe7aises","TG":"Togo","TH":"Tha\xeflande","TJ":"Tadjikistan","TK":"Tokelau","TL":"Timor-Leste","TM":"Turkm\xe9nistan","TN":"Tunisie","TO":"Tonga","TR":"Turquie","TT":"Trinit\xe9-et-Tobago","TV":"Tuvalu","TW":"Ta\xefwan","TZ":"R\xe9publique unie de Tanzanie","UA":"Ukraine","UG":"Ouganda","UM":"\xceles mineures \xe9loign\xe9es des \xc9tats-Unis","US":"\xc9tats-Unis d\'Am\xe9rique","UY":"Uruguay","UZ":"Ouzb\xe9kistan","VA":"Saint-Si\xe8ge (Vatican)","VC":"Saint-Vincent-et-les-Grenadines","VE":"Venezuela","VG":"\xceles vierges britanniques","VI":"\xceles vierges am\xe9ricaines","VN":"Vietnam","VU":"Vanuatu","WF":"Wallis-et-Futuna","WS":"Samoa","YE":"Y\xe9men","YT":"Mayotte","ZA":"Afrique du Sud","ZM":"Zambie","ZW":"Zimbabwe"}}')},60080:function(e){e.exports=JSON.parse('{"country":{"foreign":"Foreign"},"Scan":{"scan_a_doc":"Scan a doc","save_doc":"Save the doc","filename":"Filename","save":"Save","cancel":"Cancel","qualify":"Describe","apply":"Apply","error":{"offline":"You are currently offline and you can\'t use this functionality. Please, try again later.","uploading":"You are already uploading a file. Please wait until the end of this upload and try again.","generic":"Something went wrong. Please try again."},"successful":{"qualified_ok":"You just have successfully described your file! "},"items":{"accommodation_proof":"Proof of accommodation |||| Proof of accommodations","appliance_invoice":"Appliance invoice |||| Appliance invoices","bank_details":"Bank detail |||| Bank details","bank_statement":"Bank statement |||| Bank statements","birth_certificate":"Birth certificate |||| Birth certificates","building_permit":"Building permit |||| Building permits","caf":"Social benefit rate |||| Social benefit rates","car_insurance":"Car insurance certificate |||| Car insurance certificates","citizen_registration_certificate":"Certificate of citizen registration |||| Certificates of citizen registration","condition_report":"Condition report |||| Condition reports","diploma":"Diploma |||| Diplomas","divorce":"Divorce |||| Divorces","driver_license":"Driving license |||| Driving licenses","electoral_card":"Electoral card |||| Electoral cards","employment_center_certificate":"Employment center certificate |||| Employment center certificates","energy_contract":"Energy provider contract |||| Energy provider contracts","energy_invoice":"Energy invoice |||| Energy invoices","expense_claim":"Expense claim |||| Expense claims","family_record_book":"Family record book |||| Family record books","family":"Family","fidelity_card":"Benefit card |||| Benefit cards","fine":"Fine |||| Fines","gradebook":"Gradebook |||| Gradebooks","grocery_invoice":"Grocery invoice |||| Grocery invoices","health_book":"Health book |||| Health books","health_certificate":"Health/Vaccination certificate |||| Health/Vaccination certificates","health_insurance_card":"Insurance card |||| Insurance cards","health_invoice":"Health invoice |||| Health invoices","health":"Health","home":"Home","house_insurance":"Home insurance |||| Home insurances","house_sale_agreeement":"House sale agreement |||| House sale agreements","identity_photo":"Identity photo |||| Identity photos","identity":"Identity","invoice":"Invoice |||| Invoices","isp_invoice":"ISP invoice |||| ISP invoices","large_family_card":" Large Family Card |||| Large Family Cards","lease":"Lease |||| Leases","loan_agreement":"Loan agreement |||| Loan agreements","mechanic_invoice":"Repair bill |||| Repair bills","motivation_letter":"Motivation letter |||| Motivation letters","national_health_insurance_card":"National health insurance card |||| National health insurance cards","national_health_insurance_right_certificate":"National health insurance right certificate |||| National health insurance right certificates","national_id_card":"ID card |||| ID cards","note_identity_document":"Note Identity |||| Notes Identity","note_family_document":"Note Family |||| Notes Family","note_work_document":"Note Work & Study |||| Notes Work & Study","note_health_document":"Note Health |||| Notes Health","note_house_document":"Note Home |||| Notes Home","note_transport_document":"Note Transport |||| Notes Transport","note_activity_document":"Note Activities |||| Notes Activities","note_finance":"Note Finance |||| Notes Finance","note_invoice":"Note Invoice |||| Notes Invoice","other_activity_document":"Other activities document |||| Other activities documents","other_bank_document":"Other financial document |||| Other financial documents","other_family_document":"Other family document |||| Other family documents","other_health_document":"Other health document |||| Other health documents","other_house_document":"Other house document |||| Other house documents","other_identity_document":"Other document of identity |||| Other documents of identity","other_invoice":"Other invoice |||| Other invoices","other_revenue":"Other revenue |||| Other revenues","other_tax_document":"Other tax document |||| Other tax documents","other_transport_document":"Other transport document |||| Other transport documents","other_work_document":"Other work document |||| Other work documents","other_administrative_document":"Other administrative document |||| Other administrative documents","others":"Others","pacs":"Civil union |||| Civil unions","passport":"Passeport |||| Passeports","pay_sheet":"Pay sheet |||| Pay sheets","payment_proof_family_allowance":"family allowance payment proof |||| family allowance payment proofs","pension":"Pension |||| Pensions","person_insurance":"Individual insurance certificate |||| Individual insurance certificates","personal_sporting_licence":"Sporting licence |||| Sporting licences","phone_invoice":"Phone invoice |||| Phone invoices","pregnancy_medical_certificate":"Certificate of pregnancy |||| Certificates of pregnancy","prescription":"Prescription |||| Prescriptions","real_estate_insurance":"Real estate insurance certificate |||| Real estate insurance certificates","real_estate_tax":"Real estate tax |||| Real estate taxes","receipt":"Receipt |||| Receipts","rent_receipt":"Rent receipt |||| Rent receipts","residence_permit":"Residence permit |||| Residence permits","restaurant_invoice":"Restaurant invoice |||| Restaurant invoices","resume":"Resume |||| Resumes","school_attendance_certificate":"Certificate of school attendance |||| Certificates of school attendance","school_insurance_certificate":"Certificate of school insurance |||| Certificates of school insurance","single_parent_benefit":"Single parent benefit |||| Single parent benefits","student_card":"Student card |||| Student cards","tax_certificate":"Tax certificate |||| Tax certificates","tax_notice":"Tax notice |||| Tax notices","tax_return":"Tax return |||| Tax returns","tax_timetable":"Payment Plans Installment Agreement |||| Payment Plans Installment Agreements","technical_diagnostic_record":"Technical diagnostic record |||| Technical diagnostic records","telecom_invoice":"Telecom invoice |||| Telecom invoices","transport_card":"Transport card |||| Transport cards","transport_invoice":"Transport invoice |||| Transport invoices","transport":"Transport","unemployment_benefit":"Unemployment benefit |||| Unemployment benefits","unfit_for_habitation_declaration":"Declaration of unfit for habitation |||| Declarations of unfit for habitation","vehicle_registration":"Vehicle registration |||| Vehicle registrations","water_invoice":"Water invoice |||| Water invoices","web_service_invoice":"Web service invoice |||| Web service invoices","wedding":"Wedding contract |||| Wedding contracts","work_contract":"Work contract |||| Work contracts","work_disability_recognition":"Recognition of disability |||| Recognitions of disability","work_invoice":"Work invoice |||| Work invoices","work_quote":"Work quote |||| Work quotes","work_study":"Work & Study"},"attributes":{"contractType":{"cdi":"CDI","cdd":"CDD","alternate":"Alternate","internship":"Internship","other":"Other"},"noticePeriod":{"oneWeek":"1 week before","oneMonth":"1 month before","threeMonth":"3 months before","oneYear":"1 year before","custom":"Custom","noAlert":"Do not be alerted"}},"themes":{"activity":"Activities","family":"Family","finance":"Finance","health":"Health","home":"Home","identity":"Identity","invoice":"Invoice","others":"Others","transport":"Transport","undefined":"Undefined","work_study":"Work & Study"},"expiration":{"expired":"Expired","expiresIn":"Expires in %{duration}","description":"This document expires in %{duration}, consider renewing it"},"qualification":{"date":{"title":{"datetime":"Added on","AObtentionDate":"License A, delivered on","BObtentionDate":"License B, delivered on","CObtentionDate":"License C, delivered on","DObtentionDate":"License D, delivered on","issueDate":"Delivered on","expirationDate":"Expiration date","referencedDate":"Referenced date","shootingDate":"Shooting date","obtentionDate":"Date obtained","date":"Document date"}},"information":{"title":{"fine":{"number":"Amount of the fine"},"fidelity_card":{"number":"Card number"},"caf":{"number":"CAF file number"},"payment_proof_family_allowance":{"number":"CAF file number"},"vehicle":{"licenseNumber":"Vehicle registration number","confidentialNumber":"Confidential vehicle registration code"},"vehicle_registration":{"number":"Vehicle registration number (VIN)"},"national_id_card":{"number":"National ID card number"},"bank_details":{"number":"IBAN number"},"passport":{"number":"Passport number"},"driver_license":{"number":"License number"},"residence_permit":{"number":"License number"},"national_health_insurance_card":{"number":"National health insurance card number"},"pay_sheet":{"number":"Gross remuneration"},"tax_return":{"number":"Reference tax number"},"tax_notice":{"number":"Reference tax number"},"real_estate_tax":{"number":"Reference tax number"},"tax_timetable":{"number":"Reference tax number"},"country":"Document issuing country","refTaxIncome":"Reference tax income","contractType":"Contract type","noticePeriod":"Expiration alert","netSocialAmount":"Net social amount","employerName":"Name of employer","employer":"Name of employer","amount":"Amount of expenditure","subtype":"Purpose of expenditure","bicNumber":"BIC number"},"day":"day |||| days"},"contact":"Owner","page":"Side of the document","front":"Front side","back":"Back side","qualification":"Qualification","noInfo":"No information"}},"MagicFolders":{"administrative":"Administrative","photos":"Photos"}}')},76785:function(e){e.exports=JSON.parse('{"country":{"foreign":"\xc9tranger"},"Scan":{"scan_a_doc":"Num\xe9riser un doc","save_doc":"Enregistrer le document","filename":"Nom du fichier","save":"Sauvegarder","cancel":"Annuler","qualify":"Qualifier","apply":"Appliquer","error":{"offline":"Vous \xeates actuellement d\xe9connect\xe9, vous ne pouvez donc pas utiliser cette fonctionnalit\xe9. Connectez-vous \xe0 internet et recommencez. ","uploading":"Vous avez d\xe9j\xe0 un fichier en cours de t\xe9l\xe9chargement. Attendez la fin et recommencez.","generic":"Un probl\xe8me est survenu. Veuillez r\xe9essayer. "},"successful":{"qualified_ok":"Vous venez de qualifier votre fichier avec succ\xe8s !"},"items":{"accommodation_proof":"Attestation d\'h\xe9bergement |||| Attestations d\'h\xe9bergement","appliance_invoice":"Facture d\'\xe9lectrom\xe9nager |||| Factures d\'\xe9lectrom\xe9nager","bank_details":"RIB","bank_statement":"Relev\xe9 de compte |||| Relev\xe9s de compte","birth_certificate":"Acte de naissance |||| Actes de naissance","building_permit":"Permis de construire","caf":"Attestation de quotient familial CAF |||| Attestations de quotient familial CAF","car_insurance":"Attestation d\'assurance auto |||| Attestations d\'assurance auto","citizen_registration_certificate":"Attestation de recensement citoyen |||| Attestations de recensement citoyen","condition_report":"\xc9tat des lieux - Entr\xe9e/Sortie |||| \xc9tats des lieux - Entr\xe9e/Sortie","diploma":"Dipl\xf4me |||| Dipl\xf4mes","divorce":"Attestation de divorce |||| Attestations de divorce","driver_license":"Permis de conduire","electoral_card":"Carte \xe9lectorale |||| Cartes \xe9lectorales","employment_center_certificate":"Attestation de France Travail |||| Attestations de France Travail","energy_contract":"Contrat de fournisseur d\'\xe9nergies |||| Contrats de fournisseur d\'\xe9nergies","energy_invoice":"Facture d\'\xe9nergie |||| Factures d\'\xe9nergie","expense_claim":"Note de frais |||| Notes de frais","family_record_book":"Livret de famille |||| Livrets de famille","family":"Famille","fidelity_card":"Carte avantage |||| Cartes avantages","fine":"Amende |||| Amendes","gradebook":"Bulletin de notes |||| Bulletins de notes","grocery_invoice":"Facture de courses |||| Factures de courses","health_book":"Carnet de sant\xe9 |||| Carnets de sant\xe9","health_certificate":"Certificat de sant\xe9/vaccination |||| Certificats de sant\xe9/vaccination","health_insurance_card":"Carte de mutuelle |||| Cartes de mutuelle","health_invoice":"Facture m\xe9dicale |||| Factures m\xe9dicales","health":"Sant\xe9","home":"Logement","house_insurance":"Assurance logement |||| Assurances logement","house_sale_agreeement":"Compromis de vente","identity_photo":"Photo d\'identit\xe9 |||| Photos d\'identit\xe9","identity":"Identit\xe9","invoice":"Facture |||| Factures","isp_invoice":"Facture d\'internet |||| Factures d\'internet","large_family_card":"Carte famille nombreuse |||| Cartes famille nombreuse","lease":"Bail |||| Baux","loan_agreement":"Contrat de pr\xeat |||| Contrats de pr\xeat","mechanic_invoice":"Facture de r\xe9paration |||| Factures de r\xe9paration","motivation_letter":"Lettre de motivation |||| Lettres de motivation","national_health_insurance_card":"Carte vitale |||| Cartes vitales","national_health_insurance_right_certificate":"Attestation de droits de l\'Assurance Maladie |||| Attestations de droits de l\'Assurance Maladie","national_id_card":"Carte d\'identit\xe9 |||| Cartes d\'identit\xe9","note_identity_document":"Note Identit\xe9 |||| Notes Identit\xe9","note_family_document":"Note Famille |||| Notes Famille","note_work_document":"Note Travail & \xc9tudes |||| Notes Travail & \xc9tudes","note_health_document":"Note Sant\xe9 |||| Notes Sant\xe9","note_house_document":"Note Logement |||| Notes Logement","note_transport_document":"Note Transport |||| Notes Transport","note_activity_document":"Note Activit\xe9s & loisirs |||| Notes Activit\xe9s & loisirs","note_finance":"Note Finances |||| Notes Finances","note_invoice":"Note Factures |||| Notes Factures","other_activity_document":"Autre document de loisirs |||| Autres documents de loisirs","other_bank_document":"Autre document financier |||| Autres documents financiers","other_family_document":"Autre document de famille |||| Autres documents de famille","other_health_document":"Autre document de sant\xe9 |||| Autres documents de sant\xe9","other_house_document":"Autre document de logement |||| Autres documents de logement","other_identity_document":"Autre document d\'identit\xe9 |||| Autres documents d\'identit\xe9","other_invoice":"Autre facture |||| Autres factures","other_revenue":"Autre revenu |||| Autres revenus","other_tax_document":"Imp\xf4ts - Autre document |||| Imp\xf4ts - Autres documents","other_transport_document":"Autre document de transport |||| Autres documents de transport","other_work_document":"Autre document de travail |||| Autres documents de travail","other_administrative_document":"Autre document administratif |||| Autres documents administratifs","others":"Autres","pacs":"Attestation de PACS |||| Attestations de PACS","passport":"Passeport |||| Passeports","pay_sheet":"Fiche de paie |||| Fiches de paie","payment_proof_family_allowance":"Attestation de paiement CAF |||| Attestations de paiement CAF","pension":"Retraite |||| Retraites","person_insurance":"Attestation d\'assurance individuelle |||| Attestations d\'assurance individuelle","personal_sporting_licence":"Licence sportive |||| Licences sportives","phone_invoice":"Facture de t\xe9l\xe9phone |||| Factures de t\xe9l\xe9phone","pregnancy_medical_certificate":"Certificat de grossesse |||| Certificats de grossesse","prescription":"Ordonnance |||| Ordonnances","real_estate_insurance":"Attestation d\'assurance immobili\xe8re |||| Attestations d\'assurance immobili\xe8re","real_estate_tax":"Imp\xf4ts - Taxe fonci\xe8re |||| Imp\xf4ts - Taxes fonci\xe8res","receipt":"Accus\xe9 de r\xe9ception |||| Accus\xe9s de r\xe9ception","rent_receipt":"Quittance de loyer |||| Quittances de loyer","residence_permit":"Titre de s\xe9jour |||| Titres de s\xe9jour","restaurant_invoice":"Facture de restaurant |||| Factures de restaurant","resume":"CV","school_attendance_certificate":"Certificat de scolarit\xe9 |||| Certificats de scolarit\xe9","school_insurance_certificate":"Attestation d\'assurance scolaire |||| Attestations d\'assurance scolaire","single_parent_benefit":"Allocation parent isol\xe9 |||| Allocations parent isol\xe9","student_card":"Carte d\'\xe9tudiant |||| Cartes d\'\xe9tudiant","tax_certificate":"Attestation fiscale |||| Attestations fiscales","tax_notice":"Imp\xf4ts - Avis d\'imposition","tax_return":"Imp\xf4ts - D\xe9claration de revenus |||| Imp\xf4ts - D\xe9clarations de revenus","tax_timetable":"Imp\xf4ts - Ech\xe9ancier |||| Imp\xf4ts - Ech\xe9anciers","technical_diagnostic_record":"Dossier de diagnostic technique |||| Dossiers de diagnostic technique","telecom_invoice":"Facture de t\xe9l\xe9com |||| Factures de t\xe9l\xe9com","transport_card":"Carte de transport |||| Cartes de transport","transport_invoice":"Facture de transport |||| Factures de transport","transport":"Transport","unemployment_benefit":"Allocation ch\xf4mage |||| Allocations ch\xf4mage","unfit_for_habitation_declaration":"Arr\xeat\xe9 d\'insalubrit\xe9 |||| Arr\xeat\xe9s d\'insalubrit\xe9","vehicle_registration":"Carte grise |||| Cartes grises","water_invoice":"Facture d\'eau |||| Factures d\'eau","web_service_invoice":"Facture de service web |||| Factures de service web","wedding":"Contrat de mariage |||| Contrats de mariage","work_contract":"Contrat de travail |||| Contrats de travail","work_disability_recognition":"Reconnaissance de handicap - RQTH |||| Reconnaissances de handicap - RQTH","work_invoice":"Facture de travaux |||| Factures de travaux","work_quote":"Devis de travaux","work_study":"Travail & \xc9tudes"},"attributes":{"contractType":{"cdi":"CDI","cdd":"CDD","alternate":"Alternance","internship":"Stage","other":"Autre"},"noticePeriod":{"oneWeek":"1 semaine avant","oneMonth":"1 mois avant","threeMonth":"3 mois avant","oneYear":"1 an avant","custom":"Personnalis\xe9","noAlert":"Ne pas \xeatre alert\xe9"}},"themes":{"activity":"Activit\xe9s & loisirs","family":"Famille","finance":"Finances","health":"Sant\xe9","home":"Logement","identity":"Identit\xe9","invoice":"Factures","others":"Autres","transport":"Transport","undefined":"Ind\xe9fini","work_study":"Travail & \xc9tudes"},"expiration":{"expired":"Expir\xe9","expiresIn":"Expire dans %{duration}","description":"Ce document expire dans %{duration}, pensez \xe0 le renouveler"},"qualification":{"date":{"title":{"datetime":"Ajout\xe9 le","AObtentionDate":"Permis A, d\xe9livr\xe9 le","BObtentionDate":"Permis B, d\xe9livr\xe9 le","CObtentionDate":"Permis C, d\xe9livr\xe9 le","DObtentionDate":"Permis D, d\xe9livr\xe9 le","issueDate":"D\xe9livr\xe9 le","expirationDate":"Date d\'expiration","referencedDate":"Date de r\xe9f\xe9rence","shootingDate":"Date de prise de vue","obtentionDate":"Date d\'obtention","date":"Date du document"}},"information":{"title":{"fine":{"number":"Montant de l\'amende"},"fidelity_card":{"number":"Num\xe9ro de la carte"},"caf":{"number":"Num\xe9ro de dossier CAF"},"payment_proof_family_allowance":{"number":"Num\xe9ro de dossier CAF"},"vehicle":{"licenseNumber":"Num\xe9ro d\'immatriculation","confidentialNumber":"Code confidentiel de la carte grise"},"vehicle_registration":{"number":"Num\xe9ro de la carte grise (VIN)"},"national_id_card":{"number":"Num\xe9ro de la carte d\'identit\xe9"},"bank_details":{"number":"Num\xe9ro d\'IBAN"},"passport":{"number":"Num\xe9ro du passeport"},"driver_license":{"number":"Num\xe9ro du permis"},"residence_permit":{"number":"Num\xe9ro du permis"},"national_health_insurance_card":{"number":"Num\xe9ro de s\xe9curit\xe9 sociale"},"pay_sheet":{"number":"R\xe9mun\xe9ration brute"},"tax_return":{"number":"Num\xe9ro fiscal de r\xe9f\xe9rence"},"tax_notice":{"number":"Num\xe9ro fiscal de r\xe9f\xe9rence"},"real_estate_tax":{"number":"Num\xe9ro fiscal de r\xe9f\xe9rence"},"tax_timetable":{"number":"Num\xe9ro fiscal de r\xe9f\xe9rence"},"country":"Pays \xe9metteur du document","refTaxIncome":"Revenu fiscal de r\xe9f\xe9rence","contractType":"Type de contrat","noticePeriod":"Alerte dexpiration","netSocialAmount":"Montant net social","employerName":"Nom de l\'employeur","employer":"Nom de l\'employeur","amount":"Montant de la d\xe9pense","subtype":"Objet de la d\xe9pense","bicNumber":"Num\xe9ro BIC"},"day":"jour |||| jours"},"contact":"Titulaire","page":"Face du document","front":"Face avant","back":"Face arri\xe8re","qualification":"Qualification","noInfo":"Non renseign\xe9(e)"}},"MagicFolders":{"administrative":"Administratif","photos":"Photos"}}')}}]);