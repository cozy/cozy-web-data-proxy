let SHARED_WORKER_DB_NAME="sharedWorkerStorage",STORE_NAME="store",DB_NAMES_KEY="cozy-client-pouch-link-db-names";function openDB(e){return new Promise(function(n,o){let t=indexedDB.open(e,1);t.onsuccess=function(e){n(e.target.result)},t.onerror=function(e){o(e.target.error)}})}async function getItem(e,n){let o=await openDB(e);return o?new Promise(function(t,a){try{let e=o.transaction(STORE_NAME,"readonly").objectStore(STORE_NAME).get(n);e.onsuccess=function(){t(e.result?e.result.value:null)},e.onerror=function(){a(e.error)}}catch(n){"NotFoundError"===n.name&&(console.log(`No db ${e} found: nothing to clean`),t(null)),a(n)}}):null}!async function(){try{if(window.localStorage.clear(),console.log("Deleted localStorage."),window.localStorage.setItem("deletingLocalData",new Date().toISOString()),"function"==typeof window.indexedDB?.databases)window.indexedDB.databases().then(function(e){e.forEach(function(e){window.indexedDB.deleteDatabase(e.name),console.log("Deleted indexedDB database: ",e.name)})});else{let e=await getItem("sharedWorkerStorage","cozy-client-pouch-link-db-names");if(!e){console.log("No databases info found. Nothing will be removed.");return}JSON.parse(e).forEach(function(e){let n=window.indexedDB.deleteDatabase(e);n.onsuccess=function(){console.log("Deleted database:",e)},n.onerror=function(n){console.warn("Failed to delete database:",e,n)}}),window.indexedDB.deleteDatabase(LOCAL_DB_NAME)}window.localStorage.removeItem("deletingLocalData")}catch(e){console.log("Something went wrong during cleanup: ",e)}}();