"use strict";(self.webpackChunkcozy_web_data_proxy=self.webpackChunkcozy_web_data_proxy||[]).push([["465"],{18621:function(e,t,r){var n=r(34155),a=r(14746),i=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(r(54765)),u=i(r(90402)),c=i(r(98235)),s=i(r(80295)),l=i(r(68434)),d=i(r(82007)),f=i(r(65105)),p=i(r(19723)),h=i(r(64512)),y=i(r(66604)),v=i(r(17204)),m=i(r(85564)),b=i(r(45578)),g=i(r(4788)),k=i(r(84486)),O=i(r(27361)),w=i(r(37203)),_=a(r(60359)),S=r(87941),P=i(r(97619)),C=r(25367),x=r(11282),E=r(72004),D=r(71450),j=r(18118),A=i(r(20057)),T=a(r(65972)),I=i(r(39268)),M=i(r(42189)),R=r(37130),N=i(r(31344)),F=r(325),L=i(r(22853)),B=r(76305),z=i(r(67266)),U=i(r(25888)),G=r(23864);function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach(function(t){(0,h.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function q(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return J(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return J(e,t)}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Y=function(e){return{get:function(t,r){return L.default.warn(e),t[r]}}},K=function(e){var t;if(e&&"undefined"!=typeof window&&null!==(t=window.cozy)&&void 0!==t&&t.isSecureProtocol){var r,n=new URL(e);return n.protocol="https:",(r=n.toString()).endsWith("/")?r.slice(0,-1):r}return e},V="creation",W="update",Z=function(){var e,t,r,a,i,w,I,Q,J,Z,$,X,ee,et,er,en,ea,ei,eo,eu,ec,es,el;function ed(){var e,t,r=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,f.default)(this,ed),(0,h.default)(this,"fetchQueryAndGetFromState",(e=(0,d.default)(l.default.mark(function e(t){var n,a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.definition,a=t.options,e.prev=1,e.next=4,r.query(n,a);case 4:return e.abrupt("return",r.getQueryFromState(a.as,a));case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:case"end":return e.stop()}},e,null,[[1,7]])})),function(t){return e.apply(this,arguments)}));var a=n.link,i=n.links,o=n.schema,u=n.appMetadata,c=n.capabilities,p=(0,s.default)(n,["link","links","schema","appMetadata","capabilities"]);a&&L.default.warn("`link` is deprecated, use `links`"),this.appMetadata=void 0===u?{}:u,this.loginPromise=null,p.uri=K(p.uri),this.options=p,this.queryIdGenerator=new B.QueryIDGenerator,this.isLogged=!1,this.instanceOptions={},this.handleRevocationChange=this.handleRevocationChange.bind(this),this.handleTokenRefresh=this.handleTokenRefresh.bind(this),this.createClient();var y=this.getStackClient();if(y.on("error",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.emit.apply(r,["error"].concat(t))}),this.links=Array.isArray(t=a||i||new P.default)?t:[t],this.registerClientOnLinks(),this.chain=(0,R.chain)(this.links),this.schema=new M.default(void 0===o?{}:o,y),this.capabilities=c||null,this.plugins={},!(this.stackClient instanceof _.OAuthClient))try{this.loadInstanceOptionsFromDOM()}catch(e){}this._promiseCache=new U.default,p.uri&&p.token&&this.login(),this.storeAccesors=null,!1!==p.store&&this.ensureStore()}return(0,p.default)(ed,[{key:"emit",value:function(){}},{key:"on",value:function(){}},{key:"removeListener",value:function(){}},{key:"registerPlugin",value:function(e,t){if(!e.pluginName)throw Error("Cannot register a plugin whose class does not have `pluginName` attribute.");if(this.plugins[e.pluginName])throw Error("Cannot register plugin ".concat(e.pluginName,". A plugin with the same name has already been registered."));var r=new e(this,t);return this.plugins[e.pluginName]=r,r}},{key:"addSchema",value:function(e){this.schema.add(e)}},{key:"registerClientOnLinks",value:function(){var e,t=q(this.links);try{for(t.s();!(e=t.n()).done;){var r=e.value;if(r.registerClient)try{r.registerClient(this)}catch(e){L.default.warn(e)}}}catch(e){t.e(e)}finally{t.f()}}},{key:"login",value:function(e){return this.isLogged&&!this.isRevoked?(L.default.warn("CozyClient is already logged."),this.loginPromise):this.loginPromise=this._login(e)}},{key:"_login",value:(e=(0,d.default)(l.default.mark(function e(t){var r,n,a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.emit("beforeLogin"),this.registerClientOnLinks(),t&&(t.uri&&this.stackClient.setUri(t.uri),t.token&&this.stackClient.setToken(t.token)),r=q(this.links),e.prev=4,r.s();case 6:if((n=r.n()).done){e.next=13;break}if(!(a=n.value).onLogin){e.next=11;break}return e.next=11,a.onLogin();case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:if(this.isLogged=!0,this.isRevoked=!1,!(this.stackClient instanceof _.OAuthClient)){e.next=26;break}return e.next=26,this.loadInstanceOptionsFromStack();case 26:this.emit("login");case 27:case"end":return e.stop()}},e,this,[[4,15,18,21]])})),function(t){return e.apply(this,arguments)})},{key:"logout",value:(t=(0,d.default)(l.default.mark(function e(){var t,r,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLogged){e.next=3;break}return L.default.warn("CozyClient isn't logged."),e.abrupt("return");case 3:if(this.emit("beforeLogout"),this.isLogged=!1,!(this.stackClient instanceof _.OAuthClient)){e.next=17;break}if(e.prev=6,!(this.stackClient.unregister&&(!this.stackClient.isRegistered||this.stackClient.isRegistered()))){e.next=10;break}return e.next=10,this.stackClient.unregister();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),L.default.warn("Impossible to unregister client on stack: ".concat(e.t0));case 15:case 20:e.next=25;break;case 17:return e.prev=17,e.next=20,this.stackClient.fetch("DELETE","/auth/login");case 22:e.prev=22,e.t1=e.catch(17),L.default.warn("Impossible to log out: ".concat(e.t1));case 25:t=q(this.links),e.prev=26,t.s();case 28:if((r=t.n()).done){e.next=41;break}if(!(n=r.value).reset){e.next=39;break}return e.prev=31,e.next=34,n.reset();case 34:e.next=39;break;case 36:e.prev=36,e.t2=e.catch(31),L.default.warn(e.t2);case 39:e.next=28;break;case 41:e.next=46;break;case 43:e.prev=43,e.t3=e.catch(26),t.e(e.t3);case 46:return e.prev=46,t.f(),e.finish(46);case 49:this.store&&this.dispatch((0,T.resetState)()),this.emit("logout");case 51:case"end":return e.stop()}},e,this,[[6,12],[17,22],[26,43,46,49],[31,36]])})),function(){return t.apply(this,arguments)})},{key:"collection",value:function(e){return this.getStackClient().collection(e)}},{key:"fetch",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.getStackClient().fetch(e,t,r,n)}},{key:"all",value:function(e){return L.default.warn("\nclient.all is deprecated, prefer to use the Q helper to build a new QueryDefinition.\n\nimport { Q } from 'cozy-client'\nclient.query(Q('io.cozy.bills'))"),(0,D.Q)(e)}},{key:"find",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return L.default.warn("client.find(doctype, selector) is deprecated, please use Q(doctype).where(selector) to build the same query."),new D.QueryDefinition({doctype:e,selector:t})}},{key:"get",value:function(e,t){return L.default.warn("client.get(".concat(e,", id) is deprecated, please use Q(").concat(e,").getById(id) to build the same query.")),new D.QueryDefinition({doctype:e,id:t})}},{key:"create",value:(r=(0,d.default)(l.default.mark(function e(t,r,n){var a,i,o,u=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:{},r._type,o=H({_type:t},(0,s.default)(r,["_type"])),e.next=5,this.schema.validate(o);case 5:if(!(!0!==e.sent)){e.next=8;break}throw Error("Validation failed");case 8:return e.abrupt("return",this.mutate(this.getDocumentSavePlan(o,n),a));case 9:case"end":return e.stop()}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"validate",value:function(e){return this.schema.validate(e)}},{key:"save",value:(a=(0,d.default)(l.default.mark(function e(t){var r,n,a,i,o=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:{},n=t._type,a=(0,s.default)(t,["_type"]),n){e.next=4;break}throw Error("The document must have a `_type` property");case 4:return i=H({_type:n},a),e.next=7,this.schema.validate(i);case 7:if(!(!0!==e.sent)){e.next=10;break}throw Error("Validation failed");case 10:return e.abrupt("return",this.mutate(this.getDocumentSavePlan(i),r));case 11:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"saveAll",value:(i=(0,d.default)(l.default.mark(function e(t){var r=this,n,a,i,o,u=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:{},!(1!==Array.from(new Set(t.map(function(e){return e._type}))).length)){e.next=4;break}throw Error("saveAll can only save documents with the same doctype");case 4:return e.next=6,Promise.all(t.map(function(e){return r.schema.validate(e)}));case 6:if(!((a=e.sent.filter(function(e){return!0!==e})).length>0)){e.next=11;break}throw L.default.warn("There has been some validation errors while bulk saving",a),Error("Validation failed for at least one doc");case 11:return i=t.map(function(e){return r.prepareDocumentForSave(e)}),o=D.Mutations.updateDocuments(i),e.abrupt("return",this.mutate(o,n));case 14:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"ensureCozyMetadata",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{event:V};if(void 0===this.appMetadata)return e;if(e._type){var n=this.schema.getDoctypeSchema(e._type);t=(0,O.default)(n,"doctypeVersion")}var a=this.appMetadata,i=a.slug,o=a.sourceAccount,u=a.sourceAccountIdentifier,s=a.version,l=new Date().toISOString(),d=(0,O.default)(e,"cozyMetadata",{});return r.event===V?d=H({metadataVersion:1,doctypeVersion:t,createdByApp:i,sourceAccount:o,sourceAccountIdentifier:u,createdAt:l,createdByAppVersion:s,updatedAt:l,updatedByApps:i?[{date:l,slug:i,version:s}]:[]},d):r.event===W&&(d=H(H({},d),{},{updatedAt:l,updatedByApps:[{date:l,slug:i,version:s}].concat((0,c.default)((0,O.default)(e,"cozyMetadata.updatedByApps",[]).filter(function(e){return e.slug!==i})))})),H(H({},e),{},{cozyMetadata:d})}},{key:"prepareDocumentForSave",value:function(e){var t=!e._rev;return this.ensureCozyMetadata((0,E.dehydrate)(e),{event:t?V:W})}},{key:"getDocumentSavePlan",value:function(e,t){var r=this,n=!e._rev,a=this.prepareDocumentForSave(e),i=n?D.Mutations.createDocument(a):D.Mutations.updateDocument(a);if(!(t&&Object.values(t).filter(function(e){return Array.isArray(e)?e.length>0:e}).length>0))return i;for(var o=0,c=Object.keys(t);o<c.length;o++){var s,l,d=c[o],f=e._type,p=this.schema.getRelationship(f,d);if(!((s=p.type).prototype.addReferences&&s.prototype.removeReferences)){;throw l=p.name,Error('The "'.concat(l,'" relationship does not support references. If you need to add references to a document, its relationship class must have the methods {add,remove}References'))}}if(t&&!n)throw Error("Unable to save external relationships on a not-new document");return[i,function(e){var n=r.hydrateDocument(e.data);return Object.entries(t).map(function(e){var t=(0,u.default)(e,2),r=t[0],a=t[1];return n[r].addReferences(a)})}]}},{key:"triggerHook",value:function(e,t){if(ed.hooks){var r,n=q((ed.hooks[t._type]||{})[e]||[]);try{for(n.s();!(r=n.n()).done;)(0,r.value)(this,t)}catch(e){n.e(e)}finally{n.f()}}}},{key:"destroy",value:(w=(0,d.default)(l.default.mark(function e(t){var r,n,a=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.triggerHook("before:destroy",t);case 3:return e.next=5,this.mutate(D.Mutations.deleteDocument(t),r);case 5:return n=e.sent,e.next=8,this.triggerHook("after:destroy",t);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"upload",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.mutate(D.Mutations.uploadFile(e,t),r)}},{key:"ensureQueryExists",value:function(e,t,r){this.ensureStore(),("loaded"!==(0,T.getQueryFromState)(this.store.getState(),e).fetchStatus||!t.skip&&!t.bookmark)&&this.dispatch((0,T.initQuery)(e,t,r))}},{key:"query",value:(I=(0,d.default)(l.default.mark(function e(t){var r=this,n,a,i,o,u,c,d,f,p,h=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(n=h.length>1&&void 0!==h[1]?h[1]:{}).update,i=n.executeFromStore,o=(0,s.default)(n,["update","executeFromStore"]),this.ensureStore(),u=o.as||this.queryIdGenerator.generateId(t),c=this.getQueryFromState(u,o),!(void 0!==o.enabled)||!("boolean"!=typeof o.enabled)){e.next=8;break}throw Error("option.enabled should be a boolean for this query: ".concat(JSON.stringify(t)));case 8:if(!o.fetchPolicy){e.next=14;break}if(o.as){e.next=11;break}throw Error("Cannot use `fetchPolicy` without naming the query, please use `as` to name the query");case 11:if(o.fetchPolicy(c)){e.next=14;break}return e.abrupt("return");case 14:if(!(c&&Object.keys(c).length>0)||"loading"!==c.fetchStatus){e.next=17;break}return e.abrupt("return",this._promiseCache.get(function(){return(0,z.default)(t)}));case 17:return this.ensureQueryExists(u,t,o),e.prev=18,d=void 0!==o.backgroundFetching?o.backgroundFetching:this.options.backgroundFetching,this.dispatch((0,T.loadQuery)(u,{backgroundFetching:d})),f=i?function(){return Promise.resolve((0,T.executeQueryFromState)(r.store.getState(),t))}:function(){return r.requestQuery(t)},e.next=24,this._promiseCache.exec(f,function(){return(0,z.default)(t)});case 24:return p=e.sent,this.dispatch((0,T.receiveQueryResult)(u,p,{update:a,backgroundFetching:d})),e.abrupt("return",p);case 29:if(e.prev=29,e.t0=e.catch(18),this.dispatch((0,T.receiveQueryError)(u,e.t0)),!o.onError){e.next=36;break}o.onError(e.t0),e.next=41;break;case 36:if(!this.options.onError){e.next=40;break}this.options.onError(e.t0),e.next=41;break;case 40:throw e.t0;case 41:case"end":return e.stop()}},e,this,[[18,29]])})),function(e){return I.apply(this,arguments)})},{key:"queryAll",value:(Q=(0,d.default)(l.default.mark(function e(t){var r,n,a,i,o,u,s=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r=s.length>1&&void 0!==s[1]?s[1]:{}).as||this.queryIdGenerator.generateId(t),a=H(H({},r),{},{as:n}),e.prev=3,e.next=6,this.query(t,a);case 6:o=(i=e.sent).data;case 8:if(!(i&&i.next)){e.next=22;break}if(!i.bookmark){e.next=15;break}return e.next=12,this.query(t.offsetBookmark(i.bookmark),a);case 12:i=e.sent,e.next=19;break;case 15:return u=(0,T.getRawQueryFromState)(this.store.getState(),n),e.next=18,this.query(t.offset(u.data.length),a);case 18:i=e.sent;case 19:o.push.apply(o,(0,c.default)(i.data)),e.next=8;break;case 22:return e.abrupt("return",o);case 25:return e.prev=25,e.t0=e.catch(3),L.default.log("queryAll error for ".concat(e.t0.toString())),e.abrupt("return",[]);case 29:case"end":return e.stop()}},e,this,[[3,25]])})),function(e){return Q.apply(this,arguments)})},{key:"watchQuery",value:function(){return L.default.warn("client.watchQuery is deprecated, please use client.makeObservableQuery."),this.makeObservableQuery.apply(this,arguments)}},{key:"makeObservableQuery",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.ensureStore();var r=t.as||this.queryIdGenerator.generateId(e);return this.ensureQueryExists(r,e),new N.default(r,e,this,t)}},{key:"mutate",value:(J=(0,d.default)(l.default.mark(function e(t){var r,n,a,i,o,u,c=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r=c.length>1&&void 0!==c[1]?c[1]:{}).update,a=r.updateQueries,i=(0,s.default)(r,["update","updateQueries"]),this.ensureStore(),o=i.as||this.queryIdGenerator.generateId(t),this.dispatch((0,T.initMutation)(o,t)),e.prev=5,e.next=8,this.requestMutation(t);case 8:return u=e.sent,this.dispatch((0,T.receiveMutationResult)(o,u,{update:n,updateQueries:a},t)),e.abrupt("return",u);case 13:throw e.prev=13,e.t0=e.catch(5),this.dispatch((0,T.receiveMutationError)(o,e.t0,t)),e.t0;case 17:case"end":return e.stop()}},e,this,[[5,13]])})),function(e){return J.apply(this,arguments)})},{key:"requestQuery",value:(Z=(0,d.default)(l.default.mark(function e(t){var r,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.chain.request(t);case 2:return r=e.sent,e.next=5,this.persistVirtualDocuments(t,r.data);case 5:if(t.includes){e.next=7;break}return e.abrupt("return",r);case 7:return e.next=9,this.fetchRelationships(r,this.getIncludesRelationships(t));case 9:return n=e.sent,e.abrupt("return",n);case 11:case"end":return e.stop()}},e,this)})),function(e){return Z.apply(this,arguments)})},{key:"persistVirtualDocuments",value:($=(0,d.default)(l.default.mark(function e(t,r){var n,a,i,o;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=["io.cozy.files.shortcuts"].includes(t.doctype),"io.cozy.apps_registry"!==t.doctype){e.next=6;break}return e.next=5,this.persistVirtualDocument({_type:"io.cozy.apps_registry",_id:t.id,cozyPouchData:r},n);case 5:return e.abrupt("return",e.sent);case 6:if(Array.isArray(r)){e.next=11;break}return e.next=9,this.persistVirtualDocument(r,n);case 9:e.next=28;break;case 11:a=q(r),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=20;break}return o=i.value,e.next=18,this.persistVirtualDocument(o,n);case 18:e.next=14;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(12),a.e(e.t0);case 25:return e.prev=25,a.f(),e.finish(25);case 28:case"end":return e.stop()}},e,this,[[12,22,25,28]])})),function(e,t){return $.apply(this,arguments)})},{key:"persistVirtualDocument",value:(X=(0,d.default)(l.default.mark(function e(t,r){var n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!t||t.cozyLocalOnly)){e.next=2;break}return e.abrupt("return");case 2:if(!(!(null!==(n=t.meta)&&void 0!==n&&n.rev)&&!t._rev||r)){e.next=5;break}return e.next=5,this.chain.persistCozyData(t);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return X.apply(this,arguments)})},{key:"fetchRelationships",value:(ee=(0,d.default)(l.default.mark(function e(t,r){var n,a,i,o,c,s,d,f,p,h,y,v,O,w,_,S,P,C,E,j=this;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!(n=!Array.isArray(t.data))&&0===t.data.length)){e.next=3;break}return e.abrupt("return",t);case 3:return a=n?[t.data]:t.data,i=new Map,o=[],c=[],a.forEach(function(e){return(0,k.default)(r,function(t,r){try{var n=t.type.query(e,j,t),a=e._id;i.set(n,[a,r]),n instanceof D.QueryDefinition?c.push(n):o.push(n)}catch(e){}})}),s=(0,A.default)(c),e.next=11,Promise.all(s.map(function(e){return j.chain.request(e)}));case 11:d=e.sent,f=(0,b.default)((0,m.default)(o),"_id"),p=(0,m.default)(d.map(function(e){return e.included||e.data})).concat(f).filter(Boolean),h={},y=q((0,g.default)(s,d));try{for(y.s();!(v=y.n()).done;)w=(O=(0,u.default)(v.value,2))[0],_=O[1],(S=i.get(w))&&(C=(P=(0,u.default)(S,2))[0],E=P[1],h[C]=h[C]||{},h[C][E]=(0,x.responseToRelationship)(_))}catch(e){y.e(e)}finally{y.f()}return e.abrupt("return",H(H({},(0,x.attachRelationships)(t,h)),{},{included:p}));case 18:case"end":return e.stop()}},e)})),function(e,t){return ee.apply(this,arguments)})},{key:"requestMutation",value:(et=(0,d.default)(l.default.mark(function e(t){var r,n,a,i,u=this;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=8;break}return n=(r=(0,o.default)(t))[0],a=r.slice(1),e.next=4,this.requestMutation(n);case 4:return i=e.sent,e.next=7,Promise.all(a.map(function(e){var t="function"==typeof e?e(i):e;return u.requestMutation(t)}));case 7:return e.abrupt("return",i);case 8:return e.abrupt("return",this.chain.request(t));case 9:case"end":return e.stop()}},e,this)})),function(e){return et.apply(this,arguments)})},{key:"getIncludesRelationships",value:function(e){var t=this,r=e.includes,n=e.doctype;return r?(0,v.default)(r.map(function(e){return[e,t.schema.getRelationship(n,e)]})):{}}},{key:"hydrateDocuments",value:function(e,t){var r=this;if(!1===this.options.autoHydrate)return t;var n=this.schema.getDoctypeSchema(e);return n.relationships?t.map(function(e){return r.hydrateDocument(e,n)}):t}},{key:"hydrateDocument",value:function(e,t){if(!e)return e;var r=t||this.schema.getDoctypeSchema(e._type);return H(H({},e),this.hydrateRelationships(e,r.relationships))}},{key:"hydrateRelationships",value:function(e,t){var r=this.getRelationshipStoreAccessors();return(0,y.default)(t,function(t,n){return(0,C.create)(e,t,r)})}},{key:"makeNewDocument",value:function(e){return this.hydrateDocument({_type:e})}},{key:"generateRandomId",value:function(){return this.queryIdGenerator.generateRandomId()}},{key:"getAssociation",value:function(e,t){return(0,C.create)(e,this.schema.getRelationship(e._type,t),this.getRelationshipStoreAccessors())}},{key:"getRelationshipStoreAccessors",value:function(){var e=this;return!this.storeAccesors&&(this.storeAccessors={get:this.getDocumentFromState.bind(this),save:function(t,r){return e.save.call(e,t,r)},dispatch:this.dispatch.bind(this),query:function(t,r){return e.query.call(e,t,r)},mutate:function(t,r){return e.mutate.call(e,t,r)}}),this.storeAccessors}},{key:"getCollectionFromState",value:function(e){try{return(0,T.getCollectionFromState)(this.store.getState(),e)}catch(t){return L.default.warn("Could not getCollectionFromState",e,t.message),null}}},{key:"getDocumentFromState",value:function(e,t){try{return(0,T.getDocumentFromState)(this.store.getState(),e,t)}catch(r){return L.default.warn("Could not getDocumentFromState",e,t,r.message),null}}},{key:"getQueryFromState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.hydrated||!1,n=t.singleDocData||!1;try{var a=(0,T.getQueryFromState)(this.store.getState(),e),i=a.definition&&a.definition.doctype,o=a.definition&&a.definition.id;if(!r&&!n)return a;var u=r&&i?this.hydrateDocuments(i,a.data):a.data;return H(H({},a),{},{data:o&&n?u[0]:u})}catch(t){return L.default.warn("Could not get query from state. queryId: ".concat(e,", error: ").concat(t.message)),null}}},{key:"register",value:function(e){return this.getStackClient().setUri(e),this.startOAuthFlow(j.authFunction)}},{key:"isReactNative",value:function(){return"undefined"!=typeof navigator&&"ReactNative"==navigator.product}},{key:"startOAuthFlow",value:(er=(0,d.default)(l.default.mark(function e(t){var r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getStackClient(),e.next=3,r.register();case 3:return e.next=5,this.certifyFlagship();case 5:return e.abrupt("return",this.authorize({openURLCallback:t}));case 6:case"end":return e.stop()}},e,this)})),function(e){return er.apply(this,arguments)})},{key:"certifyFlagship",value:(en=(0,d.default)(l.default.mark(function e(){var t;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.getStackClient()).oauthOptions.shouldRequireFlagshipPermissions){e.next=4;break}return e.next=4,(0,G.certifyFlagship)(t.oauthOptions.certificationConfig,this);case 4:case"end":return e.stop()}},e,this)})),function(){return en.apply(this,arguments)})},{key:"authorize",value:(ea=(0,d.default)(l.default.mark(function e(){var t,r,n,a,i,o,u,c,s,d,f,p,h,y,v,m=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0===(r=(t=m.length>0&&void 0!==m[0]?m[0]:{}).openURLCallback)?j.authFunction:r,i=void 0===(a=t.sessionCode)?void 0:a,u=void 0===(o=t.pkceCodes)?{}:o,e.prev=1,c=u.codeVerifier,s=u.codeChallenge,f=(d=this.getStackClient()).generateStateCode(),p=d.getAuthCodeURL({stateCode:f,scopes:void 0,sessionCode:i,codeChallenge:s}),e.next=8,n(p);case 8:return h=e.sent,y=d.getAccessCodeFromURL(h,f),e.next=12,d.fetchAccessToken(y,void 0,void 0,c);case 12:return v=e.sent,d.setToken(v),e.abrupt("return",{token:v,infos:d.oauthOptions,client:d.oauthOptions});case 17:throw e.prev=17,e.t0=e.catch(1),e.t0.message===S.REGISTRATION_ABORT&&this.getStackClient().unregister(),e.t0;case 21:case"end":return e.stop()}},e,this,[[1,17]])})),function(){return ea.apply(this,arguments)})},{key:"renewAuthorization",value:function(){return this.authorize({openURLCallback:j.authFunction})}},{key:"setStore",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.force;if(void 0===e)throw Error("Store is undefined");if(this.store&&!(void 0!==r&&r))throw Error("Client already has a store, it is forbidden to change store.\nsetStore must be called before any query is executed. Try to\ncall setStore earlier in your code, preferably just after the\ninstantiation of the client.");this.store=e}},{key:"ensureStore",value:function(){!this.store&&this.setStore((0,T.createStore)())}},{key:"checkForRevocation",value:(ei=(0,d.default)(l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.stackClient instanceof _.OAuthClient)){e.next=4;break}return e.abrupt("return",this.stackClient.checkForRevocation());case 4:throw"checkForRevocation is only implemented for OAutClient";case 5:case"end":return e.stop()}},e,this)})),function(){return ei.apply(this,arguments)})},{key:"handleRevocationChange",value:function(e){e?(this.isRevoked=!0,this.emit("revoked")):(this.isRevoked=!1,this.emit("unrevoked"))}},{key:"handleTokenRefresh",value:function(e){this.emit("tokenRefreshed"),this.options.onTokenRefresh&&(Y("Using onTokenRefresh is deprecated, please use events like this: cozyClient.on('tokenRefreshed', token => console.log('Token has been refreshed', token)). https://git.io/fj3M3"),this.options.onTokenRefresh(e))}},{key:"createClient",value:function(){this.options.client&&L.default.warn("CozyClient: Using options.client is deprecated, please use options.stackClient.");var e=void 0===this.options.warningForCustomHandlers||this.options.warningForCustomHandlers,t=this.options.client||this.options.stackClient,r={onRevocationChange:this.handleRevocationChange,onTokenRefresh:this.handleTokenRefresh};if(t){this.stackClient=t,!t.options&&(t.options={});for(var n=0,a=Object.keys(r);n<a.length;n++){var i=a[n];t.options[i]?e&&L.default.warn("You passed a stackClient with its own ".concat(i,". It is not supported, unexpected things might happen.")):t.options[i]=r[i]}}else{var o=H(H({},this.options),r);this.stackClient=this.options.oauth?new _.OAuthClient(o):new _.default(o)}this.client=new Proxy(this.stackClient,Y("Using cozyClient.client is deprecated, please use cozyClient.stackClient."))}},{key:"getClient",value:function(){return L.default.warn("CozyClient: getClient() is deprecated, please use getStackClient()."),this.getStackClient()}},{key:"getStackClient",value:function(){return!this.stackClient&&this.createClient(),this.stackClient}},{key:"reducer",value:function(){return T.default}},{key:"dispatch",value:function(e){return this.store.dispatch(e)}},{key:"getInstanceOptions",value:function(){return this.instanceOptions}},{key:"loadInstanceOptionsFromDOM",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[role=application]",t=document.querySelector(e);if(!(t instanceof HTMLElement))throw Error("The selector that is passed does not return an HTMLElement");var r=t.dataset,n=r.cozy,a=(0,s.default)(r,["cozy"]);this.instanceOptions=H(H({},JSON.parse(void 0===n?"{}":n)),a),this.capabilities=this.instanceOptions.capabilities||null}},{key:"loadInstanceOptionsFromStack",value:(eo=(0,d.default)(l.default.mark(function e(){var t,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.query((0,D.Q)("io.cozy.settings").getById("io.cozy.settings.capabilities"));case 2:return t=e.sent.data,e.next=6,this.query((0,D.Q)("io.cozy.settings").getById("io.cozy.settings.instance"));case 6:r=e.sent.data,this.instanceOptions={capabilities:t,locale:r.locale,tracking:r.tracking},this.capabilities=this.instanceOptions.capabilities||null;case 10:case"end":return e.stop()}},e,this)})),function(){return eo.apply(this,arguments)})},{key:"setData",value:function(e){var t=this;this.ensureStore(),Object.entries(e).forEach(function(e){var r=(0,u.default)(e,2),n=(r[0],r[1]);t.dispatch((0,T.receiveQueryResult)(null,{data:n}))})}},{key:"setOnError",value:function(e){if(this.options&&this.options.onError)throw Error("On Error is already defined");this.options.onError=e}},{key:"toJSON",value:function(){return new F.CozyClient({uri:this.options.uri})}},{key:"setAppMetadata",value:function(e){this.appMetadata=H(H({},this.appMetadata),e)}},{key:"getSettings",value:(eu=(0,d.default)(l.default.mark(function e(t,r){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,E.getSettings)(this,t,r));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return eu.apply(this,arguments)})},{key:"saveAfterFetchSettings",value:(ec=(0,d.default)(l.default.mark(function e(t,r,n){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,E.saveAfterFetchSettings)(this,t,r,n));case 1:case"end":return e.stop()}},e,this)})),function(e,t,r){return ec.apply(this,arguments)})},{key:"resetQuery",value:(es=(0,d.default)(l.default.mark(function e(t){var r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(0,T.isQueryExisting)(this.store.getState(),t)){e.next=3;break}return e.abrupt("return",Promise.resolve(null));case 3:return this.dispatch((0,T.resetQuery)(t)),r=this.getQueryFromState(t),e.next=7,this.query(r.definition,{as:t});case 7:return e.abrupt("return",e.sent);case 10:throw e.prev=10,e.t0=e.catch(0),e.t0;case 13:case"end":return e.stop()}},e,this,[[0,10]])})),function(e){return es.apply(this,arguments)})}],[{key:"fromOldClient",value:function(e,t){return new ed(H({uri:e._url,token:e._token.token},t))}},{key:"fromOldOAuthClient",value:(el=(0,d.default)(l.default.mark(function e(t,r){var n,a,i;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._oauth){e.next=12;break}return e.next=3,t.authorize();case 3:if(a={oauth:(n=e.sent).client,token:n.token,scope:n.token.scope},!(i=new ed(H(H({uri:t._url},a),r))).loginPromise){e.next=9;break}return e.next=9,i.loginPromise;case 9:return e.abrupt("return",i);case 12:throw Error("Cannot instantiate a new client: old client is not an OAuth client. CozyClient.fromOldClient might be more suitable.");case 13:case"end":return e.stop()}},e)})),function(e,t){return el.apply(this,arguments)})},{key:"fromEnv",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e||(void 0!==n?n.env:{}),a=r.COZY_URL,i=r.COZY_CREDENTIALS;if(!a||!i)throw Error("Env used to instantiate CozyClient must have COZY_URL and COZY_CREDENTIALS");try{t.oauth=JSON.parse(i)}catch(e){t.token=i.trim()}return t.uri=a.trim(),new ed(H({},t))}},{key:"fromDOM",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"[role=application]",r=document.querySelector(t);if(!(r instanceof HTMLElement))throw Error("Cannot find an HTMLElement corresponding to ".concat(t));if(!r||!r.dataset)throw Error("Found no data in ".concat(t," to instantiate cozyClient"));var n=r.dataset.cozy?JSON.parse(r.dataset.cozy):H({},r.dataset),a=n.domain,i=n.token;if((!a||!i)&&(a=a||n.cozyDomain,i=i||n.cozyToken),!a||!i)throw Error("Found no data in ".concat(r.dataset," to instantiate cozyClient"));return new ed(H({uri:"".concat(window.location.protocol,"//").concat(a),token:i,capabilities:n.capabilities},e))}},{key:"registerHook",value:function(e,t,r){var n=ed.hooks[e]=ed.hooks[e]||{};n[t]=n[t]||[],n[t].push(r)}}]),ed}();Z.hooks=Z.hooks||{},Z.fetchPolicies=I.default,Z.version="49.0.0",w.default.mixin(Z);t.default=Z},37130:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.chain=t.default=void 0;var a=n(r(98235)),i=n(r(68434)),o=n(r(82007)),u=n(r(65105)),c=n(r(19723)),s=function(){var e,t,r;function n(e,t){(0,u.default)(this,n),"function"==typeof e&&(this.request=e),"function"==typeof t&&(this.persistCozyData=t)}return(0,c.default)(n,[{key:"request",value:(e=(0,o.default)(i.default.mark(function e(t,r,n){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("request is not implemented");case 1:case"end":return e.stop()}},e)})),function(t,r,n){return e.apply(this,arguments)})},{key:"persistCozyData",value:(t=(0,o.default)(i.default.mark(function e(t,r){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("persistCozyData is not implemented");case 1:case"end":return e.stop()}},e)})),function(e,r){return t.apply(this,arguments)})},{key:"reset",value:(r=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("reset is not implemented");case 1:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})}]),n}();t.default=s;var l=function(e){return"function"==typeof e?new s(e):e},d=new s(function(e,t){if(t)return t;if(e.execute)return e.execute();throw Error("No link could handle operation ".concat(JSON.stringify(e)))},function(e,t){});t.chain=function(e){return[].concat((0,a.default)(e),[d]).map(l).reduce(f)};var f=function(e,t){return new s(function(r,n,a){return e.request(r,n,function(e,r){return t.request(e,r,a)})},function(r,n){return e.persistCozyData(r,function(e){return t.persistCozyData(e,n)})})}},31344:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(65105)),i=n(r(19723)),o=n(r(64512)),u=n(r(27361)),c=r(65972),s=Object.prototype.hasOwnProperty,l=function(){function e(t,r,n,i){var u=this;if((0,a.default)(this,e),(0,o.default)(this,"handleStoreChange",function(){var e=u.currentRawResult();!function(e,t){if(d(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var a=0;a<r.length;a++)if(!s.call(t,r[a])||!d(e[r[a]],t[r[a]]))return!1;return!0}(e,u.lastResult)&&(u.lastResult=e,u.notifyObservers())}),!t||!r||!n)throw Error("ObservableQuery takes 3 arguments: queryId, definition and client");this.queryId=t,this.definition=r,this.client=n,this.observers={},this.idCounter=1,this.lastResult=this.currentRawResult(),this.options=i}return(0,i.default)(e,[{key:"currentResult",value:function(){return this.client.getQueryFromState(this.queryId,{hydrated:(0,u.default)(this.options,"hydrated",!0),singleDocData:!0})}},{key:"fetch",value:function(){return this.client.query(this.definition,{as:this.queryId})}},{key:"fetchMore",value:function(){var e=this.currentRawResult();return e.bookmark?this.client.query(this.definition.offsetBookmark(e.bookmark),{as:this.queryId}):this.client.query(this.definition.offset(e.data.length),{as:this.queryId})}},{key:"currentRawResult",value:function(){return(0,c.getRawQueryFromState)(this.getStore().getState(),this.queryId)}},{key:"notifyObservers",value:function(){var e=this;Object.keys(this.observers).forEach(function(t){return e.observers[t]()})}},{key:"subscribeToStore",value:function(){if(this._unsubscribeStore)throw Error("ObservableQuery instance is already subscribed to store.");this._unsubscribeStore=this.getStore().subscribe(this.handleStoreChange)}},{key:"unsubscribeFromStore",value:function(){if(!this._unsubscribeStore)throw Error("ObservableQuery instance is not subscribed to store");this._unsubscribeStore()}},{key:"subscribe",value:function(e){var t=this,r=this.idCounter;return this.idCounter++,this.observers[r]=e,1===Object.keys(this.observers).length&&this.subscribeToStore(),function(){return t.unsubscribe(r)}}},{key:"unsubscribe",value:function(e){if(!this.observers[e])throw Error("Cannot unsubscribe unknown callbackId ".concat(e));delete this.observers[e],0===Object.keys(this.observers).length&&(this.unsubscribeFromStore(),this._unsubscribeStore=null)}},{key:"getStore",value:function(){return this.client.store}}]),e}();function d(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}t.default=l},63384:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(r(65105)),o=a(r(19723)),u=a(r(25665)),c=a(r(27952)),s=a(r(12323)),l=a(r(64512)),d=n(r(67294)),f=a(r(45697)),p=a(r(54028)),h=f.default.shape({subscribe:f.default.func.isRequired,dispatch:f.default.func.isRequired,getState:f.default.func.isRequired}),y=function(e){(0,u.default)(a,e);var t,r,n=(t=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,s.default)(t);return e=r?Reflect.construct(n,arguments,(0,s.default)(this).constructor):n.apply(this,arguments),(0,c.default)(this,e)});function a(e,t){var r;if((0,i.default)(this,a),r=n.call(this,e,t),!e.client)throw Error("CozyProvider was not passed a client instance.");return e.store&&e.client.setStore(e.store),r}return(0,o.default)(a,[{key:"getChildContext",value:function(){return{store:this.props.store||this.context.store||this.props.client.store,client:this.props.client}}},{key:"render",value:function(){return d.default.createElement(p.default.Provider,{value:this.getChildContext()},this.props.children)}}]),a}(d.Component);t.default=y,(0,l.default)(y,"propTypes",{store:h,client:f.default.object.isRequired,children:f.default.oneOfType([f.default.element,f.default.arrayOf(f.default.element)]).isRequired}),(0,l.default)(y,"childContextTypes",{store:f.default.object,client:f.default.object.isRequired}),(0,l.default)(y,"contextTypes",{store:f.default.object})},18597:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.computeChildrenArgs=t.getQueryAttributes=t.default=t.fetchQuery=void 0;var a=n(r(65105)),i=n(r(19723)),o=n(r(8997)),u=n(r(25665)),c=n(r(27952)),s=n(r(12323)),l=n(r(64512)),d=n(r(80295)),f=r(67294);n(r(18621));var p=n(r(45697));n(r(31344));function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){(0,l.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var v={},m=function(e,t){return t.fetch?t.fetch():e.query(t.definition,{as:t.queryId})};t.fetchQuery=m;var b=function(e,t){var r=e.create.bind(e),n=e.save.bind(e),a=e.destroy.bind(e),i=e.getAssociation.bind(e),o="function"==typeof t.query?t.query(e,t):t.query,u=e.makeObservableQuery(o,t),c=u.fetchMore.bind(u),s=t.mutations,l=(0,d.default)(t,["mutations"]),f="function"==typeof s?s(e,u,l):s,p=u.fetch?u.fetch.bind(u):null;return{client:e,observableQuery:u,queryDefinition:o,createDocument:r,saveDocument:n,deleteDocument:a,getAssociation:i,fetchMore:c,fetch:p,mutations:f}};t.getQueryAttributes=b;var g=function(e){var t=e.observableQuery,r=e.fetchMore,n=e.fetch,a=e.createDocument,i=e.saveDocument,o=e.deleteDocument,u=e.getAssociation,c=e.mutations;return[y({fetchMore:r,fetch:n},t.currentResult()),y({createDocument:a,saveDocument:i,deleteDocument:o,getAssociation:u},c)]};t.computeChildrenArgs=g;var k=function(e){(0,u.default)(d,e);var t,r,n=(t=d,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,s.default)(t);return e=r?Reflect.construct(n,arguments,(0,s.default)(this).constructor):n.apply(this,arguments),(0,c.default)(this,e)});function d(e,t){(0,a.default)(this,d),r=n.call(this,e,t),(0,l.default)((0,o.default)(r),"onQueryChange",function(){r.recomputeChildrenArgs(),r.setState(v)});var r,i=t.client;if(!t.client)throw Error("Query should be used with client in context (use CozyProvider to set context)");return r.client=i,r.observableQuery=null,r.queryUnsubscribe=null,Object.assign((0,o.default)(r),b(i,e)),r.recomputeChildrenArgs(),r}return(0,i.default)(d,[{key:"componentDidMount",value:function(){this.queryUnsubscribe=this.observableQuery.subscribe(this.onQueryChange),!1!==this.props.enabled&&this.executeQueryRespectingFetchPolicy()}},{key:"executeQueryRespectingFetchPolicy",value:function(){if(this.props.fetchPolicy){var e=this.client.getQueryFromState(this.props.as);this.props.fetchPolicy&&"function"==typeof this.props.fetchPolicy&&this.props.fetchPolicy(e)&&m(this.client,this.observableQuery)}else m(this.client,this.observableQuery)}},{key:"componentDidUpdate",value:function(e){!1===e.enabled&&!1!==this.props.enabled&&this.executeQueryRespectingFetchPolicy()}},{key:"componentWillUnmount",value:function(){this.queryUnsubscribe&&this.queryUnsubscribe()}},{key:"recomputeChildrenArgs",value:function(){this.childrenArgs=g(this)}},{key:"render",value:function(){return(0,this.props.children)(this.childrenArgs[0],this.childrenArgs[1])}}]),d}(f.Component);t.default=k,k.contextTypes={client:p.default.object,store:p.default.object};var O=p.default.object;k.propTypes={query:p.default.oneOfType([p.default.func,O]).isRequired,enabled:p.default.bool,as:p.default.string,children:p.default.func.isRequired,fetchPolicy:p.default.func},k.defaultProps={enabled:!0}},1153:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(68434)),i=n(r(82007)),o=r(67294),u=n(r(26726)),c=r(45330),s=(0,o.memo)(function(e){var t=e.doctype,r=(0,u.default)();return(0,o.useEffect)(function(){var e,n=r.plugins.realtime;if(!n)throw Error("You must include the realtime plugin to use RealTimeQueries");return(e=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.subscribe("created",t,function(e){return(0,c.dispatchCreate)(r,t,e)});case 2:return e.next=4,n.subscribe("updated",t,function(e){return(0,c.dispatchUpdate)(r,t,e)});case 4:return e.next=6,n.subscribe("deleted",t,function(e){return(0,c.dispatchDelete)(r,t,e)});case 6:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})(),function(){n.unsubscribe("created",t,c.dispatchCreate),n.unsubscribe("updated",t,c.dispatchUpdate),n.unsubscribe("deleted",t,c.dispatchDelete)}},[r,t]),null});t.default=s},42189:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(68434)),i=n(r(82007)),o=n(r(65105)),u=n(r(19723)),c=n(r(64512)),s=n(r(24350)),l=n(r(66604)),d=n(r(82492)),f=n(r(84238)),p=n(r(71843)),h=r(25367);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){(0,c.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var m=function(e){var t=(0,l.default)(e.relationships||{},function(e,t){return v(v({},e),{},{name:t,type:(0,h.resolveClass)(e.doctype,e.type)})});return v(v({},e),{},{relationships:(0,f.default)(t)>0?(0,s.default)(t,"name"):null})},b=function(e,t){if(!e)throw Error(t)},g=function(e,t){var r=(0,p.default)(e,t,function(e){return e.name});b(0===r.length,"Duplicated names in schemas being added: ".concat(r.map(function(e){return e.name}).join(", ")));var n=(0,p.default)(e,t,function(e){return e.doctype});b(0===n.length,"Duplicated doctypes in schemas being added: ".concat(n.map(function(e){return e.name}).join(", ")))},k=function(){var e,t;function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,o.default)(this,r),this.byDoctype={},this.add(e),this.client=t}return(0,u.default)(r,[{key:"add",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,l.default)(e,function(e,t){return v({name:t},m(e))});g(Object.values(t),Object.values(this.byDoctype)),(0,d.default)(this.byDoctype,(0,s.default)(t,function(e){return e.doctype}))}},{key:"getDoctypeSchema",value:function(e){var t=this.byDoctype[e];return!t&&(t=m({name:e,doctype:e}),this.byDoctype[e]=t),t}},{key:"getRelationship",value:function(e,t){if(!e)throw TypeError("Invalid doctype ".concat(e));var r=this.getDoctypeSchema(e);if(!r)throw Error("Cannot find doctype ".concat(e," in schema"));if(!r.relationships)throw Error("Schema for doctype ".concat(e," has no relationships"));return r.relationships[t]}},{key:"validate",value:(e=(0,i.default)(a.default.mark(function e(t){var r,n,i,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},n=this.byDoctype[t._type]){e.next=4;break}return e.abrupt("return",!0);case 4:if(n.attributes){e.next=6;break}return e.abrupt("return",!0);case 6:e.t0=a.default.keys(n.attributes);case 7:if((e.t1=e.t0()).done){e.next=15;break}return i=e.t1.value,e.next=11,this.validateAttribute(t,i,n.attributes[i]);case 11:!0!==(o=e.sent)&&(r[i]=o),e.next=7;break;case 15:if(0!==Object.keys(r).length){e.next=17;break}return e.abrupt("return",!0);case 17:return e.abrupt("return",r);case 18:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"validateAttribute",value:(t=(0,i.default)(a.default.mark(function e(t,r,n){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.unique&&this.client)){e.next=6;break}return e.next=3,this.client.collection(t._type).checkUniquenessOf(r,t[r]);case 3:if(!(!0!==e.sent)){e.next=6;break}return e.abrupt("return","must be unique");case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)})),function(e,r,n){return t.apply(this,arguments)})}]),r}();t.default=k},97619:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.transformBulkDocsResponse=void 0;var a=n(r(80295)),i=n(r(68434)),o=n(r(82007)),u=n(r(65105)),c=n(r(19723)),s=n(r(25665)),l=n(r(27952)),d=n(r(12323)),f=n(r(64512)),p=n(r(35905)),h=r(71450),y=n(r(37130)),v=r(87941),m=r(29822),b=n(r(22853)),g=r(88930);function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach(function(t){(0,f.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var w=function(e){var t=e.selector,r=e.partialFilter,n=e.sort,a=e.fields;return!!t||!!r||!!n||!!a||!1},_=function(e,t){var r=(0,p.default)(e,t,function(e,t){return e.ok?O(O({},t),{},{_id:e.id,_rev:e.rev}):t});if(e.find(function(e){return!e.ok}))throw new m.BulkEditError(e,r);return{data:r}};t.transformBulkDocsResponse=_;var S=function(e){(0,s.default)(k,e);var t,r,n,f,p,y,m=(t=k,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,d.default)(t);return e=r?Reflect.construct(n,arguments,(0,d.default)(this).constructor):n.apply(this,arguments),(0,l.default)(this,e)});function k(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.client,n=t.stackClient,a=t.platform;return(0,u.default)(this,k),e=m.call(this),r&&b.default.warn("Using options.client is deprecated, prefer options.stackClient"),e.stackClient=n||r,e.isOnline=null==a?void 0:a.isOnline,e}return(0,c.default)(k,[{key:"registerClient",value:function(e){this.stackClient=e.stackClient||e.client}},{key:"reset",value:(n=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.stackClient=null;case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"request",value:(f=(0,o.default)(i.default.mark(function e(t,r,n){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.isOnline,!e.t0){e.next=5;break}return e.next=4,this.isOnline();case 4:e.t0=!e.sent;case 5:if(!e.t0){e.next=7;break}return e.abrupt("return",n(t));case 7:if(e.prev=7,!t.mutationType){e.next=12;break}return e.next=11,this.executeMutation(t,r,n);case 11:case 14:return e.abrupt("return",e.sent);case 12:return e.next=14,this.executeQuery(t);case 17:if(e.prev=17,e.t1=e.catch(7),!(0,g.isReactNativeOfflineError)(e.t1)){e.next=21;break}return e.abrupt("return",n(t));case 21:throw e.t1;case 22:case"end":return e.stop()}},e,this,[[7,17]])})),function(e,t,r){return f.apply(this,arguments)})},{key:"persistCozyData",value:(p=(0,o.default)(i.default.mark(function e(t,r){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r(t));case 1:case"end":return e.stop()}},e)})),function(e,t){return p.apply(this,arguments)})},{key:"executeQuery",value:function(e){var t=e.doctype,r=e.selector,n=e.id,i=e.ids,o=e.referenced,u=(0,a.default)(e,["doctype","selector","id","ids","referenced"]);if(!t)throw b.default.warn("Bad query",e),Error("No doctype found in a query definition");var c=this.stackClient.collection(t);return n?c.get(n,e):i?c.getAll(i):o?c.findReferencedBy(o,u):w(e)?c.find(r,u):c.all(u)}},{key:"executeMutation",value:(y=(0,o.default)(i.default.mark(function e(t,r,n){var o,u,c,s,l;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=t.mutationType,u=t.document,c=t.documents,s=(0,a.default)(t,["mutationType","document","documents"]),e.t0=o,e.next=e.t0===h.MutationTypes.CREATE_DOCUMENT?4:e.t0===h.MutationTypes.UPDATE_DOCUMENTS?5:e.t0===h.MutationTypes.UPDATE_DOCUMENT?9:e.t0===h.MutationTypes.DELETE_DOCUMENT?10:e.t0===h.MutationTypes.ADD_REFERENCES_TO?11:e.t0===h.MutationTypes.REMOVE_REFERENCES_TO?12:e.t0===h.MutationTypes.ADD_REFERENCED_BY?13:e.t0===h.MutationTypes.REMOVE_REFERENCED_BY?18:e.t0===h.MutationTypes.UPLOAD_FILE?23:24;break;case 4:return e.abrupt("return",this.stackClient.collection(u._type).create(u));case 5:return e.next=7,this.stackClient.collection(c[0]._type).updateAll(c);case 7:return l=e.sent,e.abrupt("return",_(l,c));case 9:return e.abrupt("return",this.stackClient.collection(u._type).update(u));case 10:return e.abrupt("return",this.stackClient.collection(u._type).destroy(u));case 11:return e.abrupt("return",this.stackClient.collection(s.referencedDocuments[0]._type).addReferencesTo(u,s.referencedDocuments));case 12:return e.abrupt("return",this.stackClient.collection(s.referencedDocuments[0]._type).removeReferencesTo(u,s.referencedDocuments));case 13:if(u._type!==v.DOCTYPE_FILES){e.next=17;break}return e.abrupt("return",this.stackClient.collection(v.DOCTYPE_FILES).addReferencedBy(u,s.referencedDocuments));case 17:case 22:throw Error("The document type should be io.cozy.files");case 18:if(u._type!==v.DOCTYPE_FILES){e.next=22;break}return e.abrupt("return",this.stackClient.collection(v.DOCTYPE_FILES).removeReferencedBy(u,s.referencedDocuments));case 23:return e.abrupt("return",this.stackClient.collection(v.DOCTYPE_FILES).upload(s.file,s.dirPath));case 24:return e.abrupt("return",n(t,r));case 25:case"end":return e.stop()}},e,this)})),function(e,t,r){return y.apply(this,arguments)})}]),k}(y.default);t.default=S},62946:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(68434)),i=n(r(82007)),o=n(r(65105)),u=n(r(19723)),c=n(r(25665)),s=n(r(27952)),l=n(r(12323)),d=n(r(37130)),f=function(e){(0,c.default)(h,e);var t,r,n,d,f,p=(t=h,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,l.default)(t);return e=r?Reflect.construct(n,arguments,(0,l.default)(this).constructor):n.apply(this,arguments),(0,s.default)(this,e)});function h(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.webviewIntent;return(0,o.default)(this,h),(e=p.call(this)).webviewIntent=r,e}return(0,u.default)(h,[{key:"registerClient",value:function(e){}},{key:"reset",value:(n=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})},{key:"request",value:(d=(0,i.default)(a.default.mark(function e(t,r,n){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.webviewIntent.call("flagshipLinkRequest",t));case 1:case"end":return e.stop()}},e,this)})),function(e,t,r){return d.apply(this,arguments)})},{key:"persistCozyData",value:(f=(0,i.default)(a.default.mark(function e(t,r){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)})),function(e,t){return f.apply(this,arguments)})}]),h}(d.default);t.default=f},28187:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(65105)),i=n(r(19723));r(71450);var o=function(){function e(t,r,n,i){(0,a.default)(this,e);var o=i.dispatch,u=i.get,c=i.query,s=i.mutate,l=i.save;this.target=t,this.name=r,this.doctype=n,this.get=u,this.query=c,this.mutate=s,this.save=l,this.dispatch=o}return(0,i.default)(e,[{key:"raw",get:function(){throw Error("A relationship must define its raw getter")}},{key:"data",get:function(){throw Error("A relationship must define its data getter")}}],[{key:"query",value:function(e,t,r){throw Error("A custom relationship must define its query() function")}}]),e}();t.default=o},13965:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.updateRelationship=t.updateHasManyItem=t.removeHasManyItem=t.setHasManyItem=t.getHasManyItems=t.getHasManyItem=void 0;var a=n(r(65105)),i=n(r(19723)),o=n(r(8997)),u=n(r(25665)),c=n(r(27952)),s=n(r(12323)),l=n(r(64512)),d=n(r(98235)),f=n(r(27361)),p=n(r(82492)),h=r(71450),y=r(65972),v=n(r(28187)),m=n(r(22853));function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach(function(t){(0,l.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var k=function(e,t,r){var n=-1===t?e.length:t;return[].concat((0,d.default)(e.slice(0,n)),[r],(0,d.default)(e.slice(n+1)))},O=function(e){(0,u.default)(p,e);var t,r,n=(t=p,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,s.default)(t);return e=r?Reflect.construct(n,arguments,(0,s.default)(this).constructor):n.apply(this,arguments),(0,c.default)(this,e)});function p(){var e;(0,a.default)(this,p);for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return e=n.call.apply(n,[this].concat(r)),(0,l.default)((0,o.default)(e),"updateRelationshipData",function(t){return function(r,n){var a=(0,y.getDocumentFromState)(n(),e.target._type,e.target._id);r((0,y.receiveQueryResult)(null,{data:g(g({},a),{},{relationships:g(g({},a.relationships),{},(0,l.default)({},e.name,t(a.relationships[e.name])))})}))}}),e}return(0,i.default)(p,[{key:"fetchMore",value:function(){throw"Not implemented"}},{key:"exists",value:function(e){return this.existsById(e._id)}},{key:"containsById",value:function(e){return void 0!==this.getRelationship().data.find(function(t){return e===t._id})}},{key:"existsById",value:function(e){return!!(this.containsById(e)&&this.get(this.doctype,e))}},{key:"add",value:function(e){var t=(Array.isArray(e)?e:[e]).map(function(e){return e._id});return this.addById(t)}},{key:"remove",value:function(e){var t=(Array.isArray(e)?e:[e]).map(function(e){return e._id});return this.removeById(t)}},{key:"addTargetRelationships",value:function(e){var t,r=this;!this.target.relationships&&(this.target.relationships={}),!this.target.relationships[this.name]&&(this.target.relationships[this.name]={data:[]});var n=(Array.isArray(e)?e:[e]).filter(function(e){return!r.existsById(e)}).map(function(e){return{_id:e,_type:r.doctype}});(t=this.target.relationships[this.name].data).push.apply(t,(0,d.default)(n)),this.updateMetaCount()}},{key:"addById",value:function(e){return this.addTargetRelationships(e),this.save(this.target)}},{key:"removeTargetRelationships",value:function(e){var t=Array.isArray(e)?e:[e];this.target.relationships[this.name].data=this.target.relationships[this.name].data.filter(function(e){var r=e._id;return!t.includes(r)}),this.updateMetaCount()}},{key:"removeById",value:function(e){return this.removeTargetRelationships(e),this.save(this.target)}},{key:"updateMetaCount",value:function(){void 0!==(0,f.default)(this.target.relationships[this.name],"meta.count")&&(this.target.relationships[this.name].meta=g(g({},this.target.relationships[this.name].meta),{},{count:this.target.relationships[this.name].data.length}))}},{key:"getRelationship",value:function(){var e=this.target[this.name],t=(0,f.default)(this.target,"relationships.".concat(this.name));return t?t:(e&&e.length&&m.default.warn("You're trying to access data on a relationship that appear to not be loaded yet. You may want to use 'include()' on your query"),{data:[],next:!0,meta:{count:0}})}},{key:"updateTargetRelationship",value:function(e,t){var r=e.readDocument(this.target._type,this.target._id);e.writeDocument(this.updateRelationship(r,t))}},{key:"updateRelationship",value:function(e,t){return p.updateRelationship(e,this.name,t)}},{key:"dehydrate",value:function(e){return g(g({},e),{},{relationships:g(g({},e.relationships),{},(0,l.default)({},this.name,{data:this.raw}))})}},{key:"raw",get:function(){return this.getRelationship().data}},{key:"data",get:function(){var e=this;return this.getRelationship().data.map(function(t){var r=t._id,n=t._type;return e.get(n,r)}).filter(Boolean)}},{key:"hasMore",get:function(){return this.getRelationship().next}},{key:"count",get:function(){var e=this.getRelationship();return e.meta?e.meta.count:e.data.length}}],[{key:"query",value:function(e,t,r){var n=(0,f.default)(e,"relationships.".concat(r.name,".data"),[]).map(function(e){return e._id});return new h.QueryDefinition({doctype:r.doctype,ids:n})}}]),p}(v.default),w=O.getHasManyItem=function(e,t,r){return(0,f.default)(e,"relationships.".concat(t,".data"),[]).find(function(e){return e._id==r})};t.getHasManyItem=w;var _=O.getHasManyItems=function(e,t){return(0,f.default)(e,"relationships.".concat(t,".data"),[])};t.getHasManyItems=_;var S=O.setHasManyItem=function(e,t,r,n){var a=O.getHasManyItems(e,t),i=a.findIndex(function(e){return e._id===r}),o=(0,p.default)({},a[i],n),u=k(a,i,o);return O.updateRelationship(e,t,function(e){return(0,p.default)({},e,{data:u})})};t.setHasManyItem=S;var P=O.removeHasManyItem=function(e,t,r){var n=O.getHasManyItems(e,t).filter(function(e){return e._id!==r});return O.updateRelationship(e,t,function(){return{data:n}})};t.removeHasManyItem=P;var C=O.updateHasManyItem=function(e,t,r,n){var a=n(O.getHasManyItem(e,t,r));return O.setHasManyItem(e,t,r,a)};t.updateHasManyItem=C;var x=O.updateRelationship=function(e,t,r){return g(g({},e),{},{relationships:g(g({},e.relationships),{},(0,l.default)({},t,g(g({},e.relationships?e.relationships[t]:{}),r(e.relationships?e.relationships[t]:{}))))})};t.updateRelationship=x;t.default=O},32349:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.getFileDatetime=void 0;var a=n(r(68434)),i=n(r(98235)),o=n(r(64512)),u=n(r(82007)),c=n(r(65105)),s=n(r(19723)),l=n(r(59655)),d=n(r(25665)),f=n(r(27952)),p=n(r(12323)),h=n(r(90402)),y=n(r(27361)),v=n(r(57557)),m=n(r(44908)),b=r(71450),g=r(65972),k=r(87941);n(r(28187));var O=n(r(13965));function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach(function(t){(0,o.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var S=function(e,t){var r=(0,h.default)(e,3),n=r[0],a=r[1],i=r[2];return[i?[n,a,i]:[n,a],t]},P=function(e){var t;return(null===(t=e.metadata)||void 0===t?void 0:t.datetime)||e.created_at};t.getFileDatetime=P;var C=function(e){(0,d.default)(w,e);var t,r,n,o,h,O=(t=w,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,p.default)(t);return e=r?Reflect.construct(n,arguments,(0,p.default)(this).constructor):n.apply(this,arguments),(0,f.default)(this,e)});function w(){return(0,c.default)(this,w),O.apply(this,arguments)}return(0,s.default)(w,[{key:"fetchMore",value:(n=(0,u.default)(a.default.mark(function e(){var t,r,n,o=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.QueryDefinition({doctype:k.DOCTYPE_FILES}),n=(r=this.getRelationship().data)[r.length-1],e.next=5,this.dispatch(function(){var e=(0,u.default)(a.default.mark(function e(u,c){var s,l,d;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=P((0,g.getDocumentFromState)(c(),n._type,n._id)),l=S([o.target._type,o.target._id,s],r[r.length-1]._id),e.next=5,o.query(t.referencedBy(o.target).offsetCursor(l));case 5:return(d=e.sent).data.shift(),e.next=9,o.dispatch(o.updateRelationshipData(function(e){return _(_({},e),{},{data:[].concat((0,i.default)(e.data),(0,i.default)(d.data)),next:d.next})}));case 9:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"addById",value:(o=(0,u.default)(a.default.mark(function e(t){var r,n,i=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Array.isArray(t)?t:[t],this.addTargetRelationships(r),n=r.map(function(e){return{_id:e,_type:i.doctype}}),e.next=5,this.mutate(this.addReferences(n));case 5:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"removeById",value:(h=(0,u.default)(a.default.mark(function e(t){var r,n,i=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Array.isArray(t)?t:[t],this.removeTargetRelationships(t),n=r.map(function(e){return{_id:e,_type:i.doctype}}),e.next=5,this.mutate(this.removeReferences(n));case 5:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"addReferences",value:function(e){if(this.target._type===k.DOCTYPE_FILES)return b.Mutations.addReferencedBy(this.target,e);if(e[0]._type===k.DOCTYPE_FILES)return b.Mutations.addReferencesTo(this.target,e);throw Error("Either the document or the references should be io.cozy.files")}},{key:"removeReferences",value:function(e){if(this.target._type===k.DOCTYPE_FILES)return b.Mutations.removeReferencedBy(this.target,e);if(e[0]._type===k.DOCTYPE_FILES)return b.Mutations.removeReferencesTo(this.target,e);throw Error("Either the document or the references should be io.cozy.files")}},{key:"dehydrate",value:function(e){return(0,v.default)(e,[this.name,"relationships.".concat(this.name)])}},{key:"data",get:function(){var e=this;return this.target._type===k.DOCTYPE_FILES?(0,y.default)(this.target,"referenced_by",[]).map(function(t){var r=t.id,n=t.type;return e.get(n,r)}).filter(Boolean):(0,l.default)((0,p.default)(w.prototype),"data",this)}}],[{key:"query",value:function(e,t,r){if(e._type===k.DOCTYPE_FILES){var n=(0,y.default)(e,"relationships.referenced_by.data",[]),a=(0,m.default)(n.filter(function(e){return e.type===r.doctype}).map(function(e){return e.id}));return a.length>0?(0,b.Q)(r.doctype).getByIds(a):null}var i=S([e._type,e._id],"");return(0,b.Q)(r.doctype).referencedBy(e).offsetCursor(i)}}]),w}(O.default);t.default=C},23433:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(64512)),i=n(r(65105)),o=n(r(19723)),u=n(r(25665)),c=n(r(27952)),s=n(r(12323)),l=r(71450),d=n(r(28187));function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var h=function(e){(0,u.default)(d,e);var t,r,n=(t=d,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,s.default)(t);return e=r?Reflect.construct(n,arguments,(0,s.default)(this).constructor):n.apply(this,arguments),(0,c.default)(this,e)});function d(){return(0,i.default)(this,d),n.apply(this,arguments)}return(0,o.default)(d,[{key:"addById",value:function(e){this.getRelationship().push(e)}},{key:"removeById",value:function(e){var t=this.getRelationship(),r=t.indexOf(e);-1!==r&&t.splice(r,1)}},{key:"existsById",value:function(e){return -1!==this.getRelationship().indexOf(e)}},{key:"getRelationship",value:function(){return this.target[this.name]=this.target[this.name]||[],this.target[this.name]}},{key:"dehydrate",value:function(e){return p(p({},e),{},(0,a.default)({},this.name,this.raw||[]))}},{key:"raw",get:function(){return this.target[this.name]}},{key:"data",get:function(){var e=this,t=this.doctype;return(this.raw||[]).map(function(r){return e.get(t,r)})}}],[{key:"query",value:function(e,t,r){var n=e[r.name];return n&&n>0?(0,l.Q)(r.doctype).getByIds(n):null}}]),d}(d.default);t.default=h},1715:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(65105)),i=n(r(19723)),o=n(r(59655)),u=n(r(25665)),c=n(r(27952)),s=n(r(12323)),l=n(r(13965)),d=r(71450),f=function(e){(0,u.default)(l,e);var t,r,n=(t=l,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,s.default)(t);return e=r?Reflect.construct(n,arguments,(0,s.default)(this).constructor):n.apply(this,arguments),(0,c.default)(this,e)});function l(){return(0,a.default)(this,l),n.apply(this,arguments)}return(0,i.default)(l,[{key:"data",get:function(){var e=this;return(0,o.default)((0,s.default)(l.prototype),"data",this).filter(function(t){return t.slug===e.target.slug})}}],[{key:"query",value:function(e,t){return(0,d.Q)("io.cozy.triggers").where({worker:"konnector"})}}]),l}(l.default);t.default=f},95760:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(64512)),i=n(r(65105)),o=n(r(19723)),u=n(r(25665)),c=n(r(27952)),s=n(r(12323)),l=n(r(27361)),d=n(r(36968)),f=r(71450),p=n(r(28187)),h=n(r(22853));function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var m=function(e){(0,u.default)(p,e);var t,r,n=(t=p,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,s.default)(t);return e=r?Reflect.construct(n,arguments,(0,s.default)(this).constructor):n.apply(this,arguments),(0,c.default)(this,e)});function p(){return(0,i.default)(this,p),n.apply(this,arguments)}return(0,o.default)(p,[{key:"add",value:function(e){return this.setRelationship(e),this.save(this.target)}},{key:"remove",value:function(){return this.setRelationship(void 0),this.save(this.target)}},{key:"setRelationship",value:function(e){if(e&&e._type!==this.doctype)throw Error("Tried to associate a ".concat(e._type," document to a HasOne relationship on ").concat(this.doctype," document"));var t="relationships[".concat(this.name,"].data");e?(0,d.default)(this.target,t,{_id:e._id,_type:e._type}):(0,d.default)(this.target,t,void 0)}},{key:"set",value:function(e){h.default.warn("set is deprecated for has-one relationships. Use `add` instead."),this.setRelationship(e)}},{key:"unset",value:function(){h.default.warn("unset is deprecated for has-one relationships. Use `remove` instead."),this.setRelationship(void 0)}},{key:"dehydrate",value:function(e){return this.raw?v(v({},e),{},{relationships:v(v({},e.relationships),{},(0,a.default)({},this.name,{data:this.raw}))}):e}},{key:"raw",get:function(){return(0,l.default)(this.target,"relationships[".concat(this.name,"].data"),null)}},{key:"data",get:function(){return this.raw?this.get(this.doctype,this.raw._id):null}}],[{key:"query",value:function(e,t,r){var n=(0,l.default)(e,"relationships.".concat(r.name,".data"),{});return n&&n._id?(0,f.Q)(r.doctype).getById(n._id):null}}]),p}(p.default);t.default=m},13846:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.BelongsToInPlace=t.default=void 0;var a=n(r(64512)),i=n(r(65105)),o=n(r(19723)),u=n(r(25665)),c=n(r(27952)),s=n(r(12323)),l=n(r(28187)),d=r(71450);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var h=function(e){(0,u.default)(l,e);var t,r,n=(t=l,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,s.default)(t);return e=r?Reflect.construct(n,arguments,(0,s.default)(this).constructor):n.apply(this,arguments),(0,c.default)(this,e)});function l(){return(0,i.default)(this,l),n.apply(this,arguments)}return(0,o.default)(l,[{key:"dehydrate",value:function(e){return p(p({},e),{},(0,a.default)({},this.name,this.raw||void 0))}},{key:"raw",get:function(){return this.target[this.name]}},{key:"data",get:function(){return this.get(this.doctype,this.raw)}}],[{key:"query",value:function(e,t,r){var n=e[r.name];return t.getDocumentFromState(r.doctype,n)||(0,d.Q)(r.doctype).getById(n)}}]),l}(l.default);t.default=h;t.BelongsToInPlace=h},11282:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getReferencedById=t.getReferencedBy=t.isReferencedById=t.isReferencedBy=t.create=t.resolveClass=t.attachRelationships=t.responseToRelationship=t.pickTypeAndId=void 0;var a=n(r(64512)),i=n(r(78718)),o=n(r(35937)),u=n(r(28187)),c=n(r(95760)),s=n(r(13846)),l=n(r(13965)),d=n(r(23433)),f=n(r(32349));function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var y=function(e){return(0,i.default)(e,"_type","_id")};t.pickTypeAndId=y;t.responseToRelationship=function(e){var t,r;return(0,o.default)({data:(t=y,Array.isArray(r=e.data)?r.map(t):t(r)),meta:e.meta,next:e.next,skip:e.skip,bookmark:e.bookmark})};var v=function(e,t){return h(h({},e),{},{relationships:h(h({},e.relationships),t)})};t.attachRelationships=function(e,t){if(Array.isArray(e.data))return h(h({},e),{},{data:e.data.map(function(e){return v(e,t[e._id])})});var r=e.data;return h(h({},e),{},{data:v(r,t[r._id])})};var m={"io.cozy.files:has-many":f.default,"has-many":l.default,"belongs-to-in-place":s.default,"has-one":c.default,"has-one-in-place":s.default,"has-many-in-place":d.default};t.resolveClass=function(e,t){if(void 0===t)throw Error("Undefined type for "+e);if("string"!=typeof t)return t;var r=m["".concat(e,":").concat(t)]||m[t];if(r)return r;throw Error("Unknown association '".concat(t,"'"))};t.create=function(e,t,r){var n=t.name,a=t.type,i=t.doctype;if(e[n]instanceof u.default)throw Error("Association ".concat(n," already exists"));return new a(e,n,i,r)};t.isReferencedBy=function(e,t){var r,n;return((null==e?void 0:null===(r=e.relationships)||void 0===r?void 0:null===(n=r.referenced_by)||void 0===n?void 0:n.data)||(null==e?void 0:e.referenced_by)||[]).some(function(e){return e.type===t})};t.isReferencedById=function(e,t,r){var n,a;return((null==e?void 0:null===(n=e.relationships)||void 0===n?void 0:null===(a=n.referenced_by)||void 0===a?void 0:a.data)||(null==e?void 0:e.referenced_by)||[]).some(function(e){return e.type===t&&e.id===r})};t.getReferencedBy=function(e,t){var r,n;return((null==e?void 0:null===(r=e.relationships)||void 0===r?void 0:null===(n=r.referenced_by)||void 0===n?void 0:n.data)||(null==e?void 0:e.referenced_by)||[]).filter(function(e){return e.type===t})};t.getReferencedById=function(e,t,r){var n,a;return((null==e?void 0:null===(n=e.relationships)||void 0===n?void 0:null===(a=n.referenced_by)||void 0===a?void 0:a.data)||(null==e?void 0:e.referenced_by)||[]).filter(function(e){return e.type===t&&e.id===r})}},25367:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"HasManyFiles",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"HasMany",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"HasOne",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"HasOneInPlace",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"HasManyInPlace",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"HasManyTriggers",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"Association",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"resolveClass",{enumerable:!0,get:function(){return d.resolveClass}}),Object.defineProperty(t,"create",{enumerable:!0,get:function(){return d.create}}),Object.defineProperty(t,"isReferencedBy",{enumerable:!0,get:function(){return d.isReferencedBy}}),Object.defineProperty(t,"isReferencedById",{enumerable:!0,get:function(){return d.isReferencedById}}),Object.defineProperty(t,"getReferencedBy",{enumerable:!0,get:function(){return d.getReferencedBy}}),Object.defineProperty(t,"getReferencedById",{enumerable:!0,get:function(){return d.getReferencedById}});var a=n(r(32349)),i=n(r(13965)),o=n(r(95760)),u=n(r(13846)),c=n(r(23433)),s=n(r(1715)),l=n(r(28187)),d=r(11282)},18118:function(e,t,r){var n,a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.authFunction=t.authenticateWithCordova=void 0;var i=a(r(68434)),o=a(r(82007)),u=r(87941),c=r(25976),s="undefined"!=typeof window?window:null,l=function(e){return new Promise(function(t,r){s.SafariViewController.show({url:e,transition:"curl"},function(e){"closed"===e.event&&r(Error(u.REGISTRATION_ABORT))},function(e){console.log("KO: "+e),r(Error(u.REGISTRATION_ABORT))});var n=s.handleOpenURL;s.handleOpenURL=function(e){s.SafariViewController.hide(),t(e),n&&(s.handleOpenURL=n)}})},d=function(e){return new Promise(function(t,r){var n=s.cordova.InAppBrowser.open(e,"_blank","clearcache=yes,zoom=no"),a=function(){n.removeEventListener("loadstart",i),n.removeEventListener("exit",o)},i=function(e){var r=e.url,i=/\?access_code=(.+)$/.test(r),o=/\?state=(.+)$/.test(r);(i||o)&&(t(r),a(),n.close())},o=function(){r(Error(u.REGISTRATION_ABORT)),a(),n.close()};n.addEventListener("loadstart",i),n.addEventListener("exit",o)})};var f=(n=(0,o.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=(0,c.isIOSApp)(),!e.t0){e.next=5;break}return e.next=4,(0,c.hasSafariPlugin)();case 4:e.t0=e.sent;case 5:if(!e.t0){e.next=9;break}return e.abrupt("return",l(t));case 9:if(!(0,c.hasInAppBrowserPlugin)()){e.next=13;break}return e.abrupt("return",d(t));case 13:return console.log(t),e.abrupt("return",new Promise(function(e){setTimeout(function(){e(prompt("Paste the url here:"))},5e3)}));case 15:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)});t.authenticateWithCordova=f;t.authFunction=f},87941:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DOCTYPE_PERMISSIONS=t.DOCTYPE_FILES=t.REGISTRATION_ABORT=void 0;t.REGISTRATION_ABORT="REGISTRATION_ABORT";t.DOCTYPE_FILES="io.cozy.files";t.DOCTYPE_PERMISSIONS="io.cozy.permissions"},20538:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.APP_TYPE=void 0;t.APP_TYPE={KONNECTOR:"konnector",WEBAPP:"webapp"}},54028:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.clientContext=void 0;var a=r(67294);n(r(18621));var i=(0,a.createContext)({client:null,store:null});t.clientContext=i;t.default=i},29822:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.BulkEditError=void 0;var a=n(r(64512)),i=n(r(65105)),o=n(r(19723)),u=n(r(25665)),c=n(r(27952)),s=n(r(12323)),l=n(r(15500)),d=n(r(35905));function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var h=function(e){(0,u.default)(a,e);var t,r,n=(t=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,s.default)(t);return e=r?Reflect.construct(n,arguments,(0,s.default)(this).constructor):n.apply(this,arguments),(0,c.default)(this,e)});function a(e,t){var r;return(0,i.default)(this,a),(r=n.call(this,"Error while bulk saving")).name="BulkEditError",r.results=(0,d.default)(e,t,function(e,t){return p(p({},e),{},{doc:t})}),r}return(0,o.default)(a,[{key:"getUpdatedDocuments",value:function(){return this.results.filter(function(e){return e.ok}).map(function(e){return e.doc})}},{key:"getErrors",value:function(){return this.results.filter(function(e){return!e.ok})}}]),a}((0,l.default)(Error));t.BulkEditError=h},23864:function(e,t,r){var n,a,i,o=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.certifyFlagship=void 0;var u=o(r(68434)),c=o(r(82007));o(r(18621));var s=r(79166);var l=(n=(0,c.default)(u.default.mark(function e(t){var r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.getStackClient(),e.next=4,r.fetchJSON("POST","/auth/clients/".concat(r.oauthOptions.clientID,"/challenge"),null,{headers:{Authorization:r.registrationAccessTokenToAuthHeader()}});case 4:return n=e.sent,e.abrupt("return",n.nonce);case 8:throw e.prev=8,e.t0=e.catch(0),Error("[FLAGSHIP_CERTIFICATION] Something went wrong while requesting a challenge from CozyStack:\n"+e.t0.message);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(e){return n.apply(this,arguments)});var d=(a=(0,c.default)(u.default.mark(function e(t,r,n){var a,i,o,c,s;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.platform,i=t.attestation,o=t.keyId,c=t.issuer,s=n.getStackClient(),e.next=5,s.fetchJSON("POST","/auth/clients/".concat(s.oauthOptions.clientID,"/attestation"),{platform:a,attestation:i,challenge:r,keyId:o,issuer:c},{headers:{Authorization:s.registrationAccessTokenToAuthHeader()}});case 5:e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),Error("[FLAGSHIP_CERTIFICATION] Something went wrong while giving attestation to CozyStack:\n"+e.t0.message);case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,t,r){return a.apply(this,arguments)});var f=(i=(0,c.default)(u.default.mark(function e(t,r){var n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("[FLAGSHIP_CERTIFICATION] Certification configuration is not set");case 2:return e.prev=2,e.next=5,l(r);case 5:return n=e.sent,e.next=8,(0,s.getAppAttestationFromStore)(n,t);case 8:return a=e.sent,e.next=11,d(a,n,r);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.warn('[FLAGSHIP_CERTIFICATION] Automatic certification for URI "'.concat(r.stackClient.uri,'" failed. This is expected on dev environments and non-official phones. Cozy-stack will continue with manual certification through 2FA')),console.warn(e.t0.message);case 17:case"end":return e.stop()}},e,null,[[2,13]])})),function(e,t){return i.apply(this,arguments)});t.certifyFlagship=f},79166:function(e,t,r){var n,a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getAppAttestationFromStore=void 0;var i=a(r(68434)),o=a(r(82007));var u=(n=(0,o.default)(i.default.mark(function e(t,r){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("getAppAttestationFromStore can only be called from a React Native container");case 1:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)});t.getAppAttestationFromStore=u},78133:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.dehydrate=void 0;var a=n(r(90402)),i=r(25367);t.dehydrate=function(e){return Object.entries(e).reduce(function(e,t){var r=(0,a.default)(t,2),n=r[0],o=r[1],u=e;if(o instanceof i.Association){if(o.dehydrate)u=o.dehydrate(u);else throw Error("Association on key ".concat(n," should have a dehydrate method"))}else u[n]=o;return u},{})}},72004:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"deconstructCozyWebLinkWithSlug",{enumerable:!0,get:function(){return n.deconstructCozyWebLinkWithSlug}}),Object.defineProperty(t,"deconstructRedirectLink",{enumerable:!0,get:function(){return n.deconstructRedirectLink}}),Object.defineProperty(t,"generateWebLink",{enumerable:!0,get:function(){return n.generateWebLink}}),Object.defineProperty(t,"ensureFirstSlash",{enumerable:!0,get:function(){return n.ensureFirstSlash}}),Object.defineProperty(t,"rootCozyUrl",{enumerable:!0,get:function(){return n.rootCozyUrl}}),Object.defineProperty(t,"InvalidRedirectLinkError",{enumerable:!0,get:function(){return n.InvalidRedirectLinkError}}),Object.defineProperty(t,"InvalidCozyUrlError",{enumerable:!0,get:function(){return n.InvalidCozyUrlError}}),Object.defineProperty(t,"InvalidProtocolError",{enumerable:!0,get:function(){return n.InvalidProtocolError}}),Object.defineProperty(t,"BlockedCozyError",{enumerable:!0,get:function(){return n.BlockedCozyError}}),Object.defineProperty(t,"dehydrate",{enumerable:!0,get:function(){return a.dehydrate}}),Object.defineProperty(t,"editSettings",{enumerable:!0,get:function(){return i.editSettings}}),Object.defineProperty(t,"getQuery",{enumerable:!0,get:function(){return i.getQuery}}),Object.defineProperty(t,"getSettings",{enumerable:!0,get:function(){return i.getSettings}}),Object.defineProperty(t,"normalizeSettings",{enumerable:!0,get:function(){return i.normalizeSettings}}),Object.defineProperty(t,"saveAfterFetchSettings",{enumerable:!0,get:function(){return i.saveAfterFetchSettings}});var n=r(77304),a=r(78133),i=r(56200)},56200:function(e,t,r){var n,a,i=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getQuery=t.extractKeys=t.editSettings=t.normalizeSettings=t.saveAfterFetchSettings=t.getSettings=void 0;var o=i(r(90402)),u=i(r(64512)),c=i(r(68434)),s=i(r(82007));i(r(18621));var l=i(r(39268)),d=r(71450);function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach(function(t){(0,u.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var y=l.default.olderThan(36e5);var v=(n=(0,s.default)(c.default.mark(function e(t,r,n){var a,i;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=_(r),e.next=3,t.fetchQueryAndGetFromState({definition:a.definition,options:a.options});case 3:return i=b(e.sent.data),e.abrupt("return",w(i,n));case 6:case"end":return e.stop()}},e)})),function(e,t,r){return n.apply(this,arguments)});t.getSettings=v;var m=(a=(0,s.default)(c.default.mark(function e(t,r,n,a){var i,o,u,s;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=_(r),e.next=3,t.fetchQueryAndGetFromState({definition:i.definition,options:i.options});case 3:return o=b(e.sent.data),u=void 0,u="function"==typeof n?n(w(o,a)):h(h({},w(o,Object.keys(n))),n),s=g(r,o,u),e.next=10,t.save(s);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e)})),function(e,t,r,n){return a.apply(this,arguments)});t.saveAfterFetchSettings=m;var b=function(e){return(Array.isArray(e)?e[0]:e)||{}};t.normalizeSettings=b;var g=function(e,t,r){var n=C(e);return"instance"===e?k(t,r):O(t,n,r)};t.editSettings=g;var k=function(e,t){for(var r=h(h({_id:e._id,_type:e._type,_rev:e.meta.rev},e),{},{attributes:h({},e.attributes)}),n=0,a=Object.entries(t);n<a.length;n++){var i=(0,o.default)(a[n],2),u=i[0],c=i[1];r[u]=c,r.attributes[u]=c}return r},O=function(e,t,r){for(var n=h({_type:t},e),a=0,i=Object.entries(r);a<i.length;a++){var u=(0,o.default)(i[a],2),c=u[0],s=u[1];n[c]=s}return n},w=function(e,t){var r={},n,a=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}}(e))){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;r[i]=e[i]}}catch(e){a.e(e)}finally{a.f()}return r};t.extractKeys=w;var _=function(e){return"instance"===e?P(e):"passwords"===e?P("bitwarden"):S(e)};t.getQuery=_;var S=function(e){var t=C(e);return{definition:(0,d.Q)(t).limitBy(1),options:{as:t,fetchPolicy:y,singleDocData:!0}}},P=function(e){var t="io.cozy.settings",r=C(e);return{definition:(0,d.Q)(t).getById(r),options:{as:"".concat(t,"/").concat(r),fetchPolicy:y,singleDocData:!0}}},C=function(e){return["instance","bitwarden"].includes(e)?"io.cozy.settings.".concat(e):"passwords"===e?"io.cozy.settings.bitwarden":"io.cozy.".concat(e,".settings")}},77304:function(e,t,r){var n,a,i,o=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.rootCozyUrl=t.InvalidCozyUrlError=t.BlockedCozyError=t.InvalidProtocolError=t.InvalidRedirectLinkError=t.deconstructRedirectLink=t.deconstructCozyWebLinkWithSlug=t.generateWebLink=t.ensureFirstSlash=void 0;var u=o(r(98235)),c=o(r(54765)),s=o(r(68434)),l=o(r(82007)),d=o(r(65105)),f=o(r(25665)),p=o(r(27952)),h=o(r(12323)),y=o(r(15500)),v=o(r(90402));function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=(0,h.default)(e);return r=t?Reflect.construct(n,arguments,(0,h.default)(this).constructor):n.apply(this,arguments),(0,p.default)(this,r)}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var g=function(e){return e?e.startsWith("/")?e:"/"+e:"/"};t.ensureFirstSlash=g;t.generateWebLink=function(e){var t=e.cozyUrl,r=e.searchParams,n=e.pathname,a=e.hash,i=e.slug,o=e.subDomainType,u=new URL(t);u.host="nested"===o?"".concat(i,".").concat(u.host):u.host.split(".").map(function(e,t){return 0===t?e+"-"+i:e}).join("."),u.pathname=g(n),u.hash=g(a);var c,s=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return b(e,t)}}(e))){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(r||[]);try{for(s.s();!(c=s.n()).done;){var l=(0,v.default)(c.value,2),d=l[0],f=l[1];u.searchParams.set(d,f)}}catch(e){s.e(e)}finally{s.f()}return u.toString()};t.deconstructCozyWebLinkWithSlug=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat",r=new URL(e),n="nested"===t?r.host.split(".")[0]:r.host.split(".")[0].split("-")[1],a="nested"===t?r.host.split(".")[1]:r.host.split(".")[0].split("-")[0];return{cozyBaseDomain:r.host.split(".").slice("nested"===t?2:1).join("."),cozyName:a,pathname:r.pathname,hash:r.hash,protocol:r.protocol,searchParams:r.searchParams.toString(),slug:n}};t.deconstructRedirectLink=function(e){var t=e.split("#"),r=(0,v.default)(t,2),n=r[0],a=r[1],i=n.split(/\/(.*)/),o=(0,v.default)(i,2),u=o[0],c=o[1];if(!u.match(/^[a-z0-9]+$/))throw new k(e);return{slug:u,pathname:c,hash:a}};var k=function(e){(0,f.default)(r,e);var t=m(r);function r(e){var n;return(0,d.default)(this,r),(n=t.call(this,"Invalid redirect link ".concat(e))).redirectLink=e,n}return r}((0,y.default)(Error));t.InvalidRedirectLinkError=k;var O=function(e){(0,f.default)(r,e);var t=m(r);function r(e){var n;return(0,d.default)(this,r),(n=t.call(this,"Invalid URL protocol ".concat(e.protocol))).url=e,n}return r}((0,y.default)(Error));t.InvalidProtocolError=O;var w=function(e){(0,f.default)(r,e);var t=m(r);function r(e){var n;return(0,d.default)(this,r),(n=t.call(this,"Blocked cozy ".concat(e.toString()))).url=e,n}return r}((0,y.default)(Error));t.BlockedCozyError=w;var _=function(e){(0,f.default)(r,e);var t=m(r);function r(e){var n;return(0,d.default)(this,r),(n=t.call(this,"URL ".concat(e.toString()," does not seem to be a valid Cozy URL"))).url=e,n}return r}((0,y.default)(Error));t.InvalidCozyUrlError=_;var S=function(e){var t=e.protocol,r=e.hostname,n=e.port;return(""!==t?"".concat(t,"//"):"https://")+r+(""!==n?":".concat(n):"")};var P=(n=(0,l.default)(s.default.mark(function e(t){var r,n,a,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(S(t)+"/.well-known/change-password");case 2:if(n=(r=e.sent).status,a=r.url,404!==n){e.next=6;break}throw new _(t);case 6:return e.next=8,x(r);case 8:if(!e.sent){e.next=10;break}throw new w(t);case 10:return i=t.origin!==new URL(a).origin,e.abrupt("return",200===n&&!i);case 12:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)});var C=(a=(0,l.default)(s.default.mark(function e(t){var r,n,a,i,o,l,d,f;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(["http:","https:"].includes(t.protocol)){e.next=2;break}throw new O(t);case 2:return e.next=4,P(t);case 4:if(!e.sent){e.next=6;break}return e.abrupt("return",new URL(S({protocol:t.protocol,hostname:t.hostname,port:t.port})));case 6:if(!/^[^.-][^.]+-[^.-]+\./.test(t.hostname)){e.next=14;break}return r=t.hostname.split("."),a=(n=(0,c.default)(r))[0],i=n.slice(1),o=[a.replace(/-.+/,"")].concat((0,u.default)(i)).join("."),l=new URL(S({protocol:t.protocol,hostname:o,port:t.port})),e.next=12,P(l);case 12:if(!e.sent){e.next=14;break}return e.abrupt("return",l);case 14:return d=t.hostname.split(".").splice(1).join("."),f=new URL(S({protocol:t.protocol,hostname:d,port:t.port})),e.next=18,P(f);case 18:if(!e.sent){e.next=20;break}return e.abrupt("return",f);case 20:throw new _(t);case 21:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)});t.rootCozyUrl=C;var x=(i=(0,l.default)(s.default.mark(function e(t){var r,n,a,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(503!==t.status)){e.next=2;break}return e.abrupt("return",!1);case 2:return a=(n=t.headers.get("content-type"))&&n.indexOf("json")>=0,e.next=6,a?t.json():t.text();case 6:if(!(null!=(i=e.sent)&&null!==(r=i.some)&&void 0!==r&&r.call(i,function(e){return"Blocked"===e.title}))){e.next=9;break}return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)})},378:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.queryConnectFlat=t.queryConnect=t.withClient=void 0;var i=a(r(64512)),o=a(r(95297)),u=n(r(67294)),c=a(r(45697)),s=a(r(47745)),l=a(r(18597)),d=a(r(26726)),f=r(72403),p=a(r(22853));function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){(0,i.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}t.withClient=function(e){var t=function(t){var r=(0,d.default)();return u.default.createElement(e,(0,o.default)({},t,{client:r}))};return t.displayName="withClient(".concat(e.displayName||e.name,")"),t};var v=function(e,t,r){if(!t)throw Error("withQuery has no options for ".concat(e," (wrapping ").concat(r.name,")"));return function(r){var n=function(n,a){if(!a.client)throw Error("Should be used with client in context (use CozyProvider to set context)");var o="function"==typeof t?t(n):t;return t.doc?(p.default.warn("queryOpts.doc is deprecated"),u.default.createElement(r,y((0,i.default)({},e,o.doc),n))):u.default.createElement(l.default,o,function(t){return u.default.createElement(r,y((0,i.default)({},e,t),n))})};return n.contextTypes={client:c.default.object},n.displayName="withQuery(".concat(r.displayName||r.name,")"),n}};t.queryConnect=function(e){return function(t){var r=Object.keys(e).map(function(r){return v(r,e[r],t)});return s.default.apply(null,r)(t)}};t.queryConnectFlat=function(e){return function(t){var r=function(r){var n=(0,f.useQueries)(e);return u.default.createElement(t,(0,o.default)({},r,n))};return r.displayName="queryConnectFlat(".concat(t.displayName||t.name,")"),r}}},54277:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(67294);t.default=function(){var e=(0,n.useRef)();return(0,n.useEffect)(function(){return e.current=!0,function(){e.current=!1}},[]),e}},29568:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(90402)),i=r(67294),o=n(r(54277));t.default=function(e){var t=(0,o.default)(),r=(0,i.useState)(e),n=(0,a.default)(r,2),u=n[0],c=n[1];return[u,(0,i.useCallback)(function(e){t.current&&c(e)},[])]}},63786:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useAppLinkWithStoreFallback",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"useCapabilities",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"useFetchShortcut",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"useClient",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"useQuery",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"useQueries",{enumerable:!0,get:function(){return s.useQueries}}),Object.defineProperty(t,"useAppsInMaintenance",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"useQueryAll",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"useMutation",{enumerable:!0,get:function(){return f.useMutation}}),Object.defineProperty(t,"useInstanceInfo",{enumerable:!0,get:function(){return p.useInstanceInfo}}),Object.defineProperty(t,"useSettings",{enumerable:!0,get:function(){return h.useSettings}});var i=a(r(25199)),o=a(r(56733)),u=a(r(90797)),c=a(r(26726)),s=n(r(72403)),l=a(r(82475)),d=a(r(71747)),f=r(34607),p=r(22380),h=r(74108)},25199:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(68434)),i=n(r(82007)),o=n(r(90402)),u=r(67294),c=r(71450),s=r(23963);t.default=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=(0,u.useState)("loading"),l=(0,o.default)(n,2),d=l[0],f=l[1],p=(0,u.useState)(!0),h=(0,o.default)(p,2),y=h[0],v=h[1],m=(0,u.useState)(null),b=(0,o.default)(m,2),g=b[0],k=b[1];return(0,u.useEffect)(function(){var n;(n=(0,i.default)(a.default.mark(function n(){var i,o,u;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.query((0,c.Q)("io.cozy.apps"));case 3:i=n.sent,o={slug:e},v(!!(u=(0,s.isInstalled)(i.data,o))),u?k((0,s.getUrl)(u)+r):k((0,s.getStoreURL)(i.data,o)),f("loaded"),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(0),f("errored");case 14:case"end":return n.stop()}},n,null,[[0,11]])})),function(){return n.apply(this,arguments)})()},[t,e,r]),{fetchStatus:d,isInstalled:y,url:g}}},82475:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(72403)),i=r(71450),o=n(r(18621));t.default=function(){return(0,a.default)((0,i.Q)("io.cozy.apps_registry").getById("maintenance"),{as:"io.cozy.apps_registry/maintenance",fetchPolicy:o.default.fetchPolicies.olderThan(6e5),singleDocData:!1}).data||[]}},56733:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(68434)),i=n(r(82007)),o=n(r(90402)),u=r(67294),c=n(r(27361)),s=r(71450);t.default=function(e){var t=(0,u.useState)(),r=(0,o.default)(t,2),n=r[0],l=r[1],d=(0,u.useState)("idle"),f=(0,o.default)(d,2),p=f[0],h=f[1];return(0,u.useEffect)(function(){var t,r=(t=(0,i.default)(a.default.mark(function t(){var r;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h("loading"),t.prev=1,t.next=4,e.query((0,s.Q)("io.cozy.settings").getById("io.cozy.settings.capabilities"));case 4:r=t.sent,l((0,c.default)(r,"data",{})),h("loaded"),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),h("failed");case 12:case"end":return t.stop()}},t,null,[[1,9]])})),function(){return t.apply(this,arguments)});e.capabilities?(l(e.capabilities),h("loaded")):r()},[e]),{capabilities:n,fetchStatus:p}}},26726:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(67294),i=n(r(54028));n(r(18621));t.default=function(){return(0,a.useContext)(i.default).client}},90797:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(68434)),i=n(r(82007)),o=n(r(90402)),u=r(67294),c=r(71450),s=n(r(18621));t.default=function(e,t){var r=(0,u.useState)(null),n=(0,o.default)(r,2),l=n[0],d=n[1],f=(0,u.useState)(null),p=(0,o.default)(f,2),h=p[0],y=p[1],v=(0,u.useState)("idle"),m=(0,o.default)(v,2),b=m[0],g=m[1];return(0,u.useEffect)(function(){var r;(r=(0,i.default)(a.default.mark(function r(){var n,i,o,u,l,f;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return g("loading"),r.prev=1,r.next=4,e.fetchQueryAndGetFromState({definition:(0,c.Q)("io.cozy.files.shortcuts").getById(t),options:{as:"io.cozy.files.shortcuts/".concat(t),fetchPolicy:s.default.fetchPolicies.olderThan(6e5),singleDocData:!0}});case 4:if(!(l=null==(u=r.sent)?void 0:null===(n=u.data)||void 0===n?void 0:null===(i=n.metadata)||void 0===i?void 0:null===(o=i.target)||void 0===o?void 0:o.app)){r.next=13;break}return r.next=9,e.getStackClient().getIconURL({type:"app",slug:l,priority:"stack"});case 9:y(r.sent),r.next=16;break;case 13:f=new URL(u.data.url),y("".concat(e.getStackClient().uri,"/bitwarden/icons/").concat(f.host,"/icon.png"));case 16:d({data:u.data}),g("loaded"),r.next=23;break;case 20:r.prev=20,r.t0=r.catch(1),g("failed");case 23:case"end":return r.stop()}},r,null,[[1,20]])})),function(){return r.apply(this,arguments)})()},[e,t]),{shortcutInfos:l,shortcutImg:h,fetchStatus:b}}},22380:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.useInstanceInfo=void 0;var a=n(r(72403)),i=n(r(18621)),o=r(71450),u=r(88930);t.useInstanceInfo=function(){var e=c("io.cozy.settings.instance"),t=(0,a.default)(e.definition,e.options),r=c("io.cozy.settings.context"),n=(0,a.default)(r.definition,r.options),i=c("io.cozy.settings.disk-usage"),o=(0,a.default)(i.definition,i.options);return{isLoaded:null!==(0,u.hasQueryBeenLoaded)(t)&&null!==(0,u.hasQueryBeenLoaded)(n)&&null!==(0,u.hasQueryBeenLoaded)(o),instance:{data:t.data},context:{data:n.data},diskUsage:{data:o.data}}};var c=function(e){return{definition:(0,o.Q)("io.cozy.settings").getById(e),options:{as:"io.cozy.settings/".concat(e),fetchPolicy:i.default.fetchPolicies.olderThan(54e4),singleDocData:!0}}}},34607:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.useMutation=void 0;var a=n(r(68434)),i=n(r(82007)),o=n(r(90402)),u=r(67294),c=n(r(45697)),s=n(r(26726)),l=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.onSuccess,n=void 0===r?void 0:r,c=t.onError,l=void 0===c?void 0:c,d=(0,s.default)(),f=(0,u.useState)("pending"),p=(0,o.default)(f,2),h=p[0],y=p[1],v=(0,u.useState)(),m=(0,o.default)(v,2),b=m[0],g=m[1],k=(0,u.useState)(),O=(0,o.default)(k,2),w=O[0],_=O[1];return{mutate:(0,u.useCallback)((e=(0,i.default)(a.default.mark(function e(t){var r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g(void 0),y("loading"),e.prev=2,e.next=5,d.save(t);case 5:if(_((r=e.sent).data),"function"!=typeof n){e.next=10;break}return e.next=10,n(r.data);case 10:y("loaded"),e.next=20;break;case 13:if(e.prev=13,e.t0=e.catch(2),y("failed"),g(e.t0),"function"!=typeof l){e.next=20;break}return e.next=20,l(e.t0);case 20:case"end":return e.stop()}},e,null,[[2,13]])})),function(t){return e.apply(this,arguments)}),[d,l,n]),mutationStatus:h,error:b,data:w}};t.useMutation=l,l.propTypes={onSuccess:c.default.func,onError:c.default.func}},72403:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.useQueries=void 0;var a=n(r(90402)),i=n(r(64512)),o=r(67294),u=r(70471),c=n(r(27361)),s=n(r(26726)),l=n(r(22853)),d=r(54028);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach(function(t){(0,i.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}r(71450);var h=(0,u.createSelectorHook)(d.clientContext),y=function(e,t){if(!h)throw Error("You must use react-redux > 7.1.0 to use useQuery (uses useSelector) under the hood");if(!e)throw l.default.warn("Bad query",e),Error("Bad query");var r,n=t.as,a=t.enabled,i=void 0===a||a;var u=i?"function"==typeof(r=e)?r():r:null;if(!n)throw Error("You must specify options.as when using useQuery");var d=(0,s.default)(),f=h(function(){return void 0===t.singleDocData&&null!=u&&u.id&&l.default.warn("useQuery options.singleDocData will pass to true in a next version of cozy-client, please add it now to prevent any problem in the future."),d.getQueryFromState(n,{hydrated:(0,c.default)(t,"hydrated",!0),singleDocData:(0,c.default)(t,"singleDocData",!1)})});(0,o.useEffect)(function(){if(!1!==i)d.query(u,t)},[n,i]);var y=(0,o.useCallback)(function(){var e,t=d.getQueryFromState(n);return d.query((e=t).bookmark?e.definition.offsetBookmark(e.bookmark):e.definition.offset(e.data.length),{as:n})},[n,d]),v=(0,o.useCallback)(function(){return d.query(u,t)},[d,u,t]);return p(p({},f),{},{fetchMore:y,fetch:v})};t.useQueries=function(e){for(var t={},r=0,n=Object.entries(e);r<n.length;r++){var i=(0,a.default)(n[r],2),o=i[0],u=i[1];t[o]=y(u.query,u)}return t};t.default=y},71747:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(68434)),i=n(r(82007)),o=n(r(90402)),u=r(67294);r(71450);var c=n(r(72403)),s=n(r(29568));t.default=function(e,t){var r=(0,s.default)(!1),n=(0,o.default)(r,2),l=n[0],d=n[1],f=(0,c.default)(e,t);return(0,u.useEffect)(function(){var e;(e=(0,i.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("loaded"===f.fetchStatus&&f.hasMore&&!l)){e.next=5;break}return d(!0),e.next=4,f.fetchMore();case 4:d(!1);case 5:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})()},[f.hasMore,f.fetchStatus,l]),f}},74108:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.useSettings=void 0;var a=n(r(80295)),i=r(67294),o=r(72004),u=r(34607),c=n(r(72403)),s=r(88930),l=r(56200);t.useSettings=function(e,t){var r=(0,o.getQuery)(e),n=(0,c.default)(r.definition,r.options),d=n.data,f=(0,a.default)(n,["data"]),p=(0,u.useMutation)(),h=p.mutate,y=(0,a.default)(p,["mutate"]),v=(0,i.useCallback)(function(t){var r=(0,o.normalizeSettings)(d);return h((0,o.editSettings)(e,r,t))},[h,d,e]),m=(0,o.normalizeSettings)(d),b=(0,s.hasQueryBeenLoaded)(f)?(0,l.extractKeys)(m,t):void 0;return{query:f,values:b,save:v,mutation:y}}},16396:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0});var i={CozyLink:!0,StackLink:!0,WebFlagshipLink:!0,compose:!0,QueryDefinition:!0,Q:!0,Mutations:!0,MutationTypes:!0,getDoctypeFromOperation:!0,Association:!0,HasMany:!0,HasOne:!0,HasOneInPlace:!0,HasManyInPlace:!0,HasManyTriggers:!0,isReferencedBy:!0,isReferencedById:!0,getReferencedBy:!0,getReferencedById:!0,deconstructCozyWebLinkWithSlug:!0,deconstructRedirectLink:!0,dehydrate:!0,generateWebLink:!0,ensureFirstSlash:!0,rootCozyUrl:!0,InvalidRedirectLinkError:!0,InvalidCozyUrlError:!0,InvalidProtocolError:!0,BlockedCozyError:!0,cancelable:!0,isQueryLoading:!0,hasQueryBeenLoaded:!0,isQueriesLoading:!0,hasQueriesBeenLoaded:!0,getQueryFromState:!0,dispatchCreate:!0,dispatchUpdate:!0,dispatchDelete:!0,Registry:!0,RealTimeQueries:!0,manifest:!0,CozyProvider:!0,withMutation:!0,withMutations:!0,Query:!0,queryConnect:!0,queryConnectFlat:!0,withClient:!0,models:!0,fetchPolicies:!0,BulkEditError:!0};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"CozyLink",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"StackLink",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"WebFlagshipLink",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"compose",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"QueryDefinition",{enumerable:!0,get:function(){return d.QueryDefinition}}),Object.defineProperty(t,"Q",{enumerable:!0,get:function(){return d.Q}}),Object.defineProperty(t,"Mutations",{enumerable:!0,get:function(){return d.Mutations}}),Object.defineProperty(t,"MutationTypes",{enumerable:!0,get:function(){return d.MutationTypes}}),Object.defineProperty(t,"getDoctypeFromOperation",{enumerable:!0,get:function(){return d.getDoctypeFromOperation}}),Object.defineProperty(t,"Association",{enumerable:!0,get:function(){return f.Association}}),Object.defineProperty(t,"HasMany",{enumerable:!0,get:function(){return f.HasMany}}),Object.defineProperty(t,"HasOne",{enumerable:!0,get:function(){return f.HasOne}}),Object.defineProperty(t,"HasOneInPlace",{enumerable:!0,get:function(){return f.HasOneInPlace}}),Object.defineProperty(t,"HasManyInPlace",{enumerable:!0,get:function(){return f.HasManyInPlace}}),Object.defineProperty(t,"HasManyTriggers",{enumerable:!0,get:function(){return f.HasManyTriggers}}),Object.defineProperty(t,"isReferencedBy",{enumerable:!0,get:function(){return p.isReferencedBy}}),Object.defineProperty(t,"isReferencedById",{enumerable:!0,get:function(){return p.isReferencedById}}),Object.defineProperty(t,"getReferencedBy",{enumerable:!0,get:function(){return p.getReferencedBy}}),Object.defineProperty(t,"getReferencedById",{enumerable:!0,get:function(){return p.getReferencedById}}),Object.defineProperty(t,"deconstructCozyWebLinkWithSlug",{enumerable:!0,get:function(){return h.deconstructCozyWebLinkWithSlug}}),Object.defineProperty(t,"deconstructRedirectLink",{enumerable:!0,get:function(){return h.deconstructRedirectLink}}),Object.defineProperty(t,"dehydrate",{enumerable:!0,get:function(){return h.dehydrate}}),Object.defineProperty(t,"generateWebLink",{enumerable:!0,get:function(){return h.generateWebLink}}),Object.defineProperty(t,"ensureFirstSlash",{enumerable:!0,get:function(){return h.ensureFirstSlash}}),Object.defineProperty(t,"rootCozyUrl",{enumerable:!0,get:function(){return h.rootCozyUrl}}),Object.defineProperty(t,"InvalidRedirectLinkError",{enumerable:!0,get:function(){return h.InvalidRedirectLinkError}}),Object.defineProperty(t,"InvalidCozyUrlError",{enumerable:!0,get:function(){return h.InvalidCozyUrlError}}),Object.defineProperty(t,"InvalidProtocolError",{enumerable:!0,get:function(){return h.InvalidProtocolError}}),Object.defineProperty(t,"BlockedCozyError",{enumerable:!0,get:function(){return h.BlockedCozyError}}),Object.defineProperty(t,"cancelable",{enumerable:!0,get:function(){return y.cancelable}}),Object.defineProperty(t,"isQueryLoading",{enumerable:!0,get:function(){return y.isQueryLoading}}),Object.defineProperty(t,"hasQueryBeenLoaded",{enumerable:!0,get:function(){return y.hasQueryBeenLoaded}}),Object.defineProperty(t,"isQueriesLoading",{enumerable:!0,get:function(){return y.isQueriesLoading}}),Object.defineProperty(t,"hasQueriesBeenLoaded",{enumerable:!0,get:function(){return y.hasQueriesBeenLoaded}}),Object.defineProperty(t,"getQueryFromState",{enumerable:!0,get:function(){return v.getQueryFromState}}),Object.defineProperty(t,"dispatchCreate",{enumerable:!0,get:function(){return v.dispatchCreate}}),Object.defineProperty(t,"dispatchUpdate",{enumerable:!0,get:function(){return v.dispatchUpdate}}),Object.defineProperty(t,"dispatchDelete",{enumerable:!0,get:function(){return v.dispatchDelete}}),Object.defineProperty(t,"Registry",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"RealTimeQueries",{enumerable:!0,get:function(){return b.default}}),Object.defineProperty(t,"CozyProvider",{enumerable:!0,get:function(){return k.default}}),Object.defineProperty(t,"withMutation",{enumerable:!0,get:function(){return O.default}}),Object.defineProperty(t,"withMutations",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(t,"Query",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"queryConnect",{enumerable:!0,get:function(){return S.queryConnect}}),Object.defineProperty(t,"queryConnectFlat",{enumerable:!0,get:function(){return S.queryConnectFlat}}),Object.defineProperty(t,"withClient",{enumerable:!0,get:function(){return S.withClient}}),Object.defineProperty(t,"fetchPolicies",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(t,"BulkEditError",{enumerable:!0,get:function(){return D.BulkEditError}}),t.models=t.manifest=void 0;var o=a(r(18621)),u=a(r(37130)),c=a(r(97619)),s=a(r(62946)),l=a(r(59242)),d=r(71450),f=r(25367),p=r(11282),h=r(72004),y=r(88930),v=r(65972),m=a(r(10513)),b=a(r(1153)),g=n(r(86092));t.manifest=g;var k=a(r(63384)),O=a(r(43592)),w=a(r(18428)),_=a(r(18597)),S=r(378),P=n(r(4034));t.models=P;var C=a(r(39268)),x=r(24424);Object.keys(x).forEach(function(e){if(!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(i,e)))(!(e in t)||t[e]!==x[e])&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}})});var E=r(63786);Object.keys(E).forEach(function(e){if(!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(i,e)))(!(e in t)||t[e]!==E[e])&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}})});var D=r(29822)},22853:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(60732)),i=(0,a.default)("cozy-client");a.default.suggest.deny("cozy-client","info");t.default=i},24424:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.createFakeClient=t.createMockClient=void 0;var a=n(r(90402)),i=n(r(68434)),o=n(r(82007)),u=n(r(64512)),c=n(r(80295)),s=n(r(82492)),l=n(r(18621)),d=r(65972),f=r(60359),p=r(71450);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var y=function(e,t,r){var n=r.definition,a=r.doctype,i=r.data,o=r.queryError,s=(0,c.default)(r,["definition","doctype","data","queryError"]);e.store.dispatch((0,d.initQuery)(t,n||(0,p.Q)(a))),o?e.store.dispatch((0,d.receiveQueryError)(t,o)):e.store.dispatch((0,d.receiveQueryResult)(t,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){(0,u.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({data:i?i.map(function(e){return(0,f.normalizeDoc)(e,a)}):i},s)))},v=function(e){var t;return t=(0,o.default)(i.default.mark(function t(r){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",{data:null});case 2:if(!e[r.doctype]){t.next=6;break}return t.abrupt("return",{data:e[r.doctype]});case 6:return t.abrupt("return",{data:[]});case 7:case"end":return t.stop()}},t)})),function(e){return t.apply(this,arguments)}};t.createMockClient=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.queries,r=e.remote,n=e.clientOptions,a=e.clientFunctions,i=jest.fn().mockImplementation(v(r));return m({queries:t,remote:r,clientOptions:n,clientFunctions:(0,s.default)({query:i,save:jest.fn(),saveAll:jest.fn(),stackClient:{fetchJSON:jest.fn()}},a)})};var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.queries,r=e.remote,n=e.clientOptions,i=e.clientFunctions,o=new l.default(n||{});o.ensureStore();for(var u=0,c=Object.entries(t||{});u<c.length;u++){var d=(0,a.default)(c[u],2);y(o,d[0],d[1])}return o.query=v(r),(0,s.default)(o,i),o};t.createFakeClient=m},94564:function(e,t,r){var n,a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isAccountWithTrigger=t.buildAccount=t.getAccountName=t.getAccountLogin=t.setContractSyncStatusInAccount=t.getContractSyncStatusFromAccount=t.muteError=t.getMutedErrors=void 0;var i=a(r(68434)),o=a(r(82007)),u=a(r(64512)),c=a(r(82492)),s=r(71450),l=r(13965),d=r(86092);function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach(function(t){(0,u.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var y=function(e){return(null==e?void 0:e.mutedErrors)||[]};t.getMutedErrors=y;t.muteError=function(e,t){var r=y(e);return r.push({type:t,mutedAt:new Date().toISOString()}),h(h({},e),{},{mutedErrors:r})};t.getContractSyncStatusFromAccount=function(e,t){var r,n,a=(0,l.getHasManyItem)(e,"contracts",t);if(!a)throw Error("Cannot find contrat ".concat(t," in account"));return null===(r=null==a?void 0:null===(n=a.metadata)||void 0===n?void 0:n.imported)||void 0===r||r};t.setContractSyncStatusInAccount=function(e,t,r){return(0,l.updateHasManyItem)(e,"contracts",t,function(e){if(void 0===e)throw Error("Cannot find contrat ".concat(t," in account"));return(0,c.default)({},e,{metadata:{imported:r}})})};var v=function(e){if(e.identifier)return e.auth[e.identifier];if(e&&e.auth){var t,r=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}}(e))){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(d.legacyLoginFields);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(e.auth[n])return e.auth[n]}}catch(e){r.e(e)}finally{r.f()}}return null};t.getAccountLogin=v;t.getAccountName=function(e){return e?e.auth&&(e.auth.accountName||v(e))||e._id:null};t.buildAccount=function(e,t){return{auth:t,account_type:e.slug,identifier:(0,d.getIdentifier)(e.fields),state:null}};var m=(n=(0,o.default)(i.default.mark(function e(t,r){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query((0,s.Q)("io.cozy.triggers").where({"message.account":r._id}).indexFields(["message.account"]).limitBy(1));case 2:return n=e.sent,e.abrupt("return",n.data.length>0);case 4:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)});t.isAccountWithTrigger=m},23963:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getAppDisplayName=t.getUrl=t.isInstalled=t.getStoreInstallationURL=t.getStoreURL=void 0;var a=n(r(27361)),i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.slug)throw Error("Expected app / konnector with the defined slug");var r=o(e,{slug:"store"});if(!r)return null;var n=r.links&&r.links.related;return n?"".concat(n,"#/discover/").concat(t.slug):null};t.getStoreURL=i;t.getStoreInstallationURL=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i(e,t);return r?"".concat(r,"/install"):null};var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.find(function(e){return e.slug===t.slug})};t.isInstalled=o;t.getUrl=function(e){return e.links&&e.links.related};t.getAppDisplayName=function(e,t){var r=(0,a.default)(e,"name_prefix"),n=(0,a.default)(e,"name"),i=(0,a.default)(e,["locales",t,"name"],n),o=(0,a.default)(e,["locales",t,"name_prefix"],r);return o&&"cozy"!==o.toLowerCase()?"".concat(o," ").concat(i):i}},88842:function(e,t,r){var n,a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.hasExtensionInstalledAttribute=void 0;var i=a(r(68434)),o=a(r(82007)),u=r(71450);var c=(n=(0,o.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetchQueryAndGetFromState({definition:(0,u.Q)("io.cozy.settings").getById("io.cozy.settings.bitwarden"),options:{as:"io.cozy.settings/io.cozy.settings.bitwarden",singleDocData:!0}});case 3:return r=e.sent.data.extension_installed,e.abrupt("return",!!r);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",!1);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(e){return n.apply(this,arguments)});t.hasExtensionInstalledAttribute=c},47978:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isMagicLink=t.isOIDC=void 0;t.isOIDC=function(e){var t;return null!==(t=e.capabilities.can_auth_with_oidc)&&void 0!==t&&t};t.isMagicLink=function(e){var t;return null!==(t=e.capabilities.can_auth_with_magic_links)&&void 0!==t&&t}},40996:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isContact=t.getIndexByFamilyNameGivenNameEmailCozyUrl=t.getDefaultSortIndexValue=t.makeDefaultSortIndexValue=t.getDisplayName=t.makeDisplayName=t.getFullname=t.makeFullname=t.getPrimaryAddress=t.getPrimaryPhone=t.getPrimaryCozyDomain=t.getPrimaryCozy=t.getPrimaryEmail=t.getInitials=t.getPrimaryOrFirst=t.CONTACTS_DOCTYPE=void 0;var a=n(r(27361)),i=n(r(41609)),o=n(r(22853)),u="io.cozy.contacts";t.CONTACTS_DOCTYPE=u;var c=function(e){return function(t){return t&&t[e]&&0!==t[e].length&&t[e][0]?t[e].find(function(e){return e.primary})||t[e][0]:""}};t.getPrimaryOrFirst=c;t.getInitials=function(e){if(null!=e&&null!==(t=e.name)&&void 0!==t&&t.givenName||null!=e&&null!==(r=e.name)&&void 0!==r&&r.familyName)return["givenName","familyName"].map(function(t){return(0,a.default)(e,["name",t,0],"")}).join("").toUpperCase();var t,r,n=s(e);if(n)return n[0].toUpperCase();var i=d(e);return i?i[0].toUpperCase():""};var s=function(e){return Array.isArray(e.email)?c("email")(e).address||"":e.email};t.getPrimaryEmail=s;var l=function(e){return Array.isArray(e.cozy)?c("cozy")(e).url||"":e.url};t.getPrimaryCozy=l;var d=function(e){try{return new URL(l(e)).hostname.replace(/^(www.)/g,"")}catch(t){return l(e)}};t.getPrimaryCozyDomain=d;t.getPrimaryPhone=function(e){return c("phone")(e).number||""};t.getPrimaryAddress=function(e){return c("address")(e).formattedAddress||""};var f=["namePrefix","givenName","additionalName","familyName","nameSuffix"],p=function(e,t){var r=(null==t?void 0:t.attributesFullname)||f;return e.name?r.map(function(t){return e.name[t]}).filter(function(e){return void 0!==e}).join(" ").trim():""};t.makeFullname=p;t.getFullname=function(e){return(0,a.default)(e,"fullname")?e.fullname:p(e)};var h=function(e,t){var r=p(e,t),n=s(e),a=d(e);return r&&r.length>0?r:n&&n.length>0?n:a&&a.length>0?a:""};t.makeDisplayName=h;t.getDisplayName=function(e){return(0,a.default)(e,"displayName")?e.displayName:h(e)};var y=function(e){var t=[(0,a.default)(e,"name.familyName",""),(0,a.default)(e,"name.givenName",""),s(e),d(e)].join("").trim().toLowerCase();return 0===t.length?null:t};t.makeDefaultSortIndexValue=y;var v=function(e){var t=(0,a.default)(e,"indexes.byFamilyNameGivenNameEmailCozyUrl",null);return null!==t?(0,i.default)(t)?null:t:y(e)};t.getDefaultSortIndexValue=v;t.getIndexByFamilyNameGivenNameEmailCozyUrl=function(e){return o.default.warn("Deprecation: `getIndexByFamilyNameGivenNameEmailCozyUrl` is deprecated, please use `getDefaultSortIndexValue` instead"),v(e)};t.isContact=function(e){return e._type===u}},65314:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getEmojiByCountry=t.getAllNationalities=t.getNationalityByCodeISO=t.getAllCountryNames=t.getCountryNameByCodeISO=t.getAllCountries=t.checkCountryCode=t.isCountryCodeAlpha2=t.isCountryCodeAlpha3=t.isValidCountryCodeTranslation=t.COUNTRIES_ISO=void 0;var a=n(r(98235)),i=r(61774),o=n(r(22853)),u=[{code2:"AF",code3:"AFG",number:"004"},{code2:"AL",code3:"ALB",number:"008"},{code2:"DZ",code3:"DZA",number:"012"},{code2:"AD",code3:"AND",number:"020"},{code2:"AO",code3:"AGO",number:"024"},{code2:"AG",code3:"ATG",number:"028"},{code2:"AR",code3:"ARG",number:"032"},{code2:"AM",code3:"ARM",number:"051"},{code2:"AU",code3:"AUS",number:"036"},{code2:"AT",code3:"AUT",number:"040"},{code2:"AZ",code3:"AZE",number:"031"},{code2:"BS",code3:"BHS",number:"044"},{code2:"BH",code3:"BHR",number:"048"},{code2:"BD",code3:"BGD",number:"050"},{code2:"BB",code3:"BRB",number:"052"},{code2:"BY",code3:"BLR",number:"112"},{code2:"BE",code3:"BEL",number:"056"},{code2:"BZ",code3:"BLZ",number:"084"},{code2:"BJ",code3:"BEN",number:"204"},{code2:"BM",code3:"BMU",number:"060"},{code2:"BT",code3:"BTN",number:"064"},{code2:"BO",code3:"BOL",number:"068"},{code2:"BQ",code3:"BES",number:"535"},{code2:"BA",code3:"BIH",number:"070"},{code2:"BW",code3:"BWA",number:"072"},{code2:"BV",code3:"BVT",number:"074"},{code2:"BR",code3:"BRA",number:"076"},{code2:"IO",code3:"IOT",number:"086"},{code2:"BN",code3:"BRN",number:"096"},{code2:"BG",code3:"BGR",number:"100"},{code2:"BF",code3:"BFA",number:"854"},{code2:"BI",code3:"BDI",number:"108"},{code2:"CV",code3:"CPV",number:"132"},{code2:"KH",code3:"KHM",number:"116"},{code2:"CM",code3:"CMR",number:"120"},{code2:"CA",code3:"CAN",number:"124"},{code2:"KY",code3:"CYM",number:"136"},{code2:"CF",code3:"CAF",number:"140"},{code2:"TD",code3:"TCD",number:"148"},{code2:"CL",code3:"CHL",number:"152"},{code2:"CN",code3:"CHN",number:"156"},{code2:"CX",code3:"CXR",number:"162"},{code2:"CC",code3:"CCK",number:"166"},{code2:"CO",code3:"COL",number:"170"},{code2:"KM",code3:"COM",number:"174"},{code2:"CD",code3:"COD",number:"180"},{code2:"CG",code3:"COG",number:"178"},{code2:"CK",code3:"COK",number:"184"},{code2:"CR",code3:"CRI",number:"188"},{code2:"HR",code3:"HRV",number:"191"},{code2:"CU",code3:"CUB",number:"192"},{code2:"CW",code3:"CUW",number:"531"},{code2:"CY",code3:"CYP",number:"196"},{code2:"CZ",code3:"CZE",number:"203"},{code2:"CI",code3:"CIV",number:"384"},{code2:"DK",code3:"DNK",number:"208"},{code2:"DJ",code3:"DJI",number:"262"},{code2:"DM",code3:"DMA",number:"212"},{code2:"DO",code3:"DOM",number:"214"},{code2:"EC",code3:"ECU",number:"218"},{code2:"EG",code3:"EGY",number:"818"},{code2:"SV",code3:"SLV",number:"222"},{code2:"GQ",code3:"GNQ",number:"226"},{code2:"ER",code3:"ERI",number:"232"},{code2:"EE",code3:"EST",number:"233"},{code2:"SZ",code3:"SWZ",number:"748"},{code2:"ET",code3:"ETH",number:"231"},{code2:"FK",code3:"FLK",number:"238"},{code2:"FO",code3:"FRO",number:"234"},{code2:"FJ",code3:"FJI",number:"242"},{code2:"FI",code3:"FIN",number:"246"},{code2:"FR",code3:"FRA",number:"250"},{code2:"GF",code3:"GUF",number:"254"},{code2:"PF",code3:"PYF",number:"258"},{code2:"TF",code3:"ATF",number:"260"},{code2:"GA",code3:"GAB",number:"266"},{code2:"GM",code3:"GMB",number:"270"},{code2:"GE",code3:"GEO",number:"268"},{code2:"DE",code3:"DEU",number:"276"},{code2:"GH",code3:"GHA",number:"288"},{code2:"GI",code3:"GIB",number:"292"},{code2:"GR",code3:"GRC",number:"300"},{code2:"GL",code3:"GRL",number:"304"},{code2:"GD",code3:"GRD",number:"308"},{code2:"GP",code3:"GLP",number:"312"},{code2:"GU",code3:"GUM",number:"316"},{code2:"GT",code3:"GTM",number:"320"},{code2:"GG",code3:"GGY",number:"831"},{code2:"GN",code3:"GIN",number:"324"},{code2:"GW",code3:"GNB",number:"624"},{code2:"GY",code3:"GUY",number:"328"},{code2:"HT",code3:"HTI",number:"332"},{code2:"HM",code3:"HMD",number:"334"},{code2:"VA",code3:"VAT",number:"336"},{code2:"HN",code3:"HND",number:"340"},{code2:"HK",code3:"HKG",number:"344"},{code2:"HU",code3:"HUN",number:"348"},{code2:"IS",code3:"ISL",number:"352"},{code2:"IN",code3:"IND",number:"356"},{code2:"ID",code3:"IDN",number:"360"},{code2:"IR",code3:"IRN",number:"364"},{code2:"IQ",code3:"IRQ",number:"368"},{code2:"IE",code3:"IRL",number:"372"},{code2:"IM",code3:"IMN",number:"833"},{code2:"IL",code3:"ISR",number:"376"},{code2:"IT",code3:"ITA",number:"380"},{code2:"JM",code3:"JAM",number:"388"},{code2:"JP",code3:"JPN",number:"392"},{code2:"JE",code3:"JEY",number:"832"},{code2:"JO",code3:"JOR",number:"400"},{code2:"KZ",code3:"KAZ",number:"398"},{code2:"KE",code3:"KEN",number:"404"},{code2:"KI",code3:"KIR",number:"296"},{code2:"KP",code3:"PRK",number:"408"},{code2:"KR",code3:"KOR",number:"410"},{code2:"KW",code3:"KWT",number:"414"},{code2:"KG",code3:"KGZ",number:"417"},{code2:"LA",code3:"LAO",number:"418"},{code2:"LV",code3:"LVA",number:"428"},{code2:"LB",code3:"LBN",number:"422"},{code2:"LS",code3:"LSO",number:"426"},{code2:"LR",code3:"LBR",number:"430"},{code2:"LY",code3:"LBY",number:"434"},{code2:"LI",code3:"LIE",number:"438"},{code2:"LT",code3:"LTU",number:"440"},{code2:"LU",code3:"LUX",number:"442"},{code2:"MO",code3:"MAC",number:"446"},{code2:"MG",code3:"MDG",number:"450"},{code2:"MW",code3:"MWI",number:"454"},{code2:"MY",code3:"MYS",number:"458"},{code2:"MV",code3:"MDV",number:"462"},{code2:"ML",code3:"MLI",number:"466"},{code2:"MT",code3:"MLT",number:"470"},{code2:"MH",code3:"MHL",number:"584"},{code2:"MQ",code3:"MTQ",number:"474"},{code2:"MR",code3:"MRT",number:"478"},{code2:"MU",code3:"MUS",number:"480"},{code2:"YT",code3:"MYT",number:"175"},{code2:"MX",code3:"MEX",number:"484"},{code2:"FM",code3:"FSM",number:"583"},{code2:"MD",code3:"MDA",number:"498"},{code2:"MC",code3:"MCO",number:"492"},{code2:"MN",code3:"MNG",number:"496"},{code2:"ME",code3:"MNE",number:"499"},{code2:"MS",code3:"MSR",number:"500"},{code2:"MA",code3:"MAR",number:"504"},{code2:"MZ",code3:"MOZ",number:"508"},{code2:"MM",code3:"MMR",number:"104"},{code2:"NA",code3:"NAM",number:"516"},{code2:"NR",code3:"NRU",number:"520"},{code2:"NP",code3:"NPL",number:"524"},{code2:"NL",code3:"NLD",number:"528"},{code2:"NC",code3:"NCL",number:"540"},{code2:"NZ",code3:"NZL",number:"554"},{code2:"NI",code3:"NIC",number:"558"},{code2:"NE",code3:"NER",number:"562"},{code2:"NG",code3:"NGA",number:"566"},{code2:"NU",code3:"NIU",number:"570"},{code2:"NF",code3:"NFK",number:"574"},{code2:"MP",code3:"MNP",number:"580"},{code2:"NO",code3:"NOR",number:"578"},{code2:"OM",code3:"OMN",number:"512"},{code2:"PK",code3:"PAK",number:"586"},{code2:"PW",code3:"PLW",number:"585"},{code2:"PS",code3:"PSE",number:"275"},{code2:"PA",code3:"PAN",number:"591"},{code2:"PG",code3:"PNG",number:"598"},{code2:"PY",code3:"PRY",number:"600"},{code2:"PE",code3:"PER",number:"604"},{code2:"PH",code3:"PHL",number:"608"},{code2:"PN",code3:"PCN",number:"612"},{code2:"PL",code3:"POL",number:"616"},{code2:"PT",code3:"PRT",number:"620"},{code2:"PR",code3:"PRI",number:"630"},{code2:"QA",code3:"QAT",number:"634"},{code2:"MK",code3:"MKD",number:"807"},{code2:"RO",code3:"ROU",number:"642"},{code2:"RU",code3:"RUS",number:"643"},{code2:"RW",code3:"RWA",number:"646"},{code2:"RE",code3:"REU",number:"638"},{code2:"BL",code3:"BLM",number:"652"},{code2:"SH",code3:"SHN",number:"654"},{code2:"KN",code3:"KNA",number:"659"},{code2:"LC",code3:"LCA",number:"662"},{code2:"MF",code3:"MAF",number:"663"},{code2:"PM",code3:"SPM",number:"666"},{code2:"VC",code3:"VCT",number:"670"},{code2:"WS",code3:"WSM",number:"882"},{code2:"SM",code3:"SMR",number:"674"},{code2:"ST",code3:"STP",number:"678"},{code2:"SA",code3:"SAU",number:"682"},{code2:"SN",code3:"SEN",number:"686"},{code2:"RS",code3:"SRB",number:"688"},{code2:"SC",code3:"SYC",number:"690"},{code2:"SL",code3:"SLE",number:"694"},{code2:"SG",code3:"SGP",number:"702"},{code2:"SX",code3:"SXM",number:"534"},{code2:"SK",code3:"SVK",number:"703"},{code2:"SI",code3:"SVN",number:"705"},{code2:"SB",code3:"SLB",number:"090"},{code2:"SO",code3:"SOM",number:"706"},{code2:"ZA",code3:"ZAF",number:"710"},{code2:"GS",code3:"SGS",number:"239"},{code2:"SS",code3:"SSD",number:"728"},{code2:"ES",code3:"ESP",number:"724"},{code2:"LK",code3:"LKA",number:"144"},{code2:"SD",code3:"SDN",number:"729"},{code2:"SR",code3:"SUR",number:"740"},{code2:"SJ",code3:"SJM",number:"744"},{code2:"SE",code3:"SWE",number:"752"},{code2:"CH",code3:"CHE",number:"756"},{code2:"SY",code3:"SYR",number:"760"},{code2:"TW",code3:"TWN",number:"158"},{code2:"TJ",code3:"TJK",number:"762"},{code2:"TZ",code3:"TZA",number:"834"},{code2:"TH",code3:"THA",number:"764"},{code2:"TL",code3:"TLS",number:"626"},{code2:"TG",code3:"TGO",number:"768"},{code2:"TK",code3:"TKL",number:"772"},{code2:"TO",code3:"TON",number:"776"},{code2:"TT",code3:"TTO",number:"780"},{code2:"TN",code3:"TUN",number:"788"},{code2:"TR",code3:"TUR",number:"792"},{code2:"TM",code3:"TKM",number:"795"},{code2:"TC",code3:"TCA",number:"796"},{code2:"TV",code3:"TUV",number:"798"},{code2:"UG",code3:"UGA",number:"800"},{code2:"UA",code3:"UKR",number:"804"},{code2:"AE",code3:"ARE",number:"784"},{code2:"GB",code3:"GBR",number:"826"},{code2:"UM",code3:"UMI",number:"581"},{code2:"US",code3:"USA",number:"840"},{code2:"UY",code3:"URY",number:"858"},{code2:"UZ",code3:"UZB",number:"860"},{code2:"VU",code3:"VUT",number:"548"},{code2:"VE",code3:"VEN",number:"862"},{code2:"VN",code3:"VNM",number:"704"},{code2:"VG",code3:"VGB",number:"092"},{code2:"VI",code3:"VIR",number:"850"},{code2:"WF",code3:"WLF",number:"876"},{code2:"EH",code3:"ESH",number:"732"},{code2:"YE",code3:"YEM",number:"887"},{code2:"ZM",code3:"ZMB",number:"894"},{code2:"ZW",code3:"ZWE",number:"716"},{code2:"AX",code3:"ALA",number:"248"}];t.COUNTRIES_ISO=u;t.isValidCountryCodeTranslation=function(e,t){var r=(0,i.getLocalizer)(e).polyglot;return s(t)&&r.has("nationalities.".concat(t))&&r.has("countries.".concat(t))};var c=function(e){if(!e)return!1;var t=e.toUpperCase();return u.some(function(e){return e.code3===t})};t.isCountryCodeAlpha3=c;var s=function(e){if(!e)return!1;var t=e.toUpperCase();return u.some(function(e){return e.code2===t})};t.isCountryCodeAlpha2=s;t.checkCountryCode=function(e){return s(e)||c(e)};var l=function(e){var t=(0,i.getLocalizer)(e).t;return u.map(function(e){return{code2:e.code2,code3:e.code3,number:e.number,name:t("countries.".concat(e.code2)),nationality:t("nationalities.".concat(e.code2))}})};t.getAllCountries=l;var d=function(e){return function(t){var r,n=null==e?void 0:null===(r=e.toString())||void 0===r?void 0:r.toUpperCase();return/^[A-Z]{2,3}$/.test(n)?t.code2===n||t.code3===n:!!/^\d+$/.test(n)&&t.number===n}};t.getCountryNameByCodeISO=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{lang:"en"},r=l(t.lang).find(d(e));return r?r.name:(o.default.warn("Country with code ".concat(e," not found")),null)};t.getAllCountryNames=function(e){return l(e).map(function(e){return e.name})};t.getNationalityByCodeISO=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{lang:"en"},r=l(t.lang).find(d(e));return r?r.nationality:(o.default.warn("Nationality with code ".concat(e," not found")),null)};t.getAllNationalities=function(e){return l(e).map(function(e){return e.nationality})};t.getEmojiByCountry=function(e){if(!e)return null;if(!/^[a-z]{2}$/i.test(e))return o.default.error("Country argument must be an ISO 3166-1 alpha-2 string, but got '".concat(JSON.stringify(e),"' instead.")),null;if(!u.find(function(t){return t.code2===e.toUpperCase()}))return o.default.error("Country with code ".concat(e," not found in the list of countries")),null;var t=(0,a.default)(e.toUpperCase()).map(function(e){return e.codePointAt(0)+127397});return String.fromCodePoint.apply(String,(0,a.default)(t))}},61774:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getLocalizer=void 0;for(var a=n(r(54078)),i=n(r(20455)),o=n(r(40883)),u={en:i.default,fr:o.default},c={},s=0,l=["fr","en"];s<l.length;s++){var d=l[s],f=new a.default;f.extend(u[d]),c[d]=f}t.getLocalizer=function(e){var t=c[e]||c.en;return{t:t.t.bind(t),polyglot:t,lang:e}}},61645:function(e,t,r){var n,a,i=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAggregatesFromDACC=t.buildAggregateParams=t.sendMeasureToDACC=t.checkMeasureParams=t.isCorrectDateFormat=void 0;var o=i(r(68434)),u=i(r(82007)),c=i(r(33918));i(r(18621));var s=function(e){try{return!!new Date(Date.parse(e)).toISOString().startsWith(e)}catch(e){return!1}};t.isCorrectDateFormat=s;var l=function(e){var t=e.createdBy,r=e.measureName,n=e.startDate,a=e.value,i=e.group1,o=e.group2,u=e.group3;if(!t||"string"!=typeof t)throw Error("Missing or wrong type parameter: createdBy");if(!r||"string"!=typeof r)throw Error("Missing or wrong type parameter: measureName");if(!n)throw Error("Missing parameter: startDate");if(!s(n))throw Error("Date should be in YYYY-MM-DD format");if("number"!=typeof a)throw Error("Missing or wrong type parameter: value");if(i&&("object"!=typeof i||0===Object.keys(i).length)||o&&("object"!=typeof o||0===Object.keys(o).length)||u&&("object"!=typeof u||0===Object.keys(u).length))throw Error("Groups should be key-value objects");if(u&&(!o||!i)||o&&!i)throw Error("Group order must be respected")};t.checkMeasureParams=l;var d=(n=(0,u.default)(o.default.mark(function e(t,r,n){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l(n),e.next=4,t.getStackClient().fetchJSON("POST","/remote/".concat(r),{data:JSON.stringify(n),path:"measure"});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),(0,c.default)("error","Error while sending measure to remote doctype: ".concat(e.t0.message)),e.t0;case 10:case"end":return e.stop()}},e,null,[[0,6]])})),function(e,t,r){return n.apply(this,arguments)});t.sendMeasureToDACC=d;var f=function(e){var t=e.measureName;if(!t||"string"!=typeof t)throw Error("Missing or wrong type parameter: measureName");var r=e.startDate||new Date(0).toISOString(),n=e.endDate||new Date(Date.now()).toISOString();if(!s(r)||!s(n))throw(0,c.default)("error","Date should be in YYYY-MM-DD format but received: startDate: ".concat(r," | endDate: ").concat(n)),Error("Date should be in YYYY-MM-DD format");return{measureName:t,startDate:r,endDate:n}};t.buildAggregateParams=f;var p=(a=(0,u.default)(o.default.mark(function e(t,r,n){var a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=f(n),e.next=4,t.getStackClient().fetchJSON("POST","/remote/".concat(r),{data:JSON.stringify(a),path:"aggregate"});case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(0),(0,c.default)("error","Error while fetching aggregates to remote doctype: ".concat(e.t0.message)),e.t0;case 11:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,t,r){return a.apply(this,arguments)});t.fetchAggregatesFromDACC=p},60195:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.iconLabelPairs=t.THEME_OTHERS_LABELS=t.THEME_INVOICE_LABELS=t.THEME_FINANCE_LABELS=t.THEME_ACTIVITY_LABELS=t.THEME_TRANSPORT_LABELS=t.THEME_HOME_LABELS=t.THEME_HEALTH_LABELS=t.THEME_WORK_STUDY_LABELS=t.THEME_FAMILY_LABELS=t.THEME_IDENTITY_LABELS=void 0;t.THEME_IDENTITY_LABELS=["identity_photo","national_id_card","passport","residence_permit","electoral_card","family_record_book","birth_certificate","driver_license","citizen_registration_certificate","note_identity_document","other_identity_document"];t.THEME_FAMILY_LABELS=["family_record_book","birth_certificate","wedding","pacs","single_parent_benefit","divorce","large_family_card","caf","payment_proof_family_allowance","note_family_document","other_family_document","person_insurance"];t.THEME_WORK_STUDY_LABELS=["diploma","work_contract","pay_sheet","unemployment_benefit","employment_center_certificate","pension","work_disability_recognition","gradebook","student_card","school_attendance_certificate","school_insurance_certificate","resume","motivation_letter","expense_claim","note_work_document","other_work_document"];t.THEME_HEALTH_LABELS=["health_certificate","health_book","national_health_insurance_card","national_health_insurance_right_certificate","health_insurance_card","prescription","health_invoice","work_disability_recognition","pregnancy_medical_certificate","note_health_document","other_health_document"];t.THEME_HOME_LABELS=["phone_invoice","isp_invoice","telecom_invoice","energy_invoice","water_invoice","other_invoice","work_invoice","house_sale_agreeement","building_permit","technical_diagnostic_record","unfit_for_habitation_declaration","lease","rent_receipt","accommodation_proof","house_insurance","work_quote","condition_report","note_house_document","other_house_document","real_estate_insurance"];t.THEME_TRANSPORT_LABELS=["driver_license","vehicle_registration","car_insurance","transport_card","mechanic_invoice","transport_invoice","note_transport_document","other_transport_document"];t.THEME_ACTIVITY_LABELS=["personal_sporting_licence","fidelity_card","note_activity_document","other_activity_document"];t.THEME_FINANCE_LABELS=["fine","tax_certificate","tax_return","tax_notice","tax_timetable","real_estate_tax","pay_sheet","receipt","single_parent_benefit","other_tax_document","bank_details","bank_statement","loan_agreement","payment_proof_family_allowance","note_finance","expense_claim","other_bank_document","other_revenue"];t.THEME_INVOICE_LABELS=["phone_invoice","isp_invoice","telecom_invoice","energy_invoice","water_invoice","appliance_invoice","web_service_invoice","restaurant_invoice","work_invoice","transport_invoice","health_invoice","note_invoice","expense_claim","energy_contract","grocery_invoice","other_invoice"];t.THEME_OTHERS_LABELS=["other_administrative_document"];t.iconLabelPairs=[{icon:"bank-check",labels:["bank_details"]},{icon:"bank",labels:["other_administrative_document","other_tax_document","real_estate_tax","tax_certificate","tax_notice","tax_return","tax_timetable"]},{icon:"benefit",labels:["loan_agreement","other_revenue","pay_sheet","payment_proof_family_allowance","pension"]},{icon:"bill",labels:["other_invoice"]},{icon:"car",labels:["car_insurance","driver_license","other_transport_document","transport_card","transport_invoice","vehicle_registration"]},{icon:"child",labels:["birth_certificate"]},{icon:"email",labels:["receipt"]},{icon:"euro",labels:["other_bank_document"]},{icon:"exchange",labels:["bank_statement"]},{icon:"file-type-note",labels:["note_activity_document","note_family_document","note_finance","note_health_document","note_house_document","note_identity_document","note_invoice","note_transport_document","note_work_document"]},{icon:"fitness",labels:["other_activity_document","personal_sporting_licence"]},{icon:"globe",labels:["residence_permit"]},{icon:"gouv",labels:["electoral_card"]},{icon:"heart",labels:["health_book","health_certificate","health_insurance_card","health_invoice","national_health_insurance_card","national_health_insurance_right_certificate","other_health_document","person_insurance","pregnancy_medical_certificate","prescription"]},{icon:"home",labels:["accommodation_proof","building_permit","condition_report","house_insurance","house_sale_agreeement","lease","mechanic_invoice","other_house_document","real_estate_insurance","rent_receipt","technical_diagnostic_record","unfit_for_habitation_declaration","work_invoice","work_quote"]},{icon:"image",labels:["identity_photo"]},{icon:"justice",labels:["fine"]},{icon:"laudry",labels:["appliance_invoice"]},{icon:"lightning",labels:["energy_contract","energy_invoice"]},{icon:"people",labels:["national_id_card","other_identity_document","resume","work_disability_recognition"]},{icon:"plane",labels:["passport"]},{icon:"remboursement",labels:["expense_claim"]},{icon:"restaurant",labels:["restaurant_invoice"]},{icon:"school",labels:["diploma","gradebook"]},{icon:"shop",labels:["fidelity_card","grocery_invoice"]},{icon:"team",labels:["caf","citizen_registration_certificate","divorce","family_record_book","large_family_card","other_family_document","pacs","single_parent_benefit","wedding"]},{icon:"telecom",labels:["isp_invoice","telecom_invoice","web_service_invoice"]},{icon:"telephone",labels:["phone_invoice"]},{icon:"water",labels:["water_invoice"]},{icon:"work",labels:["employment_center_certificate","motivation_letter","other_work_document","school_attendance_certificate","school_insurance_certificate","student_card","unemployment_benefit","work_contract"]}]},48536:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.themesList=void 0;var n=r(60195),a=r(34259),i=function(e){return e.map(function(e){try{return a.Qualification.getByLabel(e)}catch(e){return console.log("error",e),null}}).filter(function(e){return e})},o=[{id:"theme1",label:"identity",icon:"people",items:i(n.THEME_IDENTITY_LABELS),defaultItems:["birth_certificate"]},{id:"theme2",label:"family",icon:"team",items:i(n.THEME_FAMILY_LABELS),defaultItems:["family_record_book"]},{id:"theme3",label:"work_study",icon:"work",items:i(n.THEME_WORK_STUDY_LABELS)},{id:"theme4",label:"health",icon:"heart",items:i(n.THEME_HEALTH_LABELS)},{id:"theme5",label:"home",icon:"home",items:i(n.THEME_HOME_LABELS)},{id:"theme6",label:"transport",icon:"car",items:i(n.THEME_TRANSPORT_LABELS),defaultItems:["driver_license"]},{id:"theme7",label:"activity",icon:"chess",items:i(n.THEME_ACTIVITY_LABELS)},{id:"theme8",label:"finance",icon:"bank",items:i(n.THEME_FINANCE_LABELS)},{id:"theme9",label:"invoice",icon:"bill",items:i(n.THEME_INVOICE_LABELS)},{id:"theme10",label:"others",icon:"dots",items:i(n.THEME_OTHERS_LABELS)}];t.themesList=o},29444:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isQualificationNote=t.getThemeByItem=void 0;var n=r(48536);t.getThemeByItem=function(e){var t,r=(t=e,n.themesList.find(function(e){return e.defaultItems&&e.defaultItems.includes(t.label)}));return r?r:n.themesList.find(function(t){return t.items.some(function(t){return t.label===e.label})})};t.isQualificationNote=function(e){return e.label.toLowerCase().startsWith("note_")}},41818:function(e,t,r){var n=r(14746);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Qualification",{enumerable:!0,get:function(){return a.Qualification}}),Object.defineProperty(t,"setQualification",{enumerable:!0,get:function(){return a.setQualification}}),Object.defineProperty(t,"getQualification",{enumerable:!0,get:function(){return a.getQualification}}),t.helpers=t.themes=t.locales=void 0;var a=r(34259),i=n(r(92984));t.locales=i;var o=n(r(48536));t.themes=o;var u=n(r(29444));t.helpers=u},92984:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getLocalizer=t.getBoundT=void 0;var a=n(r(64512)),i=n(r(54078)),o=n(r(28330)),u=n(r(6765)),c=r(65314);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}for(var d={en:o.default,fr:u.default},f={},p=0,h=["fr","en"];p<h.length;p++){var y=h[p],v=new i.default;v.extend(d[y]),f[y]=v}t.getBoundT=function(e){var t=m(e);return function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=l(l({},r),{},{smart_count:(null==r?void 0:r.smart_count)||1}),a=null==r?void 0:r.country,i="foreign"!==a?(0,c.getEmojiByCountry)(a):null,o="foreign"===a?t("country.foreign"):null;return i||o?"".concat(t(e,n)," ").concat(i||o):t(e,n)}};var m=function(e){var t=f[e]||f.en;return t.t.bind(t)};t.getLocalizer=m},34259:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getIconByLabel=t.getQualification=t.setQualification=t.Qualification=void 0;var i=a(r(64512)),o=a(r(65105)),u=a(r(19723)),c=a(r(36968)),s=a(r(91966)),l=n(r(37504)),d=a(r(22853)),f=r(60195);function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){(0,i.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var v=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,o.default)(this,e);var n=l.qualifications.find(function(e){return e.label===t});if(n){this.icon=r.icon||m(t),this.label=n.label;var a=r.purpose||n.purpose;a&&(this.purpose=a);var i=r.sourceCategory||n.sourceCategory;i&&(this.sourceCategory=i);var u=r.sourceSubCategory||n.sourceSubCategory;u&&(this.sourceSubCategory=u);var c=r.subjects||n.subjects;c&&(this.subjects=c)}else throw Error("No qualification found for the label ".concat(t))}return(0,u.default)(e,[{key:"checkAttributes",value:function(e){if(this.purpose!==e.purpose){if(this.purpose)throw Error("The purpose for the label ".concat(this.label," should be ").concat(this.purpose,". ")+"Please use this or open an issue on https://github.com/cozy/cozy-client/issues");!l.purposeKnownValues.includes(e.purpose)&&d.default.info("This purpose is not listed among the known values: ".concat(e.purpose,". ")+"Please open an issue on https://github.com/cozy/cozy-client/issues")}if(this.sourceCategory!==e.sourceCategory){if(this.sourceCategory)throw Error("The sourceCategory for the label ".concat(this.label," should be ").concat(this.sourceCategory,". ")+"Please use this or open an issue on https://github.com/cozy/cozy-client/issues");!l.sourceCategoryKnownValues.includes(e.sourceCategory)&&d.default.info("This sourceCategory is not listed among the known values: ".concat(e.sourceCategory,". ")+"Please open an issue on https://github.com/cozy/cozy-client/issues")}if(this.sourceSubCategory!==e.sourceSubCategory){if(this.sourceSubCategory)throw Error("The sourceSubCategory for the label ".concat(this.label," should be ").concat(this.sourceSubCategory,". ")+"Please use this or open an issue on https://github.com/cozy/cozy-client/issues");!l.sourceSubCategoryKnownValues.includes(e.sourceSubCategory)&&d.default.info("This sourceSubCategory is not listed among the known values: ".concat(e.sourceSubCategory,". ")+"Please open an issue on https://github.com/cozy/cozy-client/issues")}if((0,s.default)(this.subjects,e.subjects).length>0)throw Error("The subjects for the label ".concat(this.label," should include ").concat(this.subjects,". ")+"Please use this or open an issue on https://github.com/cozy/cozy-client/issues");var t=(0,s.default)(e.subjects,this.subjects);if(t.length>0){var r=(0,s.default)(t,l.subjectsKnownValues);r.length>0&&d.default.info("These subjects are not listed among the known values: ".concat(r,". ")+"Please open an issue on https://github.com/cozy/cozy-client/issues")}}},{key:"setPurpose",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{purpose:t}))}},{key:"setSourceCategory",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{sourceCategory:t}))}},{key:"setSourceSubCategory",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{sourceSubCategory:t}))}},{key:"setSubjects",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{subjects:t}))}},{key:"setIcon",value:function(t){return new e(this.label,y(y({},this.toQualification()),{},{icon:t}))}},{key:"toQualification",value:function(){return{icon:this.icon,label:this.label,purpose:this.purpose,sourceCategory:this.sourceCategory,sourceSubCategory:this.sourceSubCategory,subjects:this.subjects}}}]),e}();t.Qualification=v,v.getByLabel=function(e){return new v(e)};t.setQualification=function(e,t){if(t.label){var r=t;return new v(t.label).checkAttributes(t),!t.icon&&(r=new v(t.label,t).setIcon(m(t.label))),(0,c.default)(e,"metadata.qualification",r)}throw Error("You must set a label to qualify")};t.getQualification=function(e){var t,r=null==e?void 0:null===(t=e.metadata)||void 0===t?void 0:t.qualification;return r?new v(r.label,r.qualification).toQualification():null};var m=function(e){var t,r=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(e,t)}}(e))){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(f.iconLabelPairs);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.labels.includes(e))return n.icon}}catch(e){r.e(e)}finally{r.f()}return d.default.info("The ".concat(e," qualification does not seem to have an icon.\n    Please open an issue on https://github.com/cozy/cozy-client/issues")),""};t.getIconByLabel=m},67348:function(e,t,r){var n,a,i,o,u,c,s,l,d,f,p,h=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.normalize=function(e){var t=e._id||e.id;return E({_id:t,id:t,_type:e._type||P.DOCTYPE_FILES},e)},t.ensureFilePath=function(e,t){if(e.path)return e;if(!t||!t.path)throw Error("Could not define a file path for ".concat(e._id||e.id));return E({path:t.path+"/"+e.name},e)},t.getParentFolderId=function(e){var t=(0,g.default)(e,"attributes.dir_id");return""===t?null:t},t.downloadFile=t.copy=t.fetchBlobFileById=t.isFromKonnector=t.hasCertifications=t.hasQualifications=t.isPlainText=t.doMobileUpload=t.readMobileFile=t.uploadFileWithConflictStrategy=t.generateFileNameForRevision=t.generateNewFileNameOnConflict=t.overrideFileForPath=t.move=t.getFullpath=t.hasMetadataAttribute=t.fetchFilesByQualificationRules=t.saveFileQualification=t.isSharingShorcutNew=t.isSharingShortcutNew=t.isSharingShorcut=t.isSharingShortcut=t.getSharingShortcutTargetDoctype=t.getSharingShortcutTargetMime=t.getSharingShortcutStatus=t.isShortcut=t.shouldBeOpenedByOnlyOffice=t.isOnlyOfficeFile=t.isEncrypted=t.isNote=t.isDirectory=t.isFile=t.splitFilename=t.ALBUMS_DOCTYPE=void 0;var y=h(r(68434)),v=h(r(82007)),m=h(r(64512)),b=r(25976),g=h(r(27361)),k=h(r(47037)),O=h(r(18721)),w=h(r(10691)),_=r(34259),S=r(71450),P=r(87941);h(r(18621));var C=h(r(22853));function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach(function(t){(0,m.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var D="file";t.ALBUMS_DOCTYPE="io.cozy.photos.albums";var j=/(.+)(\..*)$/,A=function(e){if(!(0,k.default)(e.name))throw Error("file should have a name property");if("file"===e.type){var t=e.name.match(j);if(t)return{filename:t[1],extension:t[2]}}return{filename:e.name,extension:""}};t.splitFilename=A;var T=function(e){return e&&e.type===D};t.isFile=T;t.isDirectory=function(e){return e&&"directory"===e.type};var I=function(e){return!!(e&&e.name&&e.name.endsWith(".cozy-note"))&&e.type===D&&!!e.metadata&&void 0!==e.metadata.title&&void 0!==e.metadata.version||!1};t.isNote=I;var M=function(e){return!!e.encrypted};t.isEncrypted=M;var R=function(e){return T(e)&&!I(e)&&("text"===e.class||"spreadsheet"===e.class||"slide"===e.class)};t.isOnlyOfficeFile=R;t.shouldBeOpenedByOnlyOffice=function(e){return R(e)&&!e.name.endsWith(".txt")&&!e.name.endsWith(".md")};t.isShortcut=function(e){return e&&"shortcut"===e.class};var N=function(e){return(0,g.default)(e,"metadata.sharing.status")};t.getSharingShortcutStatus=N;t.getSharingShortcutTargetMime=function(e){return(0,g.default)(e,"metadata.target.mime")};t.getSharingShortcutTargetDoctype=function(e){return(0,g.default)(e,"metadata.target._type")};var F=function(e){return!!N(e)};t.isSharingShortcut=F;t.isSharingShorcut=function(e){return C.default.warn("Deprecation: `isSharingShorcut` is deprecated, please use `isSharingShortcut` instead"),F(e)};var L=function(e){return"new"===N(e)};t.isSharingShortcutNew=L;t.isSharingShorcutNew=function(e){return C.default.warn("Deprecation: `isSharingShorcutNew` is deprecated, please use `isSharingShortcutNew` instead"),L(e)};var B=(n=(0,v.default)(y.default.mark(function e(t,r,n){var a;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,_.setQualification)(r,n),e.abrupt("return",t.collection(P.DOCTYPE_FILES).updateMetadataAttribute(r._id,a.metadata));case 2:case"end":return e.stop()}},e)})),function(e,t,r){return n.apply(this,arguments)});t.saveFileQualification=B;var z=(a=(0,v.default)(y.default.mark(function e(t,r){var n,a,i,o;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.rules,a=r.count,i=(0,S.Q)(P.DOCTYPE_FILES).where(E({},n)).partialIndex({trashed:!1}).indexFields(["cozyMetadata.updatedAt","metadata.qualification"]).sortBy([{"cozyMetadata.updatedAt":"desc"}]).limitBy(a||1),e.next=4,t.query(i);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)});t.fetchFilesByQualificationRules=z;t.hasMetadataAttribute=function(e){var t=e.file,r=e.attribute;return(0,O.default)(t,"metadata.".concat(r))};var U=(i=(0,v.default)(y.default.mark(function e(t,r,n){var a,i;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw Error("You must provide a dirId");case 2:return e.next=4,t.query((0,S.Q)(P.DOCTYPE_FILES).getById(r));case 4:return a=e.sent.data,i=(0,w.default)(a.path,"/"),e.abrupt("return","".concat(i,"/").concat(n));case 8:case"end":return e.stop()}},e)})),function(e,t,r){return i.apply(this,arguments)});t.getFullpath=U;var G=(o=(0,v.default)(y.default.mark(function e(t,r,n){var a,i,o,u,c,s=arguments;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(s.length>3&&void 0!==s[3]?s[3]:{force:!1}).force,e.prev=1,"io.cozy.remote.nextcloud.files"!==r._type){e.next=10;break}if("io.cozy.remote.nextcloud.files"!==n._type){e.next=7;break}return e.next=6,t.collection("io.cozy.remote.nextcloud.files").move(r,n);case 6:case 9:case 13:return e.abrupt("return",{moved:void 0,deleted:null});case 7:return e.next=9,t.collection("io.cozy.remote.nextcloud.files").moveToCozy(r,n);case 10:if("io.cozy.remote.nextcloud.files"!==n._type){e.next=14;break}return e.next=13,t.collection("io.cozy.remote.nextcloud.files").moveFromCozy(n,r);case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(1),e.t0;case 19:return e.prev=19,e.next=22,t.collection(P.DOCTYPE_FILES).updateFileMetadata(r._id,{dir_id:n._id});case 22:return i=e.sent,e.abrupt("return",{moved:i.data,deleted:null});case 26:if(e.prev=26,e.t1=e.catch(19),!(409===e.t1.status&&a)){e.next=43;break}return e.next=31,U(t,n._id,r.name);case 31:return o=e.sent,e.next=34,t.collection(P.DOCTYPE_FILES).statByPath(o);case 34:return u=e.sent,e.next=37,t.collection(P.DOCTYPE_FILES).destroy(u.data);case 37:return e.next=39,t.collection(P.DOCTYPE_FILES).updateFileMetadata(r._id,{dir_id:n._id});case 39:return c=e.sent,e.abrupt("return",{moved:c.data,deleted:u.data.id});case 43:throw e.t1;case 44:case"end":return e.stop()}},e,null,[[1,16],[19,26]])})),function(e,t,r){return o.apply(this,arguments)});t.move=G;var Q=(u=(0,v.default)(y.default.mark(function e(t,r,n,a){var i,o,u,c,s,l,d,f;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return!(i=r).endsWith("/")&&(i+="/"),o=t.collection(P.DOCTYPE_FILES),e.prev=3,e.next=6,o.statByPath(i+n.name);case 6:return c=(u=e.sent.data).id,s=u.dir_id,e.next=10,o.updateFile(n,{dirId:s,fileId:c,metadata:a});case 10:return l=e.sent,e.abrupt("return",l);case 14:if(e.prev=14,e.t0=e.catch(3),!/Not Found/.test(e.t0)){e.next=24;break}return e.next=19,o.ensureDirectoryExists(i);case 19:return d=e.sent,e.next=22,o.createFile(n,{dirId:d,metadata:a});case 22:return f=e.sent,e.abrupt("return",f);case 24:throw e.t0;case 25:case"end":return e.stop()}},e,null,[[3,14]])})),function(e,t,r,n){return u.apply(this,arguments)});t.overrideFileForPath=Q;var H=function(e,t){var r=(null==t?void 0:t.delimiter)||"_",n=new RegExp("(".concat(r,")([0-9]+)$")),a=e.match(n);if(!a)return"".concat(e).concat(r,"1");var i=parseInt(a[2]);return i++,e.replace(new RegExp("(".concat(r,")([0-9]+)$")),"".concat(r).concat(i))};t.generateNewFileNameOnConflict=H;t.generateFileNameForRevision=function(e,t,r){var n=A(e),a=n.filename,i=n.extension;return"".concat(a,"_").concat(r(t.updated_at,"DD MMMM - HH[h]mm")).concat(i)};var q=(c=(0,v.default)(y.default.mark(function e(t,r,n){var a,i,o,u,c,s,l,d,f,p,h;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.name,i=n.dirId,o=n.conflictStrategy,u=n.conflictOptions,e.prev=1,e.next=4,U(t,i,a);case 4:return c=e.sent,e.next=7,t.collection(P.DOCTYPE_FILES).statByPath(c);case 7:if(s=e.sent.data.id,"erase"!==o){e.next=16;break}return e.next=12,t.collection(P.DOCTYPE_FILES).updateFile(r,E(E({},n),{},{fileId:s}));case 12:return l=e.sent,e.abrupt("return",l);case 16:return f=(d=A({name:a,type:"file"})).filename,p=d.extension,h=H(f,u)+p,e.abrupt("return",q(t,r,E(E({},n),{},{name:h})));case 19:e.next=26;break;case 21:if(e.prev=21,e.t0=e.catch(1),!/Not Found/.test(e.t0.message)){e.next=25;break}return e.abrupt("return",t.collection(P.DOCTYPE_FILES).createFile(r,n));case 25:throw e.t0;case 26:case"end":return e.stop()}},e,null,[[1,21]])})),function(e,t,r){return c.apply(this,arguments)});t.uploadFileWithConflictStrategy=q;var J=(s=(0,v.default)(y.default.mark(function e(t){var r;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Promise(function(e,r){var n=function(){var t=(0,v.default)(y.default.mark(function t(n){return y.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.file(function(){var t=(0,v.default)(y.default.mark(function t(r){var n;return y.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(n=new FileReader).onloadend=(0,v.default)(y.default.mark(function t(){return y.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e(n.result);case 1:case"end":return t.stop()}},t)})),n.readAsArrayBuffer(r);case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.error("error getting fileentry file!"+e),r(e)});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),a=function(e){r(e)};window.resolveLocalFileSystemURL(t,n,a)}),e.abrupt("return",r);case 2:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)});t.readMobileFile=J;var Y=(l=(0,v.default)(y.default.mark(function e(t,r,n){var a;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(r);case 2:return a=e.sent,e.abrupt("return",q(t,a,n));case 4:case"end":return e.stop()}},e)})),function(e,t,r){return l.apply(this,arguments)});t.doMobileUpload=Y;t.isPlainText=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e?/^text\//.test(e):/\.(txt|md)$/.test(t)};t.hasQualifications=function(e){return(0,O.default)(e,"metadata.qualification")};t.hasCertifications=function(e){return(0,g.default)(e,"metadata.carbonCopy",!1)||(0,g.default)(e,"metadata.electronicSafe",!1)};t.isFromKonnector=function(e){return(0,O.default)(e,"cozyMetadata.sourceAccount")};var K=(d=(0,v.default)(y.default.mark(function e(t,r){var n,a,i;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.collection(P.DOCTYPE_FILES),e.next=3,n.fetchFileContentById(r);case 3:return a=e.sent,e.next=6,a.blob();case 6:return i=e.sent,e.abrupt("return",i);case 8:case"end":return e.stop()}},e)})),function(e,t){return d.apply(this,arguments)});t.fetchBlobFileById=K;var V=(f=(0,v.default)(y.default.mark(function e(t,r,n){var a,i,o,u;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!("io.cozy.remote.nextcloud.files"===r._type&&"io.cozy.remote.nextcloud.files"===n._type)){e.next=6;break}return e.next=4,t.collection("io.cozy.remote.nextcloud.files").copy(r,n);case 4:return a=e.sent,e.abrupt("return",a);case 6:if(!("io.cozy.remote.nextcloud.files"===r._type&&"io.cozy.files"===n._type)){e.next=11;break}return e.next=9,t.collection("io.cozy.remote.nextcloud.files").moveToCozy(r,n,{copy:!0});case 9:return i=e.sent,e.abrupt("return",i);case 11:if("io.cozy.remote.nextcloud.files"!==n._type){e.next=16;break}return e.next=14,t.collection("io.cozy.remote.nextcloud.files").moveFromCozy(n,r,{copy:!0});case 14:return o=e.sent,e.abrupt("return",o);case 16:return e.next=18,t.collection(P.DOCTYPE_FILES).copy(r._id,void 0,n._id);case 18:return u=e.sent,e.abrupt("return",u);case 22:throw e.prev=22,e.t0=e.catch(0),e.t0;case 25:case"end":return e.stop()}},e,null,[[0,22]])})),function(e,t,r){return f.apply(this,arguments)});t.copy=V;var W=(p=(0,v.default)(y.default.mark(function e(t){var r,n,a,i,o,u;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.client,n=t.file,a=t.url,i=t.webviewIntent,o=r.collection(P.DOCTYPE_FILES),!((0,b.isFlagshipApp)()&&i&&!M(n))){e.next=19;break}return e.next=5,null==i?void 0:i.call("isAvailable","downloadFile");case 5:if(e.t1=u=e.sent,e.t0=null!==e.t1,!e.t0){e.next=9;break}e.t0=void 0!==u;case 9:if(!e.t0){e.next=13;break}e.t2=u,e.next=14;break;case 13:e.t2=!1;case 14:if(!e.t2){e.next=19;break}return e.next=18,i.call("downloadFile",n);case 18:return e.abrupt("return",e.sent);case 19:if(!M(n)){e.next=21;break}return e.abrupt("return",o.forceFileDownload(a,n.name));case 21:return e.abrupt("return",o.download(n));case 22:case"end":return e.stop()}},e)})),function(e){return p.apply(this,arguments)});t.downloadFile=W},27899:function(e,t,r){var n,a,i,o=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getReferencedFolder=t.createFolderWithReference=t.ensureMagicFolder=t.MAGIC_FOLDERS=void 0;var u=o(r(68434)),c=o(r(82007)),s=o(r(89734));o(r(18621));var l=r(87941),d=r(71450),f="io.cozy.apps",p="administrative",h="photos",y={ADMINISTRATIVE:"".concat(f,"/").concat(p),PHOTOS:"".concat(f,"/").concat(h),PHOTOS_BACKUP:"".concat(f,"/").concat(h,"/mobile"),PHOTOS_UPLOAD:"".concat(f,"/").concat(h,"/upload"),NOTES:"".concat(f,"/notes"),HOME:"".concat(f,"/home"),PAPERS:"".concat(f,"/").concat(p,"/papers"),COACH_CO2:"".concat(f,"/").concat(p,"/coachco2")};t.MAGIC_FOLDERS=y;var v=(n=(0,c.default)(u.default.mark(function e(t,r,n){var a,i,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={_type:f,_id:r},e.next=3,b(t,a);case 3:if(!(i=e.sent)){e.next=6;break}return e.abrupt("return",i);case 6:if((o=Object.values(y)).includes(r)){e.next=9;break}throw Error("Cannot create Magic folder with id ".concat(r,". Allowed values are ").concat(o.join(", "),"."));case 9:if(n){e.next=11;break}throw Error("Magic folder default path must be defined");case 11:return e.abrupt("return",m(t,n,a));case 12:case"end":return e.stop()}},e)})),function(e,t,r){return n.apply(this,arguments)});t.ensureMagicFolder=v;var m=(a=(0,c.default)(u.default.mark(function e(t,r,n){var a,i,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.collection(l.DOCTYPE_FILES),e.next=3,a.ensureDirectoryExists(r);case 3:return i=e.sent,e.next=6,a.addReferencesTo(n,[{_id:i}]);case 6:return e.next=8,a.get(i);case 8:return o=e.sent.data,e.abrupt("return",o);case 11:case"end":return e.stop()}},e)})),function(e,t,r){return a.apply(this,arguments)});t.createFolderWithReference=m;var b=(i=(0,c.default)(u.default.mark(function e(t,r){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query((0,d.Q)(l.DOCTYPE_FILES).partialIndex({type:"directory",trashed:!1}).referencedBy(r));case 2:return n=e.sent.included,e.abrupt("return",n.length>0?(0,s.default)(n,"created_at").pop():null);case 5:case"end":return e.stop()}},e)})),function(e,t){return i.apply(this,arguments)});t.getReferencedFolder=b},93829:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.deltaLatitude=t.deltaLongitude=t.computeSphericalCenter=t.geodesicDistance=t.computeSpeed=void 0;function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}t.computeSpeed=function(e,t){return e&&t?Math.round(e/t*100)/100:0};var n=function(e){return e*Math.PI/180},a=function(e){return 180*e/Math.PI},i=function(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r};t.geodesicDistance=function(e,t){if((null==e?void 0:e.lon)===void 0||(null==e?void 0:e.lat)===void 0||(null==t?void 0:t.lon)===void 0||(null==t?void 0:t.lat)===void 0)return null;var r=n(e.lon),a=n(e.lat),o=n(t.lon),u=n(t.lat),c=2*Math.asin(Math.sqrt(Math.pow(Math.sin((u-a)/2),2)+Math.cos(a)*Math.cos(u)*Math.pow(Math.sin((o-r)/2),2)));return i(6378137*c,2)};t.computeSphericalCenter=function(e){if(e.length<1)return null;if(1===e.length)return e[0];var t=0,o=0,u=0,c,s=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}}(e))){i&&(e=i);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o,u=!0,c=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return u=e.done,e},e:function(e){c=!0,o=e},f:function(){try{!u&&null!=i.return&&i.return()}finally{if(c)throw o}}}}(e);try{for(s.s();!(c=s.n()).done;){var l=c.value,d=n(l.lon),f=n(l.lat),p=Math.cos(f)*Math.cos(d),h=Math.cos(f)*Math.sin(d),y=Math.sin(f);t+=p,o+=h,u+=y}}catch(e){s.e(e)}finally{s.f()}var v=t/e.length,m=o/e.length,b=u/e.length,g=a(Math.atan2(m,v));return{lat:i(a(Math.atan2(b,Math.sqrt(v*v+m*m))),13),lon:i(g,13)}};t.deltaLongitude=function(e,t){return i(a(t/(6378137*Math.cos(n(e)))),13)};t.deltaLatitude=function(e){return i(e/(40075e3/360),13)}},4034:function(e,t,r){var n=r(14746);Object.defineProperty(t,"__esModule",{value:!0}),t.geo=t.user=t.paper=t.dacc=t.sharing=t.timeseries=t.document=t.contact=t.utils=t.permission=t.note=t.account=t.konnectorFolder=t.folder=t.file=t.applications=t.instance=t.trigger=t.accounts=t.triggers=void 0;var a=n(r(20786));t.trigger=a;var i=n(r(5499));t.instance=i;var o=n(r(23963));t.applications=o;var u=n(r(67348));t.file=u;var c=n(r(27899));t.folder=c;var s=n(r(3857));t.konnectorFolder=s;var l=n(r(94564));t.account=l;var d=n(r(49666));t.note=d;var f=n(r(13001));t.permission=f;var p=n(r(1028));t.utils=p;var h=n(r(40996));t.contact=h;var y=n(r(41818));t.document=y;var v=n(r(48398));t.timeseries=v;var m=n(r(32672));t.sharing=m;var b=n(r(61645));t.dacc=b;var g=n(r(87067));t.paper=g;var k=n(r(51398));t.user=k;var O=n(r(93829));t.geo=O;t.triggers=a;t.accounts=l},5499:function(e,t,r){var n,a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.makeDiskInfos=t.hasPasswordDefinedAttribute=t.buildPremiumLink=t.hasAnOffer=t.shouldDisplayOffers=t.getUuid=t.isFreemiumUser=t.arePremiumLinksEnabled=t.isSelfHosted=void 0;var i=a(r(68434)),o=a(r(82007)),u=a(r(27361)),c=r(71450),s=5e10,l=function(e){return!(0,u.default)(e,"context.data.manager_url")};t.isSelfHosted=l;var d=function(e){return!!(0,u.default)(e,"context.data.enable_premium_links")};t.arePremiumLinksEnabled=d;var f=function(e){return parseInt((0,u.default)(e,"diskUsage.data.quota",!1))<=s};t.isFreemiumUser=f;var p=function(e){return(0,u.default)(e,"instance.data.uuid")};t.getUuid=p;t.shouldDisplayOffers=function(e){return!l(e)&&d(e)&&p(e)&&f(e)};t.hasAnOffer=function(e){return!l(e)&&d(e)&&p(e)&&!f(e)};t.buildPremiumLink=function(e){var t=(0,u.default)(e,"context.data.manager_url",!1),r=p(e);return t&&r?"".concat(t,"/cozy/instances/").concat(r,"/premium"):null};var h=(n=(0,o.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetchQueryAndGetFromState({definition:(0,c.Q)("io.cozy.settings").getById("io.cozy.settings.instance"),options:{as:"io.cozy.settings/io.cozy.settings.instance",singleDocData:!0}});case 3:return r=e.sent.data.password_defined,e.abrupt("return",!!r);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",!1);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(e){return n.apply(this,arguments)});t.hasPasswordDefinedAttribute=h;var y=function(e){return 1e-9*e},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"".concat(e%1?e.toFixed(t):e)},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return{diskQuota:y(t),diskUsage:y(e),percentUsage:e/t*100}};t.makeDiskInfos=function(e,t){var r=m(+e,t?+t:void 0),n=r.diskQuota,a=r.diskUsage,i=r.percentUsage;return{humanDiskQuota:v(n),humanDiskUsage:v(a),percentUsage:Math.round(i).toString()}}},3857:function(e,t,r){var n,a,i,o,u,c,s,l=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.findKonnectorAccountFolderByReference=t.buildFolderPermission=t.buildFolderPath=t.statDirectoryByPath=t.createDirectoryByPath=t.ensureKonnectorFolder=void 0;var d=l(r(68434)),f=l(r(90402)),p=l(r(82007)),h=r(27899);l(r(18621));var y=r(94564),v=r(92984),m=r(71450),b="io.cozy.files";var g=(n=(0,p.default)(d.default.mark(function e(t,r){var n,a,i,o,u,c,s,l,p,m,g,_,S,P,C,x;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.konnector,a=r.account,i=r.lang,o=t.collection("io.cozy.permissions"),u=t.collection(b),c=(0,v.getLocalizer)(i),e.next=6,Promise.all([(0,h.ensureMagicFolder)(t,h.MAGIC_FOLDERS.ADMINISTRATIVE,c("MagicFolders.administrative")),(0,h.ensureMagicFolder)(t,h.MAGIC_FOLDERS.PHOTOS,c("MagicFolders.photos"))]);case 6:return s=e.sent,p=(l=(0,f.default)(s,2))[0],m=l[1],g=(0,y.getAccountName)(a),e.next=13,R({client:t,slug:n.slug,sourceAccountIdentifier:g});case 13:if(!(_=e.sent)){e.next=16;break}return e.abrupt("return",_);case 16:return e.next=18,N({client:t,slug:n.slug});case 18:if(!(S=e.sent)){e.next=23;break}return e.next=22,function(e){return F.apply(this,arguments)}({client:t,mainFolder:S,konnector:n,sourceAccountIdentifier:g});case 22:return e.abrupt("return",e.sent);case 23:return P=w(n,a,{administrative:p.path,photos:m.path}),e.next=26,O(t,P);case 26:if(e.t0=e.sent,e.t0){e.next=31;break}return e.next=30,k(t,P);case 30:e.t0=e.sent;case 31:return C=e.t0,e.next=34,u.statById(C.dir_id);case 34:return x=e.sent.data,e.next=38,Promise.all([o.add(n,D(C)),I({client:t,folder:C,konnector:n}),M({client:t,folder:C,sourceAccountIdentifier:g}),I({client:t,folder:x,konnector:n})]);case 38:return e.abrupt("return",C);case 39:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)});t.ensureKonnectorFolder=g;var k=(a=(0,p.default)(d.default.mark(function e(t,r){var n;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection(b).createDirectoryByPath(r);case 2:return n=e.sent.data,e.abrupt("return",n);case 5:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)});t.createDirectoryByPath=k;var O=(i=(0,p.default)(d.default.mark(function e(t,r){var n;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.collection(b).statByPath(r);case 3:if(!(n=e.sent).data.trashed){e.next=6;break}return e.abrupt("return",null);case 6:return e.abrupt("return",n.data);case 9:if(e.prev=9,e.t0=e.catch(0),!(e.t0&&404===e.t0.status)){e.next=13;break}return e.abrupt("return",null);case 13:throw Error(e.t0.message);case 14:case"end":return e.stop()}},e,null,[[0,9]])})),function(e,t){return i.apply(this,arguments)});t.statDirectoryByPath=O;var w=function(e,t){var r,n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=j(((null==e?void 0:null===(r=e.folders)||void 0===r?void 0:null===(n=r[0])||void 0===n?void 0:n.defaultDir)||"$administrative/$konnector/$account").replace(/(\/+)/g,"/"),"/");!_(i)&&(i="$administrative/"+i);var o=i.split("/",1),u=P(i,o[0]),c=C(o[0],a),s=x(u,{konnector:e.name,account:(0,y.getAccountName)(t).replace(E,"-")});return"/".concat(c,"/").concat(s)};t.buildFolderPath=w;var _=function(e){return S.some(function(t){return e.startsWith(t)})},S=["$administrative","$photos"],P=function(e,t){var r=e.substring(t.length);return""===r&&(r="$konnector/$account"),r},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return j((t[e.slice(1)]||"Administrative").replace(/(\/+)/g,"/"),"/")},x=function(e,t){return j(e.replace(/(\/+)/g,"/"),"/").split("/").map(function(e){return(null==t?void 0:t[e.slice(1)])||e}).join("/")},E=/\//g,D=function(e){return{saveFolder:{type:b,values:[e._id],verbs:["GET","PATCH","POST"]}}};t.buildFolderPermission=D;var j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\\s";return e.replace(new RegExp("^([".concat(t,"]*)(.*?)([").concat(t,"]*)$")),"$2")},A=function(e,t){var r;return!!(null===(r=e.referenced_by)||void 0===r?void 0:r.find(function(e){return"io.cozy.konnectors"===e.type&&e.id==="io.cozy.konnectors/"+t}))},T=function(e,t){var r;return!!(null===(r=e.referenced_by)||void 0===r?void 0:r.find(function(e){return"io.cozy.accounts.sourceAccountIdentifier"===e.type&&(!t||e.id===t)}))};var I=(o=(0,p.default)(d.default.mark(function e(t){var r,n,a,i;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.client,n=t.folder,a=t.konnector,i=r.collection(b),A(n,a.slug)){e.next=5;break}return e.next=5,i.addReferencesTo(a,[n]);case 5:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)});var M=(u=(0,p.default)(d.default.mark(function e(t){var r,n,a,i;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.client,n=t.folder,a=t.sourceAccountIdentifier,i=r.collection(b),T(n,a)){e.next=5;break}return e.next=5,i.addReferencesTo({_id:a,_type:"io.cozy.accounts.sourceAccountIdentifier"},[n]);case 5:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)});var R=(c=(0,p.default)(d.default.mark(function e(t){var r,n,a,i;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.client,n=t.slug,a=t.sourceAccountIdentifier,e.next=3,r.query((0,m.Q)(b).partialIndex({type:"directory",trashed:!1}).referencedBy({_type:"io.cozy.konnectors",_id:"io.cozy.konnectors/".concat(n)}));case 3:return i=e.sent.included,e.abrupt("return",i.find(function(e){return T(e,a)}));case 6:case"end":return e.stop()}},e)})),function(e){return c.apply(this,arguments)});t.findKonnectorAccountFolderByReference=R;var N=(s=(0,p.default)(d.default.mark(function e(t){var r,n,a;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.client,n=t.slug,e.next=3,r.query((0,m.Q)(b).partialIndex({type:"directory",trashed:!1}).referencedBy({_type:"io.cozy.konnectors",_id:"io.cozy.konnectors/".concat(n)}));case 3:return a=e.sent.included,e.abrupt("return",a.find(function(e){return!T(e)}));case 6:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)});function F(){return(F=(0,p.default)(d.default.mark(function e(t){var r,n,a,i,o,u;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.client,n=t.mainFolder,a=t.konnector,i=t.sourceAccountIdentifier,o=n.path+"/"+i,e.next=4,O(r,o);case 4:if(e.t0=e.sent,e.t0){e.next=9;break}return e.next=8,k(r,o);case 8:e.t0=e.sent;case 9:return u=e.t0,e.next=12,I({client:r,folder:u,konnector:a});case 12:return e.next=14,M({client:r,folder:u,sourceAccountIdentifier:i});case 14:return e.abrupt("return",u);case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}},86092:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.sanitizeCategories=h,t.areTermsValid=y,t.isPartnershipValid=v,t.sanitize=function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e);return!e.categories&&e.category&&"string"==typeof e.category&&(t.categories=[e.category],delete t.category),t.categories=h(t.categories),"object"==typeof e.name&&(t.name=e.name.en),e.available_version&&(t.availableVersion=e.available_version,delete t.available_version),e.latest_version&&(t.latestVersion=e.latestVersion,delete t.latest_version),t.terms&&!y(t.terms)&&delete t.terms,t.partnership&&!v(t.partnership)&&delete t.partnership,t.fields&&(t.fields=b(e.fields)),t},t.getIdentifier=t.sanitizeIdentifier=t.legacyLoginFields=t.ROLE_IDENTIFIER=void 0;var a=n(r(64512)),i=n(r(59242)),o=n(r(50361)),u=n(r(70894));function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var l="identifier";t.ROLE_IDENTIFIER=l;var d=["login","identifier","new_identifier","email"];t.legacyLoginFields=d;var f=["secret","dob","code","answer","access_token","refresh_token","appSecret"],p=["banking","cozy","energy","health","host_provider","insurance","isp","mes_infos","online_services","others","partners","press","productivity","ptnb","public_service","shopping","social","telecom","transport"];function h(e){if(!e)return["others"];var t=e.filter(function(e){return p.includes(e)});return t.length?t:["others"]}function y(e){return!!(e&&e.id&&e.url&&e.version)}function v(e){return!!(e&&e.description)}var m=function(e){var t=(0,o.default)(e),r=!1;for(var n in t)t[n].role===l&&(r?delete t[n].role:r=!0);if(r)return t;var a,i=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}}(e))){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(d);try{for(i.s();!(a=i.n()).done;){var u=a.value;if(t[u])return t[u].role=l,t}}catch(e){i.e(e)}finally{i.f()}for(var s in t)if("password"!==t[s].type){t[s].role=l;break}return t};t.sanitizeIdentifier=m;t.getIdentifier=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,u.default)(m(e),function(e){return e.role===l})||null};var b=(0,i.default)([function(e){var t=(0,o.default)(e);return delete t.advancedFields,t},m,function(e){var t=(0,o.default)(e);for(var r in t){var n=t[r],a=void 0===n.required?n.isRequired:n.required;t[r].required="boolean"!=typeof a||a}return t},function(e){var t=(0,o.default)(e);for(var r in t){var n=t[r];"boolean"!=typeof n.encrypted&&(n.encrypted="password"===n.type||f.includes(r))}return t}])},49666:function(e,t,r){var n,a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchURL=t.generateUrlForNote=t.generatePrivateUrl=void 0;var i=a(r(68434)),o=a(r(82007)),u=r(72004),c=a(r(22853)),s=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.returnUrl,a=new URL(e);return n&&a.searchParams.set("returnUrl",n),a.hash="#/n/".concat(t.id),a.toString()};t.generatePrivateUrl=s;t.generateUrlForNote=function(e,t){return c.default.warn("generateUrlForNote is deprecated. Please use models.note.generatePrivateUrl instead"),s(e,t)};var l=(n=(0,o.default)(i.default.mark(function e(t,r){var n,a,o,c,s,l,d,f,p,h,y,v=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.length>2&&void 0!==v[2]?v[2]:{},e.next=3,t.getStackClient().collection("io.cozy.notes").fetchURL({_id:r.id});case 3:if(o=(a=e.sent.data).note_id,c=a.subdomain,s=a.protocol,l=a.instance,d=a.sharecode,f=a.public_name,!d){e.next=18;break}return(h=[["id",o]]).push(["sharecode",d]),f&&h.push(["username",f]),e.abrupt("return",(0,u.generateWebLink)({cozyUrl:"".concat(s,"://").concat(l),searchParams:h,pathname:null!==(p=n.pathname)&&void 0!==p?p:"/public/",slug:"notes",subDomainType:c}));case 18:return e.abrupt("return",(0,u.generateWebLink)({cozyUrl:"".concat(s,"://").concat(l),pathname:null!==(y=n.pathname)&&void 0!==y?y:"",slug:"notes",subDomainType:c,hash:"/n/".concat(o)}));case 19:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)});t.fetchURL=l},87067:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isForeignPaper=t.makeExpirationDescription=t.makeExpiresInMessage=t.makeExpiredMessage=t.formatContactValue=t.getTranslatedNameForContact=t.formatOtherMetadataValue=t.getTranslatedNameForOtherMetadata=t.formatInformationMetadataValue=t.getTranslatedNameForInformationMetadata=t.formatDateMetadataValue=t.getTranslatedNameForDateMetadata=t.getMetadataQualificationType=t.formatMetadataQualification=t.isExpiringSoon=t.isExpired=t.computeExpirationNoticeLink=t.computeExpirationNoticeDate=t.computeExpirationDate=t.isExpiring=t.KNOWN_BILLS_ATTRIBUTES_NAMES=t.KNOWN_OTHER_METADATA_NAMES=t.KNOWN_INFORMATION_METADATA_NAMES=t.KNOWN_DATE_METADATA_NAMES=void 0;var a=n(r(98235)),i=n(r(29422)),o=n(r(27546)),u=n(r(94581)),c=n(r(99580)),s=r(92984),l=r(61774),d=r(40996),f=n(r(27361)),p=r(65314),h={national_id_card:"https://www.service-public.fr/particuliers/vosdroits/N358",residence_permit:"https://www.service-public.fr/particuliers/vosdroits/N110",passport:"https://www.service-public.fr/particuliers/vosdroits/N360",driver_license:"https://permisdeconduire.ants.gouv.fr/demarches-en-ligne/perte-vol-deterioration-fin-de-validite-ou-changement-d-etat-civil"},y=["AObtentionDate","BObtentionDate","CObtentionDate","DObtentionDate","obtentionDate","expirationDate","referencedDate","issueDate","shootingDate","date","datetime"];t.KNOWN_DATE_METADATA_NAMES=y;var v=["number","bicNumber","country","refTaxIncome","contractType","netSocialAmount","employerName","vehicle.licenseNumber","vehicle.confidentialNumber","noticePeriod"];t.KNOWN_INFORMATION_METADATA_NAMES=v;var m=["contact","page","qualification"];t.KNOWN_OTHER_METADATA_NAMES=m;var b=["amount","subtype","employer"];t.KNOWN_BILLS_ATTRIBUTES_NAMES=b;var g=function(e){var t,r,n,a,i,o=null===(t=e.metadata)||void 0===t?void 0:null===(r=t.qualification)||void 0===r?void 0:r.label,u=null===(n=e.metadata)||void 0===n?void 0:n.country,c=null===(a=e.metadata)||void 0===a?void 0:a.expirationDate,s=null===(i=e.metadata)||void 0===i?void 0:i.noticePeriod;return"national_id_card"===o&&(!u||"fr"===u)&&!!c&&!!s||!1},k=function(e){var t,r,n=null===(t=e.metadata)||void 0===t?void 0:t.expirationDate,a=null===(r=e.metadata)||void 0===r?void 0:r.noticePeriod;return!!n&&!!a||!1},O=function(e){var t,r,n,a=null===(t=e.metadata)||void 0===t?void 0:null===(r=t.qualification)||void 0===r?void 0:r.label,i=null===(n=e.metadata)||void 0===n?void 0:n.referencedDate,o=e.created_at;return"personal_sporting_licence"===a&&(!!i||!!o)||!1};t.isExpiring=function(e){return!!(g(e)||k(e)||O(e))||!1};var w=function(e){if(g(e)||k(e)){var t;return new Date(null===(t=e.metadata)||void 0===t?void 0:t.expirationDate)}if(O(e)){var r,n=null===(r=e.metadata)||void 0===r?void 0:r.referencedDate,a=e.created_at;return(0,i.default)(new Date(null!=n?n:a),{days:365})}return null};t.computeExpirationDate=w;var _=function(e){if(g(e)||k(e)){var t;return parseInt(null===(t=e.metadata)||void 0===t?void 0:t.noticePeriod,10)}return O(e)?15:null},S=function(e){var t=w(e);if(null==t)return null;var r=_(e);return null==r?null:(0,o.default)(t,{days:r})};t.computeExpirationNoticeDate=S;t.computeExpirationNoticeLink=function(e){var t,r,n=null===(t=e.metadata)||void 0===t?void 0:null===(r=t.qualification)||void 0===r?void 0:r.label;return n&&h[n]||null};t.isExpired=function(e){var t=new Date,r=w(e);return null!=r&&r<=t};t.isExpiringSoon=function(e){var t=new Date,r=w(e),n=S(e);return null!=r&&null!=n&&n<=t&&t<r};var P=function(e){var t=e.metadata,r=e.knownMetadataPath,n=e.value||(0,f.default)(t,r,null)||null;return Object.keys(t).some(function(e){return r.startsWith(e)})||"contact"===r?{name:r,value:n}:null};t.formatMetadataQualification=function(e){var t=y.map(function(t){return P({metadata:e,knownMetadataPath:t})}).filter(Boolean).filter(function(e,t,r){return r.length>1?"datetime"!==e.name:e}),r=v.map(function(t){return P({metadata:e,knownMetadataPath:t})}).filter(Boolean),n=m.map(function(t){var r,n="qualification"===t?null===(r=e[t])||void 0===r?void 0:r.label:e[t];return P({metadata:e,knownMetadataPath:t,value:n})}).filter(Boolean);return[].concat((0,a.default)(t),(0,a.default)(r),(0,a.default)(n))};t.getMetadataQualificationType=function(e){if(y.includes(e))return"date";if(v.includes(e))return"information";if(m.includes(e))return"contact"===e?"contact":"other";return b.includes(e)?"bills":null};t.getTranslatedNameForDateMetadata=function(e,t){var r=t.lang;return(0,s.getLocalizer)(r)("Scan.qualification.date.title.".concat(e))};t.formatDateMetadataValue=function(e,t){var r=t.lang,n=t.f,a=(0,s.getLocalizer)(r);return e?"en"===r?n(e,"MM/DD/YYYY"):n(e,"DD/MM/YYYY"):a("Scan.qualification.noInfo")};t.getTranslatedNameForInformationMetadata=function(e,t){var r=t.lang,n=t.qualificationLabel,a=(0,s.getLocalizer)(r);return"number"===e?a("Scan.qualification.information.title.".concat(n,".").concat(e)):a("Scan.qualification.information.title.".concat(e))};t.formatInformationMetadataValue=function(e,t){var r=t.lang,n=t.name,a=t.qualificationLabel,i=(0,s.getLocalizer)(r),o=(0,l.getLocalizer)(r).t;return"number"==typeof e||e?"noticePeriod"===n?"".concat(e," ").concat(i("Scan.qualification.information.day",{smart_count:e})):"contractType"===n?i("Scan.attributes.contractType.".concat(e),{_:e}):"refTaxIncome"===n||"netSocialAmount"===n||"amount"===n||"number"===n&&"pay_sheet"===a?"".concat(e," "):"country"===n&&(0,p.isValidCountryCodeTranslation)(r,e)?o("countries.".concat(e)):e:i("Scan.qualification.noInfo")};t.getTranslatedNameForOtherMetadata=function(e,t){var r=t.lang;return(0,s.getLocalizer)(r)("Scan.qualification.".concat(e))};t.formatOtherMetadataValue=function(e,t){var r=t.lang,n=t.name,a=(0,s.getLocalizer)(r);return"qualification"===n?a("Scan.items.".concat(e),{smart_count:1}):a("Scan.qualification.".concat(e))};t.getTranslatedNameForContact=function(e){var t=e.lang;return(0,s.getLocalizer)(t)("Scan.qualification.contact")};t.formatContactValue=function(e){return e&&e.length>0?e.map(function(e){return"".concat((0,d.getDisplayName)(e))}).join(", "):""};t.makeExpiredMessage=function(e){var t=e.lang;return(0,s.getLocalizer)(t)("Scan.expiration.expired")};t.makeExpiresInMessage=function(e,t){var r=t.lang;return(0,s.getLocalizer)(r)("Scan.expiration.expiresIn",{duration:(0,u.default)(new Date(e),{locale:"fr"===r?c.default:void 0})})};t.makeExpirationDescription=function(e,t){var r=t.lang;return(0,s.getLocalizer)(r)("Scan.expiration.description",{duration:(0,u.default)(new Date(e),{locale:"fr"===r?c.default:void 0})})};t.isForeignPaper=function(e){var t;return null!==(t=e.metadata)&&void 0!==t&&!!t.country&&"fr"!==e.metadata.country.toLowerCase()}},13001:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isReadOnly=v,t.fetchOwn=m,t.isForType=g,t.isDocumentReadOnly=function(e){return O.apply(this,arguments)},t.isShortcutCreatedOnTheRecipientCozy=void 0;var a=n(r(64512)),i=n(r(68434)),o=n(r(82007)),u=n(r(98235)),c=n(r(25325)),s=n(r(27361));n(r(18621));var l=r(71450),d=r(67348),f=r(87941),p=n(r(22853));function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.writability;return e.verbs&&e.verbs.length>0&&0===(0,c.default)(e.verbs,["ALL"].concat((0,u.default)(void 0===r?["PATCH","POST","PUT","DELETE"]:r))).length}function m(e){return b.apply(this,arguments)}function b(){return(b=(0,o.default)(i.default.mark(function e(t){var r,n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.collection("io.cozy.permissions"),e.next=3,r.fetchOwnPermissions();case 3:if(n=e.sent,a=(0,s.default)(n,"data.attributes.permissions")){e.next=7;break}throw"Can't get self permissions";case 7:return e.abrupt("return",Object.values(a));case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function g(e,t){return e.type===t||e.type+".*"===t}function k(){return(k=(0,o.default)(i.default.mark(function e(t){var r,n,a,u,c,s,p,h,v,b,k;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(k=function(){return(k=(0,o.default)(i.default.mark(function e(t){var r,n,a,o,u,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.doc,n=t.client,!(o=(a=t.perms).find(function(e){if(!e.values)return!0;var t=r[e.selector||"id"];return e.values.includes(t)}))){e.next=6;break}return e.abrupt("return",o);case 6:if(c!==f.DOCTYPE_FILES){e.next=16;break}if(u=(0,d.getParentFolderId)(r),e.t0=u,!e.t0){e.next=13;break}return e.next=12,h(u);case 12:e.t0=e.sent;case 13:if(!(s=e.t0)){e.next=16;break}return e.abrupt("return",b({doc:s,perms:a,client:n}));case 16:return e.abrupt("return",void 0);case 17:case"end":return e.stop()}},e)}))).apply(this,arguments)},b=function(e){return k.apply(this,arguments)},v=function(){return(v=(0,o.default)(i.default.mark(function e(t){var r,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,l.Q)(f.DOCTYPE_FILES).getById(t),e.next=3,n.query(r);case 3:return a=e.sent,e.abrupt("return",a&&a.data);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)},h=function(e){return v.apply(this,arguments)},r=t.document,n=t.client,a=t.permissions,u=r._id||r.id,c=r._type||r.type,s=y(y({},r),{},{id:u,type:c}),!a){e.next=12;break}e.t0=a,e.next=15;break;case 12:return e.next=14,m(n);case 14:e.t0=e.sent;case 15:return p=e.t0.filter(function(e){return g(e,c)}),e.abrupt("return",b({doc:s,client:n,perms:p}));case 18:case"end":return e.stop()}},e)}))).apply(this,arguments)}function O(){return(O=(0,o.default)(i.default.mark(function e(t){var r,n,a,o,u,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.document,n=t.client,a=t.writability,void 0!==(o=t.permissions)){e.next=10;break}return e.next=7,m(n);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=o;case 11:if(!((u=e.t0).length<=1)){e.next=16;break}e.t1=u[0],e.next=19;break;case 16:return e.next=18,function(e){return k.apply(this,arguments)}({document:r,client:n,permissions:u});case 18:e.t1=e.sent;case 19:if(!(c=e.t1)){e.next=24;break}return e.abrupt("return",v(c,{writability:a}));case 24:return p.default.warn("can't find the document in current attached permissions"),e.abrupt("return",void 0);case 26:case"end":return e.stop()}},e)}))).apply(this,arguments)}t.isShortcutCreatedOnTheRecipientCozy=function(e){if(!e.included)return!1;var t=e.included.find(function(e){return"io.cozy.sharings.members"===e.type});return!!t&&!!t.attributes.instance||!1}},32672:function(e,t,r){var n,a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getSharingLink=void 0;var i=a(r(68434)),o=a(r(64512)),u=a(r(82007)),c=r(87941);a(r(18621));var s=r(72004);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){(0,o.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var f=(n=(0,u.default)(i.default.mark(function e(t,r){var n,a,o,u,l,f,p,h,y=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=(o=y.length>2&&void 0!==y[2]?y[2]:{}).ttl,l=o.password,f=d(d({_type:c.DOCTYPE_PERMISSIONS,permissions:{files:{type:c.DOCTYPE_FILES,values:r,verbs:["GET"]}}},u&&{ttl:u}),l&&{password:l}),e.next=4,t.save(f);case 4:return p=e.sent.data,h=(0,s.generateWebLink)({cozyUrl:t.getStackClient().uri,searchParams:[["sharecode",null==p?void 0:null===(n=p.attributes)||void 0===n?void 0:null===(a=n.shortcodes)||void 0===a?void 0:a.code]],pathname:"/public",slug:"drive",subDomainType:t.capabilities.flat_subdomains?"flat":"nested"}),e.abrupt("return",h);case 8:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)});t.getSharingLink=f},48398:function(e,t,r){var n,a,i=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchTimeSeriesByIntervalAndSource=t.saveTimeSeries=void 0;var o=i(r(68434)),u=i(r(82007)),c=r(71450),s=function(e){if(!e.startDate||!e.endDate)throw Error("You must specify a startDate and endDate for the time serie");if(!Date.parse(e.startDate)||!Date.parse(e.endDate))throw Error("Invalid date format for the time serie");if(!e.dataType)throw Error("You must specify a dataType for the time serie");if(!e.series||!Array.isArray(e.series))throw Error("You must specify a series array for the time serie")};var l=(n=(0,u.default)(o.default.mark(function e(t,r){var n,a,i,u,c,l,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.dataType,a=r.series,i=r.startDate,u=r.endDate,c=r.source,l=r.theme,s({dataType:n,series:a,startDate:i,endDate:u,source:c}),d={_type:"io.cozy.timeseries.".concat(n),startDate:i,endDate:u,source:c,theme:l,series:a},e.abrupt("return",t.save(d));case 5:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)});t.saveTimeSeries=l;var d=(a=(0,u.default)(o.default.mark(function e(t,r){var n,a,i,u,s,l,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.startDate,a=r.endDate,i=r.dataType,u=r.source,s=r.limit,l="io.cozy.timeseries.".concat(i),d=(0,c.Q)(l).where({source:u,startDate:{$gte:n},endDate:{$lte:a}}).indexFields(["source","startDate","endDate"]).sortBy([{source:"desc"},{startDate:"desc"},{endDate:"desc"}]).limitBy(s||5),e.abrupt("return",t.query(d));case 4:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)});t.fetchTimeSeriesByIntervalAndSource=d},20786:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.triggers=t.triggerStates=void 0;var a=n(r(64512)),i=r(94564),o=n(r(22853));function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var s=["CHALLENGE_ASKED","DISK_QUOTA_EXCEEDED","TERMS_VERSION_MISMATCH","USER_ACTION_NEEDED","USER_ACTION_NEEDED.CHANGE_PASSWORD","USER_ACTION_NEEDED.ACCOUNT_REMOVED","USER_ACTION_NEEDED.WEBAUTH_REQUIRED","USER_ACTION_NEEDED.SCA_REQUIRED","LOGIN_FAILED"],l={getLastExecution:function(e){var t;return null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_execution},getLastSuccess:function(e){var t;return null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_success},getLastsuccess:function(e){var t;return o.default.warn("Deprecated, please use getLastSuccess instead of getLastsuccess"),null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_success},isErrored:function(e){var t;return(null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.status)==="errored"},getLastErrorType:function(e){var t;return null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_error}};t.triggerStates=l;var d={isKonnectorWorker:function(e){return"konnector"===e.worker},isKonnector:function(e){return"konnector"===e.worker||"client"===e.worker},getKonnector:function(e){return d.isKonnector(e)?e.message&&e.message.konnector?e.message.konnector:e.message&&e.message.Data?JSON.parse(atob(e.message.Data)).konnector:void 0:null},getAccountId:function(e){var t,r,n=null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.Data;return n?JSON.parse(atob(n)).account:null==e?void 0:null===(r=e.message)||void 0===r?void 0:r.account},isLatestErrorMuted:function(e,t){var r=l.getLastErrorType(e),n=l.getLastSuccess(e),a=n?new Date(n):new Date;return(0,i.getMutedErrors)(t).some(function(e){return e.type===r&&(!n||new Date(e.mutedAt)>a)})},hasActionableError:function(e){var t;return s.includes(null==e?void 0:null===(t=e.current_state)||void 0===t?void 0:t.last_error)},buildTriggerAttributes:function(e){var t=e.account,r=e.cron,n=e.folder,a=e.konnector,i={account:t._id,konnector:a.slug};n&&(i.folder_to_save=n._id);var o=a.clientSide?{type:"@client"}:{type:"@cron",arguments:void 0===r?"0 0 0 * * 0":r};return c(c({},{worker:"konnector",message:i}),o)}};t.triggers=d},51398:function(e,t,r){var n,a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.hasPassword=void 0;var i=a(r(68434)),o=a(r(82007)),u=r(5499),c=r(88842),s=r(47978);var l=(n=(0,o.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.hasExtensionInstalledAttribute)(t);case 2:return r=e.sent,e.next=5,(0,u.hasPasswordDefinedAttribute)(t);case 5:return n=e.sent,e.abrupt("return",!((0,s.isMagicLink)(t)||(0,s.isOIDC)(t))||r||n);case 7:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)});t.hasPassword=l},1028:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getFlagshipDownloadLink=t.getCreatedByApp=t.hasBeenUpdatedByApp=void 0;var a=n(r(27361)),i=r(25976),o=n(r(71400));t.hasBeenUpdatedByApp=function(e,t){var r=(0,a.default)(e,"cozyMetadata.updatedByApps");return!!(r&&r.find(function(e){return e.slug===t}))};t.getCreatedByApp=function(e){return(0,a.default)(e,"cozyMetadata.createdByApp")};t.getFlagshipDownloadLink=function(e){if((0,i.isAndroid)()){var t=(0,o.default)("flagship.playstore-id")||"io.cozy.flagship.mobile";return"https://play.google.com/store/apps/details?id=".concat(t,"&hl=").concat(e)}if((0,i.isIOS)()){var r=(0,o.default)("flagship.appstore-id")||"id1600636174";return"https://apps.apple.com/".concat(e,"/app/").concat(r)}return(0,o.default)("flagship.download-link")||"https://cozy.io/".concat(e,"/download")}},39268:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={olderThan:function(e){return function(t){return!t||!t.lastUpdate||Date.now()-t.lastUpdate>e}},noFetch:function(){return!1}}},25888:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(68434)),i=n(r(82007)),o=n(r(65105)),u=n(r(19723)),c=function(){var e;function t(){(0,o.default)(this,t),this.pending={}}return(0,u.default)(t,[{key:"exec",value:(e=(0,i.default)(a.default.mark(function e(t,r){var n,i,o,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r(),(i=this.pending[n])?o=i:(o=t(),this.pending[n]=o),e.prev=3,e.next=6,o;case 6:return u=e.sent,e.abrupt("return",u);case 8:return e.prev=8,this.pending[n]=null,e.finish(8);case 11:case"end":return e.stop()}},e,this,[[3,,8,11]])})),function(t,r){return e.apply(this,arguments)})},{key:"get",value:function(e){var t=e(),r=this.pending[t];return r?r:null}}]),t}();t.default=c},71450:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.QueryDefinition=t.MutationTypes=t.Mutations=t.getDoctypeFromOperation=t.uploadFile=t.removeReferencedBy=t.addReferencedBy=t.removeReferencesTo=t.addReferencesTo=t.deleteDocument=t.updateDocuments=t.updateDocument=t.createDocument=t.isAGetByIdQuery=t.Q=void 0;var a=n(r(64512)),i=n(r(65105)),o=n(r(19723)),u=n(r(70894)),c=n(r(22853));function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,e),this.doctype=t.doctype,this.id=t.id,this.ids=t.ids,this.selector=t.selector,this.fields=t.fields,this.indexedFields=t.indexedFields,this.partialFilter=t.partialFilter,this.sort=t.sort,this.includes=t.includes,this.referenced=t.referenced,this.limit=t.limit,this.skip=t.skip,this.cursor=t.cursor,this.bookmark=t.bookmark}return(0,o.default)(e,[{key:"checkSortOrder",value:function(e){var t=e.sort,r=e.selector,n=e.indexedFields,a=this.sort||t,i=this.selector||r||{},o=this.indexedFields||n;if(!a)return;var u=o||Object.keys(i);if(!!u&&!(u.length<1)){if(a.length>u.length){c.default.warn("You should not sort on non-indexed fields.\n\n        Sort: ".concat(JSON.stringify(a),"\n\n        Indexed fields: ").concat(u));return}for(var s=0;s<a.length;s++)if(Object.keys(a[s])[0]!==u[s]){c.default.warn("The sort order should be the same than the indexed fields.\n\n          Sort: ".concat(JSON.stringify(a),"\n\n          Indexed fields: ").concat(u,"\n"));return}}}},{key:"checkSelector",value:function(e){(0,u.default)(e,["$exists",!1])&&c.default.warn('The "$exists: false" predicate should be defined as a partial index for better performance.\n\n        Selector: '.concat(JSON.stringify(e))),(0,u.default)(e,"$ne")&&c.default.info("The use of the $ne operator is more efficient with a partial index.\n\n        Selector: ".concat(JSON.stringify(e)));var t=(0,u.default)(e,function(e){return Array.isArray(e)});if(t&&!t.startsWith("$"))throw Error("You pass ".concat(JSON.stringify(e),", this is a valid mango operation, \n\n        but sift doesn't support it so CozyClient can not evaluate \n\n        the request in memory. You must use a MongoDB operator \n\n        like $in or $or operator instead, preferably in a partial index, \n\n        to avoid costly full-scan"))}},{key:"checkSelectFields",value:function(e){var t=e.fields,r=e.selector,n=e.partialFilter,a=this.fields||t,i=this.selector||r,o=this.partialFilter||n;if(!!a&&(!!i||!!o)){if(!Object.keys(l(l({},i),o)).every(function(e){return a.includes(e)}))throw Error("The .select should includes all the fields used in where or partialIndex.\n        Please fix this query: fields: ".concat(JSON.stringify(this.toDefinition())))}}},{key:"getById",value:function(t){if(!t)throw Error("getById called with undefined id");return new e(l(l({},this.toDefinition()),{},{id:t}))}},{key:"getByIds",value:function(t){return new e(l(l({},this.toDefinition()),{},{ids:t}))}},{key:"where",value:function(t){return this.checkSortOrder({selector:t}),this.checkSelector(t),this.checkSelectFields({selector:t}),new e(l(l({},this.toDefinition()),{},{selector:t}))}},{key:"select",value:function(t){return this.checkSelectFields({fields:t}),new e(l(l({},this.toDefinition()),{},{fields:t}))}},{key:"indexFields",value:function(t){return this.checkSortOrder({indexedFields:t}),new e(l(l({},this.toDefinition()),{},{indexedFields:t}))}},{key:"partialIndex",value:function(t){return this.checkSelectFields({partialFilter:t}),new e(l(l({},this.toDefinition()),{},{partialFilter:t}))}},{key:"sortBy",value:function(t){if(!Array.isArray(t))throw Error('Invalid sort, should be an array ([{ label: "desc"}, { name: "asc"}]), you passed '.concat(JSON.stringify(t),"."));return this.checkSortOrder({sort:t}),new e(l(l({},this.toDefinition()),{},{sort:t}))}},{key:"include",value:function(t){if(!Array.isArray(t))throw Error("include() takes an array of relationship names");return new e(l(l({},this.toDefinition()),{},{includes:t}))}},{key:"limitBy",value:function(t){return new e(l(l({},this.toDefinition()),{},{limit:t}))}},{key:"UNSAFE_noLimit",value:function(){return new e(l(l({},this.toDefinition()),{},{limit:null}))}},{key:"offset",value:function(t){return new e(l(l({},this.toDefinition()),{},{bookmark:void 0,cursor:void 0,skip:t}))}},{key:"offsetCursor",value:function(t){return new e(l(l({},this.toDefinition()),{},{bookmark:void 0,skip:void 0,cursor:t}))}},{key:"offsetBookmark",value:function(t){return new e(l(l({},this.toDefinition()),{},{skip:void 0,cursor:void 0,bookmark:t}))}},{key:"referencedBy",value:function(t){return new e(l(l({},this.toDefinition()),{},{referenced:t}))}},{key:"toDefinition",value:function(){return{doctype:this.doctype,id:this.id,ids:this.ids,selector:this.selector,fields:this.fields,indexedFields:this.indexedFields,partialFilter:this.partialFilter,sort:this.sort,includes:this.includes,referenced:this.referenced,limit:this.limit,skip:this.skip,cursor:this.cursor,bookmark:this.bookmark}}}]),e}();t.QueryDefinition=d;t.Q=function(e){return new d({doctype:e})};t.isAGetByIdQuery=function(e){if(!e)return!1;var t=Object.values(e);return 0!==t.length&&2===t.filter(function(e){return void 0!==e}).length&&void 0!==e.id};var f="CREATE_DOCUMENT",p="UPDATE_DOCUMENT",h="UPDATE_DOCUMENTS",y="DELETE_DOCUMENT",v="ADD_REFERENCES_TO",m="UPLOAD_FILE",b=function(e){return{mutationType:x.CREATE_DOCUMENT,document:e}};t.createDocument=b;var g=function(e){return{mutationType:x.UPDATE_DOCUMENT,document:e}};t.updateDocument=g;var k=function(e){return{mutationType:x.UPDATE_DOCUMENTS,documents:e}};t.updateDocuments=k;var O=function(e){return{mutationType:x.DELETE_DOCUMENT,document:e}};t.deleteDocument=O;var w=function(e,t){return{mutationType:x.ADD_REFERENCES_TO,referencedDocuments:t,document:e}};t.addReferencesTo=w;var _=function(e,t){return{mutationType:x.REMOVE_REFERENCES_TO,referencedDocuments:t,document:e}};t.removeReferencesTo=_;var S=function(e,t){return{mutationType:x.ADD_REFERENCED_BY,referencedDocuments:t,document:e}};t.addReferencedBy=S;var P=function(e,t){return{mutationType:x.REMOVE_REFERENCED_BY,referencedDocuments:t,document:e}};t.removeReferencedBy=P;var C=function(e,t){return{mutationType:x.UPLOAD_FILE,file:e,dirPath:t}};t.uploadFile=C;t.getDoctypeFromOperation=function(e){if(!e.mutationType)return e.doctype;var t=e.mutationType;switch(t){case f:case p:return e.document._type;case h:return e.documents[0]._type;case y:return e.document._type;case v:case m:throw Error("Not implemented");default:throw Error("Unknown mutationType ".concat(t))}};t.Mutations={createDocument:b,updateDocument:g,updateDocuments:k,deleteDocument:O,addReferencesTo:w,removeReferencesTo:_,addReferencedBy:S,removeReferencedBy:P,uploadFile:C};var x={CREATE_DOCUMENT:f,UPDATE_DOCUMENT:p,UPDATE_DOCUMENTS:h,DELETE_DOCUMENT:y,ADD_REFERENCES_TO:v,REMOVE_REFERENCES_TO:"REMOVE_REFERENCES_TO",ADD_REFERENCED_BY:"ADD_REFERENCED_BY",REMOVE_REFERENCED_BY:"REMOVE_REFERENCED_BY",UPLOAD_FILE:m};t.MutationTypes=x},20057:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(66604)),i=n(r(7739)),o=n(r(85564)),u=n(r(18446)),c=n(r(44908)),s=n(r(87185)),l=r(71450),d=function(e){var t=(0,i.default)(e,function(e){var t;return(t=e).id||t.ids?"idQueries":"others"}),r=t.idQueries,n=void 0===r?[]:r,a=t.others,d=n.length>0?new l.QueryDefinition({doctype:e[0].doctype,ids:(0,c.default)((0,o.default)(n.map(function(e){return e.id||e.ids})))}):[];return(0,s.default)(void 0===a?[]:a,u.default).concat(d)};t.default=function(e){var t=(0,i.default)(e,function(e){return e.doctype});return(0,o.default)(Object.values((0,a.default)(t,d)))}},10513:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.registryEndpoint=t.transformRegistryFormatToStackFormat=void 0;var a=n(r(68434)),i=n(r(82007)),o=n(r(65105)),u=n(r(19723)),c=n(r(64512)),s=n(r(27361));r(35449);var l=n(r(47064)),d=r(20538);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}t.transformRegistryFormatToStackFormat=function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach(function(t){(0,c.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({id:(0,s.default)(e,"latest_version.manifest.source"),attributes:(0,s.default)(e,"latest_version.manifest")},e)};t.registryEndpoint="/registry/";var p=function(e){var t=new URLSearchParams(e).toString();return t?"?".concat(t):""},h=function(e){var t=e.type,r=t===d.APP_TYPE.KONNECTOR||"node"===t?"konnectors":"apps";return"/".concat(r)},y=function(){var e,t,r;function n(e){if((0,o.default)(this,n),!e.client)throw Error("Need to pass a client to instantiate a Registry API.");this.client=e.client}return(0,u.default)(n,[{key:"installApp",value:(e=(0,i.default)(a.default.mark(function e(t,r){var n,i,o,u,c,s,d;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.slug,i=t.terms,o={},(u=t.installed)&&(o.PermissionsAcked=u),r&&(o.Source=r),c=p(o),!i){e.next=9;break}return e.next=9,l.default.save(this.client,i);case 9:return s=t.installed?"PUT":"POST",d=h(t),e.abrupt("return",this.client.stackClient.fetchJSON(s,"".concat(d,"/").concat(n).concat(c)));case 12:case"end":return e.stop()}},e,this)})),function(t,r){return e.apply(this,arguments)})},{key:"uninstallApp",value:(t=(0,i.default)(a.default.mark(function e(t){var r,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.slug,n=h(t),e.abrupt("return",this.client.stackClient.fetchJSON("DELETE","".concat(n,"/").concat(r)));case 3:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"fetchApps",value:(r=(0,i.default)(a.default.mark(function e(t){var r,n,i,o,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.channel,n=t.type,o=new URLSearchParams({limit:void 0===(i=t.limit)?"200":i,versionsChannel:r,latestChannelVersion:r}).toString(),n&&(o+="&filter[type]=".concat(n)),e.next=6,this.client.stackClient.fetchJSON("GET","/registry?".concat(o));case 6:return u=e.sent.data,e.abrupt("return",u);case 9:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"fetchAppsInMaintenance",value:function(){return this.client.stackClient.fetchJSON("GET","/registry/maintenance")}},{key:"fetchApp",value:function(e){return this.client.stackClient.fetchJSON("GET","/registry/".concat(e))}},{key:"fetchAppVersion",value:function(e){if(!e.slug)throw Error("Need to pass a slug to use fetchAppVersion");var t=e.slug,r=e.channel,n=e.version,a=r||n&&"latest"!==n?r:"stable",i="/registry/".concat(t,"/");return a?i+="".concat(a,"/").concat(n||"latest"):i+="".concat(n),this.client.stackClient.fetchJSON("GET",i)}}]),n}();t.default=y},94158:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.extractAndMergeDocument=t.getCollectionFromSlice=t.getDocumentFromSlice=t.default=t.mergeDocumentsWithRelationships=void 0;var a=n(r(64512)),i=n(r(24350)),o=n(r(27361)),u=n(r(18446)),c=n(r(57557)),s=n(r(82492)),l=n(r(22853)),d=r(76305),f=r(71450),p=r(22249),h=r(98829);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var m=function(e,t){var r=t._type;if(!r)throw Error("Document without _type");if(!(0,h.properId)(t))throw Error("Document without id");var n=(0,o.default)(e,[r,(0,h.properId)(t)]);return(0,u.default)(n,t)?e:v(v({},e),{},(0,a.default)({},r,v(v({},e[r]),{},(0,a.default)({},(0,h.properId)(t),b(n,t)))))},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=v(v({},e),t);return(e.relationships||t.relationships)&&(r.relationships=v(v({},e.relationships),t.relationships)),r};t.mergeDocumentsWithRelationships=b;t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!(0,d.isReceivingData)(t)&&!(0,p.isReceivingMutationResult)(t))return e;if(t&&t.definition&&t.definition.mutationType===f.MutationTypes.DELETE_DOCUMENT){var r=t.definition.document._id,n=t.definition.document._type;return v(v({},e),{},(0,a.default)({},n,(0,c.default)(e[n],r)))}var i=t.response,o=i.data,u=i.included;if(!o||Array.isArray(o)&&0===o.length)return e;var s=u?u.reduce(m,e):e;return Array.isArray(o)?g(o,s):m(s,o)};t.getDocumentFromSlice=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(!t)throw Error("getDocumentFromSlice: Cannot retrieve document with undefined doctype");if(!r)throw Error("getDocumentFromSlice: Cannot retrieve document with undefined id");return e[t]?e[t][r]?e[t][r]:null:null};t.getCollectionFromSlice=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!t)throw Error("getDocumentFromSlice: Cannot retrieve document with undefined doctype");return e[t]?Object.values(e[t]):null};var g=function(e,t){var r=e[0]._type;if(!r)throw l.default.info("Document without _type",e[0]),Error("Document without _type");var n=(0,i.default)(e,h.properId),a=Object.assign({},t);return a[r]=Object.assign({},t[r]),Object.values(n).map(function(e){var t=(0,h.properId)(e);a[r][t]?a[r][t]=(0,s.default)({},a[r][t],e):a[r][t]=e}),a};t.extractAndMergeDocument=g},98829:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.properId=void 0;t.properId=function(e){return e.id||e._id}},65972:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"initQuery",{enumerable:!0,get:function(){return f.initQuery}}),Object.defineProperty(t,"loadQuery",{enumerable:!0,get:function(){return f.loadQuery}}),Object.defineProperty(t,"resetQuery",{enumerable:!0,get:function(){return f.resetQuery}}),Object.defineProperty(t,"receiveQueryResult",{enumerable:!0,get:function(){return f.receiveQueryResult}}),Object.defineProperty(t,"receiveQueryError",{enumerable:!0,get:function(){return f.receiveQueryError}}),Object.defineProperty(t,"executeQueryFromState",{enumerable:!0,get:function(){return f.executeQueryFromState}}),Object.defineProperty(t,"initMutation",{enumerable:!0,get:function(){return p.initMutation}}),Object.defineProperty(t,"receiveMutationResult",{enumerable:!0,get:function(){return p.receiveMutationResult}}),Object.defineProperty(t,"receiveMutationError",{enumerable:!0,get:function(){return p.receiveMutationError}}),Object.defineProperty(t,"getStateRoot",{enumerable:!0,get:function(){return h.getStateRoot}}),Object.defineProperty(t,"getCollectionFromState",{enumerable:!0,get:function(){return h.getCollectionFromState}}),Object.defineProperty(t,"getDocumentFromState",{enumerable:!0,get:function(){return h.getDocumentFromState}}),Object.defineProperty(t,"getQueryFromStore",{enumerable:!0,get:function(){return h.getQueryFromStore}}),Object.defineProperty(t,"getQueryFromState",{enumerable:!0,get:function(){return h.getQueryFromState}}),Object.defineProperty(t,"getRawQueryFromState",{enumerable:!0,get:function(){return h.getRawQueryFromState}}),Object.defineProperty(t,"isQueryExisting",{enumerable:!0,get:function(){return h.isQueryExisting}}),Object.defineProperty(t,"dispatchCreate",{enumerable:!0,get:function(){return y.dispatchCreate}}),Object.defineProperty(t,"dispatchUpdate",{enumerable:!0,get:function(){return y.dispatchUpdate}}),Object.defineProperty(t,"dispatchDelete",{enumerable:!0,get:function(){return y.dispatchDelete}}),t.resetState=t.createStore=t.default=t.StoreProxy=void 0;var i=a(r(64512)),o=a(r(65105)),u=a(r(19723)),c=a(r(71400)),s=r(5525),l=a(r(53894)),d=a(r(94158)),f=n(r(76305)),p=r(22249),h=r(76790),y=r(45330);function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach(function(t){(0,i.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var b="COZY_CLIENT.RESET_STATE";t.resetState=function(){return{type:b}};var g=function(){function e(t){(0,o.default)(this,e),this.state=t}return(0,u.default)(e,[{key:"readDocument",value:function(e,t){return this.state.documents[e][t]}},{key:"writeDocument",value:function(e){this.setState(function(t){return m(m({},t),{},{documents:m(m({},t.documents),{},(0,i.default)({},e._type,m(m({},t.documents[e._type]),{},(0,i.default)({},e._id,e))))})})}},{key:"setState",value:function(e){this.state=e(this.state)}},{key:"getState",value:function(){return this.state}}]),e}();t.StoreProxy=g;var k={documents:{},queries:{}},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;if(t.type==b)return k;if(!(0,f.isQueryAction)(t)&&!(0,p.isMutationAction)(t))return e;if(t.update){var r=new g(e);return t.update(r,t.response),{documents:r.getState().documents,queries:(0,f.default)(r.getState().queries,t,r.getState().documents)}}var n=(0,d.default)(e.documents,t),a=n!==e.documents;return{documents:n,queries:(0,f.default)(e.queries,t,n,a)}};t.default=O;var w=(0,c.default)("debug")&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||s.compose;t.createStore=function(){return(0,s.createStore)((0,s.combineReducers)({cozy:O}),w((0,s.applyMiddleware)(l.default)))}},22249:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.receiveMutationError=t.receiveMutationResult=t.initMutation=t.isReceivingMutationResult=t.isMutationAction=void 0;var a=n(r(64512));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var u="INIT_MUTATION",c="RECEIVE_MUTATION_RESULT",s="RECEIVE_MUTATION_ERROR";t.isMutationAction=function(e){return -1!==[u,c,s].indexOf(e.type)};t.isReceivingMutationResult=function(e){return e.type===c};t.initMutation=function(e,t){return{type:u,mutationId:e,definition:t}};t.receiveMutationResult=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return o(o({type:c,mutationId:e,response:t},r),{},{definition:n})};t.receiveMutationError=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{type:s,mutationId:e,error:t,definition:r}}},76305:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.QueryIDGenerator=t.getQueryFromSlice=t.resetQuery=t.receiveQueryError=t.receiveQueryResult=t.loadQuery=t.initQuery=t.default=t.updateData=t.makeSorterFromDefinition=t.executeQueryFromState=t.mergeSelectorAndPartialIndex=t.convert$gtNullSelectors=t.sortAndLimitDocsIds=t.isReceivingData=t.isQueryAction=void 0;var a=n(r(65105)),i=n(r(19723)),o=n(r(90402)),u=n(r(64512)),c=n(r(98235)),s=n(r(66604)),l=n(r(7739)),d=n(r(91966)),f=n(r(25325)),p=n(r(57043)),h=n(r(68630)),y=n(r(44908)),v=n(r(75472)),m=n(r(47037)),b=n(r(27361)),g=n(r(14328)),k=n(r(71400)),O=r(94158),w=r(22249),_=r(98829),S=r(71450),P=n(r(22853)),C=r(76790);function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach(function(t){(0,u.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var D="INIT_QUERY",j="LOAD_QUERY",A="RECEIVE_QUERY_RESULT",T="RECEIVE_QUERY_ERROR",I="RESET_QUERY",M=(0,k.default)("debug"),R=function(e){return -1!==[D,j,A,T,I].indexOf(e.type)};t.isQueryAction=R;t.isReceivingData=function(e){return e.type===A};var N={id:null,definition:null,fetchStatus:"pending",isFetching:null,lastFetch:null,lastUpdate:null,lastErrorUpdate:null,lastError:null,hasMore:!1,count:0,fetchedPagesCount:0,data:[],bookmark:null},F=function(e,t,r,n){var a,i=n.count,o=n.fetchedPagesCount,u=(0,c.default)(r);if(e.definition.sort&&t){var s=q(e.definition),l=t[e.definition.doctype];u=s(l?u.map(function(e){return l[e]}).filter(Boolean):[]).map(_.properId)}var d=e.definition.limit;return d&&(a=i<d?o>1?d*(o-1)+i:i:d*o,u=u.slice(0,a)),u};t.sortAndLimitDocsIds=F;var L=function(e,t,r,n){var a=n.count,i=n.fetchedPagesCount,o=(0,y.default)([].concat((0,c.default)(e.data),(0,c.default)(t.data.map(_.properId))));return F(e,r,o,{count:a,fetchedPagesCount:i})},B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;switch(t.type){case D:if(e.lastUpdate&&e.id===t.queryId&&e.definition===t.queryDefinition)return e;return E(E({},e),{},{id:t.queryId,definition:t.queryDefinition,options:t.options,fetchStatus:e.lastUpdate?e.fetchStatus:"pending"});case j:if("loading"===e.fetchStatus)return e;if("loaded"===e.fetchStatus&&t.backgroundFetching)return E(E({},e),{},{fetchStatus:"loaded",isFetching:!0});return E(E({},e),{},{fetchStatus:"loading"});case A:var n=t.response;if(!n.data)return E(E({},e),{},{fetchStatus:"loaded",isFetching:!t.backgroundFetching&&null,lastFetch:Date.now(),lastUpdate:Date.now()});var a=E({fetchStatus:"loaded",isFetching:!t.backgroundFetching&&null,lastFetch:Date.now(),lastUpdate:Date.now()},M&&{execution_stats:n.execution_stats});if(!Array.isArray(n.data))return E(E(E({},e),a),{},{hasMore:!1,count:1,data:[(0,_.properId)(n.data)]});var i=n.meta&&n.meta.count?n.meta.count:n.data.length;if(t.backgroundFetching)return E(E(E({},e),a),{},{bookmark:n.bookmark||null,hasMore:void 0!==n.next?n.next:e.hasMore,count:i,data:n.data.map(_.properId)});var o=e.fetchedPagesCount+1,u=L(e,n,r,{count:i,fetchedPagesCount:o});return E(E(E({},e),a),{},{bookmark:n.bookmark||null,hasMore:void 0!==n.next?n.next:e.hasMore,count:i,fetchedPagesCount:o,data:u});case T:return E(E({},e),{},{id:t.queryId,fetchStatus:"failed",isFetching:!t.backgroundFetching&&null,lastError:t.error,lastErrorUpdate:Date.now()});case I:return E(E({},N),{},{id:t.queryId,definition:e.definition,options:e.options});default:return e}},z=function e(t){for(var r={},n=0,a=Object.entries(t);n<a.length;n++){var i=(0,o.default)(a[n],2),u=i[0],c=i[1],s=(0,h.default)(c)?e(c):c;r["$gt"===u&&null===s?"$gtnull":u]=s}return r};t.convert$gtNullSelectors=z;var U=function(e){return E(E({},(0,b.default)(e,"selector")),(0,b.default)(e,"partialFilter"))};t.mergeSelectorAndPartialIndex=U;var G=function(e){if(e.selector||e.partialFilter){var t=U(e);return g.default.use({$gtnull:function(e,t){return!!t}}),(0,g.default)(z(t))}if(e.id){var r={_id:e.id};return(0,g.default)(r)}if(!e.ids)return null;else{var n={_id:{$in:e.ids}};return(0,g.default)(n)}};t.executeQueryFromState=function(e,t){var r=(0,C.getCollectionFromState)(e,t.doctype),n=!!t.id;if(!r)return{data:n?null:[]};var a=r.filter(Q(t));return n?{data:a.length>0?a[0]:null}:{data:q(t)(a)}};var Q=function(e){var t=e.doctype,r=G(e);return function(e){return e._type===t&&!e._deleted&&(!r||!!r(e))}},H=function(e){return function(t){var r=(0,b.default)(t,e);return(0,m.default)(r)?r.toLowerCase():r}},q=function(e){var t=e.sort;if(!t)return function(e){return e};if(!Array.isArray(e.sort))return P.default.warn("Correct update of queries with a sort that is not an array is not supported. Use an array as argument of QueryDefinition::sort"),function(e){return e};var r=t.map(function(e){return Object.entries(e)[0]}),n=r.map(function(e){return e[0]}).map(H),a=r.map(function(e){return e[1]});return function(e){return(0,v.default)(e,n,a)}};t.makeSorterFromDefinition=q;var J=function(e,t,r){var n=Q(e.definition),a=(0,s.default)((0,l.default)(t,n),function(e){return e.map(_.properId)}),i=a.true,o=void 0===i?[]:i,u=a.false,c=e.data,h=e.options&&e.options.autoUpdate,y=!h||!1!==h.remove,v=!h||!1!==h.add,m=!h||!1!==h.update,b=y?(0,f.default)(c,void 0===u?[]:u):[],g=v?(0,d.default)(o,c):[],k=m?(0,f.default)(c,o):[],O=b.length||g.length||k.length,w=(0,d.default)((0,p.default)(c,g),b),S=e.fetchedPagesCount,P=F(e,r,w,{count:w.length,fetchedPagesCount:S});return E(E({},e),{},{data:P,count:P.length,fetchedPagesCount:S,lastUpdate:O?Date.now():e.lastUpdate})};t.updateData=J;var Y=function(e,t){return function(r){var n=(0,b.default)(e,"response.data")||(0,b.default)(e,"definition.document");return n?(!Array.isArray(n)&&(n=[n]),n.length&&r.definition.doctype===n[0]._type)?J(r,n,t):r:r}};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(t.type==D){var a=B(e[t.queryId],t,r);return a===e[t.queryId]?e:E(E({},e),{},(0,u.default)({},t.queryId,a))}if(R(t)){var i=Y(t,r);return(0,s.default)(e,function(e){return e.id==t.queryId?B(e,t,r):n?i(e):e})}if((0,w.isReceivingMutationResult)(t)){var o,c,l=t.updateQueries?(o=t,c=r,function(e){var t=o.updateQueries,r=o.response,n=t[e.id];if(!n)return e;var a=n(K(c,e.definition.doctype,e.data),r).map(_.properId);return E(E({},e),{},{data:a,count:a.length,lastUpdate:Date.now()})}):Y(t,r);return(0,s.default)(e,l)}return e};t.initQuery=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t.doctype)throw Error("Cannot init query with no doctype");return{type:D,queryId:e,queryDefinition:t,options:r}};t.loadQuery=function(e,t){return E({type:j,queryId:e},t)};t.receiveQueryResult=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return E({type:A,queryId:e,response:t},r)};t.receiveQueryError=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return E({type:T,queryId:e,error:t},r)};t.resetQuery=function(e){return{type:I,queryId:e}};var K=function(e,t,r){return r.map(function(r){return(0,O.getDocumentFromSlice)(e,t,r)})};t.getQueryFromSlice=function(e,t,r){if(!e||!e[t])return E(E({},N),{},{id:t,data:null});var n=e[t];return r?E(E({},n),{},{data:K(r,n.definition.doctype,n.data)}):n};var V=function(){function e(){(0,a.default)(this,e),this.idCounter=1}return(0,i.default)(e,[{key:"generateRandomId",value:function(){var e=this.idCounter;return this.idCounter++,e.toString()}},{key:"generateId",value:function(e){if(!(0,S.isAGetByIdQuery)(e))return this.generateRandomId();var t=e.id,r=e.doctype;return"".concat(r,"/").concat(t)}}]),e}();t.QueryIDGenerator=V,V.UNNAMED="unnamed"},45330:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.dispatchDelete=t.dispatchUpdate=t.dispatchCreate=void 0;var a=n(r(64512)),i=r(71450),o=r(22249);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){(0,a.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var s=function(e,t,r,n){var a,i,u=(a=r,i=t,c({id:a._id,_type:i},a));e.dispatch((0,o.receiveMutationResult)(e.generateRandomId(),{data:u},{},n(u)))};t.dispatchCreate=function(e,t,r){s(e,t,r,i.Mutations.createDocument)};t.dispatchUpdate=function(e,t,r){s(e,t,r,i.Mutations.updateDocument)};t.dispatchDelete=function(e,t,r){s(e,t,c(c({},r),{},{_deleted:!0}),i.Mutations.deleteDocument)}},76790:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isQueryExisting=t.getRawQueryFromState=t.getQueryFromState=t.getQueryFromStore=t.getDocumentFromState=t.getCollectionFromState=t.getStateRoot=void 0;var n=r(94158),a=r(76305),i=function(e){return e.cozy||{}};t.getStateRoot=i;t.getCollectionFromState=function(e,t){return(0,n.getCollectionFromSlice)(i(e).documents,t)};t.getDocumentFromState=function(e,t,r){return(0,n.getDocumentFromSlice)(i(e).documents,t,r)};t.getQueryFromStore=function(e,t){return o(e.getState(),t)};var o=function(e,t){return(0,a.getQueryFromSlice)(i(e).queries,t,i(e).documents)};t.getQueryFromState=o;t.getRawQueryFromState=function(e,t){return(0,a.getQueryFromSlice)(i(e).queries,t)};t.isQueryExisting=function(e,t){return void 0!==i(e).queries[t]}},47064:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(68434)),i=n(r(64512)),o=n(r(80295)),u=n(r(82007));function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){(0,i.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var l="io.cozy.terms";function d(){return(d=(0,u.default)(a.default.mark(function e(t,r){var n,i,u,c,d,f;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.id,i=(0,o.default)(r,["id"]),e.next=3,t.query({doctype:l,selector:{termsId:n,version:i.version},limit:1});case 3:if(!((u=e.sent.data)&&u.length)){e.next=13;break}if(!((c=u[0]).termsId==n&&c.version==i.version&&c.url!=i.url)){e.next=11;break}return d=s(s({_type:l},c),{},{url:i.url}),e.next=11,t.save(d);case 11:e.next=16;break;case 13:return f=s(s({_type:l},i),{},{termsId:n,accepted:!0,acceptedAt:new Date}),e.next=16,t.save(f);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}t.default={save:function(e,t){return d.apply(this,arguments)}}},325:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.CozyClient=void 0;var a=n(r(25665)),i=n(r(27952)),o=n(r(12323)),u=n(r(65105)),c=function(e){(0,a.default)(c,e);var t,r,n=(t=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,o.default)(t);return e=r?Reflect.construct(n,arguments,(0,o.default)(this).constructor):n.apply(this,arguments),(0,i.default)(this,e)});function c(){return(0,u.default)(this,c),n.apply(this,arguments)}return c}(function e(t){(0,u.default)(this,e),Object.assign(this,t)});t.CozyClient=c},41315:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(71450);t.default={}},88930:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isReactNativeOfflineError=t.hasQueriesBeenLoaded=t.isQueriesLoading=t.hasQueryBeenLoaded=t.isQueryLoading=t.cancelable=void 0;var a=n(r(22853));t.cancelable=function(e){var t,r=new Promise(function(r,n){t=n,e.then(r),e.catch(n)});return r.cancel=function(){t({canceled:!0})},r};var i=function(e){return e?"loading"===e.fetchStatus||"pending"===e.fetchStatus:(a.default.warn("isQueryLoading called on falsy value."),!1)};t.isQueryLoading=i;var o=function(e){return e.lastFetch};t.hasQueryBeenLoaded=o;t.isQueriesLoading=function(e){return Object.values(e).some(function(e){return i(e)})};t.hasQueriesBeenLoaded=function(e){return Object.values(e).some(function(e){return o(e)})};t.isReactNativeOfflineError=function(e){return"Network request failed"===e.message}},43592:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(r(95297)),o=a(r(65105)),u=a(r(19723)),c=a(r(8997)),s=a(r(25665)),l=a(r(27952)),d=a(r(12323)),f=a(r(64512)),p=n(r(67294)),h=a(r(45697));t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(r){var n=r.displayName||r.name||"Component",a=function(a){(0,s.default)(m,a);var h,y,v=(h=m,y=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=(0,d.default)(h);return e=y?Reflect.construct(t,arguments,(0,d.default)(this).constructor):t.apply(this,arguments),(0,l.default)(this,e)});function m(r,a){var i;if((0,o.default)(this,m),i=v.call(this,r,a),(0,f.default)((0,c.default)(i),"mutate",function(){for(var r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];return i.client.mutate(e.apply(null,n),t)}),i.client=r.client||a.client,!i.client)throw Error('Could not find "client" in either the context or props of '.concat(n));return i}return(0,u.default)(m,[{key:"render",value:function(){var e=(0,f.default)({},t.name||"mutate",this.mutate);return p.default.createElement(r,(0,i.default)({},e,this.props))}}]),m}(p.Component);return(0,f.default)(a,"contextTypes",{client:h.default.object}),a.displayName="WithMutation(".concat(n,")"),a}}},18428:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(r(95297)),o=a(r(65105)),u=a(r(19723)),c=a(r(25665)),s=a(r(27952)),l=a(r(12323)),d=a(r(64512)),f=a(r(98235)),p=a(r(82492)),h=n(r(67294)),y=a(r(45697)),v=a(r(22853));function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}t.default=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){var r=e.displayName||e.name||"Component",n=function(n){(0,c.default)(g,n);var a,y,b=(a=g,y=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=(0,l.default)(a);return e=y?Reflect.construct(t,arguments,(0,l.default)(this).constructor):t.apply(this,arguments),(0,s.default)(this,e)});function g(e,n){(0,o.default)(this,g),c=b.call(this,e,n);var a,i,u,c,s=e.client||n.client;if(v.default.warn("Deprecation: withMutations will be removed in the near future, prefer to use withClient to access the client. See https://github.com/cozy/cozy-client/pull/638 for more information."),!s)throw Error('Could not find "client" in either the context or props of '.concat(r));return c.mutations=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach(function(t){(0,d.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({createDocument:s.create.bind(s),saveDocument:s.save.bind(s),deleteDocument:s.destroy.bind(s)},(a=t,i=s,u=e,p.default.apply(void 0,(0,f.default)(a.map(function(e){return"function"==typeof e?e(i,u):e}))))),c}return(0,u.default)(g,[{key:"render",value:function(){return h.default.createElement(e,(0,i.default)({},this.mutations,this.props))}}]),g}(h.Component);return(0,d.default)(n,"contextTypes",{client:y.default.object}),n.displayName="WithMutations(".concat(r,")"),n}}},8969:function(e,t,r){var n,a,i=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.startApp=t.default=t.checkApp=void 0;var o=i(r(68434)),u=i(r(82007)),c=r(54878),s=function(){return window.startApp},l=function(e){var t=e.appId,r=e.uri;return(0,c.isAndroidApp)()?{package:t}:r},d={};var f=d.startApp=(n=(0,u.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=window.startApp,e.next=3,d.checkApp(t);case 3:if(!e.sent){e.next=9;break}return n=l(t),e.abrupt("return",new Promise(function(e,t){if(!s()){t(Error("Cordova plugin 'com.lampa.startapp' is not installed. This plugin is needed to start a native app. Required by cozy-bar"));return}r.set(n).start(e,t)}));case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)});t.startApp=f;var p=d.checkApp=(a=(0,u.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=window.startApp,n=l(t),e.abrupt("return",new Promise(function(e,t){if(!s()){t(Error("Cordova plugin 'com.lampa.startapp' is not installed."));return}r.set(n).check(function(t){return e("OK"===t||t)},function(r){!1===r||0===r.indexOf("NameNotFoundException")?e(!1):t(r)})}));case 3:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)});t.checkApp=p;t.default=d},31555:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isCordova=void 0;t.isCordova=function(){return"undefined"!=typeof window&&void 0!==window.cordova}},34586:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.openDeeplinkOrRedirect=void 0;var r=function(e,t,r){var n=document.createElement("iframe");return n.src=t,n.id="hiddenIframe_".concat(r),n.style.display="none",e.appendChild(n),n},n=function(e,t){var n=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);window.addEventListener("blur",o);var a=r(document.body,"about:blank",n),i=setTimeout(function(){t(),window.removeEventListener("blur",o),a.parentElement.removeChild(a)},500);function o(){clearTimeout(i),window.removeEventListener("blur",o),a.parentElement.removeChild(a)}a.contentWindow.location.href=e},a=function(e,t){for(var r=setTimeout(function(){t(),n.removeEventListener("blur",a)},500),n=window;n!=n.parent;)n=n.parent;function a(){clearTimeout(r),n.removeEventListener("blur",a)}n.addEventListener("blur",a),window.location=e},i=function(e,t){navigator.msLaunchUri(e,void 0,t)},o=function(){var e=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t=navigator.userAgent.toLowerCase(),r=t.includes("safari")&&!t.includes("chrome")||Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,n=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,a=n&&(t.includes("os 12_2")||t.includes("os 12_3"));return{isOpera:e,isFirefox:void 0!==window.InstallTrigger,isSafari:r,isChrome:!!window.chrome&&!e,isIOS122:a,isIOS:n}};t.openDeeplinkOrRedirect=function(e,t){if(navigator.msLaunchUri)i(e,t);else{var r=o();r.isChrome||r.isIOS&&!r.isIOS122?a(e,t):r.isSafari&&!r.isIOS122||r.isFirefox?n(e,t):t()}}},26082:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getDeviceName=void 0;var a=n(r(48403)),i=r(31555),o=r(28715),u=r(54878),c="Device",s=function(e){for(var t=0,r=["iPhone","iPad","Watch","AppleTV"];t<r.length;t++){var n=r[t];if(e.match(new RegExp(n)))return n}return c};t.getDeviceName=function(){if(!(0,o.hasDevicePlugin)())return(0,i.isCordova)()&&console.warn("You should install `cordova-plugin-device`."),c;var e=window.device,t=e.manufacturer,r=e.model,n=(0,u.isIOSApp)()?s(r):r;return"".concat((0,a.default)(t)," ").concat(n)}},70574:function(e,t,r){var n,a,i=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.isFlagshipOfflineSupported=t.isFlagshipApp=t.getFlagshipMetadata=t.FlagshipRoutes=void 0;var o=i(r(33918));t.FlagshipRoutes=a,(n=a||(t.FlagshipRoutes=a={})).Home="home",n.Cozyapp="cozyapp",n.Authenticate="authenticate",n.Onboarding="onboarding",n.Stack="stack";var u=function(){return"undefined"!=typeof window?window:void(0,o.default)("error",'"window" is not defined. This means that getGlobalWindow() shouldn\'t have been called and investigation should be done to prevent this call')};t.getFlagshipMetadata=function(){var e,t,r;return null!==(e=null===(t=u())||void 0===t?void 0:null===(r=t.cozy)||void 0===r?void 0:r.flagship)&&void 0!==e?e:{}};t.isFlagshipApp=function(){var e,t;return(null===(e=u())||void 0===e?void 0:null===(t=e.cozy)||void 0===t?void 0:t.flagship)!==void 0};t.isFlagshipOfflineSupported=function(){var e,t,r;return null===(e=u())||void 0===e?void 0:null===(t=e.cozy)||void 0===t?void 0:null===(r=t.flagship)||void 0===r?void 0:r.offline_available}},25976:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"checkApp",{enumerable:!0,get:function(){return i.checkApp}}),Object.defineProperty(t,"getDeviceName",{enumerable:!0,get:function(){return a.getDeviceName}}),Object.defineProperty(t,"getFlagshipMetadata",{enumerable:!0,get:function(){return l.getFlagshipMetadata}}),Object.defineProperty(t,"getPlatform",{enumerable:!0,get:function(){return n.getPlatform}}),Object.defineProperty(t,"hasDevicePlugin",{enumerable:!0,get:function(){return o.hasDevicePlugin}}),Object.defineProperty(t,"hasInAppBrowserPlugin",{enumerable:!0,get:function(){return o.hasInAppBrowserPlugin}}),Object.defineProperty(t,"hasNetworkInformationPlugin",{enumerable:!0,get:function(){return o.hasNetworkInformationPlugin}}),Object.defineProperty(t,"hasSafariPlugin",{enumerable:!0,get:function(){return o.hasSafariPlugin}}),Object.defineProperty(t,"isAndroid",{enumerable:!0,get:function(){return n.isAndroid}}),Object.defineProperty(t,"isAndroidApp",{enumerable:!0,get:function(){return n.isAndroidApp}}),Object.defineProperty(t,"isCordova",{enumerable:!0,get:function(){return u.isCordova}}),Object.defineProperty(t,"isFlagshipApp",{enumerable:!0,get:function(){return l.isFlagshipApp}}),Object.defineProperty(t,"isFlagshipOfflineSupported",{enumerable:!0,get:function(){return l.isFlagshipOfflineSupported}}),Object.defineProperty(t,"isIOS",{enumerable:!0,get:function(){return n.isIOS}}),Object.defineProperty(t,"isIOSApp",{enumerable:!0,get:function(){return n.isIOSApp}}),Object.defineProperty(t,"isMobile",{enumerable:!0,get:function(){return n.isMobile}}),Object.defineProperty(t,"isMobileApp",{enumerable:!0,get:function(){return n.isMobileApp}}),Object.defineProperty(t,"isWebApp",{enumerable:!0,get:function(){return n.isWebApp}}),Object.defineProperty(t,"nativeLinkOpen",{enumerable:!0,get:function(){return c.nativeLinkOpen}}),Object.defineProperty(t,"openDeeplinkOrRedirect",{enumerable:!0,get:function(){return s.openDeeplinkOrRedirect}}),Object.defineProperty(t,"startApp",{enumerable:!0,get:function(){return i.startApp}});var n=r(54878),a=r(26082),i=r(8969),o=r(28715),u=r(31555),c=r(9526),s=r(34586),l=r(70574)},9526:function(e,t,r){var n,a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.nativeLinkOpen=void 0;var i=a(r(68434)),o=a(r(82007)),u=r(28715);var c=(n=(0,o.default)(i.default.mark(function e(t){var r,n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,e.next=3,(0,u.hasSafariPlugin)();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}e.t0=window.SafariViewController;case 6:if(!e.t0){e.next=10;break}window.SafariViewController.show({url:r,transition:"curl"},function(e){"closed"===e.event&&window.SafariViewController.hide()},function(){window.SafariViewController.hide()}),e.next=11;break;case 10:(0,u.hasInAppBrowserPlugin)()?(n="_blank",a="clearcache=yes,zoom=no",window.cordova.InAppBrowser.open(r,n,a)):window.location=r;case 11:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)});t.nativeLinkOpen=c},54878:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isWebApp=t.isMobileApp=t.isMobile=t.isIOSApp=t.isIOS=t.isAndroidApp=t.isAndroid=t.getPlatform=void 0;var n=r(31555),a=function(){return(0,n.isCordova)()?window.cordova.platformId:"web"};t.getPlatform=a;var i=function(e){return a()===e};t.isIOSApp=function(){return i("ios")};t.isAndroidApp=function(){return i("android")};t.isWebApp=function(){return i("web")};t.isMobileApp=function(){return(0,n.isCordova)()};var o=function(){return window.navigator.userAgent&&window.navigator.userAgent.indexOf("Android")>=0};t.isAndroid=o;var u=function(){return window.navigator.userAgent&&/iPad|iPhone|iPod/.test(window.navigator.userAgent)};t.isIOS=u;t.isMobile=function(){return o()||u()}},28715:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.hasSafariPlugin=t.hasNetworkInformationPlugin=t.hasInAppBrowserPlugin=t.hasDevicePlugin=void 0;var n=r(31555);t.hasDevicePlugin=function(){return(0,n.isCordova)()&&void 0!==window.device};t.hasInAppBrowserPlugin=function(){return(0,n.isCordova)()&&void 0!==window.cordova.InAppBrowser};t.hasSafariPlugin=function(){return new Promise(function(e){if(!(0,n.isCordova)()||void 0===window.SafariViewController){e(!1);return}window.SafariViewController.isAvailable(function(t){return e(t)})})};t.hasNetworkInformationPlugin=function(){return(0,n.isCordova)()&&void 0!==window.navigator.connection}},73221:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(65105)),i=n(r(19723)),o=n(r(25665)),u=n(r(27952)),c=n(r(12323)),s=n(r(67294)),l=n(r(36049)),d=n(r(24394)),f=function(e){var t=e.name,r=e.onChange;return s.default.createElement("input",{type:"checkbox",checked:(0,d.default)(t),onChange:function(e){return(0,d.default)(t,JSON.parse(e.target.checked))&&r&&r()}})},p=function(e){var t=e.children,r=e.onClick;return s.default.createElement("button",{type:"button",onClick:r,style:{position:"absolute",top:"100%",left:"0"}},t)},h=(0,l.default)(function(){var e=d.default.list();return s.default.createElement("div",null,e.map(function(e){return s.default.createElement("div",{key:e},e.replace(/[a-z][A-Z]/g,function(e){return e[0]+" "+e[1].toLowerCase()})," : ",s.default.createElement(f,{onChange:function(){},name:e}))}))}),y=function(e){(0,o.default)(l,e);var t,r,n=(t=l,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,c.default)(t);return e=r?Reflect.construct(n,arguments,(0,c.default)(this).constructor):n.apply(this,arguments),(0,u.default)(this,e)});function l(e){var t;return(0,a.default)(this,l),(t=n.call(this,e)).state={folded:!0},t}return(0,i.default)(l,[{key:"render",value:function(){var e,t=this;return(0,d.default)("switcher")&&s.default.createElement("div",{className:"flag-switcher",style:(e=this.state,{borderBottomLeftRadius:".5rem",padding:".5rem",position:"absolute",zIndex:1e3,color:"white",background:"rgba(74,68,90,0.85)",top:0,right:0,transform:"translateY(".concat(e.folded?"-100%":"0",")")})},s.default.createElement(p,{onClick:function(){return t.setState(function(e){return{folded:!e.folded}})}},this.state.folded?"Show":"Hide"," flags"),s.default.createElement("button",{onClick:function(){return t.setState({date:Date.now()})}},"refresh"),"\xa0",s.default.createElement("button",{onClick:function(){return d.default.reset()&&(0,d.default)("switcher",!0)&&t.forceUpdate()}},"reset"),s.default.createElement(h,null))}}]),l}(s.default.Component);t.default=y,y.List=h},36049:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(65105)),i=n(r(19723)),o=n(r(8997)),u=n(r(25665)),c=n(r(27952)),s=n(r(12323)),l=n(r(64512)),d=n(r(67294)),f=n(r(24394)),p=f.default.store;t.default=function(e){var t,r=function(t){(0,u.default)(h,t);var r,n,f=(r=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(r);return e=n?Reflect.construct(t,arguments,(0,s.default)(this).constructor):t.apply(this,arguments),(0,c.default)(this,e)});function h(){var e;(0,a.default)(this,h);for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return e=f.call.apply(f,[this].concat(r)),(0,l.default)((0,o.default)(e),"handleChange",function(){e.forceUpdate()}),e}return(0,i.default)(h,[{key:"componentDidMount",value:function(){p.on("change",this.handleChange)}},{key:"componentWillUnmount",value:function(){p.removeListener("change",this.handleChange)}},{key:"render",value:function(){return d.default.createElement(e,this.props)}}]),h}(d.default.Component);return(0,l.default)(r,"displayName",void 0),r.displayName="withFlags(".concat(null!==(t=e.displayName)&&void 0!==t?t:e.name,")"),r}},24394:function(e,t,r){var n,a,i,o=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.resetFlags=t.listFlags=t.initializeFromRemote=t.initializeFromDOM=t.initialize=t.getTemplateData=t.enable=t.default=void 0;var u=o(r(68434)),c=o(r(65105)),s=o(r(19723)),l=o(r(82007)),d=o(r(90402)),f=r(71450),p=o(r(10916));function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var y=new p.default,v=function(e,t){return 1==arguments.length?y.get(e):(y.set(e,t),t)},m=function(){return y.keys().sort()};t.listFlags=m;var b=function(){m().forEach(function(e){return y.remove(e)})};t.resetFlags=b;var g=function(e){if(Array.isArray(e)){if(0===e.length)return;console.log("flags.enable: Deprecation warning: prefer to use an object { flag1: true, flag2: true } instead of an array when using flags.enable"),t=e.map(function(e){return[e,!0]})}else"object"==typeof e&&(t=Object.entries(e));if(!!t){var t,r,n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}}(e))){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=r.return&&r.return()}finally{if(u)throw i}}}}(t);try{for(n.s();!(r=n.n()).done;){var a=(0,d.default)(r.value,2),i=a[0],o=a[1];v(i,o)}}catch(e){n.e(e)}finally{n.f()}}};t.enable=g;var k=(n=(0,l.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query((0,f.Q)("io.cozy.settings").getById("io.cozy.settings.flags"));case 2:g(e.sent.data.attributes);case 5:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)});t.initializeFromRemote=k;var O=function(e){if("undefined"==typeof document)return null;var t,r=document.querySelector("[data-cozy]"),n=document.querySelector("[data-cozy-".concat(e,"]"));try{if(r)return JSON.parse(r.dataset.cozy)[e];if(!n)return null;else{;return console.warn('Prefer to use [data-cozy] to store template data. <div data-cozy="{{.CozyData}}></div>. "'),JSON.parse(n.dataset["cozy".concat((t=e)[0].toUpperCase()+t.slice(1))])}}catch(e){return null}};t.getTemplateData=O;var w=(a=(0,l.default)(u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=O("flags")){e.next=3;break}return e.abrupt("return",!1);case 3:return g(t),e.abrupt("return",!0);case 5:case"end":return e.stop()}},e)})),function(){return a.apply(this,arguments)});t.initializeFromDOM=w;var _=(i=(0,l.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:if(!1!=e.sent){e.next=6;break}return e.next=6,k(t);case 6:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)});t.initialize=_;var S=function(){var e,t,r;function n(e){(0,c.default)(this,n),this.client=e,this.handleLogin=this.handleLogin.bind(this),this.handleLogout=this.handleLogout.bind(this),this.client.on("login",this.handleLogin),this.client.on("logout",this.handleLogout),this.setupInitializing(),e.isLogged&&this.handleLogin()}return(0,s.default)(n,[{key:"refresh",value:(e=(0,l.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.initializeFromRemote(this.client);case 2:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"setupInitializing",value:function(){var e=this;this.initializing=new Promise(function(t){e.resolveInitializing=t})}},{key:"handleLogin",value:(t=(0,l.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.initialize(this.client);case 2:this.resolveInitializing(),this.client.emit("plugin:flag:login");case 4:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"handleLogout",value:(r=(0,l.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:v.reset(),this.setupInitializing(),this.client.emit("plugin:flag:logout");case 3:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})}]),n}();S.pluginName="flags",v.store=y,v.list=m,v.reset=b,v.enable=g,v.initializeFromRemote=k,v.initializeFromDOM=w,v.initialize=_,v.plugin=S;t.default=v},71400:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(73221)),i=n(r(36049)),o=n(r(24394)),u=n(r(99975));o.default.connect=i.default,o.default.FlagSwitcher=a.default,o.default.useFlag=u.default,"undefined"!=typeof __ENABLED_FLAGS__&&o.default.enable(__ENABLED_FLAGS__);var c=o.default;t.default=c},6465:function(e,t){function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){c=!0,o=e},f:function(){try{!u&&null!=r.return&&r.return()}finally{if(c)throw o}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.prefix=t.getKey=t.default=void 0;function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var a="flag__";t.prefix=a;var i=function(e){return a+e};t.getKey=i;var o=function(){return Object.keys(localStorage).filter(function(e){return 0===e.indexOf(a)}).map(function(e){return e.replace(a,"")})},u=function(e){var t=localStorage.getItem(i(e));return t?JSON.parse(t):t},c=function(e){return localStorage.removeItem(i(e))};t.default={getAll:function(){var e={},t,n=r(o());try{for(n.s();!(t=n.n()).done;){var a=t.value;e[a]=u(a)}}catch(e){n.e(e)}finally{n.f()}return e},getItem:u,setItem:function(e,t){var r=JSON.stringify(t);return localStorage.setItem(i(e),r)},clearAll:function(){var e,t=r(o());try{for(t.s();!(e=t.n()).done;){var n=e.value;c(n)}}catch(e){t.e(e)}finally{t.f()}},removeItem:c}},10916:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(90402)),i=n(r(65105)),o=n(r(19723)),u=n(r(37203)),c=n(r(6465)),s=function(){function e(){(0,i.default)(this,e),this.store={},"undefined"!=typeof localStorage&&(this.longtermStore=c.default),this.restore()}return(0,o.default)(e,[{key:"restore",value:function(){if(!!this.longtermStore)for(var e=this.longtermStore.getAll(),t=0,r=Object.entries(e);t<r.length;t++){var n=(0,a.default)(r[t],2),i=n[0],o=n[1];this.store[i]=o,this.emit("change",i)}}},{key:"keys",value:function(){return Object.keys(this.store)}},{key:"get",value:function(e){if(this.store.hasOwnProperty(e))return this.store[e];if("string"==typeof e){for(var t=e.split("."),r=t.length,n=r-1;n>0;n--){var a=t.slice(0,n).join(".");if(this.store.hasOwnProperty(a))return t.slice(n,r).reduce(function(e,t){return e&&e.hasOwnProperty(t)?e[t]:null},this.store[a])}}return null}},{key:"set",value:function(e,t){this.longtermStore&&this.longtermStore.setItem(e,t),this.store[e]=t,this.emit("change",e)}},{key:"remove",value:function(e){delete this.store[e],this.longtermStore&&this.longtermStore.removeItem(e),this.emit("change",e)}}]),e}();u.default.mixin(s);t.default=s},99975:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=(0,i.useState)((0,o.default)(e)),r=(0,a.default)(t,2),n=r[0],u=r[1];return(0,i.useEffect)(function(){var t=function(t){t===e&&u((0,o.default)(e))};return o.default.store.on("change",t),function(){o.default.store.removeListener("change",t)}},[u,e]),n};var a=n(r(90402)),i=r(67294),o=n(r(24394))},46553:function(e){var t=function(e){return Object.assign(this,e),this};t.prototype.toString=function(){throw Error("Cannot convert Secret to string")},e.exports=t},33918:function(e,t,r){var n=r(34155);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var i=r(46553),o=r(87593),u=o.filterLevel,c=o.filterSecrets,s=n.env.LOG_LEVEL||"debug",l=r(36865),d=[u,c],f=function(){var e,t=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){c=!0,o=e},f:function(){try{!u&&null!=r.return&&r.return()}finally{if(c)throw o}}}}(d);try{for(t.s();!(e=t.n()).done;){var r=e.value;if(!1===r.apply(null,arguments))return!0}}catch(e){t.e(e)}finally{t.f()}return!1};function p(e,t,r,n){if(!f(s,e,t,r,n))console.log(l(e,t,r,n))}p.addFilter=function(e){return d.push(e)},p.setLevel=function(e){s=e};["debug","info","warn","error","ok","critical"].forEach(function(e){p[e]=function(t,r,n){return p(e,t,r,n)}}),e.exports=p,p.setNoRetry=function(e){return e?e.no_retry=!0:e={no_retry:!0},e.no_retry},p.Secret=i,p.namespace=function(e){return function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e;p(t,r,n,a)}}},87593:function(e,t,r){var n={secret:0,debug:10,info:20,warn:30,error:40,ok:50,critical:50},a=r(46553);e.exports={filterSecrets:function(e,t,r){if("secret"!==t&&r instanceof a)throw Error("You should log a secret with log.secret")},filterLevel:function(e,t){return n[t]>=n[e]}}},36865:function(e,t,r){var n=r(62481),a=r(62481);e.exports=a},62481:function(e,t,r){var n=r(64530);e.exports=function(e,t,r,a){var i={time:new Date,type:e,label:r,namespace:a};"object"==typeof t?(t&&t.no_retry&&(i.no_retry=t.no_retry),t&&t.message&&(i.message=t.message)):i.message=t,i.message&&i.message.stack&&(i.message=i.message.stack);var o=i;try{o=n(i).substr(0,65535)}catch(e){console.log(e.message,"cozy-logger: Failed to convert message to JSON")}return o}},7756:function(e,t,r){var n=r(26465),a={debug:1,info:2,warn:3,error:4};function i(){this.enabled=!0,this.defaultResult=!0,this.clear()}function o(e,t){return e.n.test?e.n.test(t):e.n==t}n.mixin(i),i.prototype.allow=function(e,t){return this._white.push({n:e,l:a[t]}),this},i.prototype.deny=function(e,t){return this._black.push({n:e,l:a[t]}),this},i.prototype.clear=function(){return this._white=[],this._black=[],this},i.prototype.test=function(e,t){var r,n=Math.max(this._white.length,this._black.length);for(r=0;r<n;r++){if(this._white[r]&&o(this._white[r],e)&&a[t]>=this._white[r].l)return!0;if(this._black[r]&&o(this._black[r],e)&&a[t]<=this._black[r].l)return!1}return this.defaultResult},i.prototype.write=function(e,t,r){if(!this.enabled||this.test(e,t))return this.emit("item",e,t,r)},e.exports=i},94731:function(e,t,r){var n=r(26465),a=r(7756),i=new n,o=Array.prototype.slice;(t=e.exports=function(e){var r=function t(){return i.write(e,void 0,o.call(arguments)),t};return r.debug=function(){return i.write(e,"debug",o.call(arguments)),r},r.info=function(){return i.write(e,"info",o.call(arguments)),r},r.warn=function(){return i.write(e,"warn",o.call(arguments)),r},r.error=function(){return i.write(e,"error",o.call(arguments)),r},r.group=function(){return i.write(e,"group",o.call(arguments)),r},r.groupEnd=function(){return i.write(e,"groupEnd",o.call(arguments)),r},r.log=r.debug,r.suggest=t.suggest,r.format=i.format,r}).defaultBackend=t.defaultFormatter=null,t.pipe=function(e){return i.pipe(e)},t.end=t.unpipe=t.disable=function(e){return i.unpipe(e)},t.Transform=n,t.Filter=a,t.suggest=new a,t.enable=function(){return t.defaultFormatter?i.pipe(t.suggest).pipe(t.defaultFormatter).pipe(t.defaultBackend):i.pipe(t.suggest).pipe(t.defaultBackend)}},26465:function(e,t,r){function n(){}r(37203).mixin(n),n.prototype.write=function(e,t,r){this.emit("item",e,t,r)},n.prototype.end=function(){this.emit("end"),this.removeAllListeners()},n.prototype.pipe=function(e){var t=this;function r(){e.write.apply(e,Array.prototype.slice.call(arguments))}function n(){e._isStdio||e.end()}return t.emit("unpipe",e),e.emit("pipe",t),t.on("item",r),t.on("end",n),t.when("unpipe",function(a){var i=a===e||void 0===a;return i&&(t.removeListener("item",r),t.removeListener("end",n),e.emit("unpipe")),i}),e},n.prototype.unpipe=function(e){return this.emit("unpipe",e),this},n.prototype.format=function(){throw Error("Warning: .format() is deprecated in Minilog v2! Use .pipe() instead. For example:\nvar Minilog = require('minilog');\nMinilog\n  .pipe(Minilog.backends.console.formatClean)\n  .pipe(Minilog.backends.console);")},n.mixin=function(e){var t,r=n.prototype;for(t in r)r.hasOwnProperty(t)&&(e.prototype[t]=r[t])},e.exports=n},93601:function(e,t,r){var n=r(26465),a=[],i=new n;i.write=function(e,t,r){a.push([e,t,r])},i.get=function(){return a},i.empty=function(){a=[]},e.exports=i},90115:function(e,t,r){var n=r(26465),a=/\n+$/,i=new n;i.write=function(e,t,r){var n=r.length-1;if("undefined"!=typeof console&&!!console.log){if(console.log.apply)return console.log.apply(console,[e,t].concat(r));if(JSON&&JSON.stringify){r[n]&&"string"==typeof r[n]&&(r[n]=r[n].replace(a,""));try{for(n=0;n<r.length;n++)r[n]=JSON.stringify(r[n])}catch(e){}console.log(r.join(" "))}}},i.formatters=["color","minilog"],i.color=r(82035),i.minilog=r(26687),e.exports=i},82035:function(e,t,r){var n=r(26465),a=r(20477),i={debug:["cyan"],info:["purple"],warn:["yellow",!0],error:["red",!0]},o=new n;o.write=function(e,t,r){var n=console.log;console[t]&&console[t].apply&&(n=console[t]).apply(console,["%c"+e+" %c"+t,a("gray"),a.apply(a,i[t])].concat(r))},o.pipe=function(){},e.exports=o},26687:function(e,t,r){var n=r(26465),a=r(20477),i={debug:["gray"],info:["purple"],warn:["yellow",!0],error:["red",!0]},o=new n;o.write=function(e,t,r){var n=console.log;"debug"!=t&&console[t]&&(n=console[t]);var o=0;if("info"!=t){for(;o<r.length&&"string"==typeof r[o];o++);n.apply(console,["%c"+e+" "+r.slice(0,o).join(" "),a.apply(a,i[t])].concat(r.slice(o)))}else n.apply(console,["%c"+e,a.apply(a,i[t])].concat(r))},o.pipe=function(){},e.exports=o},20477:function(e){var t={black:"#000",red:"#c23621",green:"#25bc26",yellow:"#bbbb00",blue:"#492ee1",magenta:"#d338d3",cyan:"#33bbc8",gray:"#808080",purple:"#708"};e.exports=function(e,r){return r?"color: #fff; background: "+t[e]+";":"color: "+t[e]+";"}},74450:function(e,t,r){var n=r(94731),a=n.enable,i=n.disable,o="undefined"!=typeof navigator&&/chrome/i.test(navigator.userAgent),u="undefined"!=typeof navigator&&"ReactNative"===navigator.product,c=r(90115);if(n.defaultBackend=o||u?c.minilog:c,"undefined"!=typeof window){try{n.enable(JSON.parse(window.localStorage.minilogSettings))}catch(e){}if(window.location&&window.location.search){var s=RegExp("[?&]minilog=([^&]*)").exec(window.location.search);s&&n.enable(decodeURIComponent(s[1]))}}n.enable=function(){a.call(n,!0);try{window.localStorage.minilogSettings=JSON.stringify(!0)}catch(e){}return this},n.disable=function(){i.call(n);try{delete window.localStorage.minilogSettings}catch(e){}return this},(t=e.exports=n).backends={array:r(93601),browser:n.defaultBackend,localStorage:r(19377),jQuery:r(85791)}},85791:function(e,t,r){var n=r(26465),a=new Date().valueOf().toString(36);function i(e){this.url=e.url||"",this.cache=[],this.timer=null,this.interval=e.interval||3e4,this.enabled=!0,this.jQuery=window.jQuery,this.extras={}}n.mixin(i),i.prototype.write=function(e,t,r){!this.timer&&this.init(),this.cache.push([e,t].concat(r))},i.prototype.init=function(){if(this.enabled&&this.jQuery){var e=this;this.timer=setTimeout(function(){var t,r,n=[],i=e.url;if(0==e.cache.length)return e.init();for(t=0;t<e.cache.length;t++)try{JSON.stringify(e.cache[t]),n.push(e.cache[t])}catch(e){}e.jQuery.isEmptyObject(e.extras)?(r=JSON.stringify({logs:n}),i=e.url+"?client_id="+a):r=JSON.stringify(e.jQuery.extend({logs:n},e.extras)),e.jQuery.ajax(i,{type:"POST",cache:!1,processData:!1,data:r,contentType:"application/json",timeout:1e4}).success(function(t){t.interval&&(e.interval=Math.max(1e3,t.interval))}).error(function(){e.interval=3e4}).always(function(){e.init()}),e.cache=[]},this.interval)}},i.prototype.end=function(){},i.jQueryWait=function(e){if("undefined"!=typeof window&&(window.jQuery||window.$))return e(window.jQuery||window.$);"undefined"!=typeof window&&setTimeout(function(){i.jQueryWait(e)},200)},e.exports=i},19377:function(e,t,r){var n=r(26465),a=!1,i=new n;i.write=function(e,t,r){if("undefined"!=typeof window&&"undefined"!=typeof JSON&&JSON.stringify&&JSON.parse)try{!a&&(a=window.localStorage.minilog?JSON.parse(window.localStorage.minilog):[]),a.push([new Date().toString(),e,t,r]),window.localStorage.minilog=JSON.stringify(a)}catch(e){}},e.exports=i},88928:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(65105)),i=n(r(19723)),o=function(){function e(t){(0,a.default)(this,e);var r=t;"string"==typeof r&&(r=JSON.parse(r)),this.tokenType=r.token_type||r.tokenType,this.accessToken=r.access_token||r.accessToken,this.refreshToken=r.refresh_token||r.refreshToken,this.scope=r.scope}return(0,i.default)(e,[{key:"toAuthHeader",value:function(){return"Bearer "+this.accessToken}},{key:"toBasicAuth",value:function(){return"user:".concat(this.accessToken,"@")}},{key:"toJSON",value:function(){return{tokenType:this.tokenType,accessToken:this.accessToken,refreshToken:this.refreshToken,scope:this.scope}}},{key:"toString",value:function(){return JSON.stringify(this.toJSON())}},{key:"getAccessToken",value:function(){return this.accessToken}}]),e}();t.default=o},14324:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.normalizeApp=t.APPS_DOCTYPE=void 0;var i=a(r(68434)),o=a(r(82007)),u=a(r(65105)),c=a(r(19723)),s=a(r(25665)),l=a(r(27952)),d=a(r(12323)),f=a(r(64512)),p=a(r(27361)),h=r(10513),y=a(r(78140)),v=n(r(67267));r(45051);var m=a(r(79271));function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){(0,f.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var O="io.cozy.apps";t.APPS_DOCTYPE=O;var w=function(e,t){return k(k(k(k({},e.attributes),e),(0,v.normalizeDoc)(e,t)),{},{id:e.id})};t.normalizeApp=w;var _=function(e){(0,s.default)(_,e);var t,r,n,a,f,v,g,k=(t=_,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,d.default)(t);return e=r?Reflect.construct(n,arguments,(0,d.default)(this).constructor):n.apply(this,arguments),(0,l.default)(this,e)});function _(e){var t;return(0,u.default)(this,_),(t=k.call(this,O,e)).endpoint="/apps/",t}return(0,c.default)(_,[{key:"get",value:(n=(0,o.default)(i.default.mark(function e(t,r){var n,a,o,u,c,s,l,d,f=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.indexOf("/")>-1?n=t.split("/")[1]:(m.default.warn("Deprecated: in next versions of cozy-client, it will not be possible to query apps/konnectors only with id, please use the form ".concat(this.doctype,"/").concat(t,"\n\n- Q('io.cozy.apps').getById('banks')\n+ Q('io.cozy.apps').getById('io.cozy.apps/banks')")),n=t),!(r&&r.sources&&(!Array.isArray(r.sources)||0===r.sources.length))){e.next=3;break}throw Error('Invalid "sources" attribute passed in query, please use an array with at least one element.');case 3:a=(0,p.default)(r,"sources",["stack"]),o={stack:function(){return y.default.get(f.stackClient,"".concat(f.endpoint).concat(encodeURIComponent(n)),{normalize:function(e){return w(e,f.doctype)}})},registry:function(){return f.stackClient.fetchJSON("GET",h.registryEndpoint+n)}},u=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return b(e,t)}}(e))){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(a),e.prev=6,u.s();case 8:if((c=u.n()).done){e.next=27;break}return s=c.value,e.prev=10,e.next=13,o[s]();case 13:if(l=e.sent,!("registry"!==s)){e.next=16;break}return e.abrupt("return",l);case 16:return m.default.warn("The use of source registry is deprecated since it can polute the io.cozy.apps slice. For exemple, if we request data from the registry, than the app will be present in the io.cozy.apps slice and then the isInstalled() will return true.\n\n            Use Q('io.cozy.apps_registry) instead"),d=(0,h.transformRegistryFormatToStackFormat)(l),e.abrupt("return",{data:w(d,this.doctype)});case 21:if(e.prev=21,e.t0=e.catch(10),s!==a[a.length-1]){e.next=25;break}throw e.t0;case 25:e.next=8;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(6),u.e(e.t1);case 32:return e.prev=32,u.f(),e.finish(32);case 35:case"end":return e.stop()}},e,this,[[6,29,32,35],[10,21]])})),function(e,t){return n.apply(this,arguments)})},{key:"all",value:(a=(0,o.default)(i.default.mark(function e(){var t,r=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",this.endpoint);case 2:return t=e.sent,e.abrupt("return",{data:t.data.map(function(e){return w(e,r.doctype)}),meta:{count:t.meta.count},skip:0,next:!1});case 4:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"create",value:(f=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("create() method is not available for applications");case 1:case"end":return e.stop()}},e)})),function(){return f.apply(this,arguments)})},{key:"update",value:(v=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("update() method is not available for applications");case 1:case"end":return e.stop()}},e)})),function(){return v.apply(this,arguments)})},{key:"destroy",value:(g=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("destroy() method is not available for applications");case 1:case"end":return e.stop()}},e)})),function(){return g.apply(this,arguments)})}]),_}(v.default);_.normalizeDoctype=v.default.normalizeDoctypeJsonApi;t.default=_},20576:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(65105)),i=n(r(19723)),o=function(){function e(t){(0,a.default)(this,e),this.token=t||""}return(0,i.default)(e,[{key:"toAuthHeader",value:function(){return"Bearer "+this.token}},{key:"toBasicAuth",value:function(){return"user:".concat(this.token,"@")}},{key:"getAccessToken",value:function(){return this.token}}]),e}();t.default=o},69736:function(e,t,r){var n,a=r(14746),i=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.normalizeAppFromRegistry=t.APPS_REGISTRY_DOCTYPE=void 0;var o=i(r(65105)),u=i(r(19723)),c=i(r(25665)),s=i(r(27952)),l=i(r(12323)),d=i(r(68434)),f=i(r(82007)),p=i(r(64512)),h=a(r(67267));function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){(0,p.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var m="io.cozy.apps_registry";t.APPS_REGISTRY_DOCTYPE=m;var b=function(e,t){var r,n="".concat("webapp"===e.type?"io.cozy.apps":"io.cozy.konnectors","/").concat(e.slug),a=v(v({},e.attributes),null===(r=e.latest_version)||void 0===r?void 0:r.manifest);return v({},(0,h.normalizeDoc)(v(v({},e),{},{attributes:a,id:n,_id:n}),t))};t.normalizeAppFromRegistry=b;var g=(n=(0,f.default)(d.default.mark(function e(t,r,n){var a;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.fetchJSON("GET","/registry?versionsChannel=".concat(t,"&filter[type]=konnector&limit=500"));case 2:return a=e.sent,e.abrupt("return",{data:a.data.map(function(e){return b(e,r)})});case 4:case"end":return e.stop()}},e)})),function(e,t,r){return n.apply(this,arguments)}),k=function(e){(0,c.default)(h,e);var t,r,n,a,i,p=(t=h,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,l.default)(t);return e=r?Reflect.construct(n,arguments,(0,l.default)(this).constructor):n.apply(this,arguments),(0,s.default)(this,e)});function h(e){var t;return(0,o.default)(this,h),(t=p.call(this,m,e)).endpoint="/registry/",t}return(0,u.default)(h,[{key:"get",value:(n=(0,f.default)(d.default.mark(function e(t){var r,n,a=this;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.startsWith("konnectors/")){e.next=3;break}return r=t.split("/")[1],e.abrupt("return",g(r,this.doctype,this.stackClient));case 3:return e.next=5,this.stackClient.fetchJSON("GET","".concat(this.endpoint).concat(t));case 5:if(n=e.sent,"maintenance"!==t){e.next=8;break}return e.abrupt("return",{data:n.map(function(e){return b(e,a.doctype)})});case 8:return e.abrupt("return",{data:b(n,this.doctype)});case 9:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"create",value:(a=(0,f.default)(d.default.mark(function e(){return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("create() method is not available for AppsRegistryCollection");case 1:case"end":return e.stop()}},e)})),function(){return a.apply(this,arguments)})},{key:"destroy",value:(i=(0,f.default)(d.default.mark(function e(){return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("destroy() method is not available for AppsRegistryCollection");case 1:case"end":return e.stop()}},e)})),function(){return i.apply(this,arguments)})}]),h}(h.default);t.default=k},78140:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Collection=t.isDocumentUpdateConflict=t.isNoUsableIndexError=t.isIndexNotUsedWarning=t.isIndexConflictError=t.isIndexNotFoundError=t.dontThrowNotFoundError=void 0;var a=n(r(68434)),i=n(r(82007)),o=n(r(65105)),u=n(r(19723));r(79312);var c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e.message.match(/not_found/))return Array.isArray(t)?{data:t,meta:{count:0},skip:0,next:!1}:{data:t};throw e};t.dontThrowNotFoundError=c;t.isIndexNotFoundError=function(e){return e.message.match(/no_index/)};t.isIndexConflictError=function(e){return e.message.match(/error_saving_ddoc/)};t.isIndexNotUsedWarning=function(e){return e.match(/was not used because it does not contain a valid index for this query/)};t.isNoUsableIndexError=function(e){return e.message.match(/no_usable_index/)};t.isDocumentUpdateConflict=function(e){return e.message.match(/Document update conflict/)};var s=function(){var e;function t(){(0,o.default)(this,t)}return(0,u.default)(t,null,[{key:"get",value:(e=(0,i.default)(a.default.mark(function e(t,r,n){var i,o,u,s,l;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=void 0===(i=n.normalize)?function(e,t){return e}:i,s=void 0===(u=n.method)?"GET":u,e.prev=1,e.next=4,t.fetchJSON(s,r);case 4:return l=e.sent,e.abrupt("return",{data:o(l.data,l)});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",c(e.t0,null));case 11:case"end":return e.stop()}},e,null,[[1,8]])})),function(t,r,n){return e.apply(this,arguments)})}]),t}();t.Collection=s;t.default=s},25454:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.CONTACTS_DOCTYPE=void 0;var i=a(r(68434)),o=a(r(82007)),u=a(r(65105)),c=a(r(19723)),s=a(r(59655)),l=a(r(25665)),d=a(r(27952)),f=a(r(12323)),p=a(r(64512)),h=n(r(67267));r(41315);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){(0,p.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var m=function(e){(0,l.default)(m,e);var t,r,n,a,p,y=(t=m,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,f.default)(t);return e=r?Reflect.construct(n,arguments,(0,f.default)(this).constructor):n.apply(this,arguments),(0,d.default)(this,e)});function m(){return(0,u.default)(this,m),y.apply(this,arguments)}return(0,c.default)(m,[{key:"find",value:(n=(0,o.default)(i.default.mark(function e(t,r){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(void 0!==t&&1===Object.values(t).length&&!0==t.me)){e.next=4;break}return e.abrupt("return",this.findMyself());case 4:return e.abrupt("return",(0,s.default)((0,f.default)(m.prototype),"find",this).call(this,t,r));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"findMyself",value:(a=(0,o.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST","/contacts/myself");case 2:var r;return t={data:[(r=e.sent,v(v(v({},(0,h.normalizeDoc)(r.data,b)),r.data.attributes),{},{_rev:r.data.meta.rev}))],next:!1,meta:null,bookmark:!1},e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"destroy",value:(p=(0,o.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object.keys((null==t?void 0:null===(r=t.cozyMetadata)||void 0===r?void 0:r.sync)||{}).length>0)){e.next=6;break}return e.abrupt("return",(0,s.default)((0,f.default)(m.prototype),"update",this).call(this,v(v({},t),{},{trashed:!0})));case 6:return e.abrupt("return",(0,s.default)((0,f.default)(m.prototype),"destroy",this).call(this,t));case 7:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})}]),m}(h.default),b="io.cozy.contacts";t.CONTACTS_DOCTYPE=b;t.default=m},29328:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(r(68434)),o=a(r(82007)),u=a(r(64512)),c=a(r(65105)),s=a(r(19723)),l=a(r(50361)),d=n(r(14324)),f=a(r(20576));a(r(88928));var p=a(r(67267)),h=a(r(49129)),y=n(r(54056)),v=n(r(76812)),m=a(r(67207)),b=a(r(96302)),g=n(r(54026)),k=n(r(96727)),O=n(r(45082)),w=n(r(54348)),_=n(r(86247)),S=n(r(25454)),P=n(r(69736)),C=a(r(79954)),x=a(r(66605)),E=r(38558),D=a(r(37203)),j=n(r(45051)),A=a(r(79271)),T=a(r(20368)),I=r(68512);function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach(function(t){(0,u.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var N=function(e){var t=e;if(null===t)return null;for(;"/"===t[t.length-1];)t=t.slice(0,-1);return t},F=function(){var e,t,n,a;function u(e){(0,c.default)(this,u);var t=R({},e),r=t.token,n=t.uri;this.options=t,this.setUri(void 0===n?"":n),this.setToken(r),this.konnectors=new v.default(this),this.jobs=new y.default(this),this._promiseCache=new T.default}return(0,s.default)(u,[{key:"isRevocationError",value:function(e){return(null==e?!!void 0:!!e.message)&&(!!(j.default.CLIENT_NOT_FOUND.test(e.message)||j.default.UNREGISTERED_CLIENT.test(e.message))||void 0)}},{key:"collection",value:function(e){if(!e)throw Error("CozyStackClient.collection() called without a doctype");switch(e){case d.APPS_DOCTYPE:return new d.default(this);case v.KONNECTORS_DOCTYPE:return new v.default(this);case"io.cozy.files":return new h.default(e,this);case"io.cozy.sharings":return new m.default(e,this);case"io.cozy.permissions":return new b.default(e,this);case S.CONTACTS_DOCTYPE:return new S.default(e,this);case g.TRIGGERS_DOCTYPE:return new g.default(this);case y.JOBS_DOCTYPE:return new y.default(this);case k.SETTINGS_DOCTYPE:return new k.default(this);case O.NOTES_DOCTYPE:return new O.default(this);case w.OAUTH_CLIENTS_DOCTYPE:return new w.default(this);case _.SHORTCUTS_DOCTYPE:return new _.default(this);case P.APPS_REGISTRY_DOCTYPE:return new P.default(this);case I.NEXTCLOUD_FILES_DOCTYPE:return new I.NextcloudFilesCollection(this);default:return new p.default(e,this)}}},{key:"fetch",value:function(e){function t(t,r,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((e=(0,o.default)(i.default.mark(function e(t,r,n){var a,o,u,c,s,l,d=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(o=R({},a=d.length>3&&void 0!==d[3]?d[3]:{})).method=t,u=o.headers=R({},a.headers),"GET"!==t&&"HEAD"!==t&&void 0!==n&&u["Content-Type"]&&(o.body=n),!u.Authorization&&(u.Authorization=this.getAuthorizationHeader()),o.credentials=o.credentials||"include",c=this.fullpath(r),s=(0,E.shouldXMLHTTPRequestBeUsed)(t,r,o)?E.fetchWithXMLHttpRequest:fetch,e.prev=9,e.next=12,s(c,o);case 12:return!(l=e.sent).ok&&this.emit("error",new j.FetchError(l,"".concat(l.status," ").concat(l.statusText))),e.abrupt("return",l);case 17:throw e.prev=17,e.t0=e.catch(9),this.isRevocationError(e.t0)&&this.onRevocationChange(!0),e.t0;case 21:case"end":return e.stop()}},e,this,[[9,17]])})),function(t,r,n){return e.apply(this,arguments)}))},{key:"onTokenRefresh",value:function(e){this.options&&this.options.onTokenRefresh&&this.options.onTokenRefresh(e)}},{key:"onRevocationChange",value:function(e){this.options&&this.options.onRevocationChange&&this.options.onRevocationChange(e)}},{key:"refreshToken",value:(t=(0,o.default)(i.default.mark(function e(){var t,n,a,o,u,c,s,l;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.token){e.next=2;break}throw Error("Cannot refresh an empty token");case 2:if(t={method:"GET",credentials:"include"},r.g.document){e.next=5;break}throw Error("Not in a web context, cannot refresh token");case 5:return e.next=7,fetch("/?refreshToken",t);case 7:if((n=e.sent).ok){e.next=10;break}throw Error("couldn't fetch a new token - response "+n.statusCode);case 10:return e.next=12,n.text();case 12:if(a=e.sent,o=new DOMParser().parseFromString(a,"text/html")){e.next=17;break}throw Error("couldn't fetch a new token - doc is not html");case 17:if(u=o.querySelector('div[role="application"]')){e.next=20;break}throw Error("couldn't fetch a new token - no div[role=application]");case 20:if((s=(c=u.dataset.cozy?JSON.parse(u.dataset.cozy):R({},u.dataset)).token)&&(s=s||c.cozyToken),s){e.next=25;break}throw Error("couldn't fetch a new token -- missing data-cozy or data-cozy-token attribute");case 25:return l=new f.default(s),this.setToken(l),this.onTokenRefresh(l),e.abrupt("return",l);case 29:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"fetchJSON",value:(n=(0,o.default)(i.default.mark(function e(t,r,n){var a=this,o,u=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=u.length>3&&void 0!==u[3]?u[3]:{},e.prev=1,e.next=4,this.fetchJSONWithCurrentToken(t,r,n,o);case 4:case 20:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),!(j.default.EXPIRED_TOKEN.test(e.t0.message)||j.default.INVALID_TOKEN.test(e.t0.message)||j.default.INVALID_TOKEN_ALT.test(e.t0.message))){e.next=23;break}return e.prev=10,e.next=13,this._promiseCache.exec(function(){return a.refreshToken()},function(){return"refreshToken"});case 13:e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(10),e.t0;case 18:return e.next=20,this.fetchJSONWithCurrentToken(t,r,n,o);case 23:throw e.t0;case 24:case"end":return e.stop()}},e,this,[[1,7],[10,15]])})),function(e,t,r){return n.apply(this,arguments)})},{key:"fetchJSONWithCurrentToken",value:(a=(0,o.default)(i.default.mark(function e(t,r,n){var a,o,u,c,s,d,f,p,h=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.length>3&&void 0!==h[3]?h[3]:{},(u=(o=(0,l.default)(a)).headers=o.headers||{}).Accept="application/json",c=n,"GET"!==t&&"HEAD"!==t&&void 0!==c&&!u["Content-Type"]&&(u["Content-Type"]="application/json",c=JSON.stringify(c)),e.next=8,this.fetch(t,r,c,o);case 8:return f=(d=(s=e.sent).headers.get("content-type"))&&d.indexOf("json")>=0,e.next=13,f?s.json():s.text();case 13:if(p=e.sent,!s.ok){e.next=16;break}return e.abrupt("return",p);case 16:throw new j.FetchError(s,p);case 17:case"end":return e.stop()}},e,this)})),function(e,t,r){return a.apply(this,arguments)})},{key:"fullpath",value:function(e){return e.startsWith("http")?e:this.uri+e}},{key:"getAuthorizationHeader",value:function(){return this.token?this.token.toAuthHeader():null}},{key:"setCredentials",value:function(e){return(0,x.default)("CozyStackClient::setCredentials is deprecated, use CozyStackClient::setToken"),this.setToken(e)}},{key:"getCredentials",value:function(){return(0,x.default)("CozyStackClient::getCredentials is deprecated, use CozyStackClient::getAuthorizationHeader"),this.getAuthorizationHeader()}},{key:"setToken",value:function(e){if(e){if(e.toAuthHeader)this.token=e;else if("string"==typeof e)this.token=new f.default(e);else throw A.default.warn("Cozy-Client: Unknown token format",e),Error("Cozy-Client: Unknown token format");this.onRevocationChange(!1)}else this.token=null}},{key:"getAccessToken",value:function(){return this.token&&this.token.getAccessToken()}},{key:"setUri",value:function(e){this.uri=N(e)}},{key:"getIconURL",value:function(e){return(0,C.default)(this,e)}}]),u}();D.default.mixin(F);t.default=F},67267:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeDoc=L,t.normalizeDoctype=t.default=void 0;var i=a(r(80295)),o=a(r(98235)),u=a(r(68434)),c=a(r(41)),s=a(r(82007)),l=a(r(65105)),d=a(r(19723)),f=a(r(64512)),p=a(r(71400)),h=r(66804),y=a(r(44908)),v=a(r(57557)),m=a(r(91175)),b=a(r(82492)),g=a(r(10240)),k=a(r(80129)),O=r(35946),w=n(r(78140)),_=n(r(93726));r(45051);var S=a(r(79271));function P(){var e=(0,c.default)(["/data/","/_design/","/copy?rev=",""]);return P=function(){return e},e}function C(){var e=(0,c.default)(["/data/","/_design/","?rev=",""]);return C=function(){return e},e}function x(){var e=(0,c.default)(["/data/","/_design_docs?include_docs=true"]);return x=function(){return e},e}function E(){var e=(0,c.default)(["/data/","/_index"]);return E=function(){return e},e}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function j(){var e=(0,c.default)(["/data/","/","?rev=",""]);return j=function(){return e},e}function A(){var e=(0,c.default)(["/data/","/",""]);return A=function(){return e},e}function T(){var e=(0,c.default)(["/data/","/",""]);return T=function(){return e},e}function I(){var e=(0,c.default)(["/data/","/_all_docs?include_docs=true"]);return I=function(){return e},e}function M(){var e=(0,c.default)(["/data/","/_find"]);return M=function(){return e},e}function R(){var e=(0,c.default)(["/data/","/",""]);return R=function(){return e},e}function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach(function(t){(0,f.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=e._id||e.id;return F({id:r,_id:r,_type:t},e)}var B=function(e){return Object.assign({},(0,v.default)(e,"_type"),{_deleted:!0})},z=function(){var e,t,r,n,a,c,N,z,U,G,Q,H,q,J,Y,K,V,W,Z,$,X,ee;function et(e,t){(0,l.default)(this,et),this.doctype=e,this.stackClient=t,this.indexes={},this.endpoint="/data/".concat(this.doctype,"/")}return(0,d.default)(et,[{key:"all",value:(e=(0,s.default)(u.default.mark(function e(){var t=this,r,n,a,i,o,c,s,l,d,f,p,y,v,m,b,k=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(n=(r=k.length>0&&void 0!==k[0]?k[0]:{}).limit)?100:n,o=void 0===(i=r.skip)?0:i,c=r.bookmark,d=(l=!!(s=r.keys)||null===a)?"_all_docs":"_normal_docs",f=(0,h.uri)(R(),this.doctype,d),p={include_docs:!0,limit:a,skip:o,keys:s,bookmark:c},y=_.buildURL(f,p),e.prev=6,e.next=9,this.stackClient.fetchJSON("GET",y);case 9:v=e.sent,e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(6),e.abrupt("return",(0,w.dontThrowNotFoundError)(e.t0));case 15:return m=l?v.rows.filter(function(e){return e&&null!==e.doc&&!e.error&&!(0,g.default)(e.id,"_design")}).map(function(e){return L(e.doc,t.doctype)}):v.rows.map(function(e){return L(e,t.doctype)}),b=c?v.rows.length>=a:o+v.rows.length<v.total_rows,e.abrupt("return",{data:m,meta:{count:l?m.length:v.total_rows},skip:o,bookmark:v.bookmark,next:b});case 18:case"end":return e.stop()}},e,this,[[6,12]])})),function(){return e.apply(this,arguments)})},{key:"fetchDocumentsWithMango",value:(t=(0,s.default)(u.default.mark(function e(t,r){var n,a=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",this.stackClient.fetchJSON("POST",t,this.toMangoOptions(r,n)));case 2:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"migrateIndex",value:(r=(0,s.default)(u.default.mark(function e(t,r){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.copyIndex(t,r);case 3:return e.next=5,this.destroyIndex(t);case 5:e.next=16;break;case 7:if(e.prev=7,e.t0=e.catch(0),(0,w.isDocumentUpdateConflict)(e.t0)){e.next=11;break}throw e.t0;case 11:return(0,h.sleep)(1e3),e.next=14,this.copyIndex(t,r);case 14:return e.next=16,this.destroyIndex(t);case 16:case"end":return e.stop()}},e,this,[[0,7]])})),function(e,t){return r.apply(this,arguments)})},{key:"handleMissingIndex",value:(n=(0,s.default)(u.default.mark(function e(t,r){var n,a,i,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.indexedFields,a=r.partialFilter,!n&&(n=(0,O.getIndexFields)({sort:r.sort,selector:t})),i=(0,O.getIndexNameFromFields)(n,a),e.next=5,this.findExistingIndex(t,r);case 5:if(o=e.sent){e.next=11;break}return e.next=9,this.createIndex(n,{partialFilter:a,indexName:i});case 9:case 14:e.next=17;break;case 11:if(!(o._id!=="_design/".concat(i))){e.next=16;break}return e.next=14,this.migrateIndex(o,i);case 16:throw Error("Index unusable for query, index used: ".concat(i));case 17:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"findWithMango",value:(a=(0,s.default)(u.default.mark(function e(t,r){var n,a,i,o,c=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:{},e.prev=1,e.next=4,this.fetchDocumentsWithMango(t,r,n);case 4:if(!((o=(a=e.sent).warning||(null===(i=a.meta)||void 0===i?void 0:i.warning))&&n.partialFilter&&(0,w.isIndexNotUsedWarning)(o))){e.next=8;break}throw Error("no_index");case 8:e.next=21;break;case 10:if(e.prev=10,e.t0=e.catch(1),!(!(0,w.isIndexNotFoundError)(e.t0)&&!(0,w.isNoUsableIndexError)(e.t0))){e.next=16;break}throw e.t0;case 16:return e.next=18,this.handleMissingIndex(r,n);case 18:return e.next=20,this.fetchDocumentsWithMango(t,r,n);case 20:a=e.sent;case 21:return e.abrupt("return",a);case 22:case"end":return e.stop()}},e,this,[[1,10]])})),function(e,t){return a.apply(this,arguments)})},{key:"find",value:(c=(0,s.default)(u.default.mark(function e(t){var r=this,n,a,i,o,c,s=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0===(a=(n=s.length>1&&void 0!==s[1]?s[1]:{}).skip)?0:a,e.prev=2,c=(0,h.uri)(M(),this.doctype),e.next=6,this.findWithMango(c,t,n);case 6:o=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",(0,w.dontThrowNotFoundError)(e.t0));case 12:return e.abrupt("return",{data:o.docs.map(function(e){return L(e,r.doctype)}),next:o.next,skip:i,bookmark:o.bookmark,execution_stats:o.execution_stats});case 13:case"end":return e.stop()}},e,this,[[2,9]])})),function(e){return c.apply(this,arguments)})},{key:"findAll",value:(N=(0,s.default)(u.default.mark(function e(t){var r,n,a,i,c,s=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=s.length>1&&void 0!==s[1]?s[1]:{},n=!0,a=[],i=r.bookmark||void 0;case 4:if(!n){e.next=13;break}return e.next=7,this.find(t,F(F({},r),{},{bookmark:i}));case 7:c=e.sent,a.push.apply(a,(0,o.default)(c.data)),i=c.bookmark,n=c.next,e.next=4;break;case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)})),function(e){return N.apply(this,arguments)})},{key:"get",value:(z=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w.default.get(this.stackClient,"".concat(this.endpoint).concat(encodeURIComponent(t)),{normalize:this.constructor.normalizeDoctype(this.doctype)}));case 1:case"end":return e.stop()}},e,this)})),function(e){return z.apply(this,arguments)})},{key:"getAll",value:(U=(0,s.default)(u.default.mark(function e(t){var r,n,a=this;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stackClient.fetchJSON("POST",(0,h.uri)(I(),this.doctype),{keys:t});case 3:r=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",(0,w.dontThrowNotFoundError)(e.t0));case 9:return n=r.rows.filter(function(e){return e.doc}),e.abrupt("return",{data:n.map(function(e){return L(e.doc,a.doctype)}),meta:{count:n.length}});case 11:case"end":return e.stop()}},e,this,[[0,6]])})),function(e){return U.apply(this,arguments)})},{key:"create",value:(G=(0,s.default)(u.default.mark(function e(t){var r,n,a,o,c,s,l;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t._id,t._type,a=(0,i.default)(t,["_id","_type"]),c=(o=!!r)?"PUT":"POST",s=(0,h.uri)(T(),this.doctype,o?r:""),e.next=6,this.stackClient.fetchJSON(c,s,a);case 6:return l=e.sent,e.abrupt("return",{data:L(l.data,this.doctype)});case 8:case"end":return e.stop()}},e,this)})),function(e){return G.apply(this,arguments)})},{key:"update",value:(Q=(0,s.default)(u.default.mark(function e(t){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("PUT",(0,h.uri)(A(),this.doctype,t._id),t);case 2:return r=e.sent,e.abrupt("return",{data:L(r.data,this.doctype)});case 4:case"end":return e.stop()}},e,this)})),function(e){return Q.apply(this,arguments)})},{key:"destroy",value:(H=(0,s.default)(u.default.mark(function e(t){var r,n,a,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t._id,n=t._rev,a=(0,i.default)(t,["_id","_rev"]),e.next=3,this.stackClient.fetchJSON("DELETE",(0,h.uri)(j(),this.doctype,r,n));case 3:return o=e.sent,e.abrupt("return",{data:L(F(F({},a),{},{_id:r,_rev:o.rev,_deleted:!0}),this.doctype)});case 5:case"end":return e.stop()}},e,this)})),function(e){return H.apply(this,arguments)})},{key:"updateAll",value:(q=(0,s.default)(u.default.mark(function e(t){var r,n,a,i,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.stackClient,!(!(n=t?t.map(function(e){return(0,v.default)(e,"_type")}):t)||!n.length)){e.next=4;break}return e.abrupt("return",Promise.resolve([]));case 4:return e.prev=4,e.next=7,r.fetchJSON("POST","/data/".concat(this.doctype,"/_bulk_docs"),{docs:n});case 7:return a=e.sent,e.abrupt("return",a);case 11:if(e.prev=11,e.t0=e.catch(4),!(e.t0.reason&&e.t0.reason.reason&&"Database does not exist."===e.t0.reason.reason)){e.next=24;break}return e.next=16,this.create(n[0]);case 16:return i=e.sent,e.next=19,this.updateAll(n.slice(1));case 19:return(o=e.sent).unshift({ok:!0,id:i._id,rev:i._rev}),e.abrupt("return",o);case 24:throw e.t0;case 25:case"end":return e.stop()}},e,this,[[4,11]])})),function(e){return q.apply(this,arguments)})},{key:"destroyAll",value:function(e){return this.updateAll(e.map(B))}},{key:"toMangoOptions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.sort,n=t.indexedFields,a=t.partialFilter,i=t.fields,u=t.skip,c=t.limit,s=t.bookmark;r=(0,O.transformSort)(r),!n&&e&&S.default.warn("Selector fields should be manually indexed to prevent unexpected behaviour"),n=n||(0,O.getIndexFields)({sort:r,selector:e});var l=t.indexId||"_design/".concat((0,O.getIndexNameFromFields)(n,a));if(r){var d=(0,y.default)(r.map(function(e){return(0,m.default)(Object.values(e))}));if(d.length>1)throw Error("Mango sort can only use a single order (asc or desc).");var h,v=d.length>0?(0,m.default)(d):"asc",g=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return D(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return D(e,t)}}(e))){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(n);try{for(g.s();!(h=g.n()).done;)!function(){var e=h.value;!r.find(function(t){return(0,m.default)(Object.keys(t))===e})&&r.push((0,f.default)({},e,v))}()}catch(e){g.e(e)}finally{g.f()}}return{selector:a?(0,b.default)(F({},e),a):e,use_index:l,fields:i?[].concat((0,o.default)(i),["_id","_rev"]):void 0,limit:c,skip:void 0===u?0:u,bookmark:t.bookmark||s,sort:r,execution_stats:!!(0,p.default)("debug")||void 0}}},{key:"checkUniquenessOf",value:(J=(0,s.default)(u.default.mark(function e(t,r){var n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUniqueIndexId(t);case 2:return n=e.sent,e.next=5,this.find((0,f.default)({},t,r),{indexId:n,fields:["_id"]});case 5:return a=e.sent,e.abrupt("return",0===a.data.length);case 7:case"end":return e.stop()}},e,this)})),function(e,t){return J.apply(this,arguments)})},{key:"getUniqueIndexId",value:function(e){return this.getIndexId([e],{indexName:"".concat(this.doctype,"/").concat(e)})}},{key:"getIndexId",value:(Y=(0,s.default)(u.default.mark(function e(t,r){var n,a,i,o,c;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=void 0===(n=r.partialFilter)?"":n,o=void 0===(i=r.indexName)?(0,O.getIndexNameFromFields)(t):i,this.indexes[o]){e.next=20;break}return e.prev=2,e.next=5,this.createIndex(t,{partialFilter:a});case 5:c=e.sent,e.next=19;break;case 8:if(e.prev=8,e.t0=e.catch(2),(0,w.isIndexConflictError)(e.t0)){e.next=14;break}throw e.t0;case 14:return e.next=16,(0,h.sleep)(1e3);case 16:return e.next=18,this.createIndex(t,{partialFilter:a});case 18:c=e.sent;case 19:this.indexes[o]=c;case 20:return e.abrupt("return",this.indexes[o].id);case 21:case"end":return e.stop()}},e,this,[[2,8]])})),function(e,t){return Y.apply(this,arguments)})},{key:"createIndex",value:(K=(0,s.default)(u.default.mark(function e(t){var r,n,a,i,o,c,s,l,d=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r=d.length>1&&void 0!==d[1]?d[1]:{}).partialFilter,a=r.indexName,i={index:{fields:t}},a&&(i.ddoc=a),n&&(i.index.partial_filter_selector=n),e.prev=4,e.next=7,this.stackClient.fetchJSON("POST",(0,h.uri)(E(),this.doctype),i);case 7:o=e.sent,e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(4),(0,w.isIndexConflictError)(e.t0)){e.next=16;break}throw e.t0;case 16:return e.abrupt("return");case 17:if(c={id:o.id,fields:t},"exists"!==o.result){e.next=20;break}return e.abrupt("return",c);case 20:return s={},t.forEach(function(e){return s[e]={$gt:null}}),l={indexId:c.id,limit:1,partialFilterFields:n?(0,O.getIndexFields)({partialFilter:n}):null},e.next=25,(0,h.attempt)(this.find(s,l));case 25:if(!e.sent){e.next=27;break}return e.abrupt("return",c);case 27:return e.next=29,(0,h.sleep)(1e3);case 29:return e.next=31,(0,h.attempt)(this.find(s,l));case 31:if(!e.sent){e.next=33;break}return e.abrupt("return",c);case 33:return e.next=35,(0,h.sleep)(500);case 35:return e.abrupt("return",c);case 36:case"end":return e.stop()}},e,this,[[4,10]])})),function(e){return K.apply(this,arguments)})},{key:"fetchAllMangoIndexes",value:(V=(0,s.default)(u.default.mark(function e(){var t,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,h.uri)(x(),this.doctype),e.next=3,this.stackClient.fetchJSON("GET",t);case 3:return r=e.sent,e.abrupt("return",r.rows.filter(function(e){return"query"===e.doc.language}).map(function(e){return(0,O.normalizeDesignDoc)(e)}));case 5:case"end":return e.stop()}},e,this)})),function(){return V.apply(this,arguments)})},{key:"destroyIndex",value:(W=(0,s.default)(u.default.mark(function e(t){var r,n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t._id.split("/")[1],n=t._rev,a=(0,h.uri)(C(),this.doctype,r,n),e.abrupt("return",this.stackClient.fetchJSON("DELETE",a));case 4:case"end":return e.stop()}},e,this)})),function(e){return W.apply(this,arguments)})},{key:"copyIndex",value:(Z=(0,s.default)(u.default.mark(function e(t,r){var n,a,i,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id.split("/")[1],a=t._rev,i=(0,h.uri)(P(),this.doctype,n,a),o={headers:{Destination:"_design/".concat(r)}},e.abrupt("return",this.stackClient.fetchJSON("POST",i,null,o));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return Z.apply(this,arguments)})},{key:"findExistingIndex",value:($=(0,s.default)(u.default.mark(function e(t,r){var n,a,i,o,c,s;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.sort,a=r.indexedFields,i=r.partialFilter,e.next=3,this.fetchAllMangoIndexes();case 3:if(!((o=e.sent).length<1)){e.next=6;break}return e.abrupt("return",null);case 6:return n=(0,O.transformSort)(n),c=a||(0,O.getIndexFields)({sort:n,selector:t}),s=o.find(function(e){return(0,O.isMatchingIndex)(e,c,i)}),e.abrupt("return",s);case 10:case"end":return e.stop()}},e,this)})),function(e,t){return $.apply(this,arguments)})},{key:"fetchChangesRaw",value:(X=(0,s.default)(u.default.mark(function e(t){var r,n,a,i,o,c;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.doc_ids&&t.doc_ids.length>0,n="?".concat([k.default.stringify(F(F({},(0,v.default)(t,["doc_ids","includeDocs"])),{},{include_docs:t.includeDocs})),r&&void 0===t.filter?"filter=_doc_ids":void 0].filter(Boolean).join("&")),a=r?"POST":"GET",i="/data/".concat(this.doctype,"/_changes").concat(n),o=r?{doc_ids:t.doc_ids}:void 0,e.next=7,this.stackClient.fetchJSON(a,i,o);case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}},e,this)})),function(e){return X.apply(this,arguments)})},{key:"fetchChanges",value:(ee=(0,s.default)(u.default.mark(function e(){var t=this,r,n,a,i,o,c,s=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:{},a={includeDocs:!0},"object"!=typeof r?(a.since=r,S.default.warn('fetchChanges use couchOptions as Object not a string, since is deprecated, please use fetchChanges({since: "'.concat(r,'"}).'))):Object.keys(r).length>0&&Object.assign(a,r),e.next=6,this.fetchChangesRaw(a);case 6:return o=(i=e.sent).last_seq,c=i.results.map(function(e){return e.doc}).filter(Boolean),!n.includeDesign&&(c=c.filter(function(e){return 0!==e._id.indexOf("_design")})),!n.includeDeleted&&(c=c.filter(function(e){return!e._deleted})),e.abrupt("return",{newLastSeq:o,documents:c.map(function(e){return L(e,t.doctype)})});case 12:case"end":return e.stop()}},e,this)})),function(){return ee.apply(this,arguments)})}],[{key:"normalizeDoctype",value:function(e){return this.normalizeDoctypeRawApi(e)}},{key:"normalizeDoctypeJsonApi",value:function(e){return function(t,r){return L(t,e)}}},{key:"normalizeDoctypeRawApi",value:function(e){return function(t,r){return L(r,e)}}}]),et}();t.default=z;var U=z.normalizeDoctype;t.normalizeDoctype=U},49129:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isDirectory=t.isFile=void 0;var i=a(r(80295)),o=a(r(41)),u=a(r(68434)),c=a(r(82007)),s=a(r(65105)),l=a(r(19723)),d=a(r(8997)),f=a(r(25665)),p=a(r(27952)),h=a(r(12323)),y=a(r(64512)),v=a(r(12109)),m=a(r(18721)),b=a(r(27361)),g=a(r(57557)),k=a(r(78718));r(35946);var O=n(r(67267)),w=r(66804);r(45051);var _=r(78140),S=r(77069),P=n(r(93726)),C=a(r(79271));function x(){var e=(0,o.default)(["/files/_changes"]);return x=function(){return e},e}function E(){var e=(0,o.default)(["/data/","/","/relationships/not_synchronizing"]);return E=function(){return e},e}function D(){var e=(0,o.default)(["/data/","/","/relationships/not_synchronizing"]);return D=function(){return e},e}function j(){var e=(0,o.default)(["/data/","/","/relationships/not_synchronizing"]);return j=function(){return e},e}function A(){var e=(0,o.default)(["/files/","/versions"]);return A=function(){return e},e}function T(){var e=(0,o.default)(["/files/upload/metadata"]);return T=function(){return e},e}function I(){var e=(0,o.default)(["/files/",""]);return I=function(){return e},e}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function R(){var e=(0,o.default)(["/files/","?Name=","&Type=directory&MetadataID=",""]);return R=function(){return e},e}function N(){var e=(0,o.default)(["/files/metadata?Path=",""]);return N=function(){return e},e}function F(){var e=(0,o.default)(["/files/",""]);return F=function(){return e},e}function L(){var e=(0,o.default)(["/files/downloads?Path=",""]);return L=function(){return e},e}function B(){var e=(0,o.default)(["/files/downloads?VersionId=","&Filename=",""]);return B=function(){return e},e}function z(){var e=(0,o.default)(["/files/downloads?Id=","&Filename=",""]);return z=function(){return e},e}function U(){var e=(0,o.default)(["/files/","?Name=","&Type=file&Executable=","&Encrypted=",""]);return U=function(){return e},e}function G(){var e=(0,o.default)(["/files/","?Name=","&Type=file&Executable=","&Encrypted=","&MetadataID=","&Size=","&SourceAccount=","&SourceAccountIdentifier=",""]);return G=function(){return e},e}function Q(){var e=(0,o.default)(["/files/",""]);return Q=function(){return e},e}function H(){var e=(0,o.default)(["/files/","/copy"]);return H=function(){return e},e}function q(){var e=(0,o.default)(["/files/trash/",""]);return q=function(){return e},e}function J(){var e=(0,o.default)(["/files/",""]);return J=function(){return e},e}function Y(){var e=(0,o.default)(["/data/","/","/relationships/references"]);return Y=function(){return e},e}function K(){var e=(0,o.default)(["/data/","/","/relationships/references"]);return K=function(){return e},e}function V(){var e=(0,o.default)(["/files/","/relationships/referenced_by"]);return V=function(){return e},e}function W(){var e=(0,o.default)(["/files/","/relationships/referenced_by"]);return W=function(){return e},e}function Z(){var e=(0,o.default)(["/data/","/","/relationships/references"]);return Z=function(){return e},e}function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(Object(r),!0).forEach(function(t){(0,y.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var ee="io.cozy.files.root-dir",et=function(e){var t;return X(X(X({},(0,O.normalizeDoc)(e,"io.cozy.files")),e.attributes),{},{_rev:null==e?void 0:null===(t=e.meta)||void 0===t?void 0:t.rev})},er=function(e){return e?e.map(function(e){return{_type:e.type,_id:e.id}}):[]},en=function(e){return e&&e.trim()},ea=function(e){var t=en(e);if("string"!=typeof t||""===t)throw Error("Missing name argument");if("."===e||".."===e)throw Error("Invalid filename: ".concat(e));var r=(0,S.getIllegalCharacters)(t);if(r.length)throw Error("Invalid filename containing illegal character(s): ".concat(r));return t};t.isFile=function(e){var t=e._type,r=e.type;return"io.cozy.files"===t||"directory"===r||"file"===r};t.isDirectory=function(e){return"directory"===e.type};var ei=function(e,t){return new Promise(function(r){e.forEach(function(e){return e.then(function(e){t(e)&&r(!0)})}),Promise.all(e).then(function(){return r(!1)})})},eo=function(e){var t=e.lastIndexOf("/");return e.substring(0,t)},eu=function(e){(0,f.default)(eF,e);var t,r,n,a,o,O,S,$,eu,ec,es,el,ed,ef,ep,eh,ey,ev,em,eb,eg,ek,eO,ew,e_,eS,eP,eC,ex,eE,eD,ej,eA,eT,eI,eM,eR,eN=(t=eF,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,h.default)(t);return e=r?Reflect.construct(n,arguments,(0,h.default)(this).constructor):n.apply(this,arguments),(0,p.default)(this,e)});function eF(e,t){var r;return(0,s.default)(this,eF),r=eN.call(this,e,t),(0,y.default)((0,d.default)(r),"extractResponseLinkRelated",function(e){var t=e.links&&e.links.related;if(!t)throw Error("No related link in server response");return r.stackClient.fullpath(t)}),(0,y.default)((0,d.default)(r),"forceFileDownload",function(e,t){(0,w.forceDownload)(e,t)}),r.specialDirectories={},r}return(0,l.default)(eF,[{key:"get",value:function(e){return this.statById(e)}},{key:"fetchFindFiles",value:(n=(0,c.default)(u.default.mark(function e(t,r){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.stackClient.fetchJSON("POST","/files/_find",this.toMangoOptions(t,r)));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"find",value:(a=(0,c.default)(u.default.mark(function e(t){var r,n,a,i,o,c,s,l=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(n=(r=l.length>1&&void 0!==l[1]?l[1]:{}).skip)?0:n,e.prev=2,o="/files/_find",e.next=6,this.findWithMango(o,t,r);case 6:i=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",(0,_.dontThrowNotFoundError)(e.t0));case 12:return c=(0,b.default)(i,"links.next",""),s=new URL("".concat(this.stackClient.uri).concat(c)).searchParams.get("page[cursor]"),e.abrupt("return",{data:i.data.map(function(e){return et(e)}),meta:i.meta,next:i.meta.count>a+i.data.length,skip:a,bookmark:s||void 0,execution_stats:i.meta.execution_stats});case 16:case"end":return e.stop()}},e,this,[[2,9]])})),function(e){return a.apply(this,arguments)})},{key:"findReferencedBy",value:(o=(0,c.default)(u.default.mark(function e(t){var r,n,a,i,o,c,s,l,d=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(n=(r=d.length>1&&void 0!==d[1]?d[1]:{}).skip)?0:n,i=r.limit,o={include:"files","page[limit]":i,"page[cursor]":r.cursor,sort:"datetime"},c=(0,w.uri)(Z(),t._type,t._id),s=P.buildURL(c,o),e.next=6,this.stackClient.fetchJSON("GET",s);case 6:return l=e.sent,e.abrupt("return",{data:er(l.data),included:l.included?l.included.map(function(e){return et(e)}):[],next:(0,m.default)(l,"links.next"),meta:l.meta,skip:a});case 8:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"addReferencedBy",value:(O=(0,c.default)(u.default.mark(function e(t,r){var n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.map(function(e){return{id:e._id,type:e._type}}),e.next=3,this.stackClient.fetchJSON("POST",(0,w.uri)(W(),t._id),{data:n});case 3:return a=e.sent,e.abrupt("return",{data:er(a.data),meta:a.meta});case 5:case"end":return e.stop()}},e,this)})),function(e,t){return O.apply(this,arguments)})},{key:"removeReferencedBy",value:(S=(0,c.default)(u.default.mark(function e(t,r){var n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.map(function(e){return{id:e._id||e.id,type:e._type||e.type}}),e.next=3,this.stackClient.fetchJSON("DELETE",(0,w.uri)(V(),t._id||t.id),{data:n});case 3:return a=e.sent,e.abrupt("return",{data:er(a.data),meta:a.meta});case 5:case"end":return e.stop()}},e,this)})),function(e,t){return S.apply(this,arguments)})},{key:"addReferencesTo",value:($=(0,c.default)(u.default.mark(function e(t,r){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.map(function(e){return{id:e._id,type:"io.cozy.files"}}),e.abrupt("return",this.stackClient.fetchJSON("POST",(0,w.uri)(K(),t._type,t._id),{data:n}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return $.apply(this,arguments)})},{key:"removeReferencesTo",value:(eu=(0,c.default)(u.default.mark(function e(t,r){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.map(function(e){return{id:e._id,type:"io.cozy.files"}}),e.abrupt("return",this.stackClient.fetchJSON("DELETE",(0,w.uri)(Y(),t._type,t._id),{data:n}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return eu.apply(this,arguments)})},{key:"destroy",value:(ec=(0,c.default)(u.default.mark(function e(t){var r,n,a,i,o,c,s=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0===(r=(s.length>1&&void 0!==s[1]?s[1]:{}).ifMatch)?"":r,a=t._id,i=t.relationships,e.next=4,this.stackClient.fetchJSON("DELETE",(0,w.uri)(J(),a),void 0,{headers:{"If-Match":n}});case 4:if(o=e.sent,!Array.isArray(c=(0,b.default)(i,"referenced_by.data",t.referenced_by))){e.next=9;break}return e.next=9,this.removeReferencedBy(t,c);case 9:return e.abrupt("return",{data:et(o.data)});case 10:case"end":return e.stop()}},e,this)})),function(e){return ec.apply(this,arguments)})},{key:"emptyTrash",value:function(){return this.stackClient.fetchJSON("DELETE","/files/trash")}},{key:"restore",value:function(e){return this.stackClient.fetchJSON("POST",(0,w.uri)(q(),e))}},{key:"copy",value:(es=(0,c.default)(u.default.mark(function e(t,r,n){var a,i,o,c;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={name:void 0===r?void 0:ea(r),DirID:n},i=(0,w.uri)(H(),t),o=P.buildURL(i,a),e.next=5,this.stackClient.fetchJSON("POST",o);case 5:return c=e.sent,e.abrupt("return",{data:et(c.data)});case 7:case"end":return e.stop()}},e,this)})),function(e,t,r){return es.apply(this,arguments)})},{key:"deleteFilePermanently",value:(el=(0,c.default)(u.default.mark(function e(t){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("PATCH",(0,w.uri)(Q(),t),{data:{type:"io.cozy.files",id:t,attributes:{permanent_delete:!0}}});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return el.apply(this,arguments)})},{key:"upload",value:(ed=(0,c.default)(u.default.mark(function e(t,r){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureDirectoryExists(r);case 2:return n=e.sent,e.abrupt("return",this.createFile(t,{dirId:n}));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return ed.apply(this,arguments)})},{key:"create",value:(ef=(0,c.default)(u.default.mark(function e(t){var r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("directory"!==t.type){e.next=4;break}return e.abrupt("return",this.createDirectory(t));case 4:return r=t.data,n=(0,i.default)(t,["data"]),e.abrupt("return",this.createFile(r,n));case 6:case"end":return e.stop()}},e,this)})),function(e){return ef.apply(this,arguments)})},{key:"update",value:(ep=(0,c.default)(u.default.mark(function e(t){var r,n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data,n=(0,i.default)(t,["data"]),a=t.id||t._id,!r){e.next=7;break}if("directory"!==t.type){e.next=5;break}throw Error("You cannot pass a data object for a directory");case 5:return n.fileId=a,e.abrupt("return",this.updateFile(r,n));case 7:return e.abrupt("return",this.updateAttributes(a,t));case 8:case"end":return e.stop()}},e,this)})),function(e){return ep.apply(this,arguments)})},{key:"createFile",value:(eh=(0,c.default)(u.default.mark(function e(t){var r,n,a,o,c,s,l,d,f,p,h,y,v,m,b,g,k,O,_=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(r=_.length>1&&void 0!==_[1]?_[1]:{}).name,o=void 0===(a=r.dirId)?"":a,s=void 0!==(c=r.executable)&&c,d=void 0!==(l=r.encrypted)&&l,f=r.metadata,h=void 0===(p=r.sourceAccount)?"":p,v=void 0===(y=r.sourceAccountIdentifier)?"":y,m=(0,i.default)(r,["name","dirId","executable","encrypted","metadata","sourceAccount","sourceAccountIdentifier"]),!(b=n)&&"string"==typeof t.name&&(b=t.name),b=ea(b),g="",!f){e.next=11;break}return e.next=9,this.createFileMetadata(f);case 9:g=e.sent.data.id;case 11:return k="",m.contentLength&&(k=String(m.contentLength)),O=(0,w.uri)(G(),o,b,s,d,g,k,h,v),e.abrupt("return",this.doUpload(t,O,m));case 15:case"end":return e.stop()}},e,this)})),function(e){return eh.apply(this,arguments)})},{key:"updateFile",value:(ey=(0,c.default)(u.default.mark(function e(t){var r,n,a,o,c,s,l,d,f,p,h,y,v,m,b,g=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=void 0!==(n=(r=g.length>1&&void 0!==g[1]?g[1]:{}).executable)&&n,c=void 0!==(o=r.encrypted)&&o,s=r.fileId,d=void 0===(l=r.name)?"":l,f=r.metadata,p=(0,i.default)(r,["executable","encrypted","fileId","name","metadata"]),!(!s||"string"!=typeof s)){e.next=4;break}throw Error("missing fileId argument");case 4:if(!(!(h=d||t.name)||"string"!=typeof h)){e.next=7;break}throw Error("missing name in data argument");case 7:if(y=ea(h),m=(0,w.uri)(U(),s,y,a,c),!f){e.next=15;break}return e.next=12,this.createFileMetadata(f);case 12:v=e.sent.data.id,m+="&MetadataID=".concat(v);case 15:return b="",p.contentLength&&(b=String(p.contentLength),m+="&Size=".concat(b)),e.abrupt("return",this.doUpload(t,m,p,"PUT"));case 18:case"end":return e.stop()}},e,this)})),function(e){return ey.apply(this,arguments)})},{key:"getDownloadLinkById",value:function(e,t){return this.stackClient.fetchJSON("POST",(0,w.uri)(z(),e,encodeURIComponent(t))).then(this.extractResponseLinkRelated)}},{key:"getDownloadLinkByRevision",value:function(e,t){return this.stackClient.fetchJSON("POST",(0,w.uri)(B(),e,encodeURIComponent(t))).then(this.extractResponseLinkRelated)}},{key:"getDownloadLinkByPath",value:function(e){return this.stackClient.fetchJSON("POST",(0,w.uri)(L(),e)).then(this.extractResponseLinkRelated)}},{key:"download",value:(ev=(0,c.default)(u.default.mark(function e(t){var r,n,a,i,o=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:null,i=(n=o.length>2&&void 0!==o[2]?o[2]:void 0)||t.name,r){e.next=9;break}return e.next=6,this.getDownloadLinkById(t._id,i);case 6:a=e.sent,e.next=12;break;case 9:return e.next=11,this.getDownloadLinkByRevision(r,i);case 11:a=e.sent;case 12:this.forceFileDownload("".concat(a,"?Dl=1"),i);case 13:case"end":return e.stop()}},e,this)})),function(e){return ev.apply(this,arguments)})},{key:"fetchFileContent",value:(em=(0,c.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return C.default.warn("FileCollection.fetchFileContent() is deprecated. Use FileCollection.fetchFileContentById() instead"),e.abrupt("return",this.fetchFileContentById(t));case 2:case"end":return e.stop()}},e,this)})),function(e){return em.apply(this,arguments)})},{key:"fetchFileContentById",value:(eb=(0,c.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.stackClient.fetch("GET","/files/download/".concat(t)));case 1:case"end":return e.stop()}},e,this)})),function(e){return eb.apply(this,arguments)})},{key:"getBeautifulSize",value:function(e,t){return(0,w.formatBytes)(parseInt(e.size),t)}},{key:"downloadArchive",value:(eg=(0,c.default)(u.default.mark(function e(t,r){var n,a,i,o,c=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(c.length>2&&void 0!==c[2]?c[2]:{}).pages,a=r?(0,w.slugify)(r):"files",e.next=4,this.createArchiveLinkByIds({ids:t,name:a,pages:n});case 4:i=e.sent,o=this.stackClient.fullpath(i),this.forceFileDownload(o,a+".zip");case 7:case"end":return e.stop()}},e,this)})),function(e,t){return eg.apply(this,arguments)})},{key:"getArchiveLinkByIds",value:(ek=(0,c.default)(u.default.mark(function e(t){var r,n,a=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:"files",C.default.warn("CozyClient FileCollection getArchiveLinkByIds method is deprecated. Use createArchiveLinkByIds instead"),e.next=4,this.stackClient.fetchJSON("POST","/files/archive",{data:{type:"io.cozy.archives",attributes:{name:r,ids:t}}});case 4:return n=e.sent,e.abrupt("return",n.links.related);case 6:case"end":return e.stop()}},e,this)})),function(e){return ek.apply(this,arguments)})},{key:"createArchiveLinkByIds",value:(eO=(0,c.default)(u.default.mark(function e(t){var r,n,a,i,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.ids,a=void 0===(n=t.name)?"files":n,i=t.pages,e.next=3,this.stackClient.fetchJSON("POST","/files/archive",{data:{type:"io.cozy.archives",attributes:X({name:a,ids:r},i&&{pages:i})}});case 3:return o=e.sent,e.abrupt("return",o.links.related);case 5:case"end":return e.stop()}},e,this)})),function(e){return eO.apply(this,arguments)})},{key:"isChildOf",value:(ew=(0,c.default)(u.default.mark(function e(t,r){var n,a,i,o,c,s,l,d,f,p=this;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(n="object"==typeof t?t:{_id:t})._id,i=n.dirID,o=n.path,c=("object"==typeof r?r:{_id:r})._id,!(a===c||i===c)){e.next=4;break}return e.abrupt("return",!0);case 4:if(o){e.next=10;break}return e.next=7,this.statById(a);case 7:o=(s=e.sent).data.path,i=s.data.dirID;case 10:for(l=o,d=[o];""!=l;)""!=(f=eo(l))&&d.push(f),l=f;return d.reverse(),e.abrupt("return",ei(d.map(function(e){return p.statByPath(e)}),function(e){return e.data._id==c}));case 15:case"end":return e.stop()}},e,this)})),function(e,t){return ew.apply(this,arguments)})},{key:"statById",value:(e_=(0,c.default)(u.default.mark(function e(t){var r,n,a,i,o,c=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:{},n=(0,k.default)(r,["page[limit]","page[skip]","page[cursor]"]),a=(0,w.uri)(F(),t),i=P.buildURL(a,n),e.next=6,this.stackClient.fetchJSON("GET",i);case 6:return o=e.sent,e.abrupt("return",{data:et(o.data),included:o.included&&o.included.map(function(e){return et(e)}),links:o.links});case 8:case"end":return e.stop()}},e,this)})),function(e){return e_.apply(this,arguments)})},{key:"statByPath",value:(eS=(0,c.default)(u.default.mark(function e(t){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",(0,w.uri)(N(),t));case 2:return r=e.sent,e.abrupt("return",{data:et(r.data),included:r.included&&r.included.map(function(e){return et(e)})});case 4:case"end":return e.stop()}},e,this)})),function(e){return eS.apply(this,arguments)})},{key:"createDirectory",value:(eP=(0,c.default)(u.default.mark(function e(){var t,r,n,a,i,o,c,s,l,d=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t=d.length>0&&void 0!==d[0]?d[0]:{}).name,n=t.dirId,a=t.lastModifiedDate,i=t.metadata,o="",!i){e.next=8;break}return e.next=6,this.createFileMetadata(i);case 6:o=e.sent.data.id;case 8:return c=ea(r),s=a&&("string"==typeof a?new Date(a):a),e.next=12,this.stackClient.fetchJSON("POST",(0,w.uri)(R(),n,c,o),void 0,{headers:{Date:s?s.toGMTString():""}});case 12:return l=e.sent,e.abrupt("return",{data:et(l.data)});case 14:case"end":return e.stop()}},e,this)})),function(){return eP.apply(this,arguments)})},{key:"ensureDirectoryExists",value:(eC=(0,c.default)(u.default.mark(function e(t){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.specialDirectories[t]){e.next=5;break}return e.next=3,this.createDirectoryByPath(t);case 3:r=e.sent,this.specialDirectories[t]=r.data._id;case 5:return e.abrupt("return",this.specialDirectories[t]);case 6:case"end":return e.stop()}},e,this)})),function(e){return eC.apply(this,arguments)})},{key:"getDirectoryOrCreate",value:(ex=(0,c.default)(u.default.mark(function e(t,r){var n,a,i,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r&&!r.attributes)){e.next=2;break}throw Error("Malformed parent directory");case 2:return n=en(t),a="".concat(r._id===ee?"":r.attributes.path,"/").concat(n),e.prev=4,e.next=7,this.statByPath(a||"/");case 7:return i=e.sent,e.abrupt("return",i);case 11:if(e.prev=11,e.t0=e.catch(4),!((o=JSON.parse(e.t0.message).errors)&&o.length&&"404"===o[0].status)){e.next=17;break}return e.abrupt("return",this.createDirectory({name:n,dirId:r&&r._id}));case 17:throw o;case 18:case"end":return e.stop()}},e,this,[[4,11]])})),function(e,t){return ex.apply(this,arguments)})},{key:"createDirectoryByPath",value:(eE=(0,c.default)(u.default.mark(function e(t){var r,n,a,i,o,c;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.split("/").filter(function(e){return""!==e}),e.next=3,this.statById(ee);case 3:if(n=e.sent,r.length){e.next=6;break}return e.abrupt("return",n);case 6:a=n,i=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M(e,t)}}(e))){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(r),e.prev=8,i.s();case 10:if((o=i.n()).done){e.next=17;break}return c=o.value,e.next=14,this.getDirectoryOrCreate(c,a.data);case 14:a=e.sent;case 15:e.next=10;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),i.e(e.t0);case 22:return e.prev=22,i.f(),e.finish(22);case 25:return e.abrupt("return",a);case 26:case"end":return e.stop()}},e,this,[[8,19,22,25]])})),function(e){return eE.apply(this,arguments)})},{key:"updateAttributes",value:(eD=(0,c.default)(u.default.mark(function e(t,r){var n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=X({},r),r.name&&(n.name=ea(r.name)),e.next=4,this.stackClient.fetchJSON("PATCH",(0,w.uri)(I(),t),{data:{type:"io.cozy.files",id:t,attributes:n}});case 4:return a=e.sent,e.abrupt("return",{data:et(a.data)});case 6:case"end":return e.stop()}},e,this)})),function(e,t){return eD.apply(this,arguments)})},{key:"updateFileMetadata",value:(ej=(0,c.default)(u.default.mark(function e(t,r){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return C.default.warn("CozyClient FileCollection updateFileMetadata method is deprecated. Use updateAttributes instead"),e.abrupt("return",this.updateAttributes(t,r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return ej.apply(this,arguments)})},{key:"createFileMetadata",value:(eA=(0,c.default)(u.default.mark(function e(t){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST",(0,w.uri)(T()),{data:{type:"io.cozy.files.metadata",attributes:t}});case 2:return r=e.sent,e.abrupt("return",{data:r.data});case 4:case"end":return e.stop()}},e,this)})),function(e){return eA.apply(this,arguments)})},{key:"updateMetadataAttribute",value:(eT=(0,c.default)(u.default.mark(function e(t,r){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST",(0,w.uri)(A(),t),{data:{type:"io.cozy.files.metadata",attributes:r}});case 2:return n=e.sent,e.abrupt("return",{data:n.data});case 4:case"end":return e.stop()}},e,this)})),function(e,t){return eT.apply(this,arguments)})},{key:"getFileTypeFromName",value:function(e){return v.default.getType(e)||"application/octet-stream"}},{key:"doUpload",value:(eI=(0,c.default)(u.default.mark(function e(t,r,n){var a,i,o,c,s,l,d,f,p,h,y,v,m,b,g,k,O,w,_,S=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=S.length>3&&void 0!==S[3]?S[3]:"POST",i=r,o=t){e.next=5;break}throw Error("missing data argument");case 5:if(o.buffer&&o.buffer instanceof ArrayBuffer&&(o=o.buffer),c="undefined"!=typeof ArrayBuffer&&o instanceof ArrayBuffer,s="undefined"!=typeof File&&o instanceof File,l="undefined"!=typeof Blob&&o instanceof Blob,d=!0===o.readable&&"function"==typeof o.pipe,f="string"==typeof o,!(!c&&!s&&!l&&!d&&!f)){e.next=13;break}throw Error("invalid data type");case 13:return h=(p=n||{}).contentType,y=p.contentLength,v=p.checksum,m=p.lastModifiedDate,b=p.ifMatch,!h&&("string"==typeof o?h="text/plain":o.type?h=o.type:(k=new URLSearchParams((g=i.split("?")).length>1?g[1]:"").get("Name"),h=this.getFileTypeFromName(k.toLowerCase()))),(m=m||o.lastModified)&&(m=new Date(m)),O={"Content-Type":h},y&&(O["Content-Length"]=String(y)),v&&(O["Content-MD5"]=v),m&&(w=m.toISOString(),i="".concat(i,"&UpdatedAt=").concat(w,"&CreatedAt=").concat(w)),b&&(O["If-Match"]=b),e.next=24,this.stackClient.fetchJSON(a,i,o,{headers:O,onUploadProgress:n.onUploadProgress});case 24:return _=e.sent,e.abrupt("return",{data:et(_.data)});case 26:case"end":return e.stop()}},e,this)})),function(e,t,r){return eI.apply(this,arguments)})},{key:"findNotSynchronizedDirectories",value:(eM=(0,c.default)(u.default.mark(function e(t){var r,n,a,i,o,c,s,l,d,f,p=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(n=(r=p.length>1&&void 0!==p[1]?p[1]:{}).skip)?0:n,i=r.limit,o=r.cursor,s={include:void 0!==(c=r.includeFiles)&&c?"files":void 0,"page[limit]":i,"page[cursor]":o,sort:"id"},l=(0,w.uri)(j(),t._type,t._id),d=P.buildURL(l,s),e.next=6,this.stackClient.fetchJSON("GET",d);case 6:return f=e.sent,e.abrupt("return",{data:f.data.map(function(e){return et(e)}),included:f.included?f.included.map(function(e){return et(e)}):[],next:(0,m.default)(f,"links.next"),meta:f.meta,skip:a});case 8:case"end":return e.stop()}},e,this)})),function(e){return eM.apply(this,arguments)})},{key:"addNotSynchronizedDirectories",value:function(e,t){var r=t.map(function(e){return{id:e._id,type:e._type}});return this.stackClient.fetchJSON("POST",(0,w.uri)(D(),e._type,e._id),{data:r})}},{key:"removeNotSynchronizedDirectories",value:function(e,t){var r=t.map(function(e){return{id:e._id,type:e._type}});return this.stackClient.fetchJSON("DELETE",(0,w.uri)(E(),e._type,e._id),{data:r})}},{key:"fetchChanges",value:(eR=(0,c.default)(u.default.mark(function e(){var t,r,n,a,i,o,c,s,l,d,f=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]?f[0]:{},r=f.length>1&&void 0!==f[1]?f[1]:{},n={},"object"!=typeof t?(n.since=t,C.default.warn('fetchChanges use couchOptions as Object not a string, since is deprecated, please use fetchChanges({since: "'.concat(t,'"}).'))):Object.keys(t).length>0&&Object.assign(n,t),Object.keys(r).length>0&&(Object.assign(n,r),(r.skipTrashed||r.includeFilePath)&&(n.includeDocs=!0)),a=X(X({},(0,g.default)(n,["fields","includeDocs","includeFilePath","skipDeleted","skipTrashed"])),{},{fields:n.fields?n.fields.join(","):null,include_docs:n.includeDocs,include_file_path:n.includeFilePath,skip_deleted:n.skipDeleted,skip_trashed:n.skipTrashed}),i=(0,w.uri)(x()),o=P.buildURL(i,a),e.next=10,this.stackClient.fetchJSON("GET",o);case 10:return s=(c=e.sent).last_seq,l=c.pending,d=c.results,e.abrupt("return",{newLastSeq:s,pending:l,results:d});case 15:case"end":return e.stop()}},e,this)})),function(){return eR.apply(this,arguments)})}]),eF}(O.default);t.default=eu},54056:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.hasJobFinished=t.normalizeJob=t.JOBS_DOCTYPE=void 0;var i=a(r(68434)),o=a(r(41)),u=a(r(82007)),c=a(r(65105)),s=a(r(19723)),l=a(r(25665)),d=a(r(27952)),f=a(r(12323)),p=a(r(64512)),h=a(r(78140)),y=n(r(67267)),v=r(66804);function m(){var e=(0,o.default)(["/jobs/",""]);return m=function(){return e},e}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach(function(t){(0,p.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var k="io.cozy.jobs";t.JOBS_DOCTYPE=k;var O=function(e){return new Promise(function(t){return setTimeout(t,e)})},w=function(e){return g(g(g({},e),(0,y.normalizeDoc)(e,k)),e.attributes)};t.normalizeJob=w;var _=function(e){return"done"===e.state||"errored"===e.state};t.hasJobFinished=_;var S=function(e){(0,l.default)(y,e);var t,r,n,a,o,p=(t=y,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,f.default)(t);return e=r?Reflect.construct(n,arguments,(0,f.default)(this).constructor):n.apply(this,arguments),(0,d.default)(this,e)});function y(e){return(0,c.default)(this,y),p.call(this,k,e)}return(0,s.default)(y,[{key:"queued",value:function(e){return this.stackClient.fetchJSON("GET","/jobs/queue/".concat(e))}},{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.stackClient.fetchJSON("POST","/jobs/queue/".concat(e),{data:{type:k,attributes:{arguments:t,options:r,manual:n}}})}},{key:"get",value:(n=(0,u.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.default.get(this.stackClient,(0,v.uri)(m(),t),{normalize:w}));case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"update",value:(a=(0,u.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("client"!==t.worker)){e.next=2;break}throw Error("JobCollection.update only works for client workers. ".concat(t.worker," given"));case 2:return e.next=4,this.stackClient.fetchJSON("PATCH","/jobs/".concat(t._id),{data:{type:k,id:t._id,attributes:{state:t.attributes.state,error:t.attributes.error}}});case 4:return r=e.sent,e.abrupt("return",w(r.data));case 6:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"waitFor",value:(o=(0,u.default)(i.default.mark(function e(t){var r,n,a,o,u,c,s,l,d,f,p,h,y=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(n=(r=y.length>1&&void 0!==y[1]?y[1]:{}).onUpdate)?null:n,u=void 0===(o=r.until)?_:o,s=void 0===(c=r.delay)?5e3:c,d=void 0===(l=r.timeout)?3e5:l,f=Date.now(),e.next=4,this.get(t);case 4:p=e.sent.data.attributes;case 5:if(!(!p||!u(p))){e.next=17;break}return e.next=8,O(s);case 8:return e.next=10,this.get(t);case 10:if(p=e.sent.data.attributes,a&&a(p),h=Date.now(),!(f-h>d)){e.next=15;break}throw Error("Timeout for JobCollection::waitFor");case 15:e.next=5;break;case 17:return e.abrupt("return",p);case 18:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})}]),y}(y.default);t.default=S},76812:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.KONNECTORS_DOCTYPE=void 0;var i=a(r(68434)),o=a(r(82007)),u=a(r(65105)),c=a(r(19723)),s=a(r(25665)),l=a(r(27952)),d=a(r(12323)),f=a(r(78718)),p=a(r(14324)),h=n(r(54026)),y=r(67267),v="io.cozy.konnectors";t.KONNECTORS_DOCTYPE=v;var m=function(e){(0,s.default)(k,e);var t,r,n,a,p,m,b,g=(t=k,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,d.default)(t);return e=r?Reflect.construct(n,arguments,(0,d.default)(this).constructor):n.apply(this,arguments),(0,l.default)(this,e)});function k(e){var t;return(0,u.default)(this,k),(t=g.call(this,e)).doctype=v,t.endpoint="/konnectors/",t}return(0,c.default)(k,[{key:"create",value:(n=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("create() method is not available for konnectors");case 1:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})},{key:"destroy",value:(a=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("destroy() method is not available for konnectors");case 1:case"end":return e.stop()}},e)})),function(){return a.apply(this,arguments)})},{key:"findTriggersBySlug",value:(p=(0,o.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new h.default(this.stackClient),e.next=3,r.all({limit:null});case 3:return n=e.sent.data,e.abrupt("return",n.map(function(e){return e.attributes}).filter(function(e){return(0,h.isForKonnector)(e,t)}));case 6:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"launch",value:(m=(0,o.default)(i.default.mark(function e(t){var r,n,a,o,u,c=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:{},n=new h.default(this.stackClient),e.next=4,this.findTriggersBySlug(t);case 4:if(a=e.sent,1!==(o=r.accountId?a.filter(function(e){return(0,h.isForAccount)(e,r.accountId)}):a).length){e.next=10;break}return e.abrupt("return",n.launch(a[0]));case 10:if(u=JSON.stringify((0,f.default)({slug:t,accountId:r.accountId})),0!==o.length){e.next=15;break}throw Error("No trigger found for ".concat(u));case 15:if(!(o.length>1)){e.next=17;break}throw Error("More than 1 trigger found for ".concat(u));case 17:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"update",value:(b=(0,o.default)(i.default.mark(function e(t){var r,n,a,o,u=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:{},t){e.next=3;break}throw Error("Cannot call update with no slug");case 3:return n=r.source||null,a=r.sync?{headers:{Accept:"text/event-stream"}}:{},e.next=8,this.stackClient.fetchJSON("PUT","/konnectors/".concat(t)+(n?"?Source=".concat(n):""),a);case 8:return o=e.sent,e.abrupt("return",(0,y.normalizeDoc)(o));case 10:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})}]),k}(p.default);t.default=m},68512:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.NEXTCLOUD_FILES_DOCTYPE=t.NextcloudFilesCollection=void 0;var a=n(r(68434)),i=n(r(82007)),o=n(r(65105)),u=n(r(19723)),c=n(r(25665)),s=n(r(27952)),l=n(r(12323)),d=n(r(64512)),f=n(r(67267)),p=r(66804),h=r(45051);function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach(function(t){(0,d.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var b="io.cozy.remote.nextcloud.files";t.NEXTCLOUD_FILES_DOCTYPE=b;var g=f.default.normalizeDoctypeJsonApi(b),k=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.fromTrash,a=void 0!==n&&n;return function(r){var n=m(m({},r.attributes),{},{parentPath:t,path:a?r.attributes.path:(0,p.joinPath)(t,r.attributes.name),cozyMetadata:m(m({},r.attributes.cozyMetadata),{},{sourceAccount:e})});return m(m({},g(r,b)),n)}},O=function(e){(0,c.default)(x,e);var t,r,n,d,f,v,m,g,O,w,_,S,P,C=(t=x,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,l.default)(t);return e=r?Reflect.construct(n,arguments,(0,l.default)(this).constructor):n.apply(this,arguments),(0,s.default)(this,e)});function x(e){return(0,o.default)(this,x),C.call(this,b,e)}return(0,u.default)(x,[{key:"find",value:(n=(0,i.default)(a.default.mark(function e(t){var r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t["cozyMetadata.sourceAccount"]&&t.parentPath)){e.next=5;break}return e.next=3,this.stackClient.fetchJSON("GET","/remote/nextcloud/".concat(t["cozyMetadata.sourceAccount"]).concat((0,p.encodePath)(t.parentPath)));case 3:return r=e.sent,e.abrupt("return",{data:r.data.map(k(t["cozyMetadata.sourceAccount"],t.parentPath,{fromTrash:t.trashed}))});case 5:throw Error("Not implemented");case 6:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"destroy",value:(d=(0,i.default)(a.default.mark(function e(t){var r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("DELETE","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount).concat((0,p.encodePath)(t.path)));case 2:if(204!==(r=e.sent).status){e.next=5;break}return e.abrupt("return",r);case 5:throw new h.FetchError(r,r.json());case 6:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"destroyAll",value:(f=(0,i.default)(a.default.mark(function e(t){var r,n,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(e,t)}}(e))){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(t),e.prev=1,r.s();case 3:if((n=r.n()).done){e.next=9;break}return i=n.value,e.next=7,this.destroy(i);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),r.e(e.t0);case 14:return e.prev=14,r.f(),e.finish(14);case 17:case"end":return e.stop()}},e,this,[[1,11,14,17]])})),function(e){return f.apply(this,arguments)})},{key:"download",value:(v=(0,i.default)(a.default.mark(function e(t){var r,n,i,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("GET","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount).concat((0,p.encodePath)(t.path),"?Dl=1"));case 2:return r=e.sent,e.next=5,r.blob();case 5:n=e.sent,i=URL.createObjectURL(n),o=t.path.split("/").pop(),(0,p.forceDownload)(i,o);case 9:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"move",value:(m=(0,i.default)(a.default.mark(function e(t,r){var n,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,p.joinPath)(r.path,t.name),e.next=3,this.stackClient.fetch("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/move").concat((0,p.encodePath)(t.path),"?To=").concat((0,p.encodePath)(n)));case 3:if(204!==(i=e.sent).status){e.next=6;break}return e.abrupt("return",i);case 6:throw new h.FetchError(i,i.json());case 7:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"moveToCozy",value:(g=(0,i.default)(a.default.mark(function e(t,r){var n,i,o,u=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0!==(n=(u.length>2&&void 0!==u[2]?u[2]:{}).copy)&&n,e.next=3,this.stackClient.fetch("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/downstream").concat((0,p.encodePath)(t.path),"?To=").concat(r._id).concat(i?"&Copy=true":""));case 3:if(201!==(o=e.sent).status){e.next=6;break}return e.abrupt("return",o);case 6:throw new h.FetchError(o,o.json());case 7:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"moveFromCozy",value:(O=(0,i.default)(a.default.mark(function e(t,r){var n,i,o,u,c=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0!==(n=(c.length>2&&void 0!==c[2]?c[2]:{}).copy)&&n,o=(0,p.joinPath)(t.path,r.name),e.next=4,this.stackClient.fetch("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/upstream").concat((0,p.encodePath)(o),"?From=").concat(r._id).concat(i?"&Copy=true":""));case 4:if(204!==(u=e.sent).status){e.next=7;break}return e.abrupt("return",u);case 7:throw new h.FetchError(u,u.json());case 8:case"end":return e.stop()}},e,this)})),function(e,t){return O.apply(this,arguments)})},{key:"restore",value:(w=(0,i.default)(a.default.mark(function e(t){var r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/restore").concat((0,p.encodePath)(t.path)));case 2:if(204!==(r=e.sent).status){e.next=5;break}return e.abrupt("return",r);case 5:throw new h.FetchError(r,r.json());case 6:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"emptyTrash",value:(_=(0,i.default)(a.default.mark(function e(t){var r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("DELETE","/remote/nextcloud/".concat(t,"/trash"));case 2:if(204!==(r=e.sent).status){e.next=5;break}return e.abrupt("return",r);case 5:throw new h.FetchError(r,r.json());case 6:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"deletePermanently",value:(S=(0,i.default)(a.default.mark(function e(t){var r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetch("DELETE","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount).concat((0,p.encodePath)(t.path)));case 2:if(204!==(r=e.sent).status){e.next=5;break}return e.abrupt("return",r);case 5:throw new h.FetchError(r,r.json());case 6:case"end":return e.stop()}},e,this)})),function(e){return S.apply(this,arguments)})},{key:"copy",value:(P=(0,i.default)(a.default.mark(function e(t,r){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST","/remote/nextcloud/".concat(t.cozyMetadata.sourceAccount,"/copy/").concat(t.path).concat(r?"?Path=".concat(r.path,"/").concat(t.name):""));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return P.apply(this,arguments)})}]),x}(f.default);t.NextcloudFilesCollection=O},45082:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.NOTES_URL_DOCTYPE=t.NOTES_DOCTYPE=void 0;var a=n(r(41)),i=n(r(68434)),o=n(r(82007)),u=n(r(65105)),c=n(r(19723)),s=n(r(25665)),l=n(r(27952)),d=n(r(12323)),f=n(r(64512)),p=n(r(67267)),h=r(66804),y=r(10223);function v(){var e=(0,a.default)(["/notes/","/open"]);return v=function(){return e},e}function m(){var e=(0,a.default)(["/files/",""]);return m=function(){return e},e}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach(function(t){(0,f.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var k="io.cozy.notes";t.NOTES_DOCTYPE=k;var O="io.cozy.notes.url";t.NOTES_URL_DOCTYPE=O;var w=p.default.normalizeDoctypeJsonApi(k),_=function(e){return g(g({},w(e,k)),e.attributes)},S=function(e){(0,s.default)(P,e);var t,r,n,a,f,b,w,S=(t=P,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,d.default)(t);return e=r?Reflect.construct(n,arguments,(0,d.default)(this).constructor):n.apply(this,arguments),(0,l.default)(this,e)});function P(e){return(0,u.default)(this,P),S.call(this,k,e)}return(0,c.default)(P,[{key:"get",value:(n=(0,o.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET","/notes/".concat(t));case 2:return r=e.sent,e.abrupt("return",{data:_(r.data)});case 4:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"all",value:(a=(0,o.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET","/notes");case 2:return t=e.sent,e.abrupt("return",g(g({},t),{},{data:t.data.map(_)}));case 4:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"destroy",value:(f=(0,o.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t._id,e.next=3,this.stackClient.fetchJSON("DELETE",(0,h.uri)(m(),r));case 3:return n=e.sent,e.abrupt("return",{data:g(g({},_(n.data)),{},{_deleted:!0})});case 5:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"create",value:(b=(0,o.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.dir_id,e.next=3,this.stackClient.fetchJSON("POST","/notes",{data:{type:"io.cozy.notes.documents",attributes:{title:"",schema:(0,y.getDefaultSchema)(),dir_id:r}}});case 3:return n=e.sent,e.abrupt("return",g(g({},n),{},{data:_(n.data)}));case 5:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"fetchURL",value:(w=(0,o.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t._id,e.next=3,this.stackClient.fetchJSON("GET",(0,h.uri)(v(),r));case 3:var a;return n=e.sent,e.abrupt("return",{data:(a=n.data,g(g({},p.default.normalizeDoctypeJsonApi(O)(a)),a.attributes))});case 5:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"getDefaultSchema",value:function(){return(0,y.getDefaultSchema)()}}]),P}(p.default);S.normalizeDoctype=p.default.normalizeDoctypeJsonApi;t.default=S},10223:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultSchema=t.marks=t.nodes=void 0;var r=[["doc",{content:"(block)+",marks:"link"}],["paragraph",{content:"inline*",group:"block",marks:"strong code em link strike subsup textColor typeAheadQuery underline",parseDOM:[{tag:"p"}]}],["text",{group:"inline"}],["bulletList",{group:"block",content:"listItem+",parseDOM:[{tag:"ul"}]}],["orderedList",{group:"block",content:"listItem+",parseDOM:[{tag:"ol"}]}],["listItem",{content:"(paragraph ) (paragraph | bulletList | orderedList )*",defining:!0,parseDOM:[{tag:"li"}]}],["heading",{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}]}],["blockquote",{content:"paragraph+",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"blockquote"}]}],["rule",{group:"block",parseDOM:[{tag:"hr"}]}],["panel",{group:"block",content:"(paragraph | heading | bulletList | orderedList)+",attrs:{panelType:{default:"info"}},parseDOM:[{tag:"div[data-panel-type]"}]}],["confluenceUnsupportedBlock",{group:"block",attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedBlock"]'}]}],["confluenceUnsupportedInline",{group:"inline",inline:!0,atom:!0,attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedInline"]'}]}],["unsupportedBlock",{inline:!1,group:"block",atom:!0,selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedBlock"]'}]}],["unsupportedInline",{inline:!0,group:"inline",selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedInline"]'}]}],["hardBreak",{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}]}],["table",{content:"tableRow+",attrs:{isNumberColumnEnabled:{default:!1},layout:{default:"default"},__autoSize:{default:!1}},tableRole:"table",isolating:!0,selectable:!1,group:"block",parseDOM:[{tag:"table"}]}],["tableHeader",{content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading )+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"header_cell",isolating:!0,marks:"",parseDOM:[{tag:"th"}]}],["tableRow",{content:"(tableCell | tableHeader)+",tableRole:"row",parseDOM:[{tag:"tr"}]}],["tableCell",{content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | unsupportedBlock)+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"cell",marks:"",isolating:!0,parseDOM:[{tag:".ak-renderer-table-number-column",ignore:!0},{tag:"td"}]}]];t.nodes=r;var n=[["link",{excludes:"color",group:"link",attrs:{href:{},__confluenceMetadata:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]"}]}],["em",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}]}],["strong",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strong"},{tag:"b"},{style:"font-weight"}]}],["textColor",{attrs:{color:{}},inclusive:!0,group:"color",parseDOM:[{style:"color"}]}],["strike",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strike"},{tag:"s"},{tag:"del"},{style:"text-decoration"}]}],["subsup",{inclusive:!0,group:"fontStyle",attrs:{type:{default:"sub"}},parseDOM:[{tag:"sub",attrs:{type:"sub"}},{tag:"sup",attrs:{type:"sup"}}]}],["underline",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"u"},{style:"text-decoration"}]}],["code",{excludes:"fontStyle link searchQuery color",inclusive:!0,parseDOM:[{tag:"span.code",preserveWhitespace:!0},{tag:"code",preserveWhitespace:!0},{tag:"tt",preserveWhitespace:!0},{tag:"span",preserveWhitespace:!0}]}],["typeAheadQuery",{excludes:"searchQuery",inclusive:!0,group:"searchQuery",parseDOM:[{tag:"span[data-type-ahead-query]"}],attrs:{trigger:{default:""}}}]];t.marks=n;t.getDefaultSchema=function(){return{nodes:r,marks:n}}},29985:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(15500)),i=n(r(68434)),o=n(r(82007)),u=n(r(64512)),c=n(r(80295)),s=n(r(65105)),l=n(r(19723)),d=n(r(25665)),f=n(r(27952)),p=n(r(12323)),h=n(r(29328)),y=n(r(88928)),v=n(r(66605)),m=n(r(45051)),b=n(r(79271));function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){(0,u.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);return r=t?Reflect.construct(n,arguments,(0,p.default)(this).constructor):n.apply(this,arguments),(0,f.default)(this,r)}}var w={clientID:"",clientName:"",clientKind:"",clientSecret:"",clientURI:"",registrationAccessToken:"",redirectURI:"",softwareID:"",softwareVersion:"",logoURI:"",policyURI:"",notificationPlatform:"",notificationDeviceToken:""},_=function(e){(0,d.default)(x,e);var t,r,n,a,u,f,p,h,g,_,P,C=O(x);function x(e){var t,r=e.oauth,n=e.scope,a=e.onTokenRefresh,i=(0,c.default)(e,["oauth","scope","onTokenRefresh"]);return(0,s.default)(this,x),(t=C.call(this,i)).setOAuthOptions(k(k({},w),r)),r.token&&t.setToken(r.token),t.scope=void 0===n?[]:n,t.onTokenRefresh=a,t}return(0,l.default)(x,[{key:"isRegistered",value:function(){return""!==this.oauthOptions.clientID}},{key:"snakeCaseOAuthData",value:function(e){var t={softwareID:"software_id",softwareVersion:"software_version",clientID:"client_id",clientName:"client_name",clientKind:"client_kind",clientURI:"client_uri",logoURI:"logo_uri",policyURI:"policy_uri",notificationPlatform:"notification_platform",notificationDeviceToken:"notification_device_token",redirectURI:"redirect_uris"},r={};return Object.keys(e).forEach(function(n){var a=t[n]||n,i=e[n];r[a]=i}),r.redirect_uris&&r.redirect_uris instanceof Array==!1&&(r.redirect_uris=[r.redirect_uris]),r}},{key:"camelCaseOAuthData",value:function(e){var t={client_id:"clientID",client_name:"clientName",client_secret:"clientSecret",registration_access_token:"registrationAccessToken",software_id:"softwareID",redirect_uris:"redirectURI"},r={};return Object.keys(e).forEach(function(n){var a=t[n]||n,i=e[n];r[a]=i}),r}},{key:"doRegistration",value:function(){return this.fetchJSON("POST","/auth/register",this.snakeCaseOAuthData({redirectURI:this.oauthOptions.redirectURI,clientName:this.oauthOptions.clientName,softwareID:this.oauthOptions.softwareID,clientKind:this.oauthOptions.clientKind,clientURI:this.oauthOptions.clientURI,logoURI:this.oauthOptions.logoURI,policyURI:this.oauthOptions.policyURI,softwareVersion:this.oauthOptions.softwareVersion,notificationPlatform:this.oauthOptions.notificationPlatform,notificationDeviceToken:this.oauthOptions.notificationDeviceToken}))}},{key:"register",value:(t=(0,o.default)(i.default.mark(function e(){var t,r,n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRegistered()){e.next=2;break}throw Error("Client already registered");case 2:if(t=["redirectURI"],r=Object.keys(this.oauthOptions),!((n=t.filter(function(e){return r[e]})).length>0)){e.next=7;break}throw Error("Can't register client : missing ".concat(n," fields"));case 7:return e.next=9,this.doRegistration();case 9:return a=e.sent,this.setOAuthOptions(k(k({},this.oauthOptions),{},{client_id:a.client_id,client_name:a.client_name,client_secret:a.client_secret,registration_access_token:a.registration_access_token,software_id:a.software_id})),e.abrupt("return",this.oauthOptions);case 12:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"unregister",value:(r=(0,o.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRegistered()){e.next=2;break}throw new S;case 2:return t=this.oauthOptions.clientID,this.oauthOptions.clientID="",e.abrupt("return",this.fetchJSON("DELETE","/auth/register/".concat(t),null,{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}}));case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"fetchInformation",value:(n=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRegistered()){e.next=2;break}throw new S;case 2:return e.abrupt("return",this.fetchJSON("GET","/auth/register/".concat(this.oauthOptions.clientID),null,{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}}));case 3:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"updateInformation",value:(a=(0,o.default)(i.default.mark(function e(t){var r,n,a,o,u=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]&&u[1],this.isRegistered()){e.next=3;break}throw new S;case 3:return n={clientID:this.oauthOptions.clientID,clientName:this.oauthOptions.clientName,redirectURI:this.oauthOptions.redirectURI,softwareID:this.oauthOptions.softwareID},a=this.snakeCaseOAuthData(k(k({},n),t)),r&&(a.client_secret=this.oauthOptions.clientSecret),e.next=8,this.fetchJSON("PUT","/auth/register/".concat(this.oauthOptions.clientID),a,{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}});case 8:return o=e.sent,this.setOAuthOptions(k(k({},a),o)),e.abrupt("return",this.oauthOptions);case 11:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"generateStateCode",value:function(){var e;if("undefined"!=typeof window&&void 0!==window.crypto&&"function"==typeof window.crypto.getRandomValues)e=new Uint8Array(16),window.crypto.getRandomValues(e);else{e=Array(16);for(var t=0;t<e.length;t++)e[t]=Math.floor(255*Math.random())}return btoa(String.fromCharCode.apply(null,e)).replace(/=+$/,"").replace(/\//g,"_").replace(/\+/g,"-")}},{key:"getAuthCodeURL",value:function(e){var t=e.stateCode,r=e.scopes,n=void 0===r?this.scope:r,a=e.sessionCode,i=void 0===a?void 0:a,o=e.codeChallenge,u=void 0===o?void 0:o;if(!this.isRegistered())throw new S;var c={client_id:this.oauthOptions.clientID,redirect_uri:this.oauthOptions.redirectURI,state:t,response_type:"code",scope:n.join(" ")};return this.oauthOptions.registerToken&&(c=k(k({},c),{},{registerToken:this.oauthOptions.registerToken})),i&&(c=k(k({},c),{},{session_code:i})),u&&(c=k(k({},c),{},{code_challenge:u,code_challenge_method:"S256"})),"".concat(this.uri,"/auth/authorize?").concat(this.dataToQueryString(c))}},{key:"dataToQueryString",value:function(e){return Object.keys(e).map(function(t){return"".concat(t,"=").concat(encodeURIComponent(e[t]))}).join("&")}},{key:"getAccessCodeFromURL",value:function(e,t){if(!t)throw Error("Missing state code");var r=new URL(e).searchParams,n=r.get("state"),a=r.get("access_code");if(t!==n)throw Error("Given state does not match url query state");return a}},{key:"fetchAccessToken",value:(u=(0,o.default)(i.default.mark(function e(t,r,n,a){var o,u,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!this.isRegistered()&&!r)){e.next=2;break}throw new S;case 2:return u={grant_type:"authorization_code",code:t,client_id:(o=r||this.oauthOptions).clientID,client_secret:o.clientSecret},a&&(u=k(k({},u),{},{code_verifier:a})),e.next=7,this.fetchJSON("POST",(n||"")+"/auth/access_token",this.dataToQueryString(u),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 7:return c=e.sent,e.abrupt("return",new y.default(c));case 9:case"end":return e.stop()}},e,this)})),function(e,t,r,n){return u.apply(this,arguments)})},{key:"fetchKonnectorToken",value:(f=(0,o.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchJSON("POST","/auth/tokens/konnectors/".concat(t));case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),Error('oAuthClient.fetchKonnectorToken(): Could not create a token for the konnector with slug "'.concat(t,'". \n\n').concat(e.t0));case 9:case"end":return e.stop()}},e,this,[[0,6]])})),function(e){return f.apply(this,arguments)})},{key:"fetchSessionCode",value:(p=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchJSON("POST","/auth/session_code"));case 1:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"fetchSessionCodeWithPassword",value:(h=(0,o.default)(i.default.mark(function e(t){var r,n,a,o,u;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.passwordHash,a=void 0===(n=t.twoFactorToken)?void 0:n,u=void 0===(o=t.twoFactorPasscode)?void 0:o,e.abrupt("return",this.fetchJSON("POST","/auth/session_code",{passphrase:r,two_factor_token:a,two_factor_passcode:u}));case 2:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"loginFlagship",value:(g=(0,o.default)(i.default.mark(function e(t){var r,n,a,o,u,c,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0===(r=t.emailVerifiedCode)?void 0:r,a=t.passwordHash,u=void 0===(o=t.twoFactorToken)?void 0:o,s=void 0===(c=t.twoFactorPasscode)?void 0:c,e.abrupt("return",this.fetchJSON("POST","/auth/login/flagship",{client_id:this.oauthOptions.clientID,client_secret:this.oauthOptions.clientSecret,email_verified_code:n,passphrase:a,two_factor_token:u,two_factor_passcode:s}));case 2:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"refreshToken",value:(_=(0,o.default)(i.default.mark(function e(){var t,r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRegistered()){e.next=2;break}throw new S;case 2:if(this.token){e.next=4;break}throw Error("No token to refresh");case 4:return t={grant_type:"refresh_token",refresh_token:this.token.refreshToken,client_id:this.oauthOptions.clientID,client_secret:this.oauthOptions.clientSecret},e.prev=5,e.next=8,this.fetchJSONWithCurrentToken("POST","/auth/access_token",this.dataToQueryString(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 8:return r=e.sent,n=new y.default(k({refresh_token:this.token.refreshToken},r)),this.setToken(n),this.onTokenRefresh&&"function"==typeof this.onTokenRefresh&&this.onTokenRefresh(n),e.abrupt("return",n);case 15:if(e.prev=15,e.t0=e.catch(5),!this.isRevocationError(e.t0)){e.next=21;break}throw this.onRevocationChange(!0),b.default.warn("Client has been revoked. Please authenticate again."),e.t0;case 21:if(!(m.default.EXPIRED_TOKEN.test(e.t0.message)||m.default.INVALID_TOKEN.test(e.t0.message)||m.default.INVALID_TOKEN_ALT.test(e.t0.message))){e.next=28;break}return e.next=24,this.checkForRevocation();case 24:if(!e.sent){e.next=28;break}throw b.default.warn("Client has been revoked. Please authenticate again."),e.t0;case 28:throw e.t0;case 29:case"end":return e.stop()}},e,this,[[5,15]])})),function(){return _.apply(this,arguments)})},{key:"exchangeOAuthSecret",value:function(e,t){return this.fetchJSON("POST",e+"/auth/secret_exchange",{secret:t})}},{key:"setToken",value:function(e){e?this.token=e instanceof y.default?e:new y.default(e):this.token=null}},{key:"setCredentials",value:function(e){return(0,v.default)("setCredentials is deprecated, please replace by setToken"),this.setToken(e)}},{key:"setOAuthOptions",value:function(e){this.oauthOptions=this.camelCaseOAuthData(e)}},{key:"resetClientId",value:function(){this.oauthOptions.clientID=""}},{key:"resetClient",value:function(){this.resetClientId(),this.setUri(null),this.setToken(null)}},{key:"registrationAccessTokenToAuthHeader",value:function(){if(!this.oauthOptions.registrationAccessToken)throw Error("No registration access token");return"Bearer "+this.oauthOptions.registrationAccessToken}},{key:"setPassphraseFlagship",value:function(e){var t=e.registerToken,r=e.passwordHash,n=e.hint,a=e.key,i=e.publicKey,o=e.privateKey,u=e.iterations;return this.fetchJSON("POST","/settings/passphrase/flagship",{register_token:t,passphrase:r,hint:n,key:a,public_key:i,private_key:o,iterations:u,client_id:this.oauthOptions.clientID,client_secret:this.oauthOptions.clientSecret},{headers:{Authorization:this.registrationAccessTokenToAuthHeader()}})}},{key:"checkForRevocation",value:(P=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchInformation();case 3:case 11:return e.abrupt("return",!1);case 6:if(e.prev=6,e.t0=e.catch(0),!this.isRevocationError(e.t0)){e.next=11;break}return this.onRevocationChange(!0),e.abrupt("return",!0);case 12:case"end":return e.stop()}},e,this,[[0,6]])})),function(){return P.apply(this,arguments)})}]),x}(h.default),S=function(e){(0,d.default)(r,e);var t=O(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Client not registered or missing OAuth information";return(0,s.default)(this,r),(e=t.call(this,n)).message=n,e.name="NotRegisteredException",e}return r}((0,a.default)(Error));t.default=_},54348:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.OAUTH_CLIENTS_DOCTYPE=void 0;var i=a(r(68434)),o=a(r(41)),u=a(r(82007)),c=a(r(65105)),s=a(r(19723)),l=a(r(25665)),d=a(r(27952)),f=a(r(12323)),p=a(r(64512)),h=a(r(27361)),y=a(r(67267)),v=r(66804),m=n(r(93726)),b=r(78140),g=r(45051);function k(){var e=(0,o.default)(["/settings/clients/",""]);return k=function(){return e},e}function O(){var e=(0,o.default)(["/settings/clients/",""]);return O=function(){return e},e}function w(){var e=(0,o.default)(["/settings/clients"]);return w=function(){return e},e}function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach(function(t){(0,p.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var P="io.cozy.oauth.clients";t.OAUTH_CLIENTS_DOCTYPE=P;var C=y.default.normalizeDoctypeJsonApi(P),x=function(e){return S(S({},C(e,P)),e.attributes)},E=function(e){(0,l.default)(y,e);var t,r,n,a,o,p=(t=y,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,f.default)(t);return e=r?Reflect.construct(n,arguments,(0,f.default)(this).constructor):n.apply(this,arguments),(0,d.default)(this,e)});function y(e){return(0,c.default)(this,y),p.call(this,P,e)}return(0,s.default)(y,[{key:"all",value:(n=(0,u.default)(i.default.mark(function e(){var t,r,n,a,o,u,c,s,l,d,f,p,y,g,k=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0===(r=(t=k.length>0&&void 0!==k[0]?k[0]:{}).limit)?100:r,a=t.bookmark,o=t.keys,u={"page[limit]":n,"page[cursor]":a},c=(0,v.uri)(w()),s=m.buildURL(c,u),e.prev=5,e.next=8,this.stackClient.fetchJSON("GET",s);case 8:l=e.sent,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(5),e.abrupt("return",(0,b.dontThrowNotFoundError)(e.t0));case 14:if(d=(0,h.default)(l,"links.next",""),p=void 0!==(f=new URL("".concat(this.stackClient.uri).concat(d)).searchParams.get("page[cursor]")||void 0),!o){e.next=24;break}return y=l.data.filter(function(e){return o.includes(e.id)}).map(function(e){return x(e)}),g=S(S({},l.meta),{},{count:y.length}),e.abrupt("return",{data:y,meta:g,next:o.length>y.length&&p,bookmark:f});case 24:return e.abrupt("return",{data:l.data.map(function(e){return x(e)}),meta:l.meta,next:p,bookmark:f});case 25:case"end":return e.stop()}},e,this,[[5,11]])})),function(){return n.apply(this,arguments)})},{key:"get",value:(a=(0,u.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.all({keys:[t]});case 2:r=e.sent;case 3:if(!r.next){e.next=9;break}return e.next=6,this.all({keys:[t],bookmark:r.bookmark});case 6:r=e.sent,e.next=3;break;case 9:if(!r.data.length){e.next=13;break}return e.abrupt("return",{data:x(r.data[0])});case 13:throw r.url=(0,v.uri)(O(),t),r.status="404",new g.FetchError(r,"Not Found");case 16:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"destroy",value:(o=(0,u.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t._id,e.next=3,this.stackClient.fetchJSON("DELETE",(0,v.uri)(k(),r));case 3:return e.abrupt("return",{data:S(S({},x(t)),{},{_deleted:!0})});case 4:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})}]),y}(y.default);E.normalizeDoctype=y.default.normalizeDoctypeJsonApi;t.default=E},96302:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.getPermissionsFor=void 0;var i=a(r(98235)),o=a(r(64512)),u=a(r(80295)),c=a(r(68434)),s=a(r(41)),l=a(r(82007)),d=a(r(65105)),f=a(r(19723)),p=a(r(25665)),h=a(r(27952)),y=a(r(12323)),v=n(r(67267)),m=r(49129),b=r(66804),g=a(r(79271));function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach(function(t){(0,o.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _(){var e=(0,s.default)(["/permissions/doctype/","/shared-by-link"]);return _=function(){return e},e}function S(){var e=(0,s.default)(["/permissions/",""]);return S=function(){return e},e}function P(){var e=(0,s.default)(["/permissions/",""]);return P=function(){return e},e}var C=function(e){return(0,v.normalizeDoc)(e,"io.cozy.permissions")},x=function(e){(0,p.default)(M,e);var t,r,n,a,o,s,v,m,O,x,j,A,T,I=(t=M,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,y.default)(t);return e=r?Reflect.construct(n,arguments,(0,y.default)(this).constructor):n.apply(this,arguments),(0,h.default)(this,e)});function M(){return(0,d.default)(this,M),I.apply(this,arguments)}return(0,f.default)(M,[{key:"get",value:(n=(0,l.default)(c.default.mark(function e(t){var r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",(0,b.uri)(P(),t));case 2:return r=e.sent,e.abrupt("return",{data:C(r.data)});case 4:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"create",value:(a=(0,l.default)(c.default.mark(function e(t){var r,n,a,i,o,s,l,d,f;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t._id,t._type,i=void 0===(a=t.codes)?"code":a,o=t.ttl,s=t.tiny,l=(0,u.default)(t,["_id","_type","codes","ttl","tiny"]),(d=new URLSearchParams).append("codes",i),o&&d.append("ttl",o),s&&d.append("tiny",!0),e.next=7,this.stackClient.fetchJSON("POST","/permissions?".concat(d),{data:{type:"io.cozy.permissions",attributes:l}});case 7:return f=e.sent,e.abrupt("return",{data:C(f.data)});case 9:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"add",value:(o=(0,l.default)(c.default.mark(function e(t,r){var n,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t._type,e.next="io.cozy.apps"===e.t0?3:"io.cozy.konnectors"===e.t0?5:"io.cozy.permissions"===e.t0?7:9;break;case 3:return n="/permissions/apps/".concat(t.slug),e.abrupt("break",10);case 5:return n="/permissions/konnectors/".concat(t.slug),e.abrupt("break",10);case 7:return n="/permissions/".concat(t._id),e.abrupt("break",10);case 9:throw Error("Permissions can only be added on existing permissions, apps and konnectors.");case 10:return e.next=12,this.stackClient.fetchJSON("PATCH",n,{data:{type:"io.cozy.permissions",attributes:{permissions:r}}});case 12:return a=e.sent,e.abrupt("return",{data:C(a.data)});case 14:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"destroy",value:function(e){return this.stackClient.fetchJSON("DELETE",(0,b.uri)(S(),e.id))}},{key:"findLinksByDoctype",value:(s=(0,l.default)(c.default.mark(function e(t){var r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",(0,b.uri)(_(),t));case 2:return r=e.sent,e.abrupt("return",w(w({},r),{},{data:r.data.map(C)}));case 4:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"findApps",value:(v=(0,l.default)(c.default.mark(function e(){var t;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g.default.warn("PermissionCollection.findApps will be removed in next version of cozy-client. \n\n      You can use AppCollection.all() instead \n\n      or even better client.query(Q('io.cozy.apps'), {as: 'io.cozy.apps'})"),e.next=3,this.stackClient.fetchJSON("GET","/apps/");case 3:return t=e.sent,e.abrupt("return",w(w({},t),{},{data:t.data.map(function(e){return w({_id:e.id},e)})}));case 5:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"createSharingLink",value:(m=(0,l.default)(c.default.mark(function e(t){var r,n,a=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(a.length>1&&void 0!==a[1]?a[1]:{}).verbs,e.next=4,this.stackClient.fetchJSON("POST","/permissions?codes=email",{data:{type:"io.cozy.permissions",attributes:{permissions:E(t,!0,r?{verbs:r}:{})}}});case 4:return n=e.sent,e.abrupt("return",{data:C(n.data)});case 6:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"fetchPermissionsByLink",value:(O=(0,l.default)(c.default.mark(function e(t){var r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.links&&t.links.next)){e.next=5;break}return e.next=3,this.stackClient.fetchJSON("GET",t.links.next);case 3:return r=e.sent,e.abrupt("return",w(w({},r),{},{data:r.data.map(C)}));case 5:case"end":return e.stop()}},e,this)})),function(e){return O.apply(this,arguments)})},{key:"fetchAllLinks",value:(x=(0,l.default)(c.default.mark(function e(t){var r,n,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findLinksByDoctype(t._type);case 2:n=r=e.sent;case 4:if(!(n.links&&n.links.next)){e.next=11;break}return e.next=7,this.fetchPermissionsByLink(n);case 7:n=e.sent,(a=r.data).push.apply(a,(0,i.default)(n.data)),e.next=4;break;case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"revokeSharingLink",value:(j=(0,l.default)(c.default.mark(function e(t){var r,n,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchAllLinks(t);case 2:r=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(e,t)}}(e))){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(e.sent.data.filter(function(e){return D(e,t)})),e.prev=5,r.s();case 7:if((n=r.n()).done){e.next=13;break}return a=n.value,e.next=11,this.destroy(a);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:case"end":return e.stop()}},e,this,[[5,15,18,21]])})),function(e){return j.apply(this,arguments)})},{key:"getOwnPermissions",value:(A=(0,l.default)(c.default.mark(function e(){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g.default.warn("getOwnPermissions is deprecated, please use fetchOwnPermissions instead"),e.abrupt("return",this.fetchOwnPermissions());case 2:case"end":return e.stop()}},e,this)})),function(){return A.apply(this,arguments)})},{key:"fetchOwnPermissions",value:(T=(0,l.default)(c.default.mark(function e(){var t;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET","/permissions/self");case 2:return t=e.sent,e.abrupt("return",{data:C(t.data),included:t.included?t.included.map(C):[]});case 4:case"end":return e.stop()}},e,this)})),function(){return T.apply(this,arguments)})}]),M}(v.default),E=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=e._id,a=e._type,i=r.verbs?r.verbs:t?["GET"]:["ALL"];return(0,m.isFile)(e)?{files:{type:"io.cozy.files",verbs:i,values:[n]}}:{collection:{type:a,verbs:i,values:[n]},files:{type:"io.cozy.files",verbs:i,values:["".concat(a,"/").concat(n)],selector:"referenced_by"}}};t.getPermissionsFor=E,x.normalizeDoctype=v.default.normalizeDoctypeJsonApi;var D=function(e,t){var r=t._id;return(0,m.isFile)(t)?-1!==e.attributes.permissions.files.values.indexOf(r):-1!==e.attributes.permissions.collection.values.indexOf(r)};t.default=x},96727:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.normalizeSettings=t.SETTINGS_DOCTYPE=void 0;var i=a(r(41)),o=a(r(68434)),u=a(r(82007)),c=a(r(65105)),s=a(r(19723)),l=a(r(25665)),d=a(r(27952)),f=a(r(12323)),p=a(r(64512)),h=n(r(67267)),y=a(r(79271)),v=r(66804);function m(){var e=(0,i.default)(["/data/","/",""]);return m=function(){return e},e}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach(function(t){(0,p.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var k="io.cozy.settings";t.SETTINGS_DOCTYPE=k;var O=function(e){var t=(0,h.normalizeDoc)(e,k);return g(g({},t),t.attributes)};t.normalizeSettings=O;var w=function(e){(0,l.default)(p,e);var t,r,n,a,i=(t=p,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,f.default)(t);return e=r?Reflect.construct(n,arguments,(0,f.default)(this).constructor):n.apply(this,arguments),(0,d.default)(this,e)});function p(e){return(0,c.default)(this,p),i.call(this,k,e)}return(0,s.default)(p,[{key:"get",value:(n=(0,u.default)(o.default.mark(function e(t){var r,n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("io.cozy.settings.bitwarden"!==t){e.next=5;break}return e.next=3,this.stackClient.fetchJSON("GET","/data/io.cozy.settings/io.cozy.settings.bitwarden");case 3:return r=e.sent,e.abrupt("return",{data:h.default.normalizeDoctypeJsonApi(k)(r,r)});case 5:return t.startsWith("io.cozy.settings.")?n=t.substring(17):(y.default.warn("Deprecated: in next versions of cozy-client, it will not be possible to query settings with an incomplete id\n\n- Q('io.cozy.settings').getById('instance')\n+ Q('io.cozy.settings').getById('io.cozy.settings.instance')"),n=t),e.next=8,this.stackClient.fetchJSON("GET","/settings/".concat(n));case 8:return a=e.sent,e.abrupt("return",{data:O(g({id:"/settings/".concat(n)},a.data))});case 10:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"update",value:(a=(0,u.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("io.cozy.settings.instance"!==t._id){e.next=6;break}return e.next=3,this.stackClient.fetchJSON("PUT","/settings/instance",{data:t});case 3:r=e.sent,e.next=9;break;case 6:return e.next=8,this.stackClient.fetchJSON("PUT",(0,v.uri)(m(),this.doctype,t._id),t);case 8:r=e.sent;case 9:return e.abrupt("return",{data:O(r.data)});case 10:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})}]),p}(h.default);w.normalizeDoctype=h.default.normalizeDoctypeJsonApi;t.default=w},67207:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.getSharingRules=t.BITWARDEN_CIPHERS_DOCTYPE=t.BITWARDEN_ORGANIZATIONS_DOCTYPE=t.SHARING_DOCTYPE=void 0;var i=a(r(68434)),o=a(r(64512)),u=a(r(41)),c=a(r(82007)),s=a(r(65105)),l=a(r(19723)),d=a(r(25665)),f=a(r(27952)),p=a(r(12323)),h=n(r(67267)),y=r(49129),v=r(66804),m=a(r(79271));function b(){var e=(0,u.default)(["/sharings/","/recipients"]);return b=function(){return e},e}function g(){var e=(0,u.default)(["/sharings/","/recipients/self"]);return g=function(){return e},e}function k(){var e=(0,u.default)(["/sharings/","/groups/",""]);return k=function(){return e},e}function O(){var e=(0,u.default)(["/sharings/","/recipients/",""]);return O=function(){return e},e}function w(){var e=(0,u.default)(["/sharings/","/recipients"]);return w=function(){return e},e}function _(){var e=(0,u.default)(["/sharings/",""]);return _=function(){return e},e}function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach(function(t){(0,o.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function C(){var e=(0,u.default)(["/sharings/doctype/",""]);return C=function(){return e},e}var x="io.cozy.sharings";t.SHARING_DOCTYPE=x;var E="com.bitwarden.organizations";t.BITWARDEN_ORGANIZATIONS_DOCTYPE=E;var D="com.bitwarden.ciphers";t.BITWARDEN_CIPHERS_DOCTYPE=D;var j=function(e){return(0,h.normalizeDoc)(e,x)},A=function(e){(0,d.default)(S,e);var t,r,n,a,o,u,h,y=(t=S,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,p.default)(t);return e=r?Reflect.construct(n,arguments,(0,p.default)(this).constructor):n.apply(this,arguments),(0,f.default)(this,e)});function S(){return(0,s.default)(this,S),y.apply(this,arguments)}return(0,l.default)(S,[{key:"findByDoctype",value:(n=(0,c.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",(0,v.uri)(C(),t));case 2:return r=e.sent,e.abrupt("return",P(P({},r),{},{data:r.data.map(j)}));case 4:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"get",value:(a=(0,c.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,v.uri)(_(),t),e.next=3,this.stackClient.fetchJSON("GET",r);case 3:return n=e.sent,e.abrupt("return",{data:j(n.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"create",value:(o=(0,c.default)(i.default.mark(function e(t){var r,n,a,o,u,c,s,l,d,f,p,h,y;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.document,n=t.description,a=t.previewPath,o=t.rules,c=void 0===(u=t.recipients)?[]:u,l=void 0===(s=t.readOnlyRecipients)?[]:s,d=t.openSharing,f=t.appSlug,p={description:n,preview_path:a,open_sharing:d,rules:o||I(r)},h={},f&&(h={app_slug:f}),e.next=6,this.stackClient.fetchJSON("POST","/sharings/",{data:{type:"io.cozy.sharings",attributes:P(P({},p),h),relationships:P(P({},c.length>0&&{recipients:{data:c.map(z)}}),l.length>0&&{read_only_recipients:{data:l.map(z)}})}});case 6:return y=e.sent,e.abrupt("return",{data:j(y.data)});case 8:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"share",value:(u=(0,c.default)(i.default.mark(function e(t,r,n,a){var o,u,c=arguments;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=c.length>4&&void 0!==c[4]?c[4]:null,m.default.warn("SharingCollection.share is deprecated, use SharingCollection.create instead"),u="two-way"===n?{recipients:r}:{readOnlyRecipients:r},e.abrupt("return",this.create(P(P({document:t},u),{},{description:a,previewPath:o,openSharing:"two-way"===n,rules:I(t,n)})));case 4:case"end":return e.stop()}},e,this)})),function(e,t,r,n){return u.apply(this,arguments)})},{key:"getDiscoveryLink",value:function(e,t){return this.stackClient.fullpath("/sharings/".concat(e,"/discovery?sharecode=").concat(t))}},{key:"addRecipients",value:(h=(0,c.default)(i.default.mark(function e(t){var r,n,a,o,u,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.document,a=void 0===(n=t.recipients)?[]:n,u=void 0===(o=t.readOnlyRecipients)?[]:o,e.next=3,this.stackClient.fetchJSON("POST",(0,v.uri)(w(),r._id),{data:{type:"io.cozy.sharings",id:r._id,relationships:P(P({},a.length>0&&{recipients:{data:a.map(z)}}),u.length>0&&{read_only_recipients:{data:u.map(z)}})}});case 3:return c=e.sent,e.abrupt("return",{data:j(c.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"revokeRecipient",value:function(e,t){return this.stackClient.fetchJSON("DELETE",(0,v.uri)(O(),e._id,t))}},{key:"revokeGroup",value:function(e,t){return this.stackClient.fetchJSON("DELETE",(0,v.uri)(k(),e._id,t))}},{key:"revokeSelf",value:function(e){return this.stackClient.fetchJSON("DELETE",(0,v.uri)(g(),e._id))}},{key:"revokeAllRecipients",value:function(e){return this.stackClient.fetchJSON("DELETE",(0,v.uri)(b(),e._id))}}]),S}(h.default);A.normalizeDoctype=h.default.normalizeDoctypeJsonApi;var T=function(e,t){return(0,y.isFile)(e)?F(e,t):e._type===E?B(e):M(e,t)},I=function(e,t){return t&&m.default.warn("sharingType is deprecated and will be removed. We now set this default rules: ".concat(T(e),"} \n      \n      If this default rules do not fill your need, please set custom rules \n      by using the 'rules' object of the SharingCollection.create() method")),T(e,t)};t.getSharingRules=I;var M=function(e,t){var r=e._id,n=e._type;return[P({title:"collection",doctype:n,values:[r]},N(t)),P({title:"items",doctype:"io.cozy.files",values:["".concat(n,"/").concat(r)],selector:"referenced_by"},R(t))]},R=function(e){return"two-way"===e?{add:"sync",update:"sync",remove:"sync"}:{add:"push",update:"none",remove:"push"}},N=function(e){return e?"two-way"===e?{update:"sync",remove:"revoke"}:{update:"push",remove:"revoke"}:{update:"sync",remove:"revoke"}},F=function(e,t){var r=e._id;return[P({title:e.name,doctype:"io.cozy.files",values:[r]},L(e,t))]},L=function(e,t){if((0,y.isDirectory)(e))return t?"two-way"===t?{add:"sync",update:"sync",remove:"sync"}:{add:"push",update:"push",remove:"push"}:{add:"sync",update:"sync",remove:"sync"};return t?"two-way"===t?{update:"sync",remove:"revoke"}:{update:"push",remove:"revoke"}:{update:"sync",remove:"revoke"}},B=function(e){var t=e._id;return[{title:e.name,doctype:E,values:[t],add:"sync",update:"sync",remove:"revoke"},{title:"Ciphers",doctype:D,values:[t],add:"sync",update:"sync",remove:"sync",selector:"organization_id"}]},z=function(e){return{id:e._id,type:e._type}};t.default=A},86247:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SHORTCUTS_DOCTYPE=void 0;var a=n(r(68434)),i=n(r(41)),o=n(r(82007)),u=n(r(65105)),c=n(r(19723)),s=n(r(25665)),l=n(r(27952)),d=n(r(12323)),f=n(r(67267)),p=r(66804),h=r(77069);function y(){var e=(0,i.default)(["/shortcuts/",""]);return y=function(){return e},e}function v(){var e=(0,i.default)(["/shortcuts"]);return v=function(){return e},e}var m="io.cozy.files.shortcuts";t.SHORTCUTS_DOCTYPE=m;var b=function(e){(0,s.default)(g,e);var t,r,n,i,b=(t=g,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,d.default)(t);return e=r?Reflect.construct(n,arguments,(0,d.default)(this).constructor):n.apply(this,arguments),(0,l.default)(this,e)});function g(e){return(0,u.default)(this,g),b.call(this,m,e)}return(0,c.default)(g,[{key:"create",value:(n=(0,o.default)(a.default.mark(function e(t){var r,n,i,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.type&&(t.type=m),!(!t.name||!t.name.trim()||!t.url||!t.dir_id)){e.next=3;break}throw Error("you need at least a name, an url and a dir_id attributes to create a shortcut");case 3:if(!("."===(r=t.name.trim())||".."===r)){e.next=6;break}throw Error("Invalid filename: ".concat(r));case 6:if(!(n=(0,h.getIllegalCharacters)(r)).length){e.next=9;break}throw Error("Invalid filename containing illegal character(s): ".concat(n));case 9:return i=(0,p.uri)(v()),e.next=12,this.stackClient.fetchJSON("POST",i,{data:{attributes:t,type:"io.cozy.files.shortcuts"}});case 12:return o=e.sent,e.abrupt("return",{data:f.default.normalizeDoctypeJsonApi(m)(o.data,o)});case 14:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"get",value:(i=(0,o.default)(a.default.mark(function e(t){var r,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,p.uri)(y(),t),e.next=3,this.stackClient.fetchJSON("GET",r);case 3:return n=e.sent,e.abrupt("return",{data:f.default.normalizeDoctypeJsonApi(m)(n.data,n)});case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})}]),g}(f.default);b.normalizeDoctype=f.default.normalizeDoctypeJsonApi;t.default=b},54026:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isForAccount=t.isForKonnector=t.normalizeTrigger=t.TRIGGERS_DOCTYPE=t.JOBS_DOCTYPE=void 0;var i=a(r(80295)),o=a(r(41)),u=a(r(68434)),c=a(r(82007)),s=a(r(65105)),l=a(r(19723)),d=a(r(59655)),f=a(r(25665)),p=a(r(27952)),h=a(r(12323)),y=a(r(64512)),v=n(r(78140)),m=n(r(67267)),b=r(54056),g=r(66804);function k(){var e=(0,o.default)(["/jobs/triggers/","/launch"]);return k=function(){return e},e}function O(){var e=(0,o.default)(["/jobs/triggers/",""]);return O=function(){return e},e}function w(){var e=(0,o.default)(["/jobs/triggers/",""]);return w=function(){return e},e}function _(){var e=(0,o.default)(["/jobs/triggers"]);return _=function(){return e},e}r(45051);function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach(function(t){(0,y.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}t.JOBS_DOCTYPE="io.cozy.jobs";var C="io.cozy.triggers";t.TRIGGERS_DOCTYPE=C;var x=function(e){return P(P(P({},e),(0,m.normalizeDoc)(e,C)),e.attributes)};t.normalizeTrigger=x;t.isForKonnector=function(e,t){return"konnector"===e.worker&&e.message.konnector==t};t.isForAccount=function(e,t){return e.message.account==t};var E=function(e,t){var r=new URLSearchParams;return e&&(Array.isArray(e.$in)?r.set("Worker",e.$in.join(",")):r.set("Worker",e)),t&&(Array.isArray(t.$in)?r.set("Type",t.$in.join(",")):r.set("Type",t)),r.toString()},D=function(e){(0,f.default)(A,e);var t,r,n,a,o,y,m,S,D,j=(t=A,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,h.default)(t);return e=r?Reflect.construct(n,arguments,(0,h.default)(this).constructor):n.apply(this,arguments),(0,p.default)(this,e)});function A(e){return(0,s.default)(this,A),j.call(this,C,e)}return(0,l.default)(A,[{key:"all",value:(n=(0,c.default)(u.default.mark(function e(){var t,r,n=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.length>0&&void 0!==n[0]&&n[0],e.prev=1,e.next=4,this.stackClient.fetchJSON("GET","/jobs/triggers");case 4:return r=e.sent,e.abrupt("return",{data:r.data.map(function(e){return x(e,C)}),meta:{count:r.data.length},next:!1,skip:0});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",(0,v.dontThrowNotFoundError)(e.t0));case 11:case"end":return e.stop()}},e,this,[[1,8]])})),function(){return n.apply(this,arguments)})},{key:"create",value:(a=(0,c.default)(u.default.mark(function e(t){var r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,g.uri)(_()),e.next=3,this.stackClient.fetchJSON("POST",r,{data:{attributes:t}});case 3:return n=e.sent,e.abrupt("return",{data:x(n.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"destroy",value:(o=(0,c.default)(u.default.mark(function e(t){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t._id){e.next=3;break}throw Error("TriggerCollection.destroy needs a document with an _id");case 3:return e.next=5,this.stackClient.fetchJSON("DELETE",(0,g.uri)(w(),r));case 5:return e.abrupt("return",{data:x(P(P({},t),{},{_deleted:!0}))});case 6:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"find",value:(y=(0,c.default)(u.default.mark(function e(){var t,r,n,a,o,c,s=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},r=s.length>1&&void 0!==s[1]?s[1]:{},n=t.worker,a=t.type,0!==Object.keys((0,i.default)(t,["worker","type"])).length){e.next=18;break}return o="/jobs/triggers?".concat(E(n,a)),e.prev=6,e.next=9,this.stackClient.fetchJSON("GET",o);case 9:return c=e.sent,e.abrupt("return",{data:c.data.map(function(e){return x(e,C)}),meta:{count:c.data.length},next:!1,skip:0});case 13:return e.prev=13,e.t0=e.catch(6),e.abrupt("return",(0,v.dontThrowNotFoundError)(e.t0));case 16:e.next=19;break;case 18:return e.abrupt("return",(0,d.default)((0,h.default)(A.prototype),"find",this).call(this,t,r));case 19:case"end":return e.stop()}},e,this,[[6,13]])})),function(){return y.apply(this,arguments)})},{key:"get",value:(m=(0,c.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",v.default.get(this.stackClient,(0,g.uri)(O(),t),{normalize:x}));case 1:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"launch",value:(S=(0,c.default)(u.default.mark(function e(t){var r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,g.uri)(k(),t._id),e.next=3,this.stackClient.fetchJSON("POST",r);case 3:return n=e.sent,e.abrupt("return",{data:(0,b.normalizeJob)(n.data)});case 5:case"end":return e.stop()}},e,this)})),function(e){return S.apply(this,arguments)})},{key:"update",value:(D=(0,c.default)(u.default.mark(function e(t){var r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=u.default.keys(t);case 1:if((e.t1=e.t0()).done){e.next=7;break}if(["_id","_rev","_type","arguments","message","cozyMetadata"].includes(e.t1.value)){e.next=5;break}throw Error("TriggerCollection.update only works for 'arguments', and 'message' attributes.");case 5:e.next=1;break;case 7:return r=P(P({},t.arguments?{arguments:t.arguments}:{}),t.message?{message:t.message}:{}),e.next=10,this.stackClient.fetchJSON("PATCH","/jobs/triggers/".concat(t._id),{data:{attributes:r}});case 10:return n=e.sent,e.abrupt("return",{data:x(n.data)});case 12:case"end":return e.stop()}},e,this)})),function(e){return D.apply(this,arguments)})}]),A}(m.default);D.normalizeDoctype=m.default.normalizeDoctypeJsonApi;t.default=D},45051:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.FetchError=t.default=void 0;var a=n(r(65105)),i=n(r(8997)),o=n(r(25665)),u=n(r(27952)),c=n(r(12323)),s=n(r(15500)),l=/the client must be registered/;t.default={EXPIRED_TOKEN:/Expired token/,CLIENT_NOT_FOUND:/Client not found/,INVALID_TOKEN:/Invalid JWT token/,INVALID_TOKEN_ALT:/Invalid token/,UNREGISTERED_CLIENT:l};var d=/invalid_token/,f=/access_token_expired/,p=function(e){var t,r=null===(t=e.headers)||void 0===t?void 0:t.get("www-authenticate");if(r){if(f.test(r))return"Expired token";if(d.test(r))return"Invalid token"}},h=function(e){(0,o.default)(s,e);var t,r,n=(t=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,c.default)(t);return e=r?Reflect.construct(n,arguments,(0,c.default)(this).constructor):n.apply(this,arguments),(0,u.default)(this,e)});function s(e,t){if((0,a.default)(this,s),c=n.call(this),null===(u=Error.captureStackTrace)||void 0===u||u.call(Error,(0,i.default)(c),c.constructor),c.name="FetchError",c.response=e,c.url=e.url,c.status=e.status,c.reason=t,null===t)throw Error("FetchError received a ".concat(e.status," error without a Response Body when calling ").concat(e.url));var r,o,u,c,d=p(e);return Object.defineProperty((0,i.default)(c),"message",{value:(r=t,o=d,("string"==typeof r.error&&l.test(r.error)?r.error:void 0)||r.message||o||("string"==typeof r?r:JSON.stringify(r)))}),c}return s}((0,s.default)(Error));t.FetchError=h},79954:function(e,t,r){var n,a,i=r(14746),o=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.getIconURL=t.default=t._getIconURL=void 0;var u=o(r(68434)),c=o(r(82007));r(79312);var s=i(r(23355));function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var d=function(e,t,r,n){if(!r)throw Error("Cannot fetch icon: missing domain");var a=f(e,t,r,n);if(!a)throw Error("Cannot get icon source for app ".concat(e.name));return a},f=function(e,t,r,n){var a=e&&e.links&&e.links.icon||p(e,t);return a?"".concat(n,"//").concat(r).concat(a):null},p=function(e,t){return t?"/registry/".concat(t,"/icon"):e&&e.latest_version&&e.latest_version.version&&"/registry/".concat(e.slug,"/").concat(e.latest_version.version,"/icon")},h={gif:"image/gif",ico:"image/vnd.microsoft.icon",jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml"},y=function(e){if(!e.icon)throw Error("".concat(e.name,": Cannot detect icon mime type since app has no icon"));var t=e.icon.split(".").pop();if(!t)throw Error("".concat(e.name,": Unable to detect icon mime type from extension (").concat(e.icon,")"));return t};var v=(n=(0,c.default)(u.default.mark(function e(t,r){var n,a,i,o,c;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=function(e,t){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}}(e))){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{!o&&null!=a.return&&a.return()}finally{if(u)throw i}}}}(t),e.prev=1,a.s();case 3:if((i=a.n()).done){e.next=18;break}return o=i.value,e.prev=5,e.next=8,o();case 8:return c=e.sent,r&&r(c),e.abrupt("return",c);case 13:e.prev=13,e.t0=e.catch(5),n=e.t0;case 16:e.next=3;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(1),a.e(e.t1);case 23:return e.prev=23,a.f(),e.finish(23);case 26:throw n;case 27:case"end":return e.stop()}},e,null,[[1,20,23,26],[5,13]])})),function(e,t){return n.apply(this,arguments)});var m=(a=(0,c.default)(u.default.mark(function e(t,r){var n,a,i,o,c,s,l,f,p,m,b,g,k,O;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.type,a=r.slug,i=r.appData,c=void 0===(o=r.priority)?"stack":o,!t.oauthOptions){e.next=29;break}return s=[function(){return t.fetch("GET","/".concat(n,"s/").concat(a,"/icon"))},function(){return t.fetch("GET","/registry/".concat(a,"/icon"))}],"registry"===c&&s.reverse(),e.next=6,v(s,function(e){if(!e.ok)throw Error("Error while fetching icon ".concat(e.statusText))});case 6:return l=e.sent,e.next=9,l.blob();case 9:if((f=e.sent).type){e.next=26;break}if(m=[function(){var e,r,i;return e=t,r=n,i=a,e.fetchJSON("GET","/".concat(r,"s/").concat(i)).then(function(e){return e.data.attributes})},function(){var e,r,n;return e=t,r=0,n=a,e.fetchJSON("GET","/registry/".concat(n)).then(function(e){return e.latest_version.manifest})}],"registry"===c&&m.reverse(),e.t1=i,e.t1){e.next=18;break}return e.next=17,v(m);case 17:e.t1=e.sent;case 18:if(e.t0=e.t1,e.t0){e.next=21;break}e.t0={};case 21:if(h[b=y(p=e.t0)]){e.next=25;break}throw Error('Unknown image extension "'.concat(b,'" for app ').concat(p.name));case 25:f=new Blob([f],{type:h[b]});case 26:return e.abrupt("return",URL.createObjectURL(f));case 29:return e.prev=29,k=(g=new URL(t.uri)).host,O=g.protocol,e.abrupt("return",d(i,a,k,O));case 34:throw e.prev=34,e.t2=e.catch(29),Error("Cannot fetch icon: invalid stackClient.uri: ".concat(e.t2.message));case 37:case"end":return e.stop()}},e,null,[[29,34]])})),function(e,t){return a.apply(this,arguments)});t._getIconURL=m;var b=function(){return m.apply(this,arguments).catch(function(){return new s.ErrorReturned})};t.getIconURL=b;var g=(0,s.default)(b,{maxDuration:3e5,key:function(e,t){var r=t.type,n=t.slug,a=t.priority;return e.uri+NaN+r+":"+n+":"+a}});t.default=g},77069:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getIllegalCharacters=void 0;t.getIllegalCharacters=function(e){var t=e.match(/\/|\x00|\n|\r/g);return t?t.join(" "):""}},60359:function(e,t,r){var n=r(14746),a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"OAuthClient",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"errors",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"FetchError",{enumerable:!0,get:function(){return u.FetchError}}),Object.defineProperty(t,"normalizeDoc",{enumerable:!0,get:function(){return c.normalizeDoc}});var i=a(r(29328)),o=a(r(29985)),u=n(r(45051)),c=r(67267)},66605:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(79271));t.default=function(){a.default.warn.apply(a.default,arguments)}},79271:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(60732)),i=(0,a.default)("cozy-stack-client");a.default.suggest.deny("cozy-stack-client","info");t.default=i},35946:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.makeOperatorsExplicit=t.isMatchingIndex=t.getIndexFields=t.transformSort=t.getIndexNameFromFields=t.makeKeyFromPartialFilter=t.normalizeDesignDoc=void 0;var a=n(r(98235)),i=n(r(90402)),o=n(r(64512)),u=n(r(91175)),c=n(r(27361)),s=n(r(18446)),l=n(r(13218));function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}t.normalizeDesignDoc=function(e){var t=e._id||e.id;return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach(function(t){(0,o.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({id:t,_id:t},e.doc)};var f=function e(t){return"object"!=typeof t||null===t?String(t):Object.entries(t).map(function(t){var r=(0,i.default)(t,2),n=r[0],a=r[1];if(Array.isArray(a)&&a.every(function(e){return"string"==typeof e}))return"".concat(n,"_(").concat(a.join("_"),")");if(Array.isArray(a))return"(".concat(a.map(function(t){return"".concat(e(t))}).join(")_".concat(n,"_(")),")");if("object"==typeof a)return"".concat(n,"_").concat(e(a));else return"".concat(n,"_").concat(a)}).join(")_and_(")};t.makeKeyFromPartialFilter=f;t.getIndexNameFromFields=function(e,t){var r="by_".concat(e.join("_and_"));return t?"".concat(r,"_filter_(").concat(f(t),")"):r};t.transformSort=function(e){if(!e||Array.isArray(e))return e;throw Error('Passing an object to the "sort" is not supported')};t.getIndexFields=function(e){var t=e.selector,r=e.partialFilter,n=e.sort;return Array.from(new Set([].concat((0,a.default)((void 0===n?[]:n).map(function(e){return(0,u.default)(Object.keys(e))})),(0,a.default)(t?Object.keys(t):[]),(0,a.default)(r?Object.keys(r):[]))))};t.isMatchingIndex=function(e,t,r){var n=Object.keys((0,c.default)(e,"views"))[0],a=Object.keys((0,c.default)(e,"views.".concat(n,".map.fields")));if((0,s.default)(a,t)){var i=(0,c.default)(e,"views.".concat(n,".map.partial_filter_selector"));if(!r&&!i)return!0;var o=p(null!=r?r:{});if((0,s.default)(o,i))return!0}return!1};var p=function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object.entries(t).reduce(function(t,n){var a,u=(0,i.default)(n,2),c=u[0],s=u[1];if("$nor"===c)t.$and=s.map(function(e){return Object.entries(e).reduce(function(e,t){var r=(0,i.default)(t,2),n=r[0],a=r[1];return"string"==typeof a?e[n]={$ne:a}:e[n]=p(a,!0),e},{})});else null!==(a=s.$or)&&void 0!==a&&a.every(function(e){return"string"==typeof e})?t.$or=s.$or.map(function(t){return e((0,o.default)({},c,t),r)}):Array.isArray(s)&&s.every(l.default)?t[c]=s.map(function(t){return e(t,r)}):(0,l.default)(s)&&!Array.isArray(s)?t[c]=e(s,r):r&&"$eq"===c?t.$ne=s:c.startsWith("$")?t[c]=s:t[c]={$eq:s};return t},{}),a=Object.keys(n);return 1===a.length?n:{$and:a.map(function(e){return(0,o.default)({},e,n[e])})}};t.makeOperatorsExplicit=p},23355:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorReturned=t.default=void 0;var a=n(r(65105)),i=n(r(25665)),o=n(r(27952)),u=n(r(12323)),c=n(r(15500)),s=function(e){(0,i.default)(c,e);var t,r,n=(t=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,u.default)(t);return e=r?Reflect.construct(n,arguments,(0,u.default)(this).constructor):n.apply(this,arguments),(0,o.default)(this,e)});function c(){return(0,a.default)(this,c),n.apply(this,arguments)}return c}((0,c.default)(String));t.ErrorReturned=s;var l=function(e,t){for(var r=Date.now(),n=0,a=Object.keys(e);n<a.length;n++){var i=a[n];r-e[i].date>t&&delete e[i]}};t.default=function(e,t){var r={};return function(){var n,a=t.key.apply(null,arguments);l(r,t.maxDuration);var i=r[a];if(i)return i.result;var o=e.apply(this,arguments);if(r[a]={result:o,date:Date.now()},"object"==typeof(n=o)&&"function"==typeof n.then)o.then(function(e){e instanceof s&&delete r[a]}).catch(function(e){delete r[a]});return o}}},20368:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(68434)),i=n(r(82007)),o=n(r(65105)),u=n(r(19723)),c=function(){var e;function t(){(0,o.default)(this,t),this.pending={}}return(0,u.default)(t,[{key:"exec",value:(e=(0,i.default)(a.default.mark(function e(t,r){var n,i,o,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r(),(i=this.pending[n])?o=i:(o=t(),this.pending[n]=o),e.prev=3,e.next=6,o;case 6:return u=e.sent,e.abrupt("return",u);case 8:return e.prev=8,this.pending[n]=null,e.finish(8);case 11:case"end":return e.stop()}},e,this,[[3,,8,11]])})),function(t,r){return e.apply(this,arguments)})},{key:"get",value:function(e){var t=e(),r=this.pending[t];return r?r:null}}]),t}();t.default=c},93726:function(e,t,r){var n=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.buildURL=t.encode=void 0;var a=n(r(90402)),i=n(r(35937)),o=function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.isArray(t)?"["+t.map(function(t){return e(t,!0)}).join(",")+"]":r?encodeURIComponent('"'.concat(t,'"')):encodeURIComponent(t)},u=function(e){return Object.entries(e).map(function(e){var t=(0,a.default)(e,2),r=t[0],n=o(t[1]);return"".concat(r,"=").concat(n)}).join("&")};t.encode=u;t.buildURL=function(e,t){var r=u((0,i.default)(t));return r?"".concat(e,"?").concat(r):e}},79312:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={}},66804:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.joinPath=function(e,t){return"".concat(e).concat(e.endsWith("/")?"":"/").concat(t)},t.encodePath=t.forceDownload=t.formatBytes=t.slugify=t.sleep=t.attempt=t.uri=void 0;t.uri=function(e){for(var t=[e[0]],r=0;r<(arguments.length<=1?0:arguments.length-1);r++)t.push(encodeURIComponent(r+1<1||arguments.length<=r+1?void 0:arguments[r+1])+e[r+1]);return t.join("")};t.attempt=function(e){return e.then(function(){return!0}).catch(function(){return!1})};t.sleep=function(e,t){return new Promise(function(r){setTimeout(r,e,t)})};t.slugify=function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")};t.formatBytes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var r=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,r)).toFixed(t<0?0:t))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][r]};t.forceDownload=function(e,t){var r=document.createElement("a");r.setAttribute("href",e),r.setAttribute("download",t),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)};t.encodePath=function(e){return e.split("/").map(function(e){return encodeURIComponent(e).replace(/\(/g,"%28").replace(/\)/g,"%29")}).join("/")}},38558:function(e,t,r){var n,a=r(5751);Object.defineProperty(t,"__esModule",{value:!0}),t.shouldXMLHTTPRequestBeUsed=t.fetchWithXMLHttpRequest=void 0;var i=a(r(68434)),o=a(r(90402)),u=a(r(82007)),c=a(r(88306));var s=(n=(0,u.default)(i.default.mark(function e(t,r){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(e,n){var a=new XMLHttpRequest;r.onUploadProgress&&a.upload&&a.upload.addEventListener("progress",r.onUploadProgress,!1),a.onload=function(){4==this.readyState?e(this):n(this)},a.onerror=function(e){n(e)},a.open(r.method,t,!0),a.withCredentials=!0;for(var i=0,u=Object.entries(r.headers);i<u.length;i++){var c=(0,o.default)(u[i],2),s=c[0],l=c[1];a.setRequestHeader(s,l)}a.send(r.body)});case 2:return n=e.sent,e.abrupt("return",{headers:new Headers(n.getAllResponseHeaders().split("\r\n").map(function(e){return e.split(":",2)}).filter(function(e){return 2==e.length})),ok:n.status>=200&&n.status<300,text:function(){var e=(0,u.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.responseText);case 1:case"end":return e.stop()}},e)}));return function t(){return e.apply(this,arguments)}}(),json:function(){var e=(0,u.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",JSON.parse(n.responseText));case 1:case"end":return e.stop()}},e)}));return function t(){return e.apply(this,arguments)}}(),status:n.status,statusText:n.statusText});case 4:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)});t.fetchWithXMLHttpRequest=s;var l=(0,c.default)(function(){var e=new XMLHttpRequest;return"onload"in e&&"onprogress"in e});t.shouldXMLHTTPRequestBeUsed=function(e,t,r){return!!r.onUploadProgress&&l()}},37504:function(e){e.exports=JSON.parse('{"qualifications":[{"label":"identity_photo","purpose":"attestation","subjects":["identity"]},{"label":"national_id_card","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["identity"]},{"label":"passport","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["identity"]},{"label":"residence_permit","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"immigration","subjects":["permit","identity"]},{"label":"family_record_book","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["family"]},{"label":"birth_certificate","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["identity","family"]},{"label":"driver_license","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"transport","subjects":["permit","driving"]},{"label":"other_identity_document","purpose":"attestation","subjects":["identity"]},{"label":"wedding","purpose":"contract","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["family"]},{"label":"pacs","purpose":"contract","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["family"]},{"label":"divorce","purpose":"contract","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["family"]},{"label":"large_family_card","purpose":"attestation","sourceCategory":"transport","subjects":["right"]},{"label":"caf","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"family","subjects":["right"]},{"label":"other_family_document","subjects":["family"]},{"label":"diploma","purpose":"attestation","sourceCategory":"education","subjects":["achievement"]},{"label":"work_contract","purpose":"contract","sourceCategory":"employer","subjects":["work","employment"]},{"label":"pay_sheet","purpose":"attestation","sourceCategory":"employer","subjects":["work","revenues"]},{"label":"fidelity_card","sourceCategory":"shopping"},{"label":"single_parent_benefit","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"family","subjects":["revenues"]},{"label":"transport_card","sourceCategory":"transport","subjects":["vehicule"]},{"label":"electoral_card","sourceCategory":"gov"},{"label":"employment_center_certificate","purpose":"attestation","sourceCategory":"gov","subjects":["employment"]},{"label":"unemployment_benefit","purpose":"attestation","sourceCategory":"gov","subjects":["revenues"]},{"label":"pension","purpose":"attestation","sourceCategory":"gov","subjects":["revenues"]},{"label":"other_revenue","purpose":"attestation","subjects":["revenues"]},{"label":"gradebook","purpose":"report","sourceCategory":"education","subjects":["history"]},{"label":"student_card","purpose":"attestation","sourceCategory":"education","subjects":["identity","right","employment","education"]},{"label":"resume","purpose":"description","subjects":["employment"]},{"label":"motivation_letter","purpose":"description","subjects":["employment"]},{"label":"other_work_document","purpose":"employment"},{"label":"health_book","purpose":"attestation","sourceCategory":"health","subjects":["capacity","vaccine"]},{"label":"health_certificate","purpose":"attestation","sourceCategory":"health","subjects":["capacity","vaccine"]},{"label":"pregnancy_medical_certificate","purpose":"attestation","sourceCategory":"health","subjects":["pregnancy"]},{"label":"work_disability_recognition","purpose":"attestation","sourceCategory":"health","subjects":["right"]},{"label":"national_health_insurance_card","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"health","subjects":["insurance"]},{"label":"national_health_insurance_right_certificate","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"health","subjects":["right","insurance"]},{"label":"health_insurance_card","purpose":"attestation","sourceCategory":"insurance","sourceSubCategory":"health","subjects":["insurance"]},{"label":"prescription","purpose":"attestation","sourceCategory":"health","subjects":["right","medecine"]},{"label":"health_invoice","purpose":"invoice","sourceCategory":"health"},{"label":"other_health_document","subjects":["health"]},{"label":"vehicle_registration","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"transport","subjects":["vehicule","identity","right"]},{"label":"car_insurance","purpose":"attestation","sourceCategory":"insurance","sourceSubCategory":"transport","subjects":["insurance","car"]},{"label":"mechanic_invoice","purpose":"invoice","sourceCategory":"transport"},{"label":"transport_invoice","purpose":"invoice","sourceCategory":"transport"},{"label":"other_transport_document","sourceCategory":"transport"},{"label":"house_sale_agreeement","purpose":"contract","sourceCategory":"real_estate","subjects":["house"]},{"label":"real_estate_tax","purpose":"invoice","sourceCategory":"gov","sourceSubCategory":"real_estate","subjects":["tax","house"]},{"label":"building_permit","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"real_estate","subjects":["permit","house"]},{"label":"technical_diagnostic_record","purpose":"report","sourceCategory":"real_estate","subjects":["compliance","house"]},{"label":"lease","purpose":"contract","sourceCategory":"real_estate","subjects":["house"]},{"label":"rent_receipt","purpose":"invoice","sourceCategory":"real_estate","subjects":["house"]},{"label":"house_insurance","purpose":"contract","sourceCategory":"insurance","sourceSubCategory":"real_estate","subjects":["insurance","house"]},{"label":"work_quote","purpose":"description","sourceCategory":"building","subjects":["building","house"]},{"label":"work_invoice","purpose":"invoice","sourceCategory":"building","subjects":["building","house"]},{"label":"other_house_document","subjects":["house"]},{"label":"phone_invoice","purpose":"invoice","sourceCategory":"telecom","sourceSubCategory":"mobile"},{"label":"isp_invoice","purpose":"invoice","sourceCategory":"telecom","sourceSubCategory":"internet","subjects":["subscription"]},{"label":"telecom_invoice","purpose":"invoice","sourceCategory":"telecom"},{"label":"energy_invoice","purpose":"invoice","sourceCategory":"energy"},{"label":"water_invoice","purpose":"invoice","sourceCategory":"water"},{"label":"energy_contract","purpose":"contract","sourceCategory":"energy"},{"label":"appliance_invoice","purpose":"invoice","sourceCategory":"retail"},{"label":"web_service_invoice","purpose":"invoice","sourceCategory":"web"},{"label":"restaurant_invoice","purpose":"invoice","sourceCategory":"alimentation"},{"label":"grocery_invoice","purpose":"invoice","sourceCategory":"shopping"},{"label":"other_invoice","purpose":"invoice"},{"label":"tax_certificate","purpose":"attestation","sourceCategory":"gov","subjects":["tax"]},{"label":"tax_return","purpose":"report","sourceCategory":"gov","sourceSubCategory":"tax","subjects":["tax"]},{"label":"tax_notice","purpose":"invoice","sourceCategory":"gov","sourceSubCategory":"tax","subjects":["tax"]},{"label":"tax_timetable","purpose":"report","sourceCategory":"gov","sourceSubCategory":"tax","subjects":["tax"]},{"label":"other_tax_document","subjects":["tax"]},{"label":"bank_details","purpose":"attestation","sourceCategory":"bank","subjects":["bank_account"]},{"label":"bank_statement","purpose":"report","sourceCategory":"bank","subjects":["history"]},{"label":"loan_agreement","purpose":"contract","sourceCategory":"bank"},{"label":"other_bank_document","sourceCategory":"bank"},{"label":"receipt","purpose":"report"},{"label":"payment_proof_family_allowance","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"tax","subjects":["subvention"]},{"label":"school_attendance_certificate","purpose":"attestation","sourceCategory":"education","subjects":["identity","right","education"]},{"label":"school_insurance_certificate","purpose":"attestation","sourceCategory":"education","subjects":["education","insurance"]},{"label":"unfit_for_habitation_declaration","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"real_estate","subjects":["compliance"]},{"label":"accommodation_proof","purpose":"attestation","sourceCategory":"individual","subjects":["address"]},{"label":"citizen_registration_certificate","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"civil_registration","subjects":["achievement","education"]},{"label":"personal_sporting_licence","purpose":"attestation","sourceCategory":"gov","sourceSubCategory":"sport","subjects":["permit","invoice"]},{"label":"other_activity_document","sourceSubCategory":"sport","subjects":["permit","invoice"]},{"label":"real_estate_insurance","purpose":"contract","sourceCategory":"insurance","sourceSubCategory":"real_estate","subjects":["insurance"]},{"label":"person_insurance","purpose":"contract","sourceCategory":"insurance","subjects":["insurance"]},{"label":"other_administrative_document"},{"label":"expense_claim","purpose":"invoice"},{"label":"fine","purpose":"invoice","sourceCategory":"gov"},{"label":"condition_report","purpose":"contract","sourceCategory":"real_estate","subjects":["house"]},{"label":"note_identity_document"},{"label":"note_family_document"},{"label":"note_work_document"},{"label":"note_health_document"},{"label":"note_house_document"},{"label":"note_transport_document"},{"label":"note_activity_document"},{"label":"note_finance"},{"label":"note_invoice"}],"purposeKnownValues":["attestation","contract","invoice","report","description","evaluation","employment"],"sourceCategoryKnownValues":["bank","insurance","retail","telecom","energy","water","health","gov","association","education","employer","transport","goods","alimentation","building","real_estate","web","individual","shopping"],"sourceSubCategoryKnownValues":["civil_registration","immigration","transport","family","tax","health","real_estate","mobile","internet","citizen","sport"],"subjectsKnownValues":["identity","permit","family","address","driving","right","subvention","achievement","degree","work","employment","revenues","history","insurance","medical_act","vehicule","car","moto","truck","boat","subscription","buy/sale","house","compliance","building","food","real_estate","tax","address","education","statement","course","internet","phone","vaccine","capacity","health","drugs","child","pregnancy","bank_account"]}')},20455:function(e){e.exports=JSON.parse('{"nationalities":{"AD":"Andorran","AE":"Emirian","AF":"Afghan","AG":"Antiguans","AL":"Albanian","AM":"Armenian","AO":"Angolan","AR":"Argentinean","AT":"Austrian","AU":"Australian","AX":"\xc5land Islands","AZ":"Azerbaijani","BA":"Bosnian - Herzegovinian","BB":"Barbadian","BD":"Bangladeshi","BE":"Belgian","BF":"Burkinabe","BG":"Bulgarian","BH":"Bahraini","BI":"Burundian","BJ":"Beninese","BL":"Saint Barth\xe9lemy","BM":"Bermuda","BN":"Bruneian","BO":"Bolivian","BQ":"Bonaire, Sint Eustatius and Saba","BR":"Brazilian","BS":"Bahamian","BT":"Bhutanese","BV":"Bouvet Island","BW":"Batswana","BY":"Belarusian","BZ":"Belizean","CA":"Canadian","CC":"Cocos (Keeling) Islands","CD":"Congolese (Democratic Republic of the Congo)","CF":"Central African","CG":"Congolese (Republic of the Congo)","CH":"Swiss","CI":"Ivorian","CK":"Cook Islands","CL":"Chilean","CM":"Cameroonian","CN":"Chinese","CO":"Colombian","CR":"Costa Rican","CU":"Cuban","CV":"Cape Verdean","CW":"Cura\xe7ao","CX":"Christmas Island","CY":"Cypriot","CZ":"Czech","DE":"German","DJ":"Djibouti","DK":"Danish","DM":"Dominican (Dominica)","DO":"Dominican (Dominican Republic)","DZ":"Algerian","EC":"Ecuadorean","EE":"Estonian","EG":"Egyptian","EH":"Western Sahara","ER":"Eritrean","ES":"Spanish","ET":"Ethiopian","FI":"Finnish","FJ":"Fijian","FK":"Falkland Islands (Malvinas)","FM":"Micronesian","FO":"Faroe Islands","FR":"French","GA":"Gabonese","GB":"British","GD":"Grenadian","GE":"Georgian","GF":"French (French Guiana)","GG":"Guernsey","GH":"Ghanaian","GI":"Gibraltar","GL":"Greenland","GM":"Gambian","GN":"Guinean","GP":"Guadeloupe","GQ":"Equatorial Guinean","GR":"Greek","GS":"South Georgia and the South Sandwich Islands","GT":"Guatemalan","GU":"Guam","GW":"Guinea-Bissauan","GY":"Guyanese","HK":"Hong Kong","HM":"Heard Island and Mcdonald Islands","HN":"Honduran","HR":"Croatian","HT":"Haitian","HU":"Hungarian","ID":"Indonesian","IE":"Irish","IL":"Israeli","IM":"Manx","IN":"Indian","IO":"British Indian Ocean Territory","IQ":"Iraqi","IR":"Iranian","IS":"Icelandic","IT":"Italian","JE":"Jersey","JM":"Jamaican","JO":"Jordanian","JP":"Japanese","KE":"Kenyan","KG":"Kyrgyz","KH":"Cambodian","KI":"I-Kiribati","KM":"Comoran","KN":"Kittian and Nevisian","KP":"North Korean","KR":"South Korean","KW":"Kuwaiti","KY":"Cayman Islands","KZ":"Kazakhstani","LA":"Laotian","LB":"Lebanese","LC":"Saint Lucian","LI":"Liechtensteiner","LK":"Sri Lankan","LR":"Liberian","LS":"Mosotho","LT":"Lithuanian","LU":"Luxembourger","LV":"Latvian","LY":"Libyan","MA":"Moroccan","MC":"Monacan","MD":"Moldovan","ME":"Montenegrin","MF":"Saint Martin (French part)","MG":"Malagasy","MH":"Marshallese","MK":"Macedonian","ML":"Malian","MM":"Burmese","MN":"Mongolian","MO":"Macao","MP":"Northern Mariana Islands","MQ":"Martinique","MR":"Mauritanian","MS":"Montserrat","MT":"Maltese","MU":"Mauritian","MV":"Maldivan","MW":"Malawian","MX":"Mexican","MY":"Malaysian","MZ":"Mozambican","NA":"Namibian","NC":"New Caledonia","NE":"Nigerien","NF":"Norfolk Island","NG":"Nigerian","NI":"Nicaraguan","NL":"Dutch","NO":"Norwegian","NP":"Nepalese","NR":"Nauruan","NU":"Niue","NZ":"New Zealander","OM":"Omani","PA":"Panamanian","PE":"Peruvian","PF":"French (French Polynesia)","PG":"Papua New Guinea","PH":"Filipino","PK":"Pakistani","PL":"Polish","PM":"Saint Pierre and Miquelon","PN":"Pitcairn","PR":"Puerto Rico","PS":"Palestinian Territory, Occupied","PT":"Portuguese","PW":"Palauan","PY":"Paraguayan","QA":"Qatari","RE":"Reunion","RO":"Romanian","RS":"Serbian","RU":"Russian","RW":"Rwandan","SA":"Saudi","SB":"Solomon Islander","SC":"Seychellois","SD":"Sudanese","SE":"Swedish","SG":"Singaporean","SH":"Saint Helena","SI":"Slovenian","SJ":"Svalbard and Jan Mayen","SK":"Slovakian","SL":"Sierra Leonean","SM":"San Marinese","SN":"Senegalese","SO":"Somali","SR":"Surinamer","SS":"South Sudan","ST":"Sao Tomean","SV":"Salvadoran","SX":"Sint Maarten (Dutch part)","SY":"Syrian","SZ":"Swazi","TC":"Turks and Caicos Islands","TD":"Chadian","TF":"French (French Southern Territories)","TG":"Togolese","TH":"Thai","TJ":"Tajik","TK":"Tokelau","TL":"East Timorese","TM":"Turkmenistan","TN":"Tunisian","TO":"Tongan","TR":"Turkish","TT":"Trinidadian or Tobagonian","TV":"Tuvaluan","TW":"Taiwanese","TZ":"Tanzanian","UA":"Ukrainian","UG":"Ugandan","UM":"United States Minor Outlying Islands","US":"American","UY":"Uruguayan","UZ":"Uzbekistani","VA":"Holy See (Vatican City State)","VC":"Saint Vincent and the Grenadines","VE":"Venezuelan","VG":"Virgin Islands, British","VI":"Virgin Islands, U.S.","VN":"Vietnamese","VU":"Vanuatu","WF":"Welsh","WS":"Samoan","YE":"Yemenite","YT":"Mayotte","ZA":"South African","ZM":"Zambian","ZW":"Zimbabwean"},"countries":{"AD":"Andorra","AE":"United Arab Emirates","AF":"Afghanistan","AG":"Antigua and Barbuda","AL":"Albania","AM":"Armenia","AO":"Angola","AR":"Argentina","AT":"Austria","AU":"Australia","AX":"\xc5land Islands","AZ":"Azerbaijan","BA":"Bosnia and Herzegovina","BB":"Barbados","BD":"Bangladesh","BE":"Belgium","BF":"Burkina Faso","BG":"Bulgaria","BH":"Bahrain","BI":"Burundi","BJ":"Benin","BL":"Saint Barth\xe9lemy","BM":"Bermuda","BN":"Brunei Darussalam","BO":"Bolivia","BQ":"Bonaire, Sint Eustatius and Saba","BR":"Brazil","BS":"Bahamas","BT":"Bhutan","BV":"Bouvet Island","BW":"Botswana","BY":"Belarus","BZ":"Belize","CA":"Canada","CC":"Cocos (Keeling) Islands","CD":"Democratic Republic of the Congo","CF":"Central African Republic","CG":"Republic of the Congo","CH":"Switzerland","CI":"Ivory Coast","CK":"Cook Islands","CL":"Chile","CM":"Cameroon","CN":"People\'s Republic of China","CO":"Colombia","CR":"Costa Rica","CU":"Cuba","CV":"Cape Verde","CW":"Cura\xe7ao","CX":"Christmas Island","CY":"Cyprus","CZ":"Czech Republic","DE":"Germany","DJ":"Djibouti","DK":"Denmark","DM":"Dominica","DO":"Dominican Republic","DZ":"Algeria","EC":"Ecuador","EE":"Estonia","EG":"Egypt","EH":"Western Sahara","ER":"Eritrea","ES":"Spain","ET":"Ethiopia","FI":"Finland","FJ":"Fiji","FK":"Falkland Islands (Malvinas)","FM":"Micronesia, Federated States of","FO":"Faroe Islands","FR":"France","GA":"Gabon","GB":"United Kingdom","GD":"Grenada","GE":"Georgia","GF":"French Guiana","GG":"Guernsey","GH":"Ghana","GI":"Gibraltar","GL":"Greenland","GM":"Gambia","GN":"Guinea","GP":"Guadeloupe","GQ":"Equatorial Guinea","GR":"Greece","GS":"South Georgia and the South Sandwich Islands","GT":"Guatemala","GU":"Guam","GW":"Guinea-Bissau","GY":"Guyana","HK":"Hong Kong","HM":"Heard Island and McDonald Islands","HN":"Honduras","HR":"Croatia","HT":"Haiti","HU":"Hungary","ID":"Indonesia","IE":"Ireland","IL":"Israel","IM":"Isle of Man","IN":"India","IO":"British Indian Ocean Territory","IQ":"Iraq","IR":"Iran","IS":"Iceland","IT":"Italy","JE":"Jersey","JM":"Jamaica","JO":"Jordan","JP":"Japan","KE":"Kenya","KG":"Kyrgyzstan","KH":"Cambodia","KI":"Kiribati","KM":"Comoros","KN":"Saint Kitts and Nevis","KP":"North Korea","KR":"South Korea","KW":"Kuwait","KY":"Cayman Islands","KZ":"Kazakhstan","LA":"Lao People\'s Democratic Republic","LB":"Lebanon","LC":"Saint Lucia","LI":"Liechtenstein","LK":"Sri Lanka","LR":"Liberia","LS":"Lesotho","LT":"Lithuania","LU":"Luxembourg","LV":"Latvia","LY":"Libya","MA":"Morocco","MC":"Monaco","MD":"Moldova, Republic of","ME":"Montenegro","MF":"Saint Martin (French part)","MG":"Madagascar","MH":"Marshall Islands","MK":"North Macedonia","ML":"Mali","MM":"Myanmar","MN":"Mongolia","MO":"Macao","MP":"Northern Mariana Islands","MQ":"Martinique","MR":"Mauritania","MS":"Montserrat","MT":"Malta","MU":"Mauritius","MV":"Maldives","MW":"Malawi","MX":"Mexico","MY":"Malaysia","MZ":"Mozambique","NA":"Namibia","NC":"New Caledonia","NE":"Niger","NF":"Norfolk Island","NG":"Nigeria","NI":"Nicaragua","NL":"Netherlands","NO":"Norway","NP":"Nepal","NR":"Nauru","NU":"Niue","NZ":"New Zealand","OM":"Oman","PA":"Panama","PE":"Peru","PF":"French Polynesia","PG":"Papua New Guinea","PH":"Philippines","PK":"Pakistan","PL":"Poland","PM":"Saint Pierre and Miquelon","PN":"Pitcairn Islands","PR":"Puerto Rico","PS":"Palestine","PT":"Portugal","PW":"Palau","PY":"Paraguay","QA":"Qatar","RE":"Reunion","RO":"Romania","RS":"Serbia","RU":"Russia","RW":"Rwanda","SA":"Saudi Arabia","SB":"Solomon Islands","SC":"Seychelles","SD":"Sudan","SE":"Sweden","SG":"Singapore","SH":"Saint Helena","SI":"Slovenia","SJ":"Svalbard and Jan Mayen","SK":"Slovakia","SL":"Sierra Leone","SM":"San Marino","SN":"Senegal","SO":"Somalia","SR":"Suriname","SS":"South Sudan","ST":"Sao Tome and Principe","SV":"El Salvador","SX":"Sint Maarten (Dutch part)","SY":"Syrian Arab Republic","SZ":"Eswatini","TC":"Turks and Caicos Islands","TD":"Chad","TF":"French Southern Territories","TG":"Togo","TH":"Thailand","TJ":"Tajikistan","TK":"Tokelau","TL":"Timor-Leste","TM":"Turkmenistan","TN":"Tunisia","TO":"Tonga","TR":"Turkey","TT":"Trinidad and Tobago","TV":"Tuvalu","TW":"Taiwan","TZ":"United Republic of Tanzania","UA":"Ukraine","UG":"Uganda","UM":"United States Minor Outlying Islands","US":"United States of America","UY":"Uruguay","UZ":"Uzbekistan","VA":"Holy See (Vatican City State)","VC":"Saint Vincent and the Grenadines","VE":"Venezuela","VG":"Virgin Islands, British","VI":"Virgin Islands, U.S.","VN":"Vietnam","VU":"Vanuatu","WF":"Wallis and Futuna","WS":"Samoa","YE":"Yemen","YT":"Mayotte","ZA":"South Africa","ZM":"Zambia","ZW":"Zimbabwe"}}')},40883:function(e){e.exports=JSON.parse('{"nationalities":{"AD":"Andorran","AE":"\xc9mirien","AF":"Afghan","AG":"Antiguayen","AL":"Albanais","AM":"Arm\xe9nien","AO":"Angolais","AR":"Argentin","AT":"Autrichien","AU":"Australien","AX":"\xceles Aland","AZ":"Azerba\xefdjanais","BA":"Bosnien","BB":"Barbadien","BD":"Bangladais","BE":"Belge","BF":"Burkinab\xe9","BG":"Bulgare","BH":"Bahre\xefnien","BI":"Burundais","BJ":"B\xe9ninois","BL":"Saint-Barth\xe9lemy","BM":"Bermudien","BN":"Brun\xe9ien","BO":"Bolivien","BQ":"Pays-Bas Carib\xe9ens","BR":"Br\xe9silien","BS":"Bahamien","BT":"Bhoutanais","BV":"\xcele Bouvet","BW":"Botswanais","BY":"Bi\xe9lorusse","BZ":"B\xe9lizien","CA":"Canadien","CC":"\xceles Cocos","CD":"Congolais (R\xe9publique d\xe9mocratique du Congo)","CF":"Centrafricain","CG":"Congolais (R\xe9publique du Congo)","CH":"Suisse","CI":"Ivoirien","CK":"\xceles Cook","CL":"Chilien","CM":"Camerounais","CN":"Chinois","CO":"Colombien","CR":"Costaricain","CU":"Cubain","CV":"Cap verdien","CW":"Curacien","CX":"L\'\xeele Christmas","CY":"Chypriote","CZ":"Tch\xe8que","DE":"Allemand","DJ":"Djiboutien","DK":"Danois","DM":"Dominicain (Dominique)","DO":"Dominicain (R\xe9publique dominicaine)","DZ":"Alg\xe9rien","EC":"\xc9quatorien","EE":"Estonien","EG":"\xc9gyptien","EH":"Sahara Occidental","ER":"\xc9rythr\xe9en","ES":"Espagnol","ET":"\xc9thiopien","FI":"Finlandais","FJ":"Fidjien","FK":"Malouin","FM":"Micron\xe9sien","FO":"F\xe9ro\xefen","FR":"Fran\xe7ais","GA":"Gabonais","GB":"Britannique","GD":"Grenadien","GE":"G\xe9orgien","GF":"Fran\xe7ais (Guyane)","GG":"Guernesiais","GH":"Ghan\xe9en","GI":"Gibraltariens","GL":"Groenlandais","GM":"Gambien","GN":"Guin\xe9en","GP":"Guadeloup\xe9en","GQ":"\xc9quato-guin\xe9en","GR":"Grec","GS":"G\xe9orgie du Sud et les \xeeles Sandwich du Sud","GT":"Guat\xe9malt\xe8que","GU":"Guam","GW":"Bissaoguin\xe9en","GY":"Guyanais","HK":"Hongkongais","HM":"\xceles Heard-et-MacDonald","HN":"Hondurien","HR":"Croate","HT":"Ha\xeftien","HU":"Hongrois","ID":"Indon\xe9sien","IE":"Irlandais","IL":"Isra\xe9lien","IM":"\xcele de Man","IN":"Indien","IO":"Territoire britannique de l\'oc\xe9an Indien","IQ":"Irakien","IR":"Iranien","IS":"Islandais","IT":"Italien","JE":"Jersiais","JM":"Jama\xefquain","JO":"Jordanien","JP":"Japonais","KE":"K\xe9nyan","KG":"Kirghiz","KH":"Cambodgien","KI":"Kiribatiens","KM":"Comorien","KN":"Afro-Kittitien et Afro-Nevisien","KP":"Nord cor\xe9en","KR":"Sud cor\xe9en","KW":"Kowe\xeftien","KY":"Ca\xefmanien","KZ":"Kazakhstanais","LA":"Laotien","LB":"Libanais","LC":"Saint-Lucien","LI":"Liechtensteinois","LK":"Sri Lankais","LR":"Liberian","LS":"Mosotho","LT":"Lituanien","LU":"Luxembourgeois","LV":"Letton","LY":"Libyen","MA":"Marocain","MC":"Mon\xe9gasque","MD":"Moldave","ME":"Mont\xe9n\xe9grin","MF":"Saint-Martinois (France)","MG":"Malgache","MH":"Marshallais","MK":"Mac\xe9donien","ML":"Malien","MM":"Birman","MN":"Mongol","MO":"Macan\xe9en","MP":"\xceles Mariannes du Nord","MQ":"Martiniquais","MR":"Mauritanien","MS":"Montserratien","MT":"Maltais","MU":"Mauricien","MV":"Maldivien","MW":"Malawien","MX":"Mexicain","MY":"Malaisien","MZ":"Mozambicain","NA":"Namibien","NC":"N\xe9o-Cal\xe9donien","NE":"Nig\xe9rien","NF":"Norfolkais","NG":"Nig\xe9rian","NI":"Nicaraguayen","NL":"N\xe9erlandais","NO":"Norv\xe9gien","NP":"N\xe9palais","NR":"Nauruan","NU":"Niu\xe9en","NZ":"N\xe9o-Z\xe9landais","OM":"Omanais","PA":"Panam\xe9en","PE":"P\xe9ruvien","PF":"Fran\xe7ais (Polyn\xe9sie fran\xe7aise)","PG":"Papouasien","PH":"Philippin","PK":"Pakistanais","PL":"Polonais","PM":"Saint-Pierrais ou Miquelonais","PN":"\xceles Pitcairn","PR":"Portoricain","PS":"Territoires Palestiniens, Occup\xe9s","PT":"Portugais","PW":"Palauan","PY":"Paraguayen","QA":"Qatarien","RE":"R\xe9unionnais","RO":"Roumain","RS":"Serbe","RU":"Russe","RW":"Rwandais","SA":"Saoudien","SB":"Salomonais","SC":"Seychellois","SD":"Soudanais","SE":"Su\xe9dois","SG":"Singapourien","SH":"Sainte H\xe9l\xe8ne","SI":"Slov\xe8ne","SJ":"Svalbard et Jan Mayen","SK":"Slovaque","SL":"Sierra L\xe9onais","SM":"Saint-Marinais","SN":"S\xe9n\xe9galais","SO":"Somalien","SR":"Surinamais","SS":"Sud-Soudanais","ST":"Santom\xe9en","SV":"Salvadorien","SX":"Saint-Martinois (Pays-Bas)","SY":"Syrien","SZ":"Swazi","TC":"\xceles Turques-et-Ca\xefques","TD":"Tchadien","TF":"Fran\xe7ais (TAAF)","TG":"Togolais","TH":"Tha\xeflandais","TJ":"Tadjik","TK":"Tok\xe9laou","TL":"Est-Timorais","TM":"Turkm\xe8ne","TN":"Tunisien","TO":"Tongien","TR":"Turc","TT":"Trinidadien ou Tobagonien","TV":"Tuvalais","TW":"Ta\xefwanais","TZ":"Tanzanien","UA":"Ukrainien","UG":"Ougandais","UM":"\xceles mineures \xe9loign\xe9es des \xc9tats-Unis","US":"Am\xe9ricain","UY":"Uruguayen","UZ":"Ouzbek","VA":"Saint-Si\xe8ge (\xc9tat de la cit\xe9 du Vatican)","VC":"Vincentais","VE":"V\xe9n\xe9zu\xe9lien","VG":"\xceles Vierges Britanniques","VI":"\xceles Vierges Am\xe9ricaines","VN":"Vietnamien","VU":"Vanuatais","WF":"Gallois","WS":"Samoan","YE":"Y\xe9m\xe9nite","YT":"Mahorais","ZA":"Sud Africain","ZM":"Zambien","ZW":"Zimbabw\xe9en"},"countries":{"AD":"Andorre","AE":"\xc9mirats Arabes Unis","AF":"Afghanistan","AG":"Antigua-et-Barbuda","AL":"Albanie","AM":"Arm\xe9nie","AO":"Angola","AR":"Argentine","AT":"Autriche","AU":"Australie","AX":"\xc5land","AZ":"Azerba\xefdjan","BA":"Bosnie-Herz\xe9govine","BB":"Barbade","BD":"Bangladesh","BE":"Belgique","BF":"Burkina Faso","BG":"Bulgarie","BH":"Bahre\xefn","BI":"Burundi","BJ":"B\xe9nin","BL":"Saint-Barth\xe9lemy","BM":"Bermudes","BN":"Brunei Darussalam","BO":"Bolivie","BQ":"Bonaire, Saint-Eustache et Saba","BR":"Br\xe9sil","BS":"Bahamas","BT":"Bhoutan","BV":"\xcele Bouvet","BW":"Botswana","BY":"Bi\xe9lorussie","BZ":"Belize","CA":"Canada","CC":"\xceles Cocos","CD":"R\xe9publique d\xe9mocratique du Congo","CF":"R\xe9publique Centrafricaine","CG":"R\xe9publique du Congo","CH":"Suisse","CI":"C\xf4te-d\'Ivoire","CK":"\xceles Cook","CL":"Chili","CM":"Cameroun","CN":"Chine","CO":"Colombie","CR":"Costa Rica","CU":"Cuba","CV":"Cap-Vert","CW":"Cura\xe7ao","CX":"\xcele Christmas","CY":"Chypre","CZ":"R\xe9publique Tch\xe8que","DE":"Allemagne","DJ":"Djibouti","DK":"Danemark","DM":"Dominique","DO":"R\xe9publique Dominicaine","DZ":"Alg\xe9rie","EC":"\xc9quateur","EE":"Estonie","EG":"\xc9gypte","EH":"Sahara occidental","ER":"\xc9rythr\xe9e","ES":"Espagne","ET":"\xc9thiopie","FI":"Finlande","FJ":"Fidji","FK":"\xceles Malouines","FM":"Micron\xe9sie","FO":"\xceles F\xe9ro\xe9","FR":"France","GA":"Gabon","GB":"Royaume-Uni","GD":"Grenade","GE":"G\xe9orgie","GF":"Guyane fran\xe7aise","GG":"Guernesey","GH":"Ghana","GI":"Gibraltar","GL":"Groenland","GM":"Gambie","GN":"Guin\xe9e","GP":"Guadeloupe","GQ":"Guin\xe9e \xe9quatoriale","GR":"Gr\xe8ce","GS":"G\xe9orgie du Sud-et-les \xceles Sandwich du Sud","GT":"Guatemala","GU":"Guam","GW":"Guin\xe9e-Bissau","GY":"Guyana","HK":"Hong Kong","HM":"\xceles Heard-et-MacDonald","HN":"Honduras","HR":"Croatie","HT":"Ha\xefti","HU":"Hongrie","ID":"Indon\xe9sie","IE":"Irlande","IL":"Isra\xebl","IM":"\xcele de Man","IN":"Inde","IO":"Oc\xe9an Indien Britannique","IQ":"Irak","IR":"Iran","IS":"Islande","IT":"Italie","JE":"Jersey","JM":"Jama\xefque","JO":"Jordanie","JP":"Japon","KE":"Kenya","KG":"Kirghizistan","KH":"Cambodge","KI":"Kiribati","KM":"Comores","KN":"Saint-Christophe-et-Ni\xe9v\xe8s","KP":"Cor\xe9e du Nord","KR":"Cor\xe9e du Sud","KW":"Kowe\xeft","KY":"\xceles Ca\xefmans","KZ":"Kazakhstan","LA":"Laos","LB":"Liban","LC":"Sainte-Lucie","LI":"Liechtenstein","LK":"Sri Lanka","LR":"Lib\xe9ria","LS":"Lesotho","LT":"Lituanie","LU":"Luxembourg","LV":"Lettonie","LY":"Libye","MA":"Maroc","MC":"Monaco","MD":"Moldavie","ME":"Mont\xe9n\xe9gro","MF":"Saint-Martin (partie fran\xe7aise)","MG":"Madagascar","MH":"\xceles Marshall","MK":"Mac\xe9doine du Nord","ML":"Mali","MM":"Myanmar","MN":"Mongolie","MO":"Macao","MP":"\xceles Mariannes du Nord","MQ":"Martinique","MR":"Mauritanie","MS":"Montserrat","MT":"Malte","MU":"Maurice","MV":"Maldives","MW":"Malawi","MX":"Mexique","MY":"Malaisie","MZ":"Mozambique","NA":"Namibie","NC":"Nouvelle-Cal\xe9donie","NE":"Niger","NF":"\xcele Norfolk","NG":"Nig\xe9ria","NI":"Nicaragua","NL":"Pays-Bas","NO":"Norv\xe8ge","NP":"N\xe9pal","NR":"Nauru","NU":"Niu\xe9","NZ":"Nouvelle-Z\xe9lande","OM":"Oman","PA":"Panama","PE":"P\xe9rou","PF":"Polyn\xe9sie fran\xe7aise","PG":"Papouasie-Nouvelle-Guin\xe9e","PH":"Philippines","PK":"Pakistan","PL":"Pologne","PM":"Saint-Pierre-et-Miquelon","PN":"\xceles Pitcairn","PR":"Porto Rico","PS":"Palestine","PT":"Portugal","PW":"Palaos","PY":"Paraguay","QA":"Qatar","RE":"R\xe9union","RO":"Roumanie","RS":"Serbie","RU":"Russie","RW":"Rwanda","SA":"Arabie Saoudite","SB":"\xceles Salomon","SC":"Seychelles","SD":"Soudan","SE":"Su\xe8de","SG":"Singapour","SH":"Sainte-H\xe9l\xe8ne","SI":"Slov\xe9nie","SJ":"Svalbard et \xcele Jan Mayen","SK":"Slovaquie","SL":"Sierra Leone","SM":"Saint-Marin","SN":"S\xe9n\xe9gal","SO":"Somalie","SR":"Suriname","SS":"Soudan du Sud","ST":"S\xe3o Tom\xe9-et-Principe","SV":"El Salvador","SX":"Saint-Martin (partie n\xe9erlandaise)","SY":"Syrie","SZ":"Royaume d\'Eswatini","TC":"\xceles Turques-et-Ca\xefques","TD":"Tchad","TF":"Terres australes fran\xe7aises","TG":"Togo","TH":"Tha\xeflande","TJ":"Tadjikistan","TK":"Tokelau","TL":"Timor-Leste","TM":"Turkm\xe9nistan","TN":"Tunisie","TO":"Tonga","TR":"Turquie","TT":"Trinit\xe9-et-Tobago","TV":"Tuvalu","TW":"Ta\xefwan","TZ":"R\xe9publique unie de Tanzanie","UA":"Ukraine","UG":"Ouganda","UM":"\xceles mineures \xe9loign\xe9es des \xc9tats-Unis","US":"\xc9tats-Unis d\'Am\xe9rique","UY":"Uruguay","UZ":"Ouzb\xe9kistan","VA":"Saint-Si\xe8ge (Vatican)","VC":"Saint-Vincent-et-les-Grenadines","VE":"Venezuela","VG":"\xceles vierges britanniques","VI":"\xceles vierges am\xe9ricaines","VN":"Vietnam","VU":"Vanuatu","WF":"Wallis-et-Futuna","WS":"Samoa","YE":"Y\xe9men","YT":"Mayotte","ZA":"Afrique du Sud","ZM":"Zambie","ZW":"Zimbabwe"}}')},28330:function(e){e.exports=JSON.parse('{"country":{"foreign":"Foreign"},"Scan":{"scan_a_doc":"Scan a doc","save_doc":"Save the doc","filename":"Filename","save":"Save","cancel":"Cancel","qualify":"Describe","apply":"Apply","error":{"offline":"You are currently offline and you can\'t use this functionality. Please, try again later.","uploading":"You are already uploading a file. Please wait until the end of this upload and try again.","generic":"Something went wrong. Please try again."},"successful":{"qualified_ok":"You just have successfully described your file! "},"items":{"accommodation_proof":"Proof of accommodation |||| Proof of accommodations","appliance_invoice":"Appliance invoice |||| Appliance invoices","bank_details":"Bank detail |||| Bank details","bank_statement":"Bank statement |||| Bank statements","birth_certificate":"Birth certificate |||| Birth certificates","building_permit":"Building permit |||| Building permits","caf":"Social benefit rate |||| Social benefit rates","car_insurance":"Car insurance certificate |||| Car insurance certificates","citizen_registration_certificate":"Certificate of citizen registration |||| Certificates of citizen registration","condition_report":"Condition report |||| Condition reports","diploma":"Diploma |||| Diplomas","divorce":"Divorce |||| Divorces","driver_license":"Driving license |||| Driving licenses","electoral_card":"Electoral card |||| Electoral cards","employment_center_certificate":"Employment center certificate |||| Employment center certificates","energy_contract":"Energy provider contract |||| Energy provider contracts","energy_invoice":"Energy invoice |||| Energy invoices","expense_claim":"Expense claim |||| Expense claims","family_record_book":"Family record book |||| Family record books","family":"Family","fidelity_card":"Benefit card |||| Benefit cards","fine":"Fine |||| Fines","gradebook":"Gradebook |||| Gradebooks","grocery_invoice":"Grocery invoice |||| Grocery invoices","health_book":"Health book |||| Health books","health_certificate":"Health/Vaccination certificate |||| Health/Vaccination certificates","health_insurance_card":"Insurance card |||| Insurance cards","health_invoice":"Health invoice |||| Health invoices","health":"Health","home":"Home","house_insurance":"Home insurance |||| Home insurances","house_sale_agreeement":"House sale agreement |||| House sale agreements","identity_photo":"Identity photo |||| Identity photos","identity":"Identity","invoice":"Invoice |||| Invoices","isp_invoice":"ISP invoice |||| ISP invoices","large_family_card":" Large Family Card |||| Large Family Cards","lease":"Lease |||| Leases","loan_agreement":"Loan agreement |||| Loan agreements","mechanic_invoice":"Repair bill |||| Repair bills","motivation_letter":"Motivation letter |||| Motivation letters","national_health_insurance_card":"National health insurance card |||| National health insurance cards","national_health_insurance_right_certificate":"National health insurance right certificate |||| National health insurance right certificates","national_id_card":"ID card |||| ID cards","note_identity_document":"Note Identity |||| Notes Identity","note_family_document":"Note Family |||| Notes Family","note_work_document":"Note Work & Study |||| Notes Work & Study","note_health_document":"Note Health |||| Notes Health","note_house_document":"Note Home |||| Notes Home","note_transport_document":"Note Transport |||| Notes Transport","note_activity_document":"Note Activities |||| Notes Activities","note_finance":"Note Finance |||| Notes Finance","note_invoice":"Note Invoice |||| Notes Invoice","other_activity_document":"Other activities document |||| Other activities documents","other_bank_document":"Other financial document |||| Other financial documents","other_family_document":"Other family document |||| Other family documents","other_health_document":"Other health document |||| Other health documents","other_house_document":"Other house document |||| Other house documents","other_identity_document":"Other document of identity |||| Other documents of identity","other_invoice":"Other invoice |||| Other invoices","other_revenue":"Other revenue |||| Other revenues","other_tax_document":"Other tax document |||| Other tax documents","other_transport_document":"Other transport document |||| Other transport documents","other_work_document":"Other work document |||| Other work documents","other_administrative_document":"Other administrative document |||| Other administrative documents","others":"Others","pacs":"Civil union |||| Civil unions","passport":"Passeport |||| Passeports","pay_sheet":"Pay sheet |||| Pay sheets","payment_proof_family_allowance":"family allowance payment proof |||| family allowance payment proofs","pension":"Pension |||| Pensions","person_insurance":"Individual insurance certificate |||| Individual insurance certificates","personal_sporting_licence":"Sporting licence |||| Sporting licences","phone_invoice":"Phone invoice |||| Phone invoices","pregnancy_medical_certificate":"Certificate of pregnancy |||| Certificates of pregnancy","prescription":"Prescription |||| Prescriptions","real_estate_insurance":"Real estate insurance certificate |||| Real estate insurance certificates","real_estate_tax":"Real estate tax |||| Real estate taxes","receipt":"Receipt |||| Receipts","rent_receipt":"Rent receipt |||| Rent receipts","residence_permit":"Residence permit |||| Residence permits","restaurant_invoice":"Restaurant invoice |||| Restaurant invoices","resume":"Resume |||| Resumes","school_attendance_certificate":"Certificate of school attendance |||| Certificates of school attendance","school_insurance_certificate":"Certificate of school insurance |||| Certificates of school insurance","single_parent_benefit":"Single parent benefit |||| Single parent benefits","student_card":"Student card |||| Student cards","tax_certificate":"Tax certificate |||| Tax certificates","tax_notice":"Tax notice |||| Tax notices","tax_return":"Tax return |||| Tax returns","tax_timetable":"Payment Plans Installment Agreement |||| Payment Plans Installment Agreements","technical_diagnostic_record":"Technical diagnostic record |||| Technical diagnostic records","telecom_invoice":"Telecom invoice |||| Telecom invoices","transport_card":"Transport card |||| Transport cards","transport_invoice":"Transport invoice |||| Transport invoices","transport":"Transport","unemployment_benefit":"Unemployment benefit |||| Unemployment benefits","unfit_for_habitation_declaration":"Declaration of unfit for habitation |||| Declarations of unfit for habitation","vehicle_registration":"Vehicle registration |||| Vehicle registrations","water_invoice":"Water invoice |||| Water invoices","web_service_invoice":"Web service invoice |||| Web service invoices","wedding":"Wedding contract |||| Wedding contracts","work_contract":"Work contract |||| Work contracts","work_disability_recognition":"Recognition of disability |||| Recognitions of disability","work_invoice":"Work invoice |||| Work invoices","work_quote":"Work quote |||| Work quotes","work_study":"Work & Study"},"attributes":{"contractType":{"cdi":"CDI","cdd":"CDD","alternate":"Alternate","internship":"Internship","other":"Other"},"noticePeriod":{"oneWeek":"1 week before","oneMonth":"1 month before","threeMonth":"3 months before","oneYear":"1 year before","custom":"Custom","noAlert":"Do not be alerted"}},"themes":{"activity":"Activities","family":"Family","finance":"Finance","health":"Health","home":"Home","identity":"Identity","invoice":"Invoice","others":"Others","transport":"Transport","undefined":"Undefined","work_study":"Work & Study"},"expiration":{"expired":"Expired","expiresIn":"Expires in %{duration}","description":"This document expires in %{duration}, consider renewing it"},"qualification":{"date":{"title":{"datetime":"Added on","AObtentionDate":"License A, delivered on","BObtentionDate":"License B, delivered on","CObtentionDate":"License C, delivered on","DObtentionDate":"License D, delivered on","issueDate":"Delivered on","expirationDate":"Expiration date","referencedDate":"Referenced date","shootingDate":"Shooting date","obtentionDate":"Date obtained","date":"Document date"}},"information":{"title":{"fine":{"number":"Amount of the fine"},"fidelity_card":{"number":"Card number"},"caf":{"number":"CAF file number"},"payment_proof_family_allowance":{"number":"CAF file number"},"vehicle":{"licenseNumber":"Vehicle registration number","confidentialNumber":"Confidential vehicle registration code"},"vehicle_registration":{"number":"Vehicle registration number (VIN)"},"national_id_card":{"number":"National ID card number"},"bank_details":{"number":"IBAN number"},"passport":{"number":"Passport number"},"driver_license":{"number":"License number"},"residence_permit":{"number":"License number"},"national_health_insurance_card":{"number":"National health insurance card number"},"pay_sheet":{"number":"Gross remuneration"},"tax_return":{"number":"Reference tax number"},"tax_notice":{"number":"Reference tax number"},"real_estate_tax":{"number":"Reference tax number"},"tax_timetable":{"number":"Reference tax number"},"country":"Document issuing country","refTaxIncome":"Reference tax income","contractType":"Contract type","noticePeriod":"Expiration alert","netSocialAmount":"Net social amount","employerName":"Name of employer","employer":"Name of employer","amount":"Amount of expenditure","subtype":"Purpose of expenditure","bicNumber":"BIC number"},"day":"day |||| days"},"contact":"Owner","page":"Side of the document","front":"Front side","back":"Back side","qualification":"Qualification","noInfo":"No information"}},"MagicFolders":{"administrative":"Administrative","photos":"Photos"}}')},6765:function(e){e.exports=JSON.parse('{"country":{"foreign":"\xc9tranger"},"Scan":{"scan_a_doc":"Num\xe9riser un doc","save_doc":"Enregistrer le document","filename":"Nom du fichier","save":"Sauvegarder","cancel":"Annuler","qualify":"Qualifier","apply":"Appliquer","error":{"offline":"Vous \xeates actuellement d\xe9connect\xe9, vous ne pouvez donc pas utiliser cette fonctionnalit\xe9. Connectez-vous \xe0 internet et recommencez. ","uploading":"Vous avez d\xe9j\xe0 un fichier en cours de t\xe9l\xe9chargement. Attendez la fin et recommencez.","generic":"Un probl\xe8me est survenu. Veuillez r\xe9essayer. "},"successful":{"qualified_ok":"Vous venez de qualifier votre fichier avec succ\xe8s !"},"items":{"accommodation_proof":"Attestation d\'h\xe9bergement |||| Attestations d\'h\xe9bergement","appliance_invoice":"Facture d\'\xe9lectrom\xe9nager |||| Factures d\'\xe9lectrom\xe9nager","bank_details":"RIB","bank_statement":"Relev\xe9 de compte |||| Relev\xe9s de compte","birth_certificate":"Acte de naissance |||| Actes de naissance","building_permit":"Permis de construire","caf":"Attestation de quotient familial CAF |||| Attestations de quotient familial CAF","car_insurance":"Attestation d\'assurance auto |||| Attestations d\'assurance auto","citizen_registration_certificate":"Attestation de recensement citoyen |||| Attestations de recensement citoyen","condition_report":"\xc9tat des lieux - Entr\xe9e/Sortie |||| \xc9tats des lieux - Entr\xe9e/Sortie","diploma":"Dipl\xf4me |||| Dipl\xf4mes","divorce":"Attestation de divorce |||| Attestations de divorce","driver_license":"Permis de conduire","electoral_card":"Carte \xe9lectorale |||| Cartes \xe9lectorales","employment_center_certificate":"Attestation de France Travail |||| Attestations de France Travail","energy_contract":"Contrat de fournisseur d\'\xe9nergies |||| Contrats de fournisseur d\'\xe9nergies","energy_invoice":"Facture d\'\xe9nergie |||| Factures d\'\xe9nergie","expense_claim":"Note de frais |||| Notes de frais","family_record_book":"Livret de famille |||| Livrets de famille","family":"Famille","fidelity_card":"Carte avantage |||| Cartes avantages","fine":"Amende |||| Amendes","gradebook":"Bulletin de notes |||| Bulletins de notes","grocery_invoice":"Facture de courses |||| Factures de courses","health_book":"Carnet de sant\xe9 |||| Carnets de sant\xe9","health_certificate":"Certificat de sant\xe9/vaccination |||| Certificats de sant\xe9/vaccination","health_insurance_card":"Carte de mutuelle |||| Cartes de mutuelle","health_invoice":"Facture m\xe9dicale |||| Factures m\xe9dicales","health":"Sant\xe9","home":"Logement","house_insurance":"Assurance logement |||| Assurances logement","house_sale_agreeement":"Compromis de vente","identity_photo":"Photo d\'identit\xe9 |||| Photos d\'identit\xe9","identity":"Identit\xe9","invoice":"Facture |||| Factures","isp_invoice":"Facture d\'internet |||| Factures d\'internet","large_family_card":"Carte famille nombreuse |||| Cartes famille nombreuse","lease":"Bail |||| Baux","loan_agreement":"Contrat de pr\xeat |||| Contrats de pr\xeat","mechanic_invoice":"Facture de r\xe9paration |||| Factures de r\xe9paration","motivation_letter":"Lettre de motivation |||| Lettres de motivation","national_health_insurance_card":"Carte vitale |||| Cartes vitales","national_health_insurance_right_certificate":"Attestation de droits de l\'Assurance Maladie |||| Attestations de droits de l\'Assurance Maladie","national_id_card":"Carte d\'identit\xe9 |||| Cartes d\'identit\xe9","note_identity_document":"Note Identit\xe9 |||| Notes Identit\xe9","note_family_document":"Note Famille |||| Notes Famille","note_work_document":"Note Travail & \xc9tudes |||| Notes Travail & \xc9tudes","note_health_document":"Note Sant\xe9 |||| Notes Sant\xe9","note_house_document":"Note Logement |||| Notes Logement","note_transport_document":"Note Transport |||| Notes Transport","note_activity_document":"Note Activit\xe9s & loisirs |||| Notes Activit\xe9s & loisirs","note_finance":"Note Finances |||| Notes Finances","note_invoice":"Note Factures |||| Notes Factures","other_activity_document":"Autre document de loisirs |||| Autres documents de loisirs","other_bank_document":"Autre document financier |||| Autres documents financiers","other_family_document":"Autre document de famille |||| Autres documents de famille","other_health_document":"Autre document de sant\xe9 |||| Autres documents de sant\xe9","other_house_document":"Autre document de logement |||| Autres documents de logement","other_identity_document":"Autre document d\'identit\xe9 |||| Autres documents d\'identit\xe9","other_invoice":"Autre facture |||| Autres factures","other_revenue":"Autre revenu |||| Autres revenus","other_tax_document":"Imp\xf4ts - Autre document |||| Imp\xf4ts - Autres documents","other_transport_document":"Autre document de transport |||| Autres documents de transport","other_work_document":"Autre document de travail |||| Autres documents de travail","other_administrative_document":"Autre document administratif |||| Autres documents administratifs","others":"Autres","pacs":"Attestation de PACS |||| Attestations de PACS","passport":"Passeport |||| Passeports","pay_sheet":"Fiche de paie |||| Fiches de paie","payment_proof_family_allowance":"Attestation de paiement CAF |||| Attestations de paiement CAF","pension":"Retraite |||| Retraites","person_insurance":"Attestation d\'assurance individuelle |||| Attestations d\'assurance individuelle","personal_sporting_licence":"Licence sportive |||| Licences sportives","phone_invoice":"Facture de t\xe9l\xe9phone |||| Factures de t\xe9l\xe9phone","pregnancy_medical_certificate":"Certificat de grossesse |||| Certificats de grossesse","prescription":"Ordonnance |||| Ordonnances","real_estate_insurance":"Attestation d\'assurance immobili\xe8re |||| Attestations d\'assurance immobili\xe8re","real_estate_tax":"Imp\xf4ts - Taxe fonci\xe8re |||| Imp\xf4ts - Taxes fonci\xe8res","receipt":"Accus\xe9 de r\xe9ception |||| Accus\xe9s de r\xe9ception","rent_receipt":"Quittance de loyer |||| Quittances de loyer","residence_permit":"Titre de s\xe9jour |||| Titres de s\xe9jour","restaurant_invoice":"Facture de restaurant |||| Factures de restaurant","resume":"CV","school_attendance_certificate":"Certificat de scolarit\xe9 |||| Certificats de scolarit\xe9","school_insurance_certificate":"Attestation d\'assurance scolaire |||| Attestations d\'assurance scolaire","single_parent_benefit":"Allocation parent isol\xe9 |||| Allocations parent isol\xe9","student_card":"Carte d\'\xe9tudiant |||| Cartes d\'\xe9tudiant","tax_certificate":"Attestation fiscale |||| Attestations fiscales","tax_notice":"Imp\xf4ts - Avis d\'imposition","tax_return":"Imp\xf4ts - D\xe9claration de revenus |||| Imp\xf4ts - D\xe9clarations de revenus","tax_timetable":"Imp\xf4ts - Ech\xe9ancier |||| Imp\xf4ts - Ech\xe9anciers","technical_diagnostic_record":"Dossier de diagnostic technique |||| Dossiers de diagnostic technique","telecom_invoice":"Facture de t\xe9l\xe9com |||| Factures de t\xe9l\xe9com","transport_card":"Carte de transport |||| Cartes de transport","transport_invoice":"Facture de transport |||| Factures de transport","transport":"Transport","unemployment_benefit":"Allocation ch\xf4mage |||| Allocations ch\xf4mage","unfit_for_habitation_declaration":"Arr\xeat\xe9 d\'insalubrit\xe9 |||| Arr\xeat\xe9s d\'insalubrit\xe9","vehicle_registration":"Carte grise |||| Cartes grises","water_invoice":"Facture d\'eau |||| Factures d\'eau","web_service_invoice":"Facture de service web |||| Factures de service web","wedding":"Contrat de mariage |||| Contrats de mariage","work_contract":"Contrat de travail |||| Contrats de travail","work_disability_recognition":"Reconnaissance de handicap - RQTH |||| Reconnaissances de handicap - RQTH","work_invoice":"Facture de travaux |||| Factures de travaux","work_quote":"Devis de travaux","work_study":"Travail & \xc9tudes"},"attributes":{"contractType":{"cdi":"CDI","cdd":"CDD","alternate":"Alternance","internship":"Stage","other":"Autre"},"noticePeriod":{"oneWeek":"1 semaine avant","oneMonth":"1 mois avant","threeMonth":"3 mois avant","oneYear":"1 an avant","custom":"Personnalis\xe9","noAlert":"Ne pas \xeatre alert\xe9"}},"themes":{"activity":"Activit\xe9s & loisirs","family":"Famille","finance":"Finances","health":"Sant\xe9","home":"Logement","identity":"Identit\xe9","invoice":"Factures","others":"Autres","transport":"Transport","undefined":"Ind\xe9fini","work_study":"Travail & \xc9tudes"},"expiration":{"expired":"Expir\xe9","expiresIn":"Expire dans %{duration}","description":"Ce document expire dans %{duration}, pensez \xe0 le renouveler"},"qualification":{"date":{"title":{"datetime":"Ajout\xe9 le","AObtentionDate":"Permis A, d\xe9livr\xe9 le","BObtentionDate":"Permis B, d\xe9livr\xe9 le","CObtentionDate":"Permis C, d\xe9livr\xe9 le","DObtentionDate":"Permis D, d\xe9livr\xe9 le","issueDate":"D\xe9livr\xe9 le","expirationDate":"Date d\'expiration","referencedDate":"Date de r\xe9f\xe9rence","shootingDate":"Date de prise de vue","obtentionDate":"Date d\'obtention","date":"Date du document"}},"information":{"title":{"fine":{"number":"Montant de l\'amende"},"fidelity_card":{"number":"Num\xe9ro de la carte"},"caf":{"number":"Num\xe9ro de dossier CAF"},"payment_proof_family_allowance":{"number":"Num\xe9ro de dossier CAF"},"vehicle":{"licenseNumber":"Num\xe9ro d\'immatriculation","confidentialNumber":"Code confidentiel de la carte grise"},"vehicle_registration":{"number":"Num\xe9ro de la carte grise (VIN)"},"national_id_card":{"number":"Num\xe9ro de la carte d\'identit\xe9"},"bank_details":{"number":"Num\xe9ro d\'IBAN"},"passport":{"number":"Num\xe9ro du passeport"},"driver_license":{"number":"Num\xe9ro du permis"},"residence_permit":{"number":"Num\xe9ro du permis"},"national_health_insurance_card":{"number":"Num\xe9ro de s\xe9curit\xe9 sociale"},"pay_sheet":{"number":"R\xe9mun\xe9ration brute"},"tax_return":{"number":"Num\xe9ro fiscal de r\xe9f\xe9rence"},"tax_notice":{"number":"Num\xe9ro fiscal de r\xe9f\xe9rence"},"real_estate_tax":{"number":"Num\xe9ro fiscal de r\xe9f\xe9rence"},"tax_timetable":{"number":"Num\xe9ro fiscal de r\xe9f\xe9rence"},"country":"Pays \xe9metteur du document","refTaxIncome":"Revenu fiscal de r\xe9f\xe9rence","contractType":"Type de contrat","noticePeriod":"Alerte dexpiration","netSocialAmount":"Montant net social","employerName":"Nom de l\'employeur","employer":"Nom de l\'employeur","amount":"Montant de la d\xe9pense","subtype":"Objet de la d\xe9pense","bicNumber":"Num\xe9ro BIC"},"day":"jour |||| jours"},"contact":"Titulaire","page":"Face du document","front":"Face avant","back":"Face arri\xe8re","qualification":"Qualification","noInfo":"Non renseign\xe9(e)"}},"MagicFolders":{"administrative":"Administratif","photos":"Photos"}}')}}]);